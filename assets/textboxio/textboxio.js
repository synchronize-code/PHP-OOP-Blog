/*
 Textbox.io JavaScript Library
 Copyright (c) 2013-2017 Ephox Corp. All rights reserved.
 This software is provided "AS IS," without a warranty of any kind.

 Version: 2.4.1.66
 Client Build: 2.4.1.129
*/
(function(){function su(){return{major:"2",minor:"4",full:"2.4.1.66"}}function TN(){var a=h.none(),b=function(b){a=h.some(b.api)};return{add:function(c){var d=f.curry(b,c);a.isNone()&&b(c);c.api.events.focus.addListener(d)},get:function(){return a},remove:function(b){a.is(b.api)&&(a=h.none())}}}function UN(a,b,c){var d=h.from(a.ui.editorName).map(H.error);c=c.map(H.value);d=d.or(c).getOrThunk(function(){return H.value(VN())});c=tu.toolbar(a.platform.toolbar,b);b=tu.mentions(a.mentions,b);return Z.deepMerge(a,
{ui:{editorName:d},platform:{toolbar:c},mentions:b})}function WN(){var a=[];return{get:function(b){return k.find(a,function(a){return a.is(b)})},findAll:function(b){var c=qa.all(b);return k.filter(a,function(a){return k.exists(c,a.is)})},add:function(b){a.push(b)},remove:function(b){k.indexOf(a,b).each(function(b){a.splice(b,1)})}}}function uu(a,b,c,d,e){return a(c,d)?h.some(c):Q.isFunction(e)&&e(c)?h.none():b(c,d,e)}function lb(a,b){k.each(b,function(b,d){if(d>a.length-1){if(b.required())throw Error('missing parameter "'+
b.name()+'"');}else b.validate(a[d])})}function XN(a){var b=Ej.create(),c=W.map(a,function(a){var c=YN.create();b.bind(a,c.eventTrigger);return c});a=W.map(c,function(a){return a.eventRegistry});c=W.map(c,function(a){return a.eventTrigger});return{registry:a,trigger:c,destroy:function(){b.unbindAll()}}}function ZN(){var a={};return{getOrSetIndexed:function(b,c){if(void 0!==a[b])return a[b];var d=c();return a[b]=d},waitForLoad:function(){var b=W.values(a);return Ic.par(b)}}}function vu(){var a=ZN(),
b=function(){return a.waitForLoad()};return{preload:function(){b().get(f.identity)},addStylesheet:function(b,d){return a.getOrSetIndexed(b,function(){return $N.download(b,d)})},addScript:function(b,d){return a.getOrSetIndexed(b,function(){return aO.download(b).map(d)})},waitForLoad:b}}function bO(a){var b=function(b,c,g){lb(arguments,[V.func("filter"),V.string("selector"),V.func("callback")]);var l=b(c,wu(g));a.filter().customFilters().addFilter(l)},c=function(b,c,g){lb(arguments,[V.func("filter"),
V.func("predicate"),V.func("callback")]);var l=b(cO(c),wu(g));a.filter().customFilters().addFilter(l)};return{selector:{addInput:f.curry(b,sh.inputSelector),addOutput:f.curry(b,sh.outputSelector)},predicate:{addInput:f.curry(c,sh.inputPredicate),addOutput:f.curry(c,sh.outputPredicate)}}}function Nn(a,b,c,d){return{term:function(){return RegExp(a,d.getOr("g"))},prefix:b,suffix:c}}function dO(a,b,c){var d=cb.sanitise(a),e=cb.sanitise(b);return{patterns:function(){return[RegExp(d+"(.*?)"+e,"gi")]},useCursor:f.always,
generate:function(a,b){return c.generate(a,b.key(),b.value())},derive:function(a){var b=a[1];return c.get(b).map(function(c){return{startIndex:f.constant(a.index),finishIndex:f.constant(a.index+a[0].length),key:f.constant(b),value:f.constant(c)}})}}}function xu(a,b,c){return dO(a,b,{get:function(a){a=c(a);return h.some(a)},generate:function(a,b,c){a=Ld.fromHtml(c,a.dom());return cd.species({elements:f.constant(a),cursor:h.none,dictation:h.none,notify:h.none})}})}function yu(a,b){var c=function(a){try{return d(a)}catch(b){return h.none()}},
d=function(b){return a(b)?h.from(b.dom().nodeValue):h.none()},e=Y.detect().browser,g=e.isIE()&&10===e.version.major?c:d;return{get:function(c){if(!a(c))throw Error("Can only get "+b+" value of a "+b+" node");return g(c).getOr("")},getOption:g,set:function(c,d){if(!a(c))throw Error("Can only set raw "+b+" value of a "+b+" node");c.dom().nodeValue=d}}}function Sa(){return{up:f.constant({selector:I.ancestor,closest:I.closest,predicate:sa.ancestor,all:y.parents}),down:f.constant({selector:X.descendants,
predicate:lc.descendants}),styles:f.constant({get:t.get,getRaw:t.getRaw,set:t.set,remove:t.remove}),attrs:f.constant({get:m.get,set:m.set,remove:m.remove,copyTo:function(a,b){var c=m.clone(a);m.setAll(b,c)}}),insert:f.constant({before:v.before,after:v.after,afterAll:J.after,append:v.append,appendAll:J.append,prepend:v.prepend,wrap:v.wrap}),remove:f.constant({unwrap:B.unwrap,remove:B.remove}),create:f.constant({nu:q.fromTag,clone:function(a){return q.fromDom(a.dom().cloneNode(!1))},text:q.fromText}),
query:f.constant({comparePosition:function(a,b){return a.dom().compareDocumentPosition(b.dom())},prevSibling:y.prevSibling,nextSibling:y.nextSibling}),property:f.constant({children:y.children,name:A.name,parent:y.parent,isText:A.isText,isComment:A.isComment,isElement:A.isElement,getText:Fa.get,setText:Fa.set,isBoundary:function(a){return A.isElement(a)?"body"===A.name(a)?!0:k.contains(eO,A.name(a)):!1},isEmptyTag:function(a){return A.isElement(a)?k.contains(["br","img","hr","input"],A.name(a)):!1}}),
eq:L.eq,is:L.is}}function fO(a,b,c){var d=XN({loaded:a.events.loaded,focus:a.events.focus,change:a.events.change,dirty:a.events.dirty,internal:a.events.internal}),e=function(a,b){var c=y.owner(a),d=y.defaultView(a),c=Ga.get(c),e=b();d.dom().scrollTo(c.left(),c.top());return e},g=f.curry(On.getText,a),l=Fj.makeReadOnly({content:{documentElement:f.curry(Jc.documentElement,a),insertHtmlAtCursor:f.curry(Jc.insertHtmlAtCursor,a),uploadImages:f.curry(Jc.uploadImages,a),get:f.curry(Jc.get,a),set:f.curry(Jc.set,
a),isDirty:f.curry(Jc.isDirty,a),setDirty:f.curry(Jc.setDirty,a),selection:{findTagAtCursor:f.curry(On.findTagAtCursor,a),getText:g,getHtml:f.curry(On.getHtml,a)},getSelectedText:g},mode:{set:f.curry(zu.set,a),get:f.curry(zu.get,a)},filters:bO(a),macros:{addSimpleMacro:f.curry(Au.addSimpleMacro,a),removeMacro:f.curry(Au.removeMacro,a)},message:f.curry(gO.message,a),events:d.registry,element:function(){return a.element().dom()},focus:a.focus,restore:xb.cached(function(){return e(a.element(),function(){hO.blur();
var b=Jc.get(a);d.destroy();a.destroy();return c.restore(b)})})});k.each(b,function(a){Pn.hookup(l,a)});return l}function iO(){var a=TN(),b=WN(),c=function(a){return a.api},d=function(c,d){var l=UN(d.options(),function(){return p.getOrDie("Internal Error")},h.from(m.get(c,"id"))),p=jO.one(c,d.constructors(),l).map(function(d){var g=fO(d.polish,l&&l.plugins?l.plugins:[],{restore:function(c){b.remove(p);a.remove(p);return d.restore(c).dom()}}),p={is:function(a){return L.eq(c,a)},api:g};b.add(p);a.add(p);
return g});return p};return{getOrCreate:function(a,g){return b.get(a).map(c).orThunk(function(){return d(a,g)})},get:function(a){a=b.findAll(a);return k.map(a,c)},getActiveEditor:a.get}}function Qn(a,b,c){var d=c||!1,e=function(){b();d=!0},g=function(){a();d=!1};return{on:e,off:g,toggle:function(){(d?g:e)()},isOn:function(){return d}}}function r(a){var b=C.immutable.apply(null,a),c=[];return{bind:function(a){if(void 0===a)throw"Event bind error: undefined handler";c.push(a)},unbind:function(a){c=
k.filter(c,function(b){return b!==a})},trigger:function(){var a=b.apply(null,arguments);k.each(c,function(b){b(a)})}}}function Bu(a,b){var c=function(c){var d=b(c);return 0>=d||null===d?(c=t.get(c,a),parseFloat(c)||0):d},d=function(a,b){return k.foldl(b,function(b,c){var d=t.get(a,c),d=void 0===d?0:parseInt(d,10);return isNaN(d)?b:b+d},0)};return{set:function(b,c){if(!Q.isNumber(c)&&!c.match(/^[0-9]+$/))throw a+".set accepts only positive integer values. Value was "+c;var d=b.dom();Md.isSupported(d)&&
(d.style[a]=c+"px")},get:c,getOuter:c,aggregate:d,max:function(a,b,c){a=d(a,c);return b>a?b-a:0}}}function Kc(a){return k.mapToObject(a,function(){return{bind:f.noop,unbind:f.noop}})}function Cu(a){a=xa(a.dirty);var b=a.get,c=a.set,d=D.create({dirty:r([]),clean:r([])}),e=Lc.tap(function(a){var l=b();a!==l&&(c(a),!0===a?d.trigger.dirty():(e.control.block(),d.trigger.clean(),e.control.unblock()))});return{events:d.registry,isDirty:b,setDirty:e.instance,state:function(){return{dirty:b()}}}}function Du(a,
b,c){var d=[],e=f.curry(b,"input"),g=f.curry(b,"output"),l=f.curry(c,"input"),p=f.curry(c,"output");b=function(a){sh.cata(a,e,g,l,p);d.push(a)};k.each(a.customs,b);return{state:function(){return{customs:d.slice(0)}},addFilter:b}}function Rn(a){var b={};W.each(a,function(a,d){b[d]=a});return{get:function(){return W.values(b)},add:function(a){var d=Ma.generate("macro");b[d]=a;return d},remove:function(a){delete b[a]},state:function(){return Z.merge({},b)}}}function kO(){var a=f.noop;return Sn({setAutocorrect:f.noop,
setSpelling:f.noop,events:Kc(["analytics"]),init:function(b){b.body().each(function(b){m.set(b,"spellcheck","false");a=function(){m.remove(b,"spellcheck")}})},ui:h.none,check:f.noop,scanView:f.noop,situation:kf.noSituation,hasDropdown:f.constant(!1),hasAutocorrect:f.constant(!1),handle:f.noop,assign:f.noop,lock:f.apply,destroy:function(){a()},state:f.constant({}),lookup:f.constant(h.none()),name:f.constant("spelling-disabled")})}function K(a,b){var c=r(a),d=0,e=function(b){var d=k.map(a,function(a){return b[a]()});
c.trigger.apply(null,d)};return{bind:function(a){c.bind(a);d++;1===d&&b.bind(e)},unbind:function(a){c.unbind(a);d--;0===d&&b.unbind(e)},trigger:f.die("Cannot trigger a source event.")}}function Eu(a,b,c){var d=Aa.state(c),e=h.none(),g=h.none(),l=D.create({loaded:r([]),focus:r([]),dirty:K([],d.laundry.events.dirty),change:r([]),internal:r(["command","data"]),paint:r(["dimensions"])}),p=P.div();ea.add(p,[w.resolve("source-container"),"ephox-textbox-font",w.resolve("layer-editor")]);c=function(){return p};
var s=function(){return g.getOrDie("CodeMirror not added to DOM")},z=function(a){return R()?Fu.beautify(a):a},x=function(a){var b=s().doc;a=z(a);b.setValue(a);b.clearHistory()},M=function(a){var b=q.fromDom(a.getWrapperElement()),c=-1;a.on("changes",function(){var d=a.doc.lineCount();d!=c&&(c=d,d=a.getScrollInfo(),d=Gu({width:ra.get(b),docWidth:d.width,height:d.height,docHeight:d.height}),l.trigger.paint(d))})},k=function(){s().focus()},R=function(){return!0===a.content.prettyprint};return uh.internal({activateInline:Mc.activateInline,
blur:f.die("blur is not supported in the API."),communication:Aa.communication,connect:function(c){if(a.content&&!0===a.content.autoresize){var d=c.dom().clientHeight;ha.set(p,d)}v.append(c,p);b.updateUi(p);vh.detect(p);c=Gj.use.codemirror()(p.dom(),{mode:"text/html",extraKeys:{"Ctrl-Space":"autocomplete"},lineWrapping:!0});c.on("focus",function(){l.trigger.focus()});g=h.some(c);l.trigger.loaded();M(c);return!0},content:f.constant({body:f.constant(h.none()),doc:f.die("content.doc is not supported in code view"),
execCommand:f.die("content.execCommand is not supported in code view"),getSelectedText:function(){var a=s().getSelection();return void 0!==a&&null!==a&&0<a.length?h.some(a):h.none()},focus:k,isInline:f.constant(!1)}),deactivateInline:Mc.deactivateInline,destroy:function(){B.remove(p);B.empty(p);g=h.none()},element:c,events:l.registry,filter:d.filter,focus:k,fromTransfer:function(a){var b=function(a){x(a);e=h.some(a);g.each(function(a){a.on("changes",function(a,b){d.laundry.setDirty(!0);l.trigger.change()})})};
we.cata(a,b,b)},fullscreen:Aa.fullscreen,getContent:function(){return s().doc.getValue()},getMode:yb.code,insertHtmlAtCursor:function(a){s().replaceSelection(a)},isDirty:d.laundry.isDirty,isPrettyPrinting:R,keyboard:Mc.keyboard,macros:d.macros,operations:Mc.operations,setContent:function(a){x(a);d.laundry.setDirty(!1)},setDirty:d.laundry.setDirty,smartview:Mc.smartview,state:function(){return d.getState({content:{}})},toTransfer:function(){var a=s().doc.getValue();return e.filter(function(b){return z(b)===
a}).fold(function(){return we.changed(a)},we.unchanged)},ui:Mc.ui,undo:f.constant(Aa.undo()),uploader:f.constant(Aa.uploader()),viewport:c})}function lO(a){var b=P.span();n.add(b,ia.resolve("toolbar-group"));var c=k.map(a,function(a){return a.component()});J.append(b,c);return Hu.group({component:function(){return b},isVisible:function(){return k.exists(c,wh.isShowing)},refreshUi:function(){k.each(a,function(a){a.refreshUi()})},destroy:function(){k.each(a,function(a){a.destroy()})}})}function Tn(a,
b,c){n.add(a,Ta.resolve("button"));var d=mO.disable(a);b=b.getOr(a);var e=null,g=n.toggler(a,Ta.resolve("button-disabled")),l=function(){g.isOn()||f.trigger.click()},p=E.bind(b,"click",l),f=D.create({click:r([])});return{element:function(){return a},name:function(){return c},destroy:function(){p.unbind();d.unbind();B.remove(a)},content:function(b){null!==e&&B.remove(e.element());v.append(a,b.element());e=b},enable:g.off,disable:g.on,disabled:g.isOn,click:l,events:f.registry}}function Yb(a){var b=
q.fromTag("span");n.add(b,Ta.resolve("independent-button"));return Tn(b,h.none(),a)}function Nd(a){var b=P.span();m.set(b,"aria-hidden",!0);ea.add(b,[Ta.resolve("icon-content")].concat(a));return{element:function(){return b},destroy:function(){B.remove(b)}}}function Un(a){var b=P.span();n.add(b,Ta.resolve("statebutton"));var c=Tn(P.span(),h.some(b),a);n.add(c.element(),Ta.resolve("dependent-button"));v.append(b,c.element());a=n.toggler(b,Ta.resolve("statebutton-selected"));var d=n.toggler(b,Ta.resolve("statebutton-disabled"));
return{element:function(){return b},destroy:function(){c.destroy();B.remove(b)},name:c.name,content:c.content,enable:function(){d.off();c.enable()},disable:function(){d.on();c.disable()},disabled:function(){return d.isOn()&&c.disabled()},click:c.click,events:c.events,select:a.on,deselect:a.off,selected:a.isOn}}function dd(a){var b=Un(a),c=D.create({click:r([])}),d=function(){b.selected()?b.deselect():b.select();c.trigger.click()};b.events.click.bind(d);return{element:b.element,name:b.name,content:b.content,
destroy:function(){b.events.click.unbind(d);b.destroy()},enable:b.enable,disable:b.disable,disabled:b.disabled,click:b.click,events:c.registry,select:b.select,deselect:b.deselect,selected:b.selected}}function nO(a){var b=P.span();n.add(b,Ta.resolve("dropbutton"));var c=P.span();n.add(c,Ta.resolve("dropbutton-button"));var d=P.span();n.add(d,Ta.resolve("dropbutton-arrow"));J.append(b,[c,d]);var e=Yb(),g=dd();g.content(Nd(["ephox-pastry-arrow-icon"]));v.append(c,e.element());v.append(d,g.element());
var l=D.create({click:r([]),open:r([]),close:r([])}),p=function(){l.trigger.click()},f=function(){(g.selected()?l.trigger.open:l.trigger.close)()};e.events.click.bind(p);g.events.click.bind(f);return{element:function(){return b},name:function(){return a},content:e.content,events:l.registry,open:function(){g.select();l.trigger.open()},close:function(){g.deselect();l.trigger.close()},destroy:function(){e.events.click.unbind(p);g.events.click.unbind(f);e.destroy();g.destroy();B.remove(b)},isOpen:function(){return g.selected()}}}
function oO(a){var b=P.span();n.add(b,Ta.resolve("dropbutton"));var c=P.span();n.add(c,Ta.resolve("dropbutton-button"));var d=P.span();n.add(d,Ta.resolve("dropbutton-arrow"));J.append(b,[c,d]);var e=dd(),g=dd();g.content(Nd(["ephox-pastry-arrow-icon"]));v.append(c,e.element());v.append(d,g.element());var l=D.create({click:r([]),open:r([]),close:r([])}),p=function(){l.trigger.click()},s=function(){(g.selected()?l.trigger.open:l.trigger.close)()};e.events.click.bind(p);g.events.click.bind(s);return{element:f.constant(b),
name:f.constant(a),content:e.content,events:l.registry,open:function(){g.select();l.trigger.open()},close:function(){g.deselect();l.trigger.close()},destroy:function(){e.events.click.unbind(p);g.events.click.unbind(s);e.destroy();g.destroy();B.remove(b)},isOpen:function(){return g.selected()},click:e.click,enable:e.enable,disable:e.disable,disabled:e.disabled,select:e.select,deselect:e.deselect,selected:e.selected}}function mc(a){var b=P.span();n.add(b,Ta.resolve("text-content"));v.append(b,q.fromText(a));
return{element:function(){return b},destroy:function(){B.remove(b)}}}function Hj(a){var b=md.resolve(a);return{set:function(a){n.add(a,b)},up:function(a){return n.has(a,b)?h.some(a):I.ancestor(a,"."+b)},all:function(a){return X.descendants(a,"."+b)},first:function(a){return I.descendant(a,"."+b)},is:function(a){return n.has(a,b)}}}function Iu(a,b){var c=void 0!==b?b:"info",d=P.div();ea.add(d,[w.resolve("banner"),w.resolve("banner-"+c)]);c=P.div();n.add(c,w.resolve("banner-message"));v.append(c,q.fromText(a));
var e=P.div();n.add(e,w.resolve("banner-buttons"));var g=q.fromTag("span");n.add(g,w.resolve("banner-close"));v.append(e,g);O.button(g,u.translate("banner.close"));J.append(d,[c,e]);var l=E.bind(g,"click",function(){p.trigger.close()}),p=D.create({close:r([])});return{element:function(){return d},action:function(a){v.prepend(e,a.element())},destroy:function(){l.unbind();B.remove(d)},events:p.registry}}function xh(a,b){var c=void 0!==b?b:"error",d=a.description(),e=a.link(),g=Iu(d,c),l=h.none(),p=
function(a,b){return E.bind(a,"click",function(a){a.kill();window.open(b.url())})},c=function(a){var b=q.fromTag("a");m.set(b,"href",a.url());m.set(b,"target","_blank");var c=q.fromText(a.text());l=h.some(p(b,a));v.append(b,c);g.action({element:f.constant(b)})};null!==e&&e.url()&&e.text()&&c(e);return{element:g.element,action:g.action,destroy:function(){g.destroy();l.each(function(a){a.unbind()})},events:g.events}}function pO(a,b){var c=D.create({populate:r(["items"])}),d=function(b){var c=a(b.textkey),
c=ab.item(qO,b.name+"-menu-trigger",c);n.add(c,ia.resolve("menu-more"));b=yh.generate("ephox-chameleon-"+b.name);J.prepend(c,b);O.menuItem(c,h.none(),h.some(!0));return c}(b),e=function(a){a=q.fromText(a);g(a)},g=function(a){I.child(d,".ephox-gopher-item-text").each(function(b){B.empty(b);v.append(b,a);n.remove(b,Ju)})},l=$f.control(d);return{element:f.constant(d),populate:function(a){c.trigger.populate(a)},select:function(c){I.child(d,Oa.tokenSelector()).each(B.remove);var g=Oa.describe(d,b.describe(c));
v.append(d,g);c=a(c.textkey());e(c)},selectElement:g,disable:l.disable,enable:l.enable,clear:function(){e(a(b.textkey));I.child(d,".ephox-gopher-item-text").each(function(a){n.add(a,Ju)})},destroy:function(){B.remove(d)},events:c.registry}}function rO(a,b){var c=b?a.slice(0):[],d=b,e=b?k.map(W.values(N),function(a){return a()}):[];return{swallowShortcuts:function(a){c=a.slice(0)},yieldShortcuts:function(a){c=k.difference(c,a)},swallowChars:function(){d=!0},yieldChars:function(){d=!1},swallowKeys:function(a){e=
a.slice(0)},yieldKeys:function(a){e=k.difference(e,a)},process:function(a,b){a.fold(function(a){k.contains(c,a)&&b()},function(a){k.contains(e,a)&&b()},function(){d&&b()})}}}function sO(a,b){var c=!1,d=rO(a,b);return{on:function(){c=!0},off:function(){c=!1},isOn:function(){return c},handle:function(a){return function(b){c&&a(b.raw())}},stop:function(b){var c=tO.identify(b,a);d.process(c,f.curry(Ku.stop,b))},swallowShortcuts:d.swallowShortcuts,yieldShortcuts:d.yieldShortcuts,swallowChars:d.swallowChars,
yieldChars:d.yieldChars,swallowKeys:d.swallowKeys,yieldKeys:d.yieldKeys}}function zh(a){var b=Z.merge({shortcuts:[],swallow:!1},a),c=D.create({character:r(["character"]),space:r(["shift","stopper"]),left:r(["shift","stopper"]),right:r(["shift","stopper"]),backspace:r(["shift","stopper"]),tab:r(["shift","stopper"]),enter:r(["shift","stopper"]),capslock:r(["shift","stopper"]),escape:r(["shift","stopper"]),pageup:r(["shift","stopper"]),pagedown:r(["shift","stopper"]),end:r(["shift","stopper"]),home:r(["shift",
"stopper"]),down:r(["shift","stopper"]),up:r(["shift","stopper"]),insert:r(["shift","stopper"]),del:r(["shift","stopper"]),command:r(["command"])}),d=sO(b.shortcuts,b.swallow),e=function(a){return k.find(b.shortcuts,function(b){return Lu.isCommand(a,b)})},g=function(a,b,d){p(a);c.trigger[b].apply(void 0,d)},l=function(a){return function(){d.isOn()&&Ku.stop(a)}};a=d.handle(function(a){e(a).fold(function(){var b=nf.getSpecial(a.keyCode);nf.noModifiers(a)&&null!==b&&(b=b.toLowerCase(),g(a,b,[a.shiftKey,
l(a)]))},function(b){g(a,"command",[b])})});var p=function(a){d.isOn()&&d.stop(a)},f=d.handle(function(a){if(nf.noModifiers(a))nf.isCharCode(a)||null===nf.getSpecial(a.keyCode)?e(a).isSome()?p(a):a.which&&g(a,"character",[String.fromCharCode(a.which)]):p(a);else return!1});return{off:d.off,on:d.on,events:c.registry,swallowShortcuts:d.swallowShortcuts,yieldShortcuts:d.yieldShortcuts,swallowChars:d.swallowChars,yieldChars:d.yieldChars,swallowKeys:d.swallowKeys,yieldKeys:d.yieldKeys,keypress:f,keydown:a}}
function uO(a){var b=D.create({mouseover:r(["item"]),click:r(["item"])}),c=[],d=zh({shortcuts:a.shortcuts,swallow:a.swallow});a=a.tabs?[N.TAB()]:[];d.swallowKeys([N.UP(),N.DOWN(),N.ENTER(),N.SPACE(),N.ESCAPE()].concat(a));var e=function(){k.each(c,function(a){a.mouseover().unbind();a.click().unbind();a.keydown().unbind()});c=[];d.off()};return{destroy:function(){e()},attach:function(a){e();c=k.map(a,function(a){var c=E.bind(a,"mouseover",function(a){Rb.up(a.target()).each(b.trigger.mouseover)}),e=
E.bind(a,"click",function(a){Rb.up(a.target()).each(b.trigger.click)});a=E.bind(a,"keydown",function(a){d.keydown(a)});return{mouseover:f.constant(c),click:f.constant(e),keydown:f.constant(a)}});d.on()},detach:e,simulateKey:function(a){d.keydown(a)},events:b.registry,keys:d.events}}function vO(a,b){var c=D.create({select:r(["item"]),active:r(["item"]),show:r(["menu"]),hide:r(["menu"]),collapse:r(["menu"]),expand:r(["menu","trigger"]),escaped:r([])}),d=uO({shortcuts:[],swallow:[],tabs:b.tabs}),e={},
g=function(b){Nc.activate(a,b)},l=function(){var b=Nc.inactive(a);k.each(b,function(a){xe.submenu().is(a)&&c.trigger.hide(a)})},p=function(b){Rb.isEnabled(b)&&Nc.submenu(a,e,b).each(function(a){c.trigger.expand(a,b)})},s=function(a){Nc.up(a).each(function(b){g(b);Oc.selectAll(b,[a]);c.trigger.active(a)})},z=function(b){Nc.active(a).bind(function(a){Oc.selected(a).orThunk(function(){return Vn.first(a)}).each(function(c){b(a,c)})})},x=function(a){z(function(b,c){Rb.isEnabled(c)&&a(b,c)})},h=function(b){z(function(d,
g){b(d,g).each(function(b){L.eq(g,b)||(Nc.submenu(a,e,g).each(c.trigger.collapse),c.trigger.active(b))})})},G=f.curry(h,Vn.prev),R=f.curry(h,Vn.next),Da=function(){xe.main().first(a).each(function(a){g(a);Oc.selected(a).each(c.trigger.active)})},na=function(b){T.active().fold(b.stopper(),function(a){!1===k.contains(["input"],A.name(a))&&b.stopper()()});x(function(b,d){Nc.submenu(a,e,d).fold(function(){xe.submenu().is(b)&&(c.trigger.collapse(b),Da())},function(a){c.trigger.expand(a,d);Oc.none(a);Oc.first(a).each(c.trigger.active);
g(a)})})},h=function(a){T.active().fold(a.stopper(),function(b){!1===k.contains(["input"],A.name(b))&&a.stopper()()});x(function(a,b){xe.submenu().is(a)&&(c.trigger.collapse(a),Da())})},m=function(a){x(function(b,d){var g=Rb.get(d);e.hasOwnProperty(g)&&void 0!==e[g]?na(a):c.trigger.select(d)})},n=function(a){a.shift()?G(a):R(a)};d.keys.up.bind(G);d.keys.down.bind(R);b.tabs&&d.keys.tab.bind(n);d.keys.enter.bind(m);d.keys.space.bind(m);d.keys.escape.bind(function(a){a.stopper()();z(function(a,b){xe.submenu().is(a)?
(c.trigger.collapse(a),Da()):c.trigger.escaped()})});"ltr"===Od.getDirection(a)?(d.keys.left.bind(h),d.keys.right.bind(na)):(d.keys.right.bind(h),d.keys.left.bind(na));d.events.mouseover.bind(function(b){b=b.item();Oc.is(b)&&Nc.submenu(a,e,b).forall(Sb.isVisible)||(s(b),l(),p(b))});d.events.click.bind(function(a){a=a.item();var b=Rb.get(a);e.hasOwnProperty(b)&&void 0!==e[b]||!Rb.isEnabled(a)||c.trigger.select(a)});return{destroy:function(){d.destroy()},populate:function(a){e=Z.merge({},a)},on:function(a){a=
void 0!==a?a:[q.fromDom(document)];d.attach(a)},off:function(){d.detach()},selectFirst:function(){Nc.active(a).each(function(a){Oc.none(a);Oc.first(a).each(c.trigger.active)})},select:function(a){s(a);l()},setActiveMenu:g,simulateKey:d.simulateKey,state:function(){return Nc.active(a).bind(function(a){return Oc.selected(a).map(function(b){return{menu:f.constant(a),item:f.constant(b)}})})},events:c.registry}}function Wn(a,b,c){var d=P.div();n.add(d,ia.resolve("menu-"+b()+"-sandbox"));m.set(d,"tabindex",
-1);v.append(a(),d);var e=h.none(),g=vO(d,{tabs:!0}),l=xa({}),p=function(){g.off();x();z.trigger.close()},s=function(a){var b=W.mapToArray(l.get(),C.immutable("submenu","item")),c=m.get(a,"data-ephox-gopher-menu-value");return k.find(b,function(a){return a.submenu()===c}).bind(function(b){return I.descendant(d,"[data-ephox-gopher-item-value="+b.item()+"]").map(function(b){return{menu:f.constant(a),item:f.constant(b)}})})};a=function(a){var b=s(a.menu()).map(function(a){return a.item()});z.trigger.collapse(a.menu(),
b)};var z=D.create({open:r([]),close:r([]),itemAction:r(["value","item"]),itemHover:K(["item"],g.events.active),reveal:K(["menu","trigger"],g.events.expand),collapse:r(["menu","item"]),escaped:K([],g.events.escaped)});g.events.hide.bind(a);g.events.collapse.bind(a);g.events.escaped.bind(function(){g.state().fold(p,function(a){s(a.menu()).fold(function(){p()},function(a){z.trigger.collapse(a.menu(),h.some(a.item()));g.select(a.item())})})});g.events.select.bind(function(a){a=a.item();var b=m.get(a,
"data-ephox-gopher-item-value");z.trigger.itemAction(b,a)});g.events.active.bind(function(a){c.focusActive()&&T.focusInside(a.item())});var x=function(){W.each(l.get(),function(a,b){I.descendant(d,'[data-ephox-gopher-menu-value="'+a+'"]').each(function(a){var c=I.descendant(d,'[data-ephox-gopher-item-value="'+b+'"]');z.trigger.collapse(a,c)})})};return{update:function(a){l.set(a);g.populate(a)},setActiveMenu:function(a){e=h.from(a);g.setActiveMenu(a);g.selectFirst()},getActiveMenu:function(){return e},
structure:l,destroy:function(){p();g.destroy()},open:function(a,b){T.focus(b);g.on(a);z.trigger.open()},close:p,events:z.registry,sandbox:f.constant(d),select:g.select,simulateKey:g.simulateKey}}function ag(a,b){return{southeast:f.constant(Ba(-a,b)),southwest:f.constant(Ba(a,b)),northeast:f.constant(Ba(-a,-b)),northwest:f.constant(Ba(a,-b))}}function Ij(){return{northwest:function(){return Ba(-2,1)},northeast:function(){return Ba(0,1)},southwest:function(){return Ba(-2,-2)},southeast:function(){return Ba(0,
-2)}}}function Mu(a,b,c){c=c||[q.fromDom(document)];var d=[],e=function(c){var d=b();c=c.target();L.member(c,d)||wO.anyAncestor(c,d)||a(c)};return{on:function(){k.each(c,function(a){d.push(E.bind(a,"mousedown",e).unbind)})},off:function(){k.each(d,f.apply)},mousedown:e}}function xO(a){var b=Z.merge({layerClass:null,zindex:null},a),c=P.div();n.add(c,Ta.resolve("panel"));t.setAll(c,{position:"fixed",display:"none",top:"0px"});b.zindex&&t.set(c,"z-index",b.zindex);b.layerClass&&n.add(c,b.layerClass);
a=void 0!==a.container?a.container:I.first("body").getOrDie();v.append(a,c);a=Sb.displayToggler(c,"block");return{element:function(){return c},destroy:function(){B.remove(c)},content:function(a){B.empty(c);v.append(c,a)},show:a.on,hide:a.off,toggle:a.toggle}}function Ah(a,b,c,d,e){var g=[],l=function(){var a=k.map(g,function(a){return a.popup().panel()}).concat(d);k.each(g,function(b){b.popup().setComponents(a)})},p=function(a){var b=Jj.get(g,a,Kj(a)).fold(function(){return z(a)},function(a){return a.popup()});
l();g=Jj.put(g,a,b,Nu,Kj(a));return b},s=function(a){Jj.get(g,a,Kj(a)).each(function(a){a.popup().close()});t.set(a,"display","none")},z=function(b){var c=yO.create(a,e);c.setContent(b);g=Jj.put(g,b,c,Nu,Kj(b));l();return c};return{initMenu:z,registerMenus:function(a){g=zO.triage(g);return k.map(a,p)},hideAll:function(){k.each(g,function(a){s(a.menu())})},hideMenu:s,expandMenu:function(d,e){var g=p(d),l=db.descendant(d,"."+Lj.styles())?Pd.expandable():Pd.anchored(),l=of.submenu(a,b,f.constant(e),
c.uiDirection(),l);t.set(d,"display","block");g.open();l.recalculate(g);return{popup:g,anchorage:l}}}}function Ou(a,b){var c=P.span();ea.add(c,[Ta.resolve("righticon-content"),b]);v.append(c,a);return{element:function(){return c},destroy:function(){B.remove(c)}}}function AO(a,b){var c=mc(a),d=Ou(c.element(),b);return{element:d.element,destroy:function(){c.destroy();d.destroy()}}}function BO(a,b,c,d,e,g,l,p,s,z){var x=dd(c);l=Xn.control(x);ea.add(x.element(),[ia.resolve("dropdown-button"),ia.resolve(c+
"-dropdown-button")]);m.set(x.element(),"title",p(d));O.toolbarButton(x.element(),p(d),!0,s);var h=Wn(a.uiContainer,f.constant("dropdown-"+c),Bh.menu({focusActive:!0})),G=q.fromDom(document),R=ab.mainmenu(G,c+"-menu",[]),Da=Ah(h.sandbox,a.bounds,b,[x.element()],z).initMenu(R);c=Ij();var na=of.main(a.uiContainer,a.bounds,x.element,c,b.uiDirection(),Pd.anchored());O.menu(R,p(e));var lf=Ma.generate("menu-control");m.set(R,"id",lf);O.controls(x.element(),lf);var th=P.span();n.add(th,ia.resolve("dropdown-viewport"));
x.content({element:f.constant(th)});var mf=function(a,b){var c=b.map(yh.generate).getOr([]);J.prepend(a,c)};b=function(){t(p(d))};var t=function(a){B.empty(th);v.append(th,AO(a,"ephox-pastry-arrow-righticon").element())},u=function(){x.deselect();s&&ga.pressed(x);ga.collapsed(x.element());O.disown(x.element());Da.close();h.close()},w=function(){x.select();s&&ga.pressed(x);ga.expanded(x.element());O.owns(x.element(),lf);Da.open();var b=[a.uiContainer()];h.open(b,x.element())},y=D.create({select:K(["value",
"item"],h.events.itemAction),itemHover:K(["item"],h.events.itemHover),escaped:K([],h.events.escaped),open:r(["menu","popup","anchor"]),close:K([],h.events.close)});x.events.click.bind(function(){(x.selected()?w:u)()});Da.events.close.bind(u);h.events.open.bind(function(){y.trigger.open(R,Da,na);h.update({});DO()||h.setActiveMenu(R)});h.events.escaped.bind(u);b();return{element:f.constant(x.element()),menu:Da.element,list:f.constant(R),click:x.click,populate:function(a){B.empty(R);k.each(a,function(a){a.label().each(function(a){a=
Mj.generateSeparator(G,a,p);v.append(R,a)});k.each(a.items(),function(a){var b=Mj.generateItem(G,a,g,p);O.menuItemCheckbox(b);mf(b,a.icon());v.append(R,b)})})},enable:l.enable,disable:l.disable,close:u,uiStale:Da.uiStale,recalculate:function(){na.recalculate(Da)},clear:b,select:function(a){t(p(a.textkey()));mf(th,a.icon())},selectElement:function(a){a=Ou(a,"ephox-pastry-arrow-righticon");x.content({element:a.element,destroy:f.noop})},tick:f.curry(bg.tick,R),untick:f.curry(bg.untick,R),activate:f.curry(bg.activate,
x.element()),deactivate:f.curry(bg.deactivate,x.element()),destroy:function(){h.destroy();x.destroy()},events:y.registry}}function EO(a){var b=Pu.menu(a);return{widget:b.widget,menu:b.menu,general:b.general,"inline-widget":function(a){return b["inline-widget"]({instance:function(){return a.instance(Yn.menu())}})},"split-widget":b["split-widget"],dropdown:b.dropdown,palette:b.palette}}function FO(a,b,c,d,e,g,l){var p=Pu.toolbar(g,c,l,pf.editorContainer()),s=function(s){return f.curry(s,p,a,b,c,d,e,
g,l)};return{widget:s(Zn.widget),"inline-widget":s(Zn.inlineWidget),"split-widget":s(Zn.splitWidget),cards:p.cards,general:s(GO.init),dropdown:s(HO.init),menu:s(IO.init),palette:p.palette}}function JO(a){var b=Un("overflower");n.add(b.element(),ia.resolve("more-button"));b.content(mc(a("toolbar.more")));var c=ye.onButton(b);m.set(b.element(),"tabindex","-1");a=a("aria.label.more");m.set(b.element(),"title",a);var d=qf.aria(b,a,!0,!0),e=$n.toolbar([{component:b.element,destroy:b.destroy,refreshUi:f.noop}]);
return{group:e.component,select:function(){b.select();d.press()},deselect:function(){d.release();b.deselect()},focus:function(){T.focus(b.element())},destroy:function(){c.unbind();d.destroy();e.destroy()},events:b.events}}function Qu(a){var b=[];return{add:function(c,d){var e=d?a.indexOf(b,d).getOrDie():b.length;b.splice(e,0,c);return Ru(c,e)},remove:function(c){var d=a.resolve(b,c).getOrDie();return k.indexOf(b,d).bind(function(a){b.splice(a,1);return Ru(d,a)})},get:function(){return b.slice(0)},
itemAt:function(c){return a.resolve(b,c)}}}function Su(a){var b=function(a,b){return Q.isNumber(b)?c(a,b):Q.isString(b)?d(a,b):Q.isObject(b)?e(a,b):H.error("Unsupported specifier type: "+b)},c=function(a,b){return 0===a.length?H.error("Items is empty"):0>b||b>=a.length?H.error("Item index: "+b+" is out of range (0-"+(a.length-1)+")"):H.value(a[b])},d=function(b,c){return k.find(b,function(b){return a(b)===c}).fold(function(){return H.error("No item with value: ["+c+"]")},function(a){return H.value(a)})},
e=function(a,b){return k.indexOf(a,b).fold(function(){return H.error("Specified object is not a registered item: "+b)},function(a){return H.value(b)})};return{resolve:b,indexOf:function(a,c){return b(a,c).bind(function(b){return k.indexOf(a,b).fold(function(){return H.error("Item not found: "+c)},function(a){return H.value(a)})})},index:c,value:d,item:e}}function KO(a,b){var c=D.create({grow:r([]),shrink:r([]),exit:r([])}),d=Qu(Su(f.identity)),e=q.fromTag("div");t.set(e,"overflow-x","auto");n.add(e,
ia.resolve("toolstrip"));O.toolbarGroup(e);var g=q.fromTag("div");ea.add(g,[ia.resolve("toolbar"),ia.resolve("toolbar-primary")]);var l=q.fromTag("div");ea.add(l,[ia.resolve("toolbar"),ia.resolve("toolbar-more")]);v.append(e,g);v.append(e,l);var p=function(){var a=d.get();return k.bind(a,function(a){return a.isVisible()?[a.component()]:[]})},s=function(){var b=p(),b=a.build(b);B.empty(g);B.empty(l);J.append(g,b);t.reflow(g)};return{element:function(){return e},main:f.constant(g),mores:f.constant(l),
destroy:function(){var a=d.get();k.each(a,function(a){a.destroy()})},focused:f.never,enter:f.noop,restore:f.noop,refocus:f.noop,refresh:f.curry(cg.preserve,s,e),repaint:f.curry(cg.preserve,s,e),add:function(a){d.add(a)},events:c.registry}}function Tu(a){ao(a);var b=!1,c=E.bind(a,"transitionend",function(c){"height"===c.raw().propertyName&&(ea.remove(a,[Uu,Vu]),b&&t.remove(a,"height"))});return{visible:function(){return b},hide:function(){b=!1;bo(a,ha.get(a));n.add(a,Vu);ao(a)},show:function(){Wu(a);
var c=ha.get(a);ao(a);n.add(a,Uu);Wu(a);bo(a,c);b=!0},destroy:function(){c.unbind()}}}function LO(a,b){var c=D.create({grow:r([]),shrink:r([]),exit:r([])}),d=Qu(Su(f.identity)),e=q.fromTag("div");O.toolbarGroup(e);n.add(e,ia.resolve("toolstrip"));var g=q.fromTag("div");ea.add(g,[ia.resolve("toolbar"),ia.resolve("toolbar-primary")]);var l=q.fromTag("div");ea.add(l,[ia.resolve("toolbar"),ia.resolve("toolbar-more")]);v.append(e,g);v.append(e,l);var p=Tu(l);b.events.click.bind(function(){p.visible()?
(p.hide(),b.deselect(),c.trigger.shrink()):(p.show(),b.select(),c.trigger.grow())});var s=function(){var a=d.get();return k.bind(a,function(a){return a.isVisible()?[a.component()]:[]})},z=function(){a.update();var c=s(),c=a.build(c);t.set(g,"visibility","hidden");a.clearWidth();B.empty(g);J.append(g,c);var d=a.width(g);v.append(g,b.group());var c=MO.partition(d,c,ra.getOuter,b.group()),d=c.extra(),e=c.within();B.empty(g);B.empty(l);J.append(g,e);J.append(l,d);a.updateWidth(b,c);t.remove(g,"visibility")},
x=function(){cg.preserve(z,e)};return{element:function(){return e},main:f.constant(g),mores:f.constant(l),destroy:function(){var a=d.get();k.each(a,function(a){a.destroy()});b.destroy();p.destroy()},focused:f.never,enter:f.noop,restore:f.noop,refocus:f.noop,refresh:x,repaint:function(){a.shouldRefresh()&&x()},add:function(a){d.add(a)},events:c.registry}}function ze(a,b,c){var d=E.bind(a,"keydown",c.getOr(function(a){k.find(b,function(b){return b.matches(a)}).each(function(b){b.run(a).each(function(b){a.kill()})})})),
e=D.create({enter:r([]),exit:r([])});return nc({isFocused:f.curry(Na.isFocused,a),element:f.constant(a),clear:f.noop,enter:function(){Na.set(a);e.trigger.enter()},refresh:f.noop,isEnabled:f.always,exit:function(){e.trigger.exit()},events:e.registry,destroy:function(){d.unbind()}})}function co(a,b){var c=ze(a,[U.rule(U.inSet(N.SPACE().concat(N.ENTER())),function(){b.execute()(a);return h.some(!0)})],b.process());return nc({element:c.element,destroy:c.destroy,clear:c.clear,isFocused:c.isFocused,isEnabled:f.always,
refresh:f.noop,enter:c.enter,exit:c.exit})}function Ch(a,b){var c=f.curry(b,-1,0),d=f.curry(b,1,0),e=Od.onDirection(c,d),g=Od.onDirection(d,c),c=f.curry(b,0,-1),d=f.curry(b,0,1),l=function(b){return b(a)()},e=f.curry(l,e),g=f.curry(l,g);return{west:e,east:g,north:c,south:d}}function Xu(a,b){var c=E.bind(a,"keydown",function(a){var c=ka.locate(b,a);if(U.is(N.ESCAPE()[0])(a))d(),a.kill();else if(void 0!==c&&null!==c&&U.is(N.TAB()[0])(a)){var e=(U.isShift(a)?ka.prev:ka.next)(b,c);ka.progress(c,e);a.kill()}}),
d=function(){ka.exit(b);e.trigger.exit()},e=D.create({enter:r([]),exit:r([])});return nc({enter:function(){ka.first(b).each(function(a){a.enter()})},exit:d,clear:f.curry(ka.clear,b),refresh:f.curry(ka.refresh,b),isEnabled:f.curry(ka.isEnabled,b),isFocused:f.curry(Na.isFocused,a),destroy:function(){ka.destroy(b);c.unbind()},events:e.registry})}function NO(a,b){var c=JO(b),d=Y.detect().deviceType.isTouch()?KO(a,c):LO(a,c);O.toolbar(d.main(),b("aria.label.toolbar"));O.group(d.mores());var e=D.create({drawer:K(["delta",
"total"],d.events.drawer),grow:K([],d.events.grow),shrink:r([]),transitionend:r(["property"]),exit:r([])}),g=E.bind(d.element(),"transitionend",function(a){e.trigger.transitionend(a.raw().propertyName)}),l=h.none(),p=pa.sectors({first:h.none,trigger:ye.trigger}),f=ba.sectors(d.element(),OO,p);f.events.exit.bind(function(){l=h.none();e.trigger.exit()});f.events.active.bind(function(a){l=h.some(a.element())});var z=function(){return f.isFocused()},x=function(){l.each(T.focus)};d.events.shrink.bind(function(){T.search(d.mores()).isSome()&&
c.focus();e.trigger.shrink()});return{element:d.element,refresh:d.refresh,repaint:d.repaint,add:d.add,enter:function(){f.enter()},destroy:function(){f.exit();l=h.none();g.unbind();d.destroy();f.destroy()},focused:z,restore:x,refocus:function(){z()&&x()},events:e.registry}}function PO(){var a=P.div();n.add(a,w.resolve("bannerarium"));n.add(a,w.resolve("layer-above-editor"));var b=h.some([]),c=Ej.create(),d=function(a){b=b.bind(function(b){b=k.filter(b,function(b){return b!==a});return h.some(b)});
e(a)},e=function(a){a.destroy();c.unbind(a.events.close);B.remove(a.element())},g=D.create({close:r(["banner"])});return{element:function(){return a},display:function(e){b.fold(function(){e.destroy()},function(b){b.push(e);c.bind(e.events.close,function(){d(e);g.trigger.close(e)});v.append(a,e.element())})},hide:d,destroy:function(){B.remove(a);b=b.bind(function(a){k.each(a,e);return h.none()})},events:g.registry}}function Yu(){var a=PO();a.events.close.bind(function(){b.trigger.resize()});var b=
D.create({resize:r([])});return{element:a.element,display:function(c){a.display(c);b.trigger.resize()},hide:function(c){a.hide(c);b.trigger.resize()},destroy:a.destroy,events:b.registry}}function Zu(a,b,c){var d=-1;return{shouldRefresh:function(){return ra.getOuter(b)!==d},updateWidth:f.curry(function(a,b,c){d=ra.getOuter(a)},b),updateHeight:f.noop,clearWidth:f.noop,build:f.identity,update:f.noop,width:ra.getOuter,init:function(a,b,c,d,f,z){a.refresh()},state:f.constant({toolbar:{drag:h.none()}}),
integrate:function(a,b,c,d,f){var z=P.div();ea.add(z,[w.resolve("sticky-container"),w.resolve("layer-above-editor")]);J.append(z,[b.element(),c.element(),f]);J.append(a,[z,d])},destroy:f.noop,events:Kc(["changed","dock","undock"])}}function QO(a){a=Z.merge({layerClass:$u.resolve("blocker")},a);var b=q.fromTag("div");m.set(b,"role","presentation");t.setAll(b,{position:"fixed",left:"0px",top:"0px",width:"100%",height:"100%"});n.add(b,$u.resolve("blocker"));n.add(b,a.layerClass);return{element:function(){return b},
destroy:function(){B.remove(b)}}}function RO(){var a=h.none(),b=function(b,c){var g=a.map(function(a){return b.compare(a,c)});a=h.some(c);return g},c=D.create({move:r(["info"])});return{onEvent:function(a,e){e.extract(a).each(function(a){b(e,a).each(function(a){c.trigger.move(a)})})},reset:function(){a=h.none()},events:c.registry}}function SO(a){return{onEvent:function(a,c){},reset:f.noop}}function TO(){var a=SO(),b=RO(),c=a;return{on:function(){c.reset();c=b},off:function(){c.reset();c=a},isOn:function(){return c===
b},onEvent:function(a,b){c.onEvent(a,b)},events:b.events}}function UO(a,b){var c=D.create({relocate:r(["x","y","deltaX","deltaY"]),dragend:r([])}),d=VO.both(a),e=Dh.transform(d),g=E.bind(a,"mousedown",function(a){0!==a.raw().button||db.closest(a.target(),b)||(e.on(),e.go(q.fromDom(document.body)))});e.events.stop.bind(function(){c.trigger.dragend();e.off()});d.events.relocate.bind(function(a){c.trigger.relocate(a.x(),a.y(),a.deltaX(),a.deltaY())});return{blocker:e.element,destroy:function(){g.unbind();
e.destroy()},events:c.registry}}function WO(){var a=D.create({dock:r([]),undock:r([])}),b=function(a,b,e,g,l,p){if("true"===m.get(e,"data-ephox-snap")){var f=Ja.absolute(l),z=f.top()+p.top;if(av.isAllInside(b,z,z+g()))return f=a.locationToAbsolute(e,f.left(),z),h.some({position:"absolute",left:p.left+f.left()+"px",top:f.top()+"px"});a=p.top+f.top()-g()<=b.y()?b.fy():b.fy()+b.h()-g();l=Ja.viewport(l).left()-f.left();p=p.left+f.left()+l;return h.some({position:"fixed",left:p+"px",top:a+"px"})}return h.none()};
return{update:function(c,d,e,g,l,p){b(c,d,e,g,l,p).each(function(b){var c=t.get(e,"position");t.setAll(e,b);"absolute"===b.position&&c!==b.position?a.trigger.dock():"fixed"===b.position&&c!==b.position&&a.trigger.undock()})},getState:function(a){return"true"===m.get(a,"data-ephox-snap")},events:a.registry}}function XO(a){var b=function(a,b,c){a=y.owner(a);a=Ga.get(a);b-=a.left();c-=a.top();return Ba(b,c)},c=function(a,b,c){a=y.owner(a);a=Ga.get(a);b+=a.left();c+=a.top();return Ba(b,c)};return{locationToFixed:b,
fixedToLocation:c,absoluteToFixed:function(b,c,g){var l=a();b=y.owner(b);b=Ga.get(b);c-=b.left();return Ba(c,l.top()-g)},locationToAbsolute:function(b,c,g){b=a();return Ba(c,g).translate(-b.left(),-b.top())},absoluteToLocation:function(b,c,g){b=a();return Ba(c,g).translate(b.left(),b.top())},fromFixed:function(a,b,g){var l=Ba(b,g);a=c(a,b,g);return bv(l,a)},fromLocation:function(a,c,g){a=b(a,c,g);c=Ba(c,g);return bv(a,c)},boundToFixed:function(a,b,c,l,p,f,z){b=c<a.x()?a.fx():c>a.x()+a.w()?a.fx()+
a.w():p;a=l<a.y()?a.fy():l+z>a.y()+a.h()?a.fy()+a.h()-z:f;return Ba(b,a)}}}function cv(a,b){var c=a.isInline()?a.element():b;return YO(function(){var a=Ga.get();return{x:a.left,y:a.top,w:f.constant(window.innerWidth),h:f.constant(window.innerHeight),fx:f.constant(0),fy:f.constant(0)}},function(){return a.isInline()?Ba(0,0):Ja.absolute(c)},function(){var a=I.descendant(b,".ephox-chameleon-toolbar").getOr(b);return ha.getOuter(a)},c)}function ZO(a,b,c){var d=P.div();t.set(d,"position","relative");n.add(d,
w.resolve("dragging-container"));var e=P.div();n.add(e,w.resolve("draggable-container"));var g=a.isInline()?b:e;c=cv(a,g);var l=dv.transitions,p=ev.except([".ephox-pastry-button","."+w.resolve("banner-buttons")+" *",".ephox-polish-ui-container",".ephox-polish-socket",".ephox-polish-widget-container"]),s=fv.register(c,g,p,l),z=D.create({changed:K([],s.events.dragend),dock:K([],s.events.dock),undock:K([],s.events.undock),appear:r(["container","wrapper"]),disappear:r(["container","wrapper"])});uc.initFade(e);
s.events.appear.bind(function(){z.trigger.appear(g,e)});s.events.disappear.bind(function(){z.trigger.disappear(g,e)});n.add(e,w.resolve("layer-above-editor"));ea.add(s.blocker(),[w.resolve("above-outside"),w.resolve("dragging")]);var x=P.span();O.hidden(x,!0);ea.add(x,[w.resolve("toolbar-drag-handle"),w.resolve("general-drag-handle"),"ephox-textbox-font",w.resolve("icon")]);c=Y.detect();c.browser.isIE()&&10===c.browser.version.major&&n.add(x,w.resolve("ie10"));return{shouldRefresh:f.constant(!0),
updateWidth:f.curry(uc.updateWidth,g),updateHeight:f.noop,clearWidth:f.curry(uc.clearWidth,g),build:function(a){return[x].concat(a)},width:f.curry(uc.width,g),init:function(b,c,d,l,p,f){var z=t.preserve(g,function(){t.set(g,"visibility","hidden");t.remove(g,"display");b.refresh();return ha.get(b.element())});f.toolbar.drag.fold(function(){var b=uc.offsetFrom(a,g,z,p);s.init(b.left,b.top,h.from(p.toolbar.offset).getOr({top:-1*z,left:0}))},s.setState);J.append(e,[b.element(),c.element()])},update:function(){s.update()},
state:function(){return{toolbar:{drag:s.state()}}},integrate:function(c,g,l,p,f){v.append(e,g.element());a.isInline()?(J.append(d,[e,f,p]),v.append(b,d)):J.append(b,[e,f,p])},destroy:function(){s.destroy()},events:z.registry}}function $O(a,b,c){var d=P.div();t.set(d,"position","relative");n.add(d,w.resolve("floating-container"));!0!==c.autoresize&&n.add(d,w.resolve("floating-container-sticky"));c=P.div();n.add(c,w.resolve("draggable-container"));var e=a.isInline()?b:c;c=cv(a,a.isInline()?e:d);var g=
fv.register(c,e,ev.none,dv.transitions),l=D.create({changed:K([],g.events.dragend),dock:K([],g.events.dock),undock:K([],g.events.undock),appear:r(["container","wrapper"]),disappear:r(["container","wrapper"])});uc.initFade(e);g.events.appear.bind(function(){l.trigger.appear(e,e)});g.events.disappear.bind(function(){l.trigger.disappear(e,e)});n.add(e,w.resolve("layer-toolbar"));var p=function(){g.update()},s=function(){if(t.getRaw(e,"position").is("fixed")){var b=Ja.absolute(a.element());t.getRaw(e,
"left").is(b.left())||t.set(e,"left",b.left()+"px")}b=ra.get(a.element());b!==ra.get(e)&&t.set(e,"width",b+"px");return b},z=function(){var b=ha.get(e)+"px";t.getRaw(a.element(),"margin-top").is(b)||t.set(a.element(),"margin-top",b)};return{shouldRefresh:function(){return!0},updateWidth:function(b,c){a.isInline()?uc.updateWidth(e,b,c):(s(),z(),p())},updateHeight:function(){a.isInline()||z()},clearWidth:function(){a.isInline()&&uc.clearWidth(e)},build:f.identity,width:function(b){return a.isInline()?
uc.width(e,b):ra.get(a.element())},init:function(b,c,d,l,p,f){f=t.preserve(e,function(){t.set(e,"visibility","hidden");t.remove(e,"display");b.refresh();return ha.get(b.element())});d=uc.offsetFrom(a,e,f,p);a.isInline()||(s(),z());p=p.toolbar.sticky?{top:0,left:0}:h.from(p.toolbar.offset).getOr({top:-1*f,left:0});g.init(d.left,d.top,p);J.append(e,[b.element(),c.element(),l])},update:p,state:f.constant({toolbar:{drag:h.none()}}),integrate:function(c,g,l,p,f){v.append(e,g.element());a.isInline()?J.append(d,
[f,p]):J.append(d,[e,p]);v.append(b,d)},destroy:function(){g.destroy()},events:l.registry}}function aP(a,b,c,d,e,g){var l=Y.detect(),p=q.fromTag("div"),s=c.uiContainer(),z=P.div();gv(d,p);n.add(p,w.resolve("editor-main"));!0===e.autoresize&&n.add(p,ed.autoresize());a.isInline()||l.deviceType.isTouch()||!0===e.toolbar.sticky?v.append(p,s):(gv(d,z),n.add(z,w.resolve("external-ui")),d=ca.body(),v.append(d,z),v.append(z,s));var x=bP.setup(a,p,e,g),h=Qd.toolbar(x,u.translate);!1===e.toolbar.visible&&n.add(p,
"ephox-polish-no-toolbar");b.events.toolbar.bind(h.enter);h.events.exit.bind(a.focus);var k=Yu(),R=P.div();n.add(R,w.resolve("socket"));var Da=P.div();n.add(Da,w.resolve("widget-container"));x.integrate(p,h,k,R,Da);hv.build(p,e.sideBar,e.bottomBar);var m=a.isInline()?function(){t.set(k.element(),"min-width",ra.getOuter(a.element())+"px")}:f.noop;a.events.paint.bind(function(a){h.repaint();c.refresh();m()});x.events.changed.bind(function(){h.refresh()});a.isInline()||!0!==e.toolbar.sticky||(x.events.dock.bind(function(){t.set(s,
"position","absolute");c.refresh()}),x.events.undock.bind(function(){t.set(s,"position","fixed");c.refresh()}));if(a.isInline()||!0===e.toolbar.sticky)x.events.appear.bind(function(b){var c=a.isInline()?[b.container()]:[b.container(),s];uc.fadeIn(c,b.wrapper())}),x.events.disappear.bind(function(b){var c=a.isInline()?[b.container()]:[b.container(),s];uc.fadeOut(c,b.wrapper())});h.events.transitionend.bind(x.updateHeight);return{element:f.constant(p),socket:function(a){a.connect(R)},viewport:f.constant(R),
uiContainerParent:f.constant(z),connect:function(a){v.append(a,p);vh.detect(p);return!0},destroy:function(){h.destroy();x.destroy();k.destroy();B.remove(p);B.remove(z)},toolbar:h,position:function(){m();x.init(h,k,R,Da,e,g)},refresh:function(){x.update();h.refresh()},banners:k.element,displayBanner:k.display,hideBanner:k.hide,state:x.state,dialogContainer:f.constant(Da)}}function cP(a){var b=h.none(),c=function(b){return function(){for(var c=[],d=0;d<arguments.length;d++)c[d]=arguments[d];d=a.get()[b];
if(null===d||void 0===d)throw"can't find instance method: "+b;return d.apply(null,c)}},d=function(){var a=b.getOrDie("Cannot reconnect the editor before it has been connected the first time.");c("connect")(a)&&e.trigger.connected()},e=D.create({connected:r([])});return uh.external({activateInline:c("activateInline"),deactivateInline:c("deactivateInline"),content:c("content"),keyboard:c("keyboard"),smartview:c("smartview"),macros:c("macros"),ui:c("ui"),filter:c("filter"),undo:c("undo"),operations:c("operations"),
getMode:c("getMode"),element:c("element"),connect:function(a){b=h.some(a);d()},reconnect:function(){var c=b.getOrDie("Cannot reconnect the editor before it has been connected the first time."),e=t.getRaw(c,"height");a.get().events.loaded.bind(function(){e.fold(function(){t.remove(c,"height")},function(a){t.set(c,"height",a)})});var p=t.get(c,"height");t.set(c,"height",p);d()},focus:c("focus"),getContent:c("getContent"),setContent:c("setContent"),insertHtmlAtCursor:c("insertHtmlAtCursor"),state:c("state"),
communication:c("communication"),uploader:c("uploader"),isDirty:c("isDirty"),setDirty:c("setDirty"),isPrettyPrinting:c("isPrettyPrinting"),events:e.registry})}function iv(a){var b=f.compose(H.error,a);return{invalidError:b,different:function(a,d,e,g,l){return 0===d.length?b(g):d===e?b(l):H.value(a)}}}function dP(a){var b=iv(a);return{changeAlt:function(a,d,e,g){var l=m.get(a,"src");return b.different(a,d,l,e,g).map(function(a){m.set(a,"alt",d);return a})}}}function Zb(a,b,c,d){var e=L.eq(a,c)&&b===
d;return{startContainer:f.constant(a),startOffset:f.constant(b),endContainer:f.constant(c),endOffset:f.constant(d),collapsed:f.constant(e)}}function jv(a){var b=function(b){return a(b).isRtl()?Nj.rtl:Nj.ltr};return{delta:function(a,d){return b(d).delta(a,d)},edge:function(a){return b(a).edge(a)},positions:function(a,d){return b(d).positions(a,d)}}}function eP(a){var b=iv(a);return{changeCaption:function(a,d,e,g){var l=m.get(a,"summary");return b.different(a,d,l,e,g).map(function(a){Ae.setCaption(a,
d);return a})},changeSummary:function(a,d,e,g){var l=I.descendant(a,"caption").map(ua.get).getOr("");return b.different(a,d,l,e,g).map(function(a){Ae.setSummary(a,d);return a})},setHeaders:function(a,d,e,g){return(!0===e&&!0===g?Ae.addBothHeaders:!0===e?Ae.addRowHeader:!0===g?Ae.addColumnHeader:f.constant(b.invalidError("a11y.t4b.repair.errors.none")))(a,d)},setScope:function(a,b){m.set(a,"scope",b);return H.value(a)}}}function fP(a){var b=C.immutableBag("id description prompts element severity url repair".split(" "),
[]),c=C.immutableBag(["ui","repair"],[]),d=dP(a),e=eP(a),g={I1:h.some(c({ui:[zb.field("image-alt","a11y.i1.repair.info",f.constant(""))],repair:function(a,b,c){return d.changeAlt(b.element(),c["image-alt"](),"a11y.i1.repair.errors.empty","a11y.i1.repair.errors.duplicate")}})),I2:h.some(c({ui:[zb.field("image-alt","a11y.i2.repair.info",function(a){return m.get(a.element(),"alt")})],repair:function(a,b,c){return d.changeAlt(b.element(),c["image-alt"](),"a11y.i2.repair.errors.empty","a11y.i2.repair.errors.duplicate")}})),
T1:h.some(c({ui:[zb.field("table-caption","a11y.t1.repair.info",f.constant(""))],repair:function(a,b,c){return e.changeCaption(b.element(),c["table-caption"](),"a11y.t1.repair.errors.empty","a11y.t1.repair.errors.duplicate")}})),T2:h.some(c({ui:[zb.field("table-summary","a11y.t2.repair.info",f.constant(""))],repair:function(a,b,c){return e.changeSummary(b.element(),c["table-summary"](),"a11y.t2.repair.errors.empty","a11y.t2.repair.errors.duplicate")}})),T3:h.some(c({ui:[zb.field("table-caption","a11y.t3.repair.info",
function(a){return m.get(a.element(),"summary")})],repair:function(a,b,c){return e.changeCaption(b.element(),c["table-caption"](),"a11y.t3.repair.errors.empty","a11y.t3.repair.errors.duplicate")}})),T4A:h.none(),T4B:h.some(c({ui:[zb.toggles("table-headers","a11y.t4b.repair.info",[zb.toggle("row-header","ephox-polish-row-header","a11y.t4b.repair.row"),zb.toggle("col-header","ephox-polish-column-header","a11y.t4b.repair.column")])],repair:function(a,b,c){var d=c["row-header"]();c=c["col-header"]();
return e.setHeaders(a,b.element(),d,c)}})),T4C:h.some(c({ui:[zb.select("scope-type","a11y.t4c.repair.info",[zb.pair("row","a11y.t4c.repair.scope.row"),zb.pair("col","a11y.t4c.repair.scope.col"),zb.pair("rowgroup","a11y.t4c.repair.scope.rowgroup"),zb.pair("colgroup","a11y.t4c.repair.scope.colgroup")])],repair:function(a,b,c){return e.setScope(b.element(),c["scope-type"]())}})),D1:h.some(c({ui:[zb.select("heading-type","a11y.d1.repair.info",[zb.pair("h1","a11y.d1.repair.block.h1"),zb.pair("h2","a11y.d1.repair.block.h2"),
zb.pair("h3","a11y.d1.repair.block.h3"),zb.pair("h4","a11y.d1.repair.block.h4"),zb.pair("h5","a11y.d1.repair.block.h5"),zb.pair("h6","a11y.d1.repair.block.h6")])],repair:function(a,b,c){return kv.convertToHeading(b.element(),c["heading-type"]())}})),D2:h.none(),D3:h.some(c({ui:[],repair:function(a,b,c){return kv.joinLinks(a.content().isRoot,b.element())}})),D4:h.none(),D5:h.none(),O1:h.none(),O2:h.none()};return{convert:function(a,c){var d=function(b){var c=b.repair();return function(b,d){return a.undo().transaction(function(){return c(a,
b,d)})}};return k.map(c,function(a){var c=a.rule(),e=c.id().toUpperCase(),l=void 0!==g[e]?g[e]:h.none(),p=c.desckey();return b({id:e,description:p,prompts:l.map(function(a){return a.ui()}),element:q.fromDom(a.element()),url:c.url(),severity:c.severity(),repair:l.map(d).getOr(function(){return H.error("no repair")})})})}}}function gP(a){return{audit:function(b){return hP.audit(b,a.rules())}}}function iP(){var a=xa([]),b=xa(0),c=C.immutable("index","total","detail"),d=function(d){var g=a.get();if(0===
g.length)return h.none();var l,p=b.get();l=g.length-1;d=p+d;l=d>l?0:0>d?l:d;b.set(l);return h.some(c(l,g.length,g[l]))};return{load:function(d){if(0===d.length)return h.none();b.set(0);a.set(d);return h.some(c(b.get(),d.length,d[0]))},backwards:function(){return d(-1)},current:function(){var d=a.get();return 0===d.length?h.none():h.some(c(b.get(),d.length,d[b.get()]))},resolve:function(){var d=a.get();if(0===d.length)return h.none();var d=d.slice(0,b.get()).concat(d.slice(b.get()+1)),g=Math.min(d.length-
1,b.get());b.set(g);a.set(d);return 0===d.length?h.none():h.some(c(b.get(),d.length,d[b.get()]))},forwards:function(){return d(1)}}}function jP(a,b){var c=P.div();n.add(c,Ha.resolve(b,"assistance"));var d=Ha.resolve(b,"assistance-invalid"),e=h.none(),g=q.fromTag("p");n.add(g,Ha.resolve(b,"repair-error"));m.set(g,"aria-live","polite");var l=function(){n.remove(c,d);B.remove(g)},p=D.create({execute:r([])}),s=ba.dynamic(c,pa.dynamic({})),z=[s];return{element:f.constant(c),keylayouts:f.constant(z),markInvalid:function(a){n.add(c,
d);Oa.shout(c,a);ua.set(g,a);v.append(c,g)},markValid:l,getChange:function(){return e.map(function(a){return a.get()})},destroy:function(){e.each(function(a){a.destroy()})},update:function(d){l();d=d.detail();var g=d.prompts();e.each(function(a){a.destroy()});d=kP.generate(a,g,d,b);e=h.some(d);B.empty(c);J.prepend(c,d.elements());d.events.execute.bind(function(){p.trigger.execute()});s.set(d.keylayouts())},events:p.registry}}function lP(a,b){var c=P.div();n.add(c,Ha.resolve(b,"commands"));var d=P.div();
n.add(d,Ha.resolve(b,"commands-buttons"));var e=Rd.defaultActionButton(a,[Ha.resolve(b,"repair")],$b.repairLabel(),$b.repairText(),b),g=Rd.normalButton(a,[Ha.resolve(b,"ignore")],$b.ignoreLabel(),$b.ignoreText(),b),l=Rd.defaultActionButton(a,[Ha.resolve(b,"ok")],$b.okLabel(),$b.okText(),b),p=function(){J.append(d,[g.element(),e.element()])};p();var s=pa.button({execute:function(a){a.dom().click()}}),s=[ba.button(g.element(),s),ba.button(e.element(),s),ba.button(l.element(),s)];v.append(c,d);var z=
D.create({repair:K([],e.events.click),ignore:K([],g.events.click),done:K([],l.events.click)});return{element:f.constant(c),destroy:function(){e.destroy();g.destroy();l.destroy()},keylayouts:f.constant(s),focus:function(){var a=e.disabled()?e.element():g.element();T.focus(a)},update:function(a){B.remove(l.element());a=a.detail();Sb.isVisible(g.element())||p();a.prompts().fold(function(){e.disable();ga.disable(e.element())},function(a){e.enable();ga.enable(e.element());Oa.speak(ca.body(),Ha.translate(b,
$b.repairAvailable()))})},zero:function(a){B.empty(d);v.append(d,l.element());T.focus(l.element())},events:z.registry}}function mP(a,b){var c=P.div();n.add(c,Ha.resolve(b,"information"));m.set(c,"data-severity","info");var d=P.div();n.add(d,Ha.resolve(b,"icon"));var e=P.div();n.add(e,Ha.resolve(b,"description"));v.append(e,q.fromText(""));var g=q.fromTag("a");n.add(g,Ha.resolve(b,"help-icon"));m.set(g,"href","javascript:void(0)");J.append(c,[d,e,g]);var l=E.bind(g,"click",function(){var a=m.get(g,
"data-url");window.open(a,"","height=700,width=820,resizable=yes,scrollbars=yes")}),d=[ba.single(g,[],h.none())];return{element:f.constant(c),destroy:function(){l.unbind()},keylayouts:f.constant(d),update:function(a){a=a.detail();var d=a.severity();m.set(c,"data-severity",d);Oa.speak(ca.body(),Ha.translate(b,$b.severity(d)));d=Ha.translate(b,a.description());ua.set(e,d);Oa.speak(ca.body(),d);m.set(g,"title",Ha.translate(b,$b.issueHelp()));m.set(g,"data-url",a.url());v.after(e,g)},zero:function(){m.set(c,
"data-severity","success");var a=Ha.translate(b,$b.noIssue());ua.set(e,a);Oa.speak(ca.body(),a);B.remove(g)}}}function nP(a,b){var c=P.div(),d=P.span();n.add(d,Ha.resolve(b,"spin"));n.add(c,Ha.resolve(b,"loading"));v.append(c,d);return{element:f.constant(c),destroy:f.noop}}function oP(a,b){var c=Oj("titlebar",h.none(),b),d=Oj("title",h.none(),b),e=Oj("title-text",h.some($b.title()),b),g=Oj("issue",h.some($b.running()),b);J.append(d,[e,g]);var l=P.div();n.add(l,Ha.resolve(b,"navigation"));var e=Rd.icon(a,
Ha.resolve(b,"previous"),$b.previous(),b),p=Rd.icon(a,Ha.resolve(b,"next"),$b.next(),b),s=[e,p],e=D.create({previous:K([],e.events.click),next:K([],p.events.click)});J.append(l,k.map(s,function(a){return a.element()}));v.append(c,d);var z=pa.button({execute:function(a){a.dom().click()}}),p=k.map(s,function(a){return ba.button(a.element(),z)}),x=function(a){a.disable();ga.disable(a.element())},M=function(a){a.enable();ga.enable(a.element())},G=function(){k.each(s,x)},R=function(){k.each(s,M)},Da=function(){cg.preserve(function(){v.after(d,
l)},l)};return{element:f.constant(c),update:function(a){var c=a.index()+1;a=a.total();c=Ha.translate(b,$b.issueCounter(),c,a);ua.set(g,c);Oa.speak(ca.body(),c);(1===a?G:R)();Da()},zero:function(){ua.set(g,"&nbsp;");Da();G()},keylayouts:f.constant(p),destroy:function(){k.each(s,function(a){a.destroy()})},events:e.registry}}function pP(a,b){var c=P.div();n.add(c,Ha.resolve(b,"widget"));var d=Ha.resolve(b,"loading");n.add(c,d);var e=oP(a,b),g=mP(a,b),l=jP(a,b),p=lP(a,b),s=nP(a,b);J.append(c,[e.element(),
s.element()]);var z=D.create({showcase:r(["detail"]),ignored:r(["detail"]),solved:r(["detail"]),done:r([])}),h=function(a){k.each([e,g,l,p],function(b){b.update(a)});z.trigger.showcase(a.detail());cg.preserve(function(){v.after(e.element(),g.element());v.after(g.element(),l.element());v.after(l.element(),p.element())},c)},M=function(a){a.fold(function(){v.after(e.element(),g.element());v.after(g.element(),p.element());B.remove(l.element());e.zero();g.zero();p.zero()},h)},G=xa(iP());e.events.previous.bind(function(){G.get().backwards().each(h)});
e.events.next.bind(function(){G.get().forwards().each(h)});var R=function(){var a=l.getChange().getOr({});G.get().current().each(function(b){var c=b.detail();c.repair()(c,a).fold(function(a){l.markInvalid(a)},function(a){l.markValid();a=G.get().resolve();z.trigger.solved(c);M(a);p.focus()})})};l.events.execute.bind(R);p.events.repair.bind(R);p.events.ignore.bind(function(){G.get().current().each(function(a){var b=G.get().resolve();z.trigger.ignored(a.detail());M(b)})});p.events.done.bind(function(){z.trigger.done()});
R=k.flatten([e.keylayouts(),g.keylayouts(),l.keylayouts(),p.keylayouts()]);return{element:f.constant(c),destroy:function(){k.each([e,g,l,p],function(a){a.destroy()})},load:function(a){B.remove(s.element());n.remove(c,d);a=G.get().load(a);M(a)},open:function(){v.append(c,s.element());n.add(c,d)},skip:function(){var a=G.get().resolve();M(a)},keylayouts:f.constant(R),events:z.registry}}function qP(a){var b=eo.ignoreAttr(),c={prefix:f.constant("accessibility-check"),translate:lv.translate,tnames:f.constant("a11y")},
d=pP(rP,c),c=sP.all(),c=tP({rules:c}),e=gP(c),g=fP(lv.translate),l=eo.manager(a.content()),p=function(c){c=e.audit(c.dom());c=g.convert(a,c);return k.filter(c,function(a){var c=a.element(),c=Sd.read(c,b);return!k.contains(c,a.id())})};d.events.showcase.bind(function(b){a.content().body().each(function(c){c=b.detail().element();ca.inBody(c)?(l.moveTo(c,b.detail().severity()),rf.elementIntoView(a.content(),c)):d.skip()})});d.events.ignored.bind(function(a){a=a.detail();l.ignore(a.element(),a.id(),a.severity())});
d.events.solved.bind(function(a){a=a.detail();l.solve(a.element(),a.id(),a.severity())});c=D.create({done:K([],d.events.done)});return{element:d.element,anchorName:f.constant("a11y-widget-anchor"),textkey:f.constant("action.a11ycheck"),dialogTextkey:f.constant("a11y.widget.title"),destroy:function(){d.destroy()},keylayouts:d.keylayouts,openWidget:function(){a.content().hideInlineSelection();d.open();a.content().body().each(function(a){a=p(a);l.start(a);d.load(a)})},closeWidget:function(){l.stop()},
events:c.registry}}function uP(a,b){var c=D.create({open:r([]),close:r([])}),d=q.fromTag("div");n.add(d,ia.resolve("layer-menus"));n.add(d,ia.resolve("toolstrip"));v.append(a(),d);var e=function(){t.getRaw(d,"opacity").isNone()&&(g.cancel(),t.remove(d,"display"),c.trigger.close())},g=oc.last(e,1E3),l=E.bind(d,"transitionend",e);return{element:function(){return d},destroy:function(){l.unbind();B.remove(d)},open:function(){t.set(d,"display","block");t.reflow(d);c.trigger.open();t.set(d,"opacity","1")},
close:function(){t.remove(d,"opacity");g.throttle()},setContent:function(a){v.append(d,a)},events:c.registry}}function mv(a,b,c,d){var e=a.content(),g=a.ui().tabstrip.element(),l=[b.element()],p="."+w.resolve(c)+", ."+ia.resolve("more-button"),f=function(){var a=X.descendants(g,p);return l.concat(a)},z=pc.api(),h=D.create({abort:r([]),open:r([]),close:r([])}),k=function(){e.events.mousedown.unbind(G);z.clear();R.off()},G=function(){z.isSet()&&(b.closeWidget(),z.run(function(a){a.close()}))},R=Mu(G,
f);b.events.done.bind(function(){G()});var m=ba.multiple(b.element(),b.keylayouts());m.events.exit.bind(function(){h.trigger.abort()});return{destroy:function(){k();m.destroy();b.destroy();R.off()},events:h.registry,open:function(){R.on();b.openWidget();var c=uP(a.ui().dialogContainer,f);c.setContent(b.element());n.add(c.element(),d);var g=c.element();ea.add(g,[w.resolve(b.anchorName()),w.resolve("side-widget-anchor")]);O.dialog(g,u.translate(b.dialogTextkey()));c.open();c.events.close.bind(function(){e.focus();
h.trigger.close();k()});z.set(c);m.enter();h.trigger.open();e.events.mousedown.bind(G)},close:G,isOpen:z.isSet}}function vP(a){var b=a.filter();eo.configure(b);var c=pc.api(),d=function(){var b;b=qP(a);b=mv(a,b,fo,wP);b.events.abort.bind(b.close);b.events.close.bind(g);c.set(b);b.open()},e=function(){c.run(function(a){a.close()})},g=function(){c.clear()};return{ui:Za.ui({"a11ycheck.general":{toggle:!1,hasPopup:!1,value:fo,textkey:u.key("action.a11ycheck"),action:function(){(c.isSet()?e:d)()},updateGeneral:function(a){n.add(a.element(),
w.resolve(fo))},icon:!0,tooltip:Va.get}}),destroy:g}}function go(a){return{change:function(b,c){return(a.directionAt(b).isRtl()?nv.rtl:nv.ltr).change(b,c)}}}function xP(a){var b=a.property(),c=function(a,c){return b.parent(a).map(b.name).map(function(a){return!k.contains(c,a)}).getOr(!1)};return{validateText:function(a){return b.isText(a)&&c(a,yP)}}}function zP(a,b){return{is:function(c){return t.get(c,a)===b},remove:function(b){t.remove(b,a)},set:function(c){t.set(c,a,b)}}}function AP(a){var b=a.content(),
c=a.keyboard(),d=a.shortcuts(),e=a.context(),g=D.create({analytics:r(["message","properties"])}),l=f.curry(fd.indent,a),p=f.curry(fd.outdent,a),s=f.curry(fd.blockquote,a);d.events.indent.bind(l);d.events.outdent.bind(p);d.events.blockquote.bind(s);var z=function(a){var c=a.stopper();Pj.context(b).bind(function(b){Pj.cata(b,f.noop,function(b){(a.shift()?p:l)();c()})})},x=c.editor();x.on();x.events.tab.bind(z);e.events.preLinebreak.bind(function(b){ho.atQuoteBreak(a.content()).each(function(c){fd.breakQuote(a,
c.quote(),c.element());b.handler().handle()})});var k=C.immutable("value","icon","textkey"),c=k("justifyleft",h.some(ia.resolve("justifyleft")),u.key("alignment.left")),d=k("justifycenter",h.some(ia.resolve("justifycenter")),u.key("alignment.center")),e=k("justifyright",h.some(ia.resolve("justifyright")),u.key("alignment.right")),G=k("justifyfull",h.some(ia.resolve("justifyfull")),u.key("alignment.justify")),R=k("justifyleft",h.some(ia.resolve("justifyleft")),u.key("alignment.left")),m=k("justifycenter",
h.some(ia.resolve("justifycenter")),u.key("alignment.center")),k=k("justifyright",h.some(ia.resolve("justifyright")),u.key("alignment.right")),na=[c,d,e,G],lf=[R,m,k],n=function(){return Jb.detect(b.getSelection()).fold(function(){return na},function(a){return lf})},q={justifyleft:f.curry(fd.imageLeft),justifycenter:f.curry(fd.imageCentre),justifyright:f.curry(fd.imageRight)},t={justifyleft:fd.justifyLeft,justifycenter:fd.justifyCentre,justifyright:fd.justifyRight,justifyfull:fd.justifyFull},v=function(a){return a.toLowerCase()},
w=h.none();return{ui:Za.ui({"indent.general":{value:"indent",textkey:u.key("action.indent"),action:l,updateGeneral:f.identity,tooltip:Va.get,toggle:!1},"outdent.general":{value:"outdent",textkey:u.key("action.outdent"),action:p,updateGeneral:f.identity,tooltip:Va.get,toggle:!1},"blockquote.general":{value:"blockquote",textkey:u.key("action.blockquote"),action:s,updateGeneral:function(a){ho.read(b).quoted().fold(a.deselect,f.noop,a.select)},tooltip:Va.get,toggle:!0},"alignment.dropdown":{name:"alignment",
textkey:u.key("alignment.toolbar"),menuTextkey:u.key("alignment.menu"),action:function(c){var d=Jb.detect(b.getSelection()).fold(f.constant(t),f.constant(q));(void 0!==d[c]?d[c]:f.noop)(a)},updateDropdown:function(a){var c=n(),d=ho.read(b).alignment().fold(function(){return 0<c.length?oa.on(c[0].value()):oa.off()},oa.unchanged,oa.on);a.populate([{label:h.none,items:f.constant(c)}]);Qj.updateMenu(a,d.map(v),oa.on(),c,w)},values:na,render:w,tooltip:Va.get,toggle:!1,describe:function(a){return u.translate("alignment.describe",
u.get(a.textkey()))}}}),events:g.registry,destroy:function(){x.off();x.events.tab.unbind(z);x.destroy()}}}function BP(a,b){var c=function(a,b,c){var d=q.fromText(b);a(c,d);return h.some({element:f.constant(d),cleanup:function(){B.remove(d)},splits:f.constant([])})},d=function(a){return{none:h.none,start:f.curry(c,v.before,a),end:f.curry(c,v.after,a),middle:function(b,d,e){return c(v.after,a,d)}}},e=function(a){var b=function(a){return function(b,c){v.appendAt(b,c,a)}};return{prepend:f.curry(c,v.prepend,
a),before:f.curry(c,v.before,a),after:f.curry(c,v.after,a),insertAt:function(d,e){return c(b(e),a,d)},append:f.curry(c,v.append,a)}};return{before:{text:d(a),element:{hasPrevious:e(a).insertAt,first:e(a).prepend,empty:e(a).before,otherwise:e(a).append}},after:{text:d(b),element:{hasNext:e(b).insertAt,rightEdge:e(b).append,empty:e(b).after,otherwise:e(b).append}},general:{insertBefore:e(a).before,insertAfter:e(b).after}}}function ov(a,b,c,d){c=[b].concat(c);var e=f.curry(io.nuTag,b),g=f.curry(sf.relatedTags,
c),l=Tb.tagList(c),p=sf.queriesTag(b),s={nu:e,matches:g,purifiers:f.constant(l)},z=function(a){var b=q.fromText(Ua.zeroWidth());Rj.atStartOf(a.startContainer(),a.startOffset(),b);return mb.hare(b,0,b,1)},x=function(a,b,c){return A.isText(b)&&c===Fa.get(b).length?Kb.after(b,a).fold(function(){return S.point(b,c)},function(a){return S.point(a,0)}):S.point(b,c)},M=function(a,b,c){return A.isText(b)&&0===c?Kb.before(b,a).fold(function(){return S.point(b,c)},function(a){return S.point(a,ja.getEnd(a))}):
S.point(b,c)},G=function(a,b){return b.map(function(b){var c=x(a,b.start(),b.soffset());b=M(a,b.finish(),b.foffset());return mb.fussy(c.element(),c.offset(),b.element(),b.offset())})};c={nu:e,purifiers:f.constant(l),isStyled:f.constant(!0)};var R=["font-size"],m=function(a){return a.getSelection().map(function(a){var c=W.keys(d),c=k.difference(c,R);return k.forall(c,function(c){return sf.queryStyleOn(c,d[c],[b],a)})}).getOr(!1)};return{run:function(a,c){var d=c.doc();return jo.detect(c,p.queryOn).fold(function(){return h.none()},
function(b){b=z(b);gd.doRemoveUpto(a,l,b,g);return h.some(mb.fromHare(b))},function(a){a=z(a);var c=q.fromTag(b,d.dom());n.add(c,hb.styleSpan());v.wrap(a.startContainer(),c);return h.some(mb.fussy(a.startContainer(),1,a.startContainer(),1))},function(b){b=gd.doRemoveUpto(a,l,b,g);return G(a,b)},function(b){return ko.run(c.doc(),a,b,s)})},query:function(a){return p.query(a)||m(a)},deferred:f.constant(c),name:f.constant(a)}}function pv(a,b){return{element:f.constant(b),wrap:function(c){a.insert().append(b,
c)}}}function Sj(a,b,c,d,e,g){var l=f.curry(io.nu,d,e,b),p=f.curry(sf.relatedStyle,d,e,c),s=Tb.cssAndTag(c,d,e),z=sf.queriesStyle(d,e,c),x=f.constant(!0),k=function(b,c){Td.generic(b,f.noop,x,function(b){n.add(b,hb.styleSpan());t.set(b,d,c);m.set(b,hb.overrideSpan(),a);t.reflow(b)});return h.none()};b={nu:l,purifiers:f.constant(s),isStyled:function(a){return"span"===A.name(a)&&Eh.rawState(a,d,e)},matches:p};return{run:function(a,b){return jo.detect(b,z.queryOn).fold(function(){return h.none()},function(a){return k(b,
g)},function(a){return k(b,e)},function(b){return gd.doRemoveUpto(a,s,b,p)},function(c){return ko.run(b.doc(),a,c,{nu:l,matches:p,purifiers:f.constant(s)})})},query:function(b){var c="["+hb.overrideSpan()+'="'+a+'"]';return b.getSelection().bind(function(a){return I.closest(a.startContainer(),c).bind(function(b){return I.closest(a.endContainer(),c).bind(function(a){return L.eq(b,a)?t.getRaw(b,d).map(function(a){return a===e}):h.none()})})}).getOrThunk(function(){return z.query(b)})},deferred:f.constant(b),
name:f.constant(a)}}function CP(a){var b=a.content(),c=a.shortcuts(),d=a.undo(),e=D.create({analytics:r(["message","properties"])}),g=function(a,c){var d=DP.read(b);(void 0!==d[a]?d[a]():oa.unchanged()).fold(c.deselect,f.noop,c.select)},l=function(c){var e=function(a){return c(b.isRoot,a)};return function(){qb.cata(a.selections().get(),f.noop,Tj.multiple(b,d,e),Tj.single(b,d,e));b.uiChanged()}},p=l(vc.bold),s=l(vc.italic),z=l(vc.underline),h=l(vc.strikethrough),k=l(vc.subscript),G=l(vc.superscript),
l=l(vc.removeformat);c.events.bold.bind(p);c.events.italic.bind(s);c.events.underline.bind(z);return{ui:Za.ui({"bold.general":{toggle:!0,value:"bold",textkey:u.key("action.bold"),action:p,updateGeneral:f.curry(g,"bold"),icon:!0,tooltip:Va.get},"italic.general":{toggle:!0,value:"italic",textkey:u.key("action.italic"),action:s,updateGeneral:f.curry(g,"italic"),icon:!0,tooltip:Va.get},"underline.general":{toggle:!0,value:"underline",textkey:u.key("action.underline"),action:z,updateGeneral:f.curry(g,
"underline"),icon:!0,tooltip:Va.get},"strikethrough.general":{toggle:!0,value:"strikethrough",textkey:u.key("action.strikethrough"),action:h,updateGeneral:f.curry(g,"strikethrough"),icon:!0,tooltip:Va.get},"removeformat.general":{toggle:!1,value:"removeformat",textkey:u.key("action.removeformat"),action:l,updateGeneral:f.identity,icon:!0,tooltip:Va.get},"subscript.general":{toggle:!0,value:"subscript",textkey:u.key("action.subscript"),action:k,updateGeneral:f.curry(g,"subscript"),icon:!0,tooltip:Va.get},
"superscript.general":{toggle:!0,value:"superscript",textkey:u.key("action.superscript"),action:G,updateGeneral:f.curry(g,"superscript"),icon:!0,tooltip:Va.get}}),events:e.registry,destroy:f.noop}}function qv(a){var b=function(b,d,e,g){var l=e.join(",");b=a.up().closest(b,l,g);d=a.up().closest(d,l,g);return b.isSome()&&d.isSome()?(g=b.getOrDie("Just checked it was some."),d=d.getOrDie("Just checked it was some."),a.eq(g,d)?k.find(e,f.curry(a.is,g)):h.none()):h.none()};return{query:function(a,d,e){d=
d.concat(EP.tags());return b(a.startContainer(),a.endContainer(),d,e)},queryAll:b}}function rv(a,b){var c=C.immutable("base","value","textkey","icon","styles","tag"),d=a.styles,e=b.map(f.curry(FP,a.showDocumentStyles)).getOr([]),d=d.concat(e),d=k.map(d,function(a){return{name:a.rule,text:h.from(a.text).map(u.raw),style:void 0===a.style?{}:a.style}}),g={};k.each(d,function(a){GP.decipher(a).each(function(b){g[a.name]=b})});var d=f.always,e=f.never,l=function(a,b,c,d){return function(e){return Be.cata(e,
a,b,c,d)}},p=W.values(g),s=k.filter(p,l(e,e,e,d)),z=k.filter(p,l(e,e,d,e)),x=k.filter(p,l(e,d,e,e)),M=k.filter(p,l(d,e,e,e)),d=function(){var a=s.concat(x).concat(z).concat(M);return k.map(a,function(a){return Be.cata(a,function(a,b,c){return"."+a},function(a,b,c,d){return a+"."+b},function(a,b,c){return a},function(a,b,c,d){return a+"."+b})})}(),G=function(a){return void 0!==g[a]?h.some(g[a]):h.none()},R=function(a){return Be.cata(a,function(a,b,d){return c("span","."+a,b,h.none(),d,"span")},function(a,
b,d,e){return c(a,a+"."+b,d,h.none(),e,"span")},function(a,b,d){return c(a,a,b,h.none(),d,a)},function(a,b,d,e){return c(a,a+"."+b,d,h.none(),e,a)})},e=function(){var a=W.values(g);return k.map(a,R)}();return{candidateByName:function(a){return G(a).map(R)},toCandidate:R,ruleByName:G,divisions:function(){return{classblocks:f.constant(s),blocks:f.constant(z),objects:f.constant(x),inlines:f.constant(M)}},backup:function(a){return c(a,a,u.key("block."+a),h.none(),{},"span")},selectors:f.constant(d),everything:f.constant(e)}}
function HP(a,b,c){var d=c(void 0===b||"default"===b?h.none():h.some(b)),e=q.fromTag("div");n.add(e,w.resolve("list-style-option"));c=void 0===b||"default"===b?IP(e,"ul"===a?"list.unordered.default":"list.ordered.default"):JP(a,b);v.append(e,c);a=u.translate(("ul"===a?"list.unordered.":"list.ordered.")+b);m.set(e,"title",a);O.label(e,a);O.menuItemCheckbox(e);var g=Oa.describe(e,u.translate("aria.widget.navigation"));v.append(e,g);var l=D.create({action:r(["type","element"])}),p=function(){ga.checked(e,
!0);n.add(e,w.resolve("list-style-selected"))},s=function(){ga.checked(e,!1);n.remove(e,w.resolve("list-style-selected"))},z=E.bind(e,"click",function(a){l.trigger.action(d,h.some(e))});return{element:f.constant(e),instance:d,style:b,update:function(a){(d.query(a)&&d.queryStyle(a)?oa.on(!0):oa.off()).fold(s,f.noop,p)},select:p,deselect:s,events:l.registry,destroy:function(){z.unbind();B.remove(e);B.remove(g)}}}function KP(a,b,c){var d=D.create({action:r(["type"])}),e=P.div();n.add(e,w.resolve("list-style-palette"));
var g=k.map(a,function(a){return HP("bullist"===b?"ul":"ol",a,c)});k.each(g,function(a){a.events.action.bind(function(a){a.element().each(s);d.trigger.action(a.type())});v.append(e,a.element())});var l=function(){var a=Math.floor(g.length/4)+(0<g.length%4?1:0);return ba.grid(e,{cell:f.constant("."+w.resolve("list-style-option"))},a,4,pa.grid({trigger:function(a){a.dom().click();return h.some(a)}}))}(),p=function(a){return k.find(g,a)},s=function(a){I.sibling(a,"["+Uj+'="default"]').filter(function(b){return b!==
a}).bind(function(b){m.remove(b,Uj);m.set(a,Uj,"default")})};return{enter:l.enter,element:f.constant(e),update:function(a){k.each(g,function(b){b.update(a)})},events:d.registry,destroy:function(a){l.isFocused()&&l.exit();l.destroy();k.each(g,function(a){a.destroy()});B.remove(e)},findDefault:function(){return p(function(a){return m.has(a.element(),Uj)}).map(function(a){return a.instance})}}}function sv(a){var b=a.region(),c=a.content(),d=a.undo(),e=a.keyboard(),g=a.listConstructor(),l=a.type(),p=
a.styles(),s=a.textkey(),z=a.menuTextkey(),h=g("default"),k=Y.detect(),G=e.all();G.swallowKeys([N.ESCAPE()]);var R=D.create({abort:r([]),done:r([]),close:r([]),analytics:r(["message"])});G.events.escape.bind(function(a){R.trigger.abort()});var m=function(e,g){var l=dg.list(function(a,c,d,l,p){return e.apply(a,c,d,l,p,go(b),g)},b,c,d,a.selections());R.trigger.done();c.focus();return l},na=function(){I.descendant(n.element(),'[data-ephox-polish-list-style="default"]').each(function(a){T.focus(a)})},
n=KP(p,l,g);n.events.action.bind(function(a){m(a.type(),!1)});return{action:function(){var a=n.findDefault().getOr(h);m(a,!0)},element:n.element,shortcut:!1,textkey:f.constant(s),menuTextkey:f.constant(z),label:f.constant(!1),name:f.constant(l),tooltip:Va.get,toggle:!0,value:l,updateWidget:function(a){c.getSelection().each(function(b){var c=h.query(b)?oa.on(!0):oa.off();c.fold(a.deselect,f.noop,a.select);c.fold(a.release,f.noop,a.press);n.update(b)})},open:function(){k.deviceType.isTouch()||na();
G.on()},close:function(){G.off();R.trigger.close()},icon:!0,events:R.registry,enter:n.enter,destroy:function(){G.off();G.destroy();n.destroy()}}}function LP(a,b,c){var d=function(b){if("p"===A.name(b))return tv.replace(a,b,"li");var c=q.fromTag("li");v.before(b,c);v.append(c,b);return c},e=function(a){var d=q.fromTag(b);c.each(function(a){t.set(d,"list-style-type",a)});v.before(a[0],d);J.append(d,a);h.from(m.get(a[0],"dir")).each(function(a){m.set(d,"dir",a)});return d},g=function(a){var d=ac.mutate(a,
b);c.fold(function(){t.remove(d,"list-style-type")},function(a){t.set(d,"list-style-type",a)});return d},l=function(a){var b=f.constant(!0),c=f.constant(!1);return a.fold(b,c,c)},p=function(a,b){return function(c){return Fh.cata(c,function(c){var d=X.descendants(c,"li");return 0<d.length?(c=d[0],d=d[d.length-1],c=Ab.first(c).getOr(c),d=Ab.last(d).getOr(d),lo.outdent(a,c,0,d,ja.getEnd(d),b).map(function(a){return a.all()})):h.none()},h.none,h.none).getOr([])}},s=function(a){return Fh.cata(a,function(a){return[a]},
function(a){return[g(a)]},function(a){a=k.map(a,d);e(a);return a})};return{apply:function(a,d,e){e=MP.categorise(e,b,c);a=k.forall(e,l)?p(a,d):s;return k.bind(e,a)}}}function NP(a,b){var c=D.create({analytics:r(["message"])}),d=rv(b,h.none()),e=a.region(),g=a.content(),l=a.undo();g.events.stylesheetLoad.bind(function(a){d=rv(b,h.some(a.sheets()));g.uiChanged()});var p=h.some(uv.format),s=g.isRoot,z=function(a){OP.deviceType.isiOS()&&k.each(k.groupBy(k.filter(k.map(a,function(a){return I.ancestor(a,
"ul,ol",s).getOr(!1)}),f.identity),function(a){return a.dom()}),function(a){var b=t.get(a[0],"list-style-type");t.set(a[0],"list-style-type","none");setTimeout(function(){t.set(a[0],"list-style-type",b)},0)})},x=function(){return qb.cata(a.selections().get(),f.constant([]),function(a){return 0<a.length?vv.groups(d,a[0]):[]},function(a,b){return vv.groups(d,a.startContainer(),s)})},M=function(a){var b=nd.hasSelection(g),c=PP.read(g,d),e=x();a.populate(e);Qj.updateMenu(a,c.tag(),b.content(),d.everything(),
h.none())},G=function(b){d.ruleByName(b).each(function(b){Be.cata(b,function(b,c,d){dg.inline(e,g,l,a.selections(),b)},function(b,c,d,p){dg.setClass(e,g,l,a.selections(),b,c)},function(b,c,d){dg.transform(e,g,l,a.selections(),b).each(function(a){k.each(a,function(a){m.remove(a,"class")});z(a)})},function(b,c,d,p){dg.transform(e,g,l,a.selections(),b).each(function(a){k.each(a,function(a){m.set(a,"class",c)});z(a)})});g.uiChanged()})},R=C.immutableBag("region content undo selections keyboard listConstructor type styles textkey menuTextkey".split(" "),
[]),Da=R({region:e,content:g,undo:l,selections:a.selections(),keyboard:a.keyboard(),listConstructor:f.curry(Vj.unordered,s),type:"bullist",styles:["default","disc","circle","square"],textkey:u.key("action.bullist"),menuTextkey:u.key("list.unordered.menu")}),R=R({region:e,content:g,undo:l,selections:a.selections(),keyboard:a.keyboard(),listConstructor:f.curry(Vj.ordered,s),type:"numlist",styles:"default decimal upper-alpha lower-alpha upper-roman lower-roman lower-greek".split(" "),textkey:u.key("action.numlist"),
menuTextkey:u.key("list.ordered.menu")}),na=function(a){return u.translate("block.describe",u.get(a.textkey()))},Da=f.curry(sv,Da),R=f.curry(sv,R);return{ui:Za.ui({"blocktag.dropdown":function(){return{name:"blocktag",textkey:u.key("block.styles"),menuTextkey:u.key("block.menu"),updateDropdown:M,action:G,values:d.everything(),render:p,tooltip:Va.get,toggle:!1,describe:na}},"bullist.widget":Da,"numlist.widget":R,"bullist.general":f.constant(wv.ul(a)),"numlist.general":f.constant(wv.ol(a))},f.identity),
events:c.registry,destroy:f.noop}}function Qa(a,b,c,d){return{context:a,profile:b,action:c,label:f.constant(d)}}function QP(a){var b=a.content(),c=pc.destroyable();return{ui:Za.ui({"bookmark.general":{toggle:!1,value:"bookmark",textkey:u.key("insert.bookmark"),action:function(){b.getSelection().each(function(a){var c=q.fromTag("span"),g=b.getSelectedText().fold(function(){return Wj.generate("textbox-bookmark")},function(a){a=50<a.length?a.substr(0,50):a;return Wj.generate(Pc.getAnchorValue(a,"textbox-bookmark"))});
m.set(c,"id",g);a=wc.after(a.startContainer(),a.startOffset(),a.endContainer(),a.endOffset())?Zb(a.endContainer(),a.endOffset(),a.endContainer(),a.endOffset()):Zb(a.startContainer(),a.startOffset(),a.startContainer(),a.startOffset());var l=q.fromText(Ua.zeroWidth());xc.insertAt(b,a,[c,l]).each(function(a){var c=y.nextSibling(a.element()).filter(function(a){return ja.isCursorPosition(a)&&!L.eq(l,a)}).getOrThunk(function(){var b=q.fromText(" ");v.after(a.element(),b);return b});b.win().each(function(a){Ea.setExact(a,
c,0,c,0)})})})},updateGeneral:f.noop,icon:!0,shortcut:!1,hasPopup:!1,hasDialog:!0}}),destroy:function(){c.clear()}}}function RP(a,b){return{is:function(c){return m.get(c,a)===b},remove:function(b){m.remove(b,a)},set:function(c){m.set(c,a,b)}}}function SP(a){var b=a.content(),c=D.create({analytics:r(["message","properties"])}),d=function(a,c){xv.readDir(b).map(function(b){return b[a]}).fold(oa.unchanged,f.apply).fold(c.deselect,f.noop,c.select)};return{ui:Za.ui({"ltrdir.general":{value:"ltrdir",textkey:u.key("directionality.ltrdir"),
action:f.curry(yv.dirLtr,a),updateGeneral:f.curry(d,"ltrdir"),toggle:!0},"rtldir.general":{value:"rtldir",textkey:u.key("directionality.rtldir"),action:f.curry(yv.dirRtl,a),updateGeneral:f.curry(d,"rtldir"),toggle:!0}}),events:c.registry,destroy:f.noop}}function zv(a,b){return Av(document.createElement("canvas"),a,b)}function Bv(a){return a.getContext("2d")}function Av(a,b,c){a.width=b;a.height=c;return a}function Cv(a,b){return new (Ub.getOrDie("Blob"))(a,b)}function mo(){return new (Ub.getOrDie("FileReader"))}
function Dv(a){return new (Ub.getOrDie("Uint8Array"))(a)}function Ev(a){return new Ud(function(b,c){function d(){p();b(l)}function e(){p();c("Unable to load data of type "+a.type+": "+g)}var g=URL.createObjectURL(a),l=new Image,p=function(){l.removeEventListener("load",d);l.removeEventListener("error",e)};l.addEventListener("load",d);l.addEventListener("error",e);l.src=g;l.complete&&d()})}function Fv(a){return new Ud(function(b,c){var d=new XMLHttpRequest;d.open("GET",a,!0);d.responseType="blob";
d.onload=function(){200==this.status&&b(this.response)};d.onerror=function(){var a;0===this.status?(a=Error("No access to download image"),a.code=18,a.name="SecurityError"):a=Error("Error "+this.status+" downloading image");c(a)};d.send()})}function Gv(a){var b=a.split(",");a=/data:([^;]+)/.exec(b[0]);if(!a)return h.none();a=a[1];for(var b=Xj.atob(b[1]),c=b.length,d=Math.ceil(c/1024),e=Array(d),g=0;g<d;++g){for(var l=1024*g,p=Math.min(l+1024,c),f=Array(p-l),z=0;l<p;++z,++l)f[z]=b[l].charCodeAt(0);
e[g]=Dv(f)}return h.some(Cv(e,{type:a}))}function no(a){return new Ud(function(b,c){Gv(a).fold(function(){c("uri is not base64: "+a)},b)})}function Hv(a){return new Ud(function(b){var c=new mo;c.onloadend=function(){b(c.result)};c.readAsDataURL(a)})}function oo(a,b,c){function d(b,c){return a.then(function(a){return yc.canvasToDataURL(a,b,c)})}return{getType:f.constant(b.type),toBlob:function(){return Ud.resolve(b)},toDataURL:function(){return c},toBase64:function(){return c.split(",")[1]},toAdjustedBlob:function(b,
c){return a.then(function(a){return yc.canvasToBlob(a,b,c)})},toAdjustedDataURL:d,toAdjustedBase64:function(a,b){return d(a,b).then(function(a){return a.split(",")[1]})},toCanvas:function(){return a.then(bc.clone)}}}function Iv(a){return yc.blobToDataUri(a).then(function(b){return oo(yc.blobToCanvas(a),a,b)})}function TP(a){var b=D.create({insertAssets:r(["assets"]),insertHtml:r(["html"])}),c=a.content(),d=h.none(),e=function(a){c.win().each(function(b){Ea.getAtPoint(b,a.x(),a.y()).each(function(a){Ea.setExact(b,
a.start(),a.soffset(),a.finish(),a.foffset())})})},g=function(a){e(a);b.trigger.insertAssets(a.assets())},l=function(b){e(b);b=b.html();a.undo().save();b=Ld.fromHtml(b);xc.insertAtCursor(c,b)};c.events.ready.bind(function(a){var b=h.none();d=h.some(UP.forImages(a.api().canvas(),b,!0));d.each(function(a){a.events.dragndropimages.bind(g);a.events.dragndrophtml.bind(l)})});return{events:b.registry,destroy:function(a){d.each(function(a){a.destroy()})}}}function Yj(a,b){var c=void 0!==b?b:VP,d=C.immutable("result",
"timestamp"),e={},g=function(a,b,c){e[a]=d(b,c)},l=function(a){var b=Gh.now();W.map(a,function(a,d){b-a.timestamp<c&&g(d,a.result,a.timestamp)})};Q.isObject(a)&&l(a);return{set:g,get:function(a,b){return h.from(e[b]).filter(function(b){return a-b.timestamp()<c}).map(function(a){return a.result()})},dump:function(){return W.map(e,function(a){return{result:a.result(),timestamp:a.timestamp()}})}}}function WP(a){return va.nu(function(b){var c=mo();c.onload=function(a){b(a.target.result)};c.readAsText(a)})}
function XP(a,b,c){var d=Yj(c),e=Zj.get("ephox.media.service.one",po.requestOne(),a+"/1/embed?url=${url}&maxWidth=${maxWidth}",b);return{checkOne:function(a,b,c){var f=Gh.now();c=ak.single(function(c,d){return e.execute({url:encodeURIComponent(a),maxWidth:b,fresh:d})},d,b+"&"+a,f,void 0!==c?c:!1);return Vd.foldSync(c,Jv.failed,Jv.success)},dumpCache:d.dump}}function YP(a,b,c){var d=qo.embedChecking(),e=a.internalevents(),g=a.communication(),l=XP(c.url,g.newHeaders(),b.cache),p=a.undo(),f=a.content();
a=a.filter();qo.configure(a);var z=["img","video","audio"],h=function(a,b){v.after(a,b);B.remove(a)},M=function(a,b){n.add(a,d);var e=l.checkOne(b,400);Vd.handle(e,function(b){n.remove(a,d)},function(e){n.remove(a,d);p.save();var g=q.fromHtml(e.recommended().html().trim());k.contains(z,A.name(g))||m.set(g,"data-ephox-embed-iri",b);var l=q.fromTag("div");v.append(l,g);c.inlineStyles&&f.doc().each(function(a){Kv.inlinePrefixedStyles(a,l,".ephox-summary-card")});f.getSelection().fold(function(){h(a,
g)},function(b){var c=L.eq(b.startContainer(),a)||L.contains(a,b.startContainer());h(a,g);var d=y.nextSibling(g).filter(ja.isCursorPosition).getOrThunk(function(){var a=q.fromTag("br");v.after(g,a);return a});(c||y.parent(g).filter(function(a){return b.collapsed()&&(L.eq(b.startContainer(),a)||L.contains(a,b.startContainer()))}).isSome())&&f.setSelection(d,0,d,0)})})},G=function(a){var b=a.command(),c=a.data();m.has(c,Wa.bookmarkAnchorDataAttr())||"insertLink"!==b&&"updateLink"!==b||y.parent(c).each(function(a){var b=
nb.get(a).replace(Ua.zeroWidth(),""),d=m.get(c,"href");if(b===d||"http://"+b===d)M(c,d);else{var e=y.children(a),g=k.find(k.reverse(e),function(a){return"br"===A.name(a)&&bk.documentPositionPreceding(c.dom(),a.dom())}).map(function(a){a=k.indexOf(e,a).getOr(-1);return e.slice(a+1,e.length)}).getOr(e);a=k.find(e,function(a){return"br"===A.name(a)&&bk.documentPositionPreceding(a.dom(),c.dom())}).map(function(a){a=k.indexOf(g,a).getOr(0);return g.slice(0,a)}).getOr(g);a=k.foldl(a,function(a,b){return a+
nb.get(b)},"").replace(Ua.zeroWidth(),"");a!==d&&"http://"+a!==d||M(c,d)}})};e.events.internal.bind(G);return{destroy:function(){e.events.internal.unbind(G)},state:function(){return{cache:l.dumpCache()}}}}function Lv(a){var b=function(){return null===a.project.apiKey?{}:{"textbox-api-key":a.project.apiKey}},c=function(a){var b=a+(-1===a.indexOf("?")?"?":"&")+"url=";return function(a){return h.some(b+encodeURIComponent(a))}},c=void 0===a.imageEdit.proxy?h.none:c(a.imageEdit.proxy);return{headers:function(){return{headers:b(),
xhrFields:{withCredentials:!0}}},newHeaders:b,proxy:c,destroy:f.noop}}function ZP(a){var b="true"===m.get(a,"contenteditable");m.set(a,"contenteditable","true");var c=E.bind(a,"keydown",function(a){u.trigger.keydown(a)}),d=E.bind(a,"keyup",function(a){u.trigger.keyup(a)}),e=E.bind(a,"keypress",function(a){u.trigger.keypress(a)}),g=E.bind(a,"mousedown",function(a){u.trigger.mousedown(a)}),l=E.bind(a,"mouseout",function(a){u.trigger.mouseout(a)}),p=E.bind(a,"mouseup",function(a){u.trigger.mouseup(a)}),
s=E.bind(a,"contextmenu",function(a){u.trigger.contextmenu(a)}),z=E.bind(a,"cut",function(a){u.trigger.cut(a)}),x=E.bind(a,"copy",function(a){u.trigger.copy(a)}),M=E.bind(a,"paste",function(a){u.trigger.paste(a)}),G=E.bind(q.fromDom(document),"selectionchange",function(a){u.trigger.selectionchange(a)}),R=function(){u.trigger.paint()},Da=E.capture(a,"load",R);Mv.bind(a,R);var na=Nv.browser.isFirefox()?"focus":"focusin",lf=E.bind(a,na,function(a){u.trigger.focus(a)}),t=E.bind(a,"focusout",function(a){u.trigger.focusOut(a)}),
mf=E.bind(a,"dblclick",function(a){u.trigger.dblclick(a)}),v=function(b){return L.eq(a,b)},na={loaded:va.pure(H.error("no iframe in inline mode")),stylesheetLoad:va.pure(h.none())},u=D.create({keydown:r(["original"]),keyup:r(["original"]),keypress:r(["original"]),mousedown:r(["original"]),mouseup:r(["original"]),mouseout:r(["original"]),contextmenu:r(["original"]),cut:r(["original"]),copy:r(["original"]),paste:r(["original"]),focus:r(["original"]),dblclick:r(["original"]),focusOut:r(["original"]),
selectionchange:r(["original"]),paint:r([])});return{win:f.constant(window),doc:f.constant(q.fromDom(document)),body:f.constant(a),get:function(){return ua.get(a)},set:function(b){ua.set(a,b)},focus:function(){Nv.browser.isIE()?a.dom().setActive(!0):T.focus(a)},focused:function(){return document.activeElement===a.dom()},blur:function(){a.dom().blur()},destroy:function(){b||m.remove(a,"contenteditable");k.each([c,d,e,g,p,l,s,z,x,M,lf,t,mf,G,Da],function(a){a.unbind()});Mv.unbind(a,R)},events:u.registry,
futures:na,background:f.noop,foreground:f.noop,hasRange:function(a){return sa.closest(a.startContainer(),v).isSome()&&sa.closest(a.endContainer(),v).isSome()},isActive:function(){return n.has(a,ed.active())}}}function Ov(a,b,c){var d=f.curry(L.eq,b),e=function(c){var e=Ka.freefallRtl(b).element();return I.ancestor(e,"table",d).filter($P(a,c)).map(Pv.above)},g=function(b,d,e,g,f){b.kill();Ea.setExact(a,d,e,g,f);c()};return function(c){var p=c.y();e(p).orThunk(function(){var c=Ka.freefallLtr(b).element();
return I.ancestor(c,"table",d).filter(aQ(a,p)).map(Pv.below)}).fold(function(){if("html"===A.name(c.target())){var e=c.x(),p=c.y();Ea.getAtPoint(a,e,p).each(function(a){var e=function(a){return I.closest(a,'[contenteditable="false"]',d).isSome()},p=e(a.start()),e=e(a.finish());(p||e)&&ck.browser.isIE()||T.focus(b);if(ck.browser.isIE()&&1===y.childNodesCount(b)&&(p=y.children(b)[0],"p"===A.name(p)&&0===y.childNodesCount(p))){v.append(p,q.fromTag("br"));g(c,p,0,p,0);return}g(c,a.start(),a.soffset(),
a.finish(),a.foffset())})}},function(a){var b=q.fromHtml("<p><br /></p>");a.fold(function(a){v.after(a,b)},function(a){v.before(a,b)});g(c,b,0,b,0)})}}function Qv(a){var b=null,c=function(){b=null;rb.get(a.win()).each(function(b){b.collapsed()&&a.focused()&&d.trigger.loiter(b.startContainer(),b.startOffset())})},d=D.create({loiter:r(["node","offset"])});return{reset:function(){null!==b&&(clearTimeout(b),b=null);b=setTimeout(c,1E3)},destroy:function(){null!==b&&(clearTimeout(b),b=null)},events:d.registry}}
function Rv(a,b){var c=h.none(),d=Lc.tap(function(){d.control.block();var g=a();g.filter(function(a){return ca.inBody(a.startContainer())}).each(function(a){var d=function(){e.trigger.nodeChanged(a.startContainer(),a.startOffset(),c.map(function(a){return a.startContainer()}))};c.fold(d,function(c){var e=L.eq,g=a.startContainer(),f=a.endContainer(),h=c.startContainer(),k=c.endContainer(),m=c.startOffset()!==a.startOffset();c=c.endOffset()!==a.endOffset();e(h,g)&&e(k,f)&&!(!A.isText(g)&&m||!A.isText(f)&&
c)||!1!==bQ([a.startContainer()],b)||d()})});c=g;d.control.unblock()}),e=D.create({nodeChanged:r(["node","offset","prev"])});return{update:function(){d.instance()},clear:function(){c=h.none()},destroy:function(){c=h.none();d.control.block()},events:e.registry}}function cQ(){var a=h.none();return{get:function(){return a},restore:function(b){a.each(b)},update:function(b){a=b.or(a)},clear:function(){a=h.none()}}}function dQ(a,b){var c=function(){return R().orThunk(g.get)},d=E.bind(a.body(),"click",Ov(a.win(),
a.body(),f.noop)),e=Rv(c,b),g=cQ(),l=function(){e.update();G()},p=function(){g.restore(function(a){m(a.startContainer(),a.startOffset(),a.endContainer(),a.endOffset())})};e.events.nodeChanged.bind(function(a){y.trigger.nodeChanged(a.node(),a.offset(),a.prev());y.trigger.uiStale()});a.events.keyup.bind(function(a){y.trigger.keyup(a.original());l();s.reset();y.trigger.interaction()});a.events.mouseout.bind(function(a){G()});a.events.mouseup.bind(function(a){y.trigger.mouseup(a.original());l();s.reset();
y.trigger.interaction()});var s=Qv(a);s.events.loiter.bind(function(a){y.trigger.loiter(a.node(),a.offset())});var z=function(){R().isNone()?p():G()},h=function(){a.isActive()&&(z(),Sv.focus(a,c,n))},k=function(){y.trigger.domChanged()},G=function(){var a=R();g.update(a)},R=function(){return rb.get(window).filter(a.hasRange)},m=function(a,b,c,d){try{rb.setExact(window,a,b,c,d)}catch(e){console.log("Skipping restoring invalid cursor position")}},na=function(b){mf(function(c){a.isActive()&&b();l()},
ro.build(a.focused,z,h,q.fromDom(document)))},n=function(a,b,c,d){na(function(){m(a,b,c,d)})},t=function(a,b){var c=rb.get(window);p();var d=a(b);b.toOld();c.each(function(a){m(a.startContainer(),a.startOffset(),a.endContainer(),a.endOffset());eQ.browser.isEdge()&&(b.isSet()||b.toOld())});return d},mf=function(a,b){var c=a(b);b.toOld();return c},u=function(b){var c=ro.build(a.focused,z,h,q.fromDom(document));return(R().isSome()?mf:t)(b,c)},v=function(a){return function(){var b=arguments;return u(function(c){c.toEditor();
return a(b)})}}(function(a){document.execCommand.apply(document,a);G()}),w=function(a,b){return Ba(a,b)},y=D.create({nodeChanged:r(["node","offset","prev"]),loiter:r(["node","offset"]),uiStale:r([]),domChanged:r([]),interaction:r([]),keyup:r(["original"]),mouseup:r(["original"]),keydown:K(["original"],a.events.keydown),keypress:K(["original"],a.events.keypress),mousedown:K(["original"],a.events.mousedown),contextmenu:K(["original"],a.events.contextmenu),cut:K(["original"],a.events.cut),copy:K(["original"],
a.events.copy),paste:K(["original"],a.events.paste),focus:K(["original"],a.events.focus),focusOut:K(["original"],a.events.focusOut),dblclick:K(["original"],a.events.dblclick),selectionchange:r(["original"]),paint:K([],a.events.paint)});a.events.selectionchange.bind(function(a){R().each(function(){y.trigger.selectionchange(a.original())})});return{win:a.win,doc:a.doc,body:a.body,canvas:a.body,getContent:a.get,setContent:a.set,resetContent:function(b){a.set(b);g.clear();e.clear();b=Ka.freefallLtr(a.body());
n(b.element(),b.offset(),b.element(),b.offset());k()},blur:a.blur,focus:function(){ro.toEditor(a.focused,z,h,q.fromDom(document))},uiChanged:function(){u(function(){y.trigger.uiStale()})},domChanged:k,clearSelection:function(){rb.clearAll(window)},getSelection:c,setSelection:n,setRelativeSelection:function(a,b){na(function(){rb.setRelative(window,a,b)})},backupSelection:G,replaceSelection:function(a){R().fold(function(){p();R().each(function(){rb.replace(window,a);l()})},function(b){rb.replace(window,
a);l()})},execCommand:v,destroy:function(){a.destroy();s.destroy();d.unbind();e.destroy()},events:y.registry,futures:a.futures,background:a.background,foreground:a.foreground,translateScreen:w,translateLocation:w}}function so(){var a=null,b=[],c=function(){return null!==a},d=function(){k.each(b,function(a){e(a)})},e=function(b){setTimeout(function(){b.apply(null,a)},0)};return{get:function(a){c()?e(a):b.push(a)},set:function(){a=Array.prototype.slice.call(arguments);d();b=[]},isSet:c}}function fQ(a,
b,c){var d=q.fromTag("div");O.presentation(d);t.set(d,"display","none");var e=ua.get(a);(function(b){var c=y.owner(a);k.each(b,function(a){gQ.addLinkIfMissing(c,a)})})(b);b=so();var g=ZP(a),l=dQ(g,c);b.set(l);return{element:function(){return a},onCanvas:function(a){a(l.canvas())},initial:f.constant(e),placeholder:function(){return d},tabindex:function(b){m.set(a,"tabindex",b)},destroy:function(){B.remove(d);l.destroy()},loaded:b.get,isInline:f.constant(!0)}}function hQ(a,b){var c=a.doc();return{execCommand:function(a){var e=
arguments,g=a.toLowerCase(),l=f.die("This should not be in hare."),l={fontsize:l,forecolor:l,fontname:l,bgcolor:l,inserthtml:l,blockquote:l};(void 0!==l[g]?l[g]:function(){c.dom().execCommand.apply(c.dom(),e)})();b.update()}}}function iQ(a){var b=function(){return rb.get(a.win())},c=function(b,c,g,l){b=Zb(b,c,g,l);rb.set(a.win(),b)};return{clearSelection:function(){rb.clearAll(a.win())},getSelection:b,replaceSelection:function(b){rb.replace(a.win(),b)},setSelection:c,setRelativeSelection:function(b,
c){rb.setRelative(a.win(),b,c)},restore:f.noop,backup:f.noop,nativeCall:f.apply,focus:function(){Sv.focus(a,b,c)},destroy:f.noop,clear:f.noop}}function jQ(a,b){var c=h.none(),d=E.bind(b,"blur",function(a){g()}),e=function(){c=h.none()},g=function(){rb.get(a.win()).fold(f.noop,function(a){c=h.some(a)})},l=function(b,d){try{d(a.win(),b),c=h.some(b)}catch(e){Tv()}},p=function(a){l(a,rb.set)},s=function(){c.each(p)},z=function(a){var b=document.activeElement;a=a();null!==b&&void 0!==b&&b!==document.activeElement&&
void 0!==b.focus&&b.focus();return a};return{clearSelection:function(){T.hasFocus(b)&&rb.clearAll(a.win())},getSelection:function(){return T.hasFocus(b)?rb.get(a.win()):c},replaceSelection:function(c){T.hasFocus(b)||s();rb.replace(a.win(),c)},setSelection:function(a,c,d,e){z(function(){var g=Zb(a,c,d,e);T.hasFocus(b)?p(g):l(g,f.noop)})},setRelativeSelection:function(b,c){z(function(){e();try{rb.setRelative(a.win(),b,c)}catch(d){Tv()}g()})},restore:s,backup:g,nativeCall:function(a){return z(function(){T.hasFocus(b)||
s();return a()})},focus:function(){if(document.activeElement!==b.dom()){var d=c;a.focus();d.each(p)}else rb.get(a.win()).fold(s,f.noop)},destroy:function(){d.unbind()},clear:e}}function kQ(a,b,c){var d=Y.detect(),e=d.browser.isIE()||d.browser.isEdge()?jQ(a,b):iQ(a),g=E.bind(a.doc(),"click",Ov(a.win(),a.body(),e.backup)),l=function(){return e.getSelection()},p=Rv(l,c),f=hQ(a,p);(d.browser.isChrome()||d.browser.isSafari())&&f.execCommand("defaultParagraphSeparator",!1,"p");p.events.nodeChanged.bind(function(a){m.trigger.nodeChanged(a.node(),
a.offset(),a.prev());m.trigger.uiStale()});a.events.keyup.bind(function(a){e.backup();p.update(a)});var z=oc.adaptable(p.update,300);a.events.mouseup.bind(function(a){e.backup();z.throttle(a)});var h=Qv(a);h.events.loiter.bind(function(a){m.trigger.loiter(a.node(),a.offset())});c=function(){h.reset();m.trigger.interaction()};a.events.keyup.bind(c);a.events.mouseup.bind(c);a.events.paint.bind(function(a){return m.trigger.paint()});var k=function(){m.trigger.domChanged()},G=function(a,b,c,d){e.setSelection(a,
b,c,d);p.update()},R=function(a,c){return Ja.absolute(b).translate(a,c)},m=D.create({nodeChanged:r(["node","offset","prev"]),loiter:r(["node","offset"]),uiStale:r([]),domChanged:r([]),interaction:r([]),keydown:K(["original"],a.events.keydown),keyup:K(["original"],a.events.keyup),keypress:K(["original"],a.events.keypress),mousedown:K(["original"],a.events.mousedown),mouseup:K(["original"],a.events.mouseup),contextmenu:K(["original"],a.events.contextmenu),cut:K(["original"],a.events.cut),copy:K(["original"],
a.events.copy),paste:K(["original"],a.events.paste),focus:K(["original"],a.events.focus),focusOut:K(["original"],a.events.focusOut),dblclick:K(["original"],a.events.dblclick),selectionchange:K(["original"],a.events.selectionchange),paint:r([])});return{win:a.win,doc:a.doc,body:a.body,canvas:a.doc,getContent:a.get,setContent:a.set,resetContent:function(b){a.set(b);e.clear();p.clear();b=Ka.freefallLtr(a.body());G(b.element(),b.offset(),b.element(),b.offset());k()},blur:a.blur,focus:function(){e.focus()},
uiChanged:function(){m.trigger.uiStale()},domChanged:k,clearSelection:function(){e.clearSelection()},getSelection:l,setSelection:G,setRelativeSelection:function(a,b){e.setRelativeSelection(a,b);p.update()},backupSelection:function(){e.backup()},replaceSelection:function(a){e.replaceSelection(a);p.update()},execCommand:function(){var a=arguments;e.nativeCall(function(){f.execCommand.apply(null,a);m.trigger.uiStale()})},destroy:function(){e.destroy();a.destroy();h.destroy();g.unbind();p.destroy()},
events:m.registry,futures:a.futures,background:a.background,foreground:a.foreground,translateScreen:R,translateLocation:function(b,c){var d=Ga.get(a.doc());return R(b,c).translate(-d.left(),-d.top())}}}function lQ(a){return{background:f.noop,foreground:f.noop,focus:f.noop,keydown:f.noop,mousedown:h.some,mouseup:h.some,selectionchange:function(a){return oc.adaptable(a,300).throttle}}}function mQ(a,b){return{background:f.noop,foreground:f.noop,focus:function(a,d,e){Ga.preserve(q.fromDom(document),function(){Ga.preserve(y.owner(e),
function(){b.browser.isEdge()&&window.getSelection().removeAllRanges();e.dom().focus()})})},keydown:f.noop,mousedown:h.some,mouseup:h.some,selectionchange:f.constant(f.noop)}}function nQ(a){var b=function(a){return"body"===A.name(a.target())||"html"===A.name(a.target())?h.none():h.some(a)};return{background:function(a,b,e){y.owner(b).dom().defaultView.focus()},foreground:function(a,b,e){void 0!==a.focus&&a.focus()},focus:f.noop,keydown:function(a){void 0!==a.focus&&a.focus()},mousedown:function(a){return b(a)},
mouseup:function(a){return b(a)},selectionchange:f.constant(f.noop)}}function oQ(a,b){var c=a.dom().contentWindow,d=Uv.doc(a),e=I.descendant(d,"body").getOrDie();ea.add(e,[ed.base(),ed.active()]);b.autoresize&&n.add(y.documentElement(e),ed.autoresize());var g=pQ.browser.isFirefox(),l=D.create({keydown:r(["original"]),keyup:r(["original"]),keypress:r(["original"]),mousedown:r(["original"]),mouseup:r(["original"]),contextmenu:r(["original"]),cut:r(["original"]),copy:r(["original"]),paste:r(["original"]),
focus:r(["original"]),dblclick:r(["original"]),focusOut:r(["original"]),paint:r([]),selectionchange:r(["original"])}),p=qQ.get(l),s=function(){return k.filter(d.dom().styleSheets,function(a){try{return 0<=a.cssRules.length}catch(c){return b.needStyles&&console.warn("Unable to access rules from "+a.href),!1}})},z={stylesheetLoad:va.nu(function(a){var b=0,d=setInterval(function(){50<b||0>=c.stillToLoad?(clearInterval(d),a(h.some(s()))):b++},100)})},x=E.bind(d,"keydown",function(a){p.keydown(c);l.trigger.keydown(a)}),
M=E.bind(d,"keyup",function(a){l.trigger.keyup(a)}),G=E.bind(d,"keypress",function(a){l.trigger.keypress(a)}),R=E.bind(d,"mousedown",function(a){p.mousedown(a).fold(function(){a.kill()},l.trigger.mousedown)}),m=E.bind(d,"mouseup",function(a){p.mouseup(a).fold(function(){a.kill()},l.trigger.mouseup)}),na=E.bind(d,"contextmenu",function(a){l.trigger.contextmenu(a)}),q=E.bind(d,"cut",function(a){l.trigger.cut(a)}),t=E.bind(d,"copy",function(a){l.trigger.copy(a)}),u=E.bind(d,"paste",function(a){l.trigger.paste(a)}),
v=E.bind(d,g?"focus":"focusin",function(a){l.trigger.focus(a)}),w=E.bind(d,"focusout",function(a){l.trigger.focusOut(a)}),A=E.bind(d,"dblclick",function(a){l.trigger.dblclick(a)}),B=p.selectionchange(function(a){l.trigger.mouseup(a)}),C=E.bind(d,"selectionchange",function(a){B(a);l.trigger.selectionchange(a)}),F=E.bind(d,"touchstart",function(a){l.trigger.mousedown(a)}),L=E.bind(d,"touchend",function(a){l.trigger.mouseup(a);N()}),H=function(){l.trigger.paint()},J=E.capture(d,"load",H),K=function(){c.addEventListener("resize",
H,!1);return{unbind:function(){c.removeEventListener&&c.removeEventListener("resize",H,!1)}}}(),N=function(){p.foreground(c,a,e)};return{win:f.constant(c),doc:f.constant(d),body:f.constant(e),get:function(){return ua.get(e)},set:function(a){ua.set(e,a)},focus:function(){p.focus(c,a,e)},focused:function(){return document.activeElement===a.dom()},blur:function(){e.dom().blur()},destroy:function(){k.each([x,M,G,R,m,na,q,t,u,v,w,C,A,F,L,J,K],function(a){a.unbind()})},events:l.registry,futures:z,background:function(){p.background(c,
a,e)},foreground:N}}function rQ(a){var b=q.fromTag("iframe");n.add(b,sQ.resolve("content-iframe"));var c=h.none(),d=so(),e=E.bind(b,"load",function(){e.unbind();var g=tQ(a);Vv.write(b,g);g=Wv.onShow(b,function(){c.each(f.apply);c=h.none();ca.inBody(b)&&d.set(oQ(b,a))});c=h.some(g)});return{element:function(){return b},tabindex:function(a){m.set(b,"tabindex",a)},destroy:function(){B.remove(b);e.unbind();c.each(f.apply)},loaded:d.get}}function uQ(a,b){var c=rQ(a),d=so(),e=f.noop;c.loaded(function(g){var l=
kQ(g,c.element(),b),p=function(a){a=ha.get(y.documentElement(l.body()));var b=ha.get(c.element());a!==b&&ha.set(c.element(),a)},s=function(a){a=ha.get(l.body());var b=ha.get(c.element());a!==b&&ha.set(l.body(),b)},z=oc.last(p,0),z=a.autoresize?z.throttle:s,p=a.autoresize?p:s;l.events.uiStale.bind(f.curry(z,"uiStale"));l.events.domChanged.bind(f.curry(z,"domChanged"));l.events.paint.bind(f.curry(z,"paint"));g.events.keyup.bind(f.curry(p,"keyup"));g.events.mouseup.bind(f.curry(p,"mouseup"));setTimeout(function(){d.set(l);
e=l.destroy},0)});return{element:c.element,onCanvas:function(a){d.get(function(b){a(b.canvas())})},initial:f.constant(""),placeholder:c.element,tabindex:c.tabindex,destroy:function(){e();c.destroy()},loaded:d.get,isInline:f.constant(!1)}}function vQ(a){var b=h.none(),c=h.none(),d=function(){b.each(function(b){a.setSelection(b.startContainer(),b.startOffset(),b.endContainer(),b.endOffset())});c.each(function(a){a.restore()})},e=function(){b=h.none();c=h.none()};return{restore:function(){d();e()},save:function(){b=
a.getSelection();c=a.doc().map(Ga.capture)},get:function(){return b},clear:e,attempt:function(a){b=a.or(b)}}}function to(){var a=D.create({fail:r(["url","image"]),success:r(["url","image"]),start:r(["url"])}),b=function(a,b,c){var l=a.dom();l.addEventListener(b,c,!1);return{unbind:function(){l.removeEventListener(b,c,!1)}}},c=function(c){var e=m.get(c,"src"),g=b(c,"load",function(){g.unbind();l.unbind();(!0===c.dom().complete?a.trigger.success:a.trigger.fail)(e,c)}),l=b(c,"error",function(){g.unbind();
l.unbind();a.trigger.fail(e,c)})};return{go:function(b){a.trigger.start(b);var e=new Image;e.src=b;c(q.fromDom(e))},monitor:c,events:a.registry}}function wQ(a){var b=xa({}),c=xa([]),d={},e=h.none();return{structure:b.get,all:c.get,main:function(){return c.get()[0]},update:function(g){k.each(c.get(),function(a){B.remove(a)});e=h.some(g);var l=W.keys(d);W.each(d,function(a){a.assign(e)});var p=W.tupleMap(d,function(a,b){return{k:b,v:a.situation(g)}}),f=xQ.derive(a,l,p),z=yQ.derive(a,l,p),l=k.foldr(l,
function(a,b){return Z.merge(a,p[b].submenus())},{});if(0===f.length)c.set([]);else{var x=ab.mainmenu(a,w.resolve("main-context-menu"),[]);J.append(x,f);O.menu(x,u.translate("aria.context.menu.generic"));f=[x].concat(z);k.each(f,function(a){n.add(a,w.resolve("layer-menus"))});c.set(f);b.set(l)}},handle:function(a){var b=uo.type(a),b=d[b];void 0!==b&&b.handle(a)},register:function(a,b){d[a]=b}}}function zQ(a,b,c,d,e,g){var l=[],p={register:function(a,b){l=l.concat([{name:a,feature:b}])},destroy:f.noop};
b.events.ready.bind(function(f){p=AQ(a,b,c,d,e,g);k.each(l,function(a){p.register(a.name,a.feature)})});return{register:function(a,b){p.register(a,b)},destroy:function(){p.destroy()}}}function BQ(a,b,c,d){var e=function(c){b.get().fold(f.noop,function(b){c.stopper();d.transaction(function(){k.each(b,CQ)});a.domChanged();a.toEditing();k.find(b,function(a){return qa.is(a,od.lastSelectedSelector())}).bind(Ab.first).each(function(b){a.setSelection(b,0,b,0)})},f.noop)},g=c.editor();g.events.del.bind(e);
g.events.backspace.bind(e);g.on();return{destroy:function(){g.off()}}}function DQ(){var a=!0;return{isHandled:function(){return a},handle:function(){a=!1}}}function EQ(a,b){var c=D.create({preLinebreak:r(["handler"]),postLinebreak:r([])});FQ.listen(a);var d=function(d){b.save();a.getSelection().each(function(b){var e=DQ();c.trigger.preLinebreak(e);a.getSelection().each(function(b){e.isHandled()&&(Xv.preLinebreak(a),(d?Yv.soft:Yv.hard)(b,a.isRoot).each(function(b){a.setRelativeSelection(b.start(),
b.finish());a.domChanged();a.cursorIntoView()}));c.trigger.postLinebreak()})})},e=nd.isTextArea;a.events.keydown.bind(function(a){hd.isEnter(a)&&!e(a.original().target())&&(a.original().raw().preventDefault(),d(a.original().raw().shiftKey))});return{linebreak:d,destroy:f.noop,events:c.registry}}function vo(a,b){return{find:function(b){return X.descendants(b,a)},cleaner:b}}function GQ(){var a=[];return{add:function(b){a.push(b)},get:function(){return a.slice(0)}}}function HQ(){var a={},b=function(b){return h.from(a[b])};
return{get:b,getOrInit:function(b){var d=a[b];void 0===d&&(a[b]=GQ(),d=a[b]);return d},filterDom:function(a,d){b(a).each(function(a){dk.filterDom(d,a.get())})},filterHtml:function(a,d){return b(a).fold(function(){return d},function(a){return dk.filterHtml(d,a.get())})}}}function IQ(a,b){return{find:function(b){return lc.descendants(b,a)},cleaner:b}}function JQ(a){var b=HQ(),c=f.constant("output"),d=f.constant("input"),e=f.constant("history"),g=f.constant("internal"),l=f.constant("paste"),p=[],s=function(a,
c,d){a=b.getOrInit(a);c=vo(c,d);a.add(c)},h=function(a,c,d){a=b.getOrInit(a);c=IQ(c,d);a.add(c)};a=Du(a,s,h);return{add:function(a,b,c){s(a,"."+b,c)},addSelector:s,addPredicate:h,filterHtml:b.filterHtml,filterDom:b.filterDom,internal:g,output:c,input:d,paste:l,history:e,customFilters:f.constant(a),state:a.state,destroy:f.noop,addExcludedContext:function(a){p=p.concat(a)},includeContext:function(a){return!k.exists(p,f.curry(qa.is,a))}}}function KQ(a,b,c){var d=!1,e=D.create({maximize:r(["layout"]),
restore:r(["layout"]),analytics:r(["message"]),select:r([]),deselect:r([])}),g=function(){e.trigger.maximize(c.alternate)},l=function(){e.trigger.restore(c.alternate)},p=function(a){d?a.select():a.deselect()},s=function(){e.trigger.analytics("fullscreen_"+(d?"off":"on"));a.focus();(d?l:g)()},h=function(a,b){var c=u.key(d?"action.toggle.fullscreen":"action.fullscreen");return Va.get(c,b)};b.events.fullscreen.bind(s);b=Za.ui({"fullscreen.general":function(){return{toggle:!0,value:"fullscreen",textkey:u.key("action.fullscreen"),
tooltip:h,action:s,updateGeneral:p,icon:!0,shortcut:!0,selected:d}}},f.identity);var x=Za.actions({maximize:g,restore:l});return{ui:b,actions:x,select:function(){d=!0},deselect:function(){d=!1},destroy:f.noop,events:e.registry}}function LQ(){var a={inputLinks:"insertLink"},b=D.create({internal:r(["command","data"])}),c=function(c,e){h.from(a[c]).fold(function(){throw Error("invalid internal event: "+c);},function(a){k.each(e,function(c){b.trigger.internal(a,c)})})};return{input:function(a){a=Pc.many(a);
c("inputLinks",a)},destroy:f.noop,events:b.registry}}function MQ(a,b,c){var d=zh(),e=[E.bind(b,"keydown",d.keydown),E.bind(b,"keypress",d.keypress),E.bind(c,"keydown",d.keydown),E.bind(c,"keypress",d.keypress)],g=function(a){d.keydown(a.original())},l=function(a){d.keypress(a.original())};a.events.keydown.bind(g);a.events.keypress.bind(l);return{off:d.off,on:d.on,swallowShortcuts:d.swallowShortcuts,yieldShortcuts:d.yieldShortcuts,swallowChars:d.swallowChars,yieldChars:d.yieldChars,swallowKeys:d.swallowKeys,
yieldKeys:d.yieldKeys,destroy:function(){k.each(e,function(a){a.unbind()});a.events.keydown.unbind(g);a.events.keypress.unbind(l)},events:d.events}}function NQ(a){var b=zh(),c=function(a){b.keydown(a.original())},d=function(a){b.keypress(a.original())};a.events.keydown.bind(c);a.events.keypress.bind(d);return{off:b.off,on:b.on,swallowShortcuts:b.swallowShortcuts,yieldShortcuts:b.yieldShortcuts,swallowChars:b.swallowChars,yieldChars:b.yieldChars,swallowKeys:b.swallowKeys,yieldKeys:b.yieldKeys,events:b.events,
destroy:function(){a.events.keydown.unbind(c);a.events.keypress.unbind(d)}}}function OQ(a){var b=zh(),c=E.bind(a,"keydown",b.keydown),d=E.bind(a,"keypress",b.keypress);return{off:b.off,on:b.on,swallowShortcuts:b.swallowShortcuts,yieldShortcuts:b.yieldShortcuts,swallowChars:b.swallowChars,yieldChars:b.yieldChars,swallowKeys:b.swallowKeys,yieldKeys:b.yieldKeys,destroy:function(){c.unbind();d.unbind()},events:b.events}}function PQ(a,b){return{all:function(){return MQ(a,b.element(),b.uiContainerParent())},
container:function(a){return OQ(a)},editor:function(){return NQ(a)},destroy:f.noop}}function Zv(a){return{backup:f.identity,restore:f.constant(h.none()),element:f.constant(a)}}function QQ(a,b){var c=w.resolve("ops-eph-cursor");a.add(a.internal(),c,Ca.remove);a.add(a.output(),c,Ca.remove);a.addExcludedContext(["."+c]);var d=function(a){var d=function(d){d=$v.diagnose(b.isRoot,d)(c,a);d.cursor().each(function(a){ca.inBody(a.startContainer())&&ca.inBody(a.endContainer())&&b.getSelection().each(function(c){b.setSelection(a.startContainer(),
a.startOffset(),a.endContainer(),a.endOffset())})});return d.result()};return function(){return b.getSelection().fold(a,d)}};return{destroy:f.noop,run:function(a){return d(a)()}}}function RQ(a,b){var c=QQ(a,b),d=function(a,c){var d=a(),e=aw.handle(c);b.getSelection().forall(function(a){return!L.eq(a.startContainer(),e.startContainer())||!L.eq(a.endContainer(),e.endContainer())||a.startOffset()!==e.startOffset()||a.endOffset()!==e.endOffset()})&&b.setSelection(e.startContainer(),e.startOffset(),e.endContainer(),
e.endOffset());return d},e=function(a){return A.isText(a)||"br"===A.name(a)};return{destroy:function(){},run:c.run,preserve:f.curry(rf.preserve,b),lightweightWith:function(a,b){return e(b.startContainer())&&e(b.endContainer())||Jb.detect(h.some(b)).isSome()?d(a,b):c.run(a)},adapt:function(a){b.getSelection().each(function(b){c.run(function(){a(b.startContainer(),b.endContainer())})})},pure:function(a){b.getSelection().each(function(b){a(b.startContainer(),b.endContainer())})},atomic:function(a){return c.run(a)}}}
function bw(){var a=D.create({back:r([]),abort:r([])});return{ui:Za.ui({"back.general":{toggle:!1,value:"mobile-back",textkey:u.key("toolbar.backbutton"),action:function(){a.trigger.back()},updateGeneral:f.noop,icon:!0,label:!0}}),events:a.registry,destroy:f.noop}}function Wd(a,b){return H.error({small:f.constant(a),big:f.constant(b)})}function SQ(a,b,c,d,e){var g=function(a,b){return a()?b:{feature:h.none()}};c=g(function(){return!a&&Lb.isLargeDesktop()},{feature:c.ui(),command:"fullscreen",type:"general",
unsupported:"Fullscreen is not supported in inline mode"});e=Lb.choice([Hh(Lb.isLargeDesktop,{feature:d.fileupload().ui(),command:"fileupload",type:"general"}),Hh(Lb.isLargeTouch,{feature:d.fileupload().ui(),command:"fileupload",type:"menu"})],wo.make({feature:d.fileupload().ui(),command:"fileupload"},e.allowLocalImages?["camera"]:[]));var l=g(Lb.isLargeDesktop,{feature:d.accessibility().ui(),command:"a11ycheck",type:"general"}),g=g(Lb.isLarge,{feature:d.specialchar().ui(),command:"specialchar",type:"general"}),
f=Lb.choice([Hh(Lb.isLarge,{feature:d.blocktag().ui(),command:"bullist",type:"split-widget"})],{feature:d.blocktag().ui(),command:"bullist",type:"general"}),s=Lb.choice([Hh(Lb.isLarge,{feature:d.blocktag().ui(),command:"numlist",type:"split-widget"})],{feature:d.blocktag().ui(),command:"numlist",type:"general"}),z={feature:d.formatting().ui(),command:"superscript",type:"general"},x={feature:d.formatting().ui(),command:"subscript",type:"general"},k={feature:d.formatting().ui(),command:"strikethrough",
type:"general"},G={feature:d.font().ui(),command:"fontface",type:"dropdown"},R=Lb.choice([Hh(Lb.isTouch,{feature:d.font().ui(),command:"fontsize",type:"general"})],{feature:d.font().ui(),command:"fontsize",type:"inline-widget"}),m={feature:d.font().ui(),command:"fontcolor",type:"widget"},na={feature:d.spelling().hasAutocorrect()?d.macros().ui():h.none(),command:"autocorrect",type:"general"},n={feature:d.spelling().ui(),command:"spelling",type:d.spelling().hasDropdown()?"dropdown":"general"},q={feature:d.macros().ui(),
command:"capitalisation",type:"general"},r={feature:d.help().ui(),command:"help",type:"general"},t={feature:d.wordcount().ui(),command:"wordcount",type:"general"};return{link:{feature:d.link().ui(),command:"link",type:"general"},wordcount:t,media:{feature:d.media().ui(),command:"media",type:"general"},hr:{feature:d.horizontalrule().ui(),command:"horizontalrule",type:"general"},specialchar:g,fileupload:e,table:{feature:d.table().ui(),command:"table",type:"widget"},undo:{feature:b.ui(),command:"undo",
type:"general"},redo:{feature:b.ui(),command:"redo",type:"general"},styles:{feature:d.blocktag().ui(),command:"blocktag",type:"dropdown"},language:{feature:d.parlance().ui(),command:"parlance",type:"dropdown"},ltrdir:{feature:d.directionality().ui(),command:"ltrdir",type:"general"},rtldir:{feature:d.directionality().ui(),command:"rtldir",type:"general"},bold:{feature:d.formatting().ui(),command:"bold",type:"general"},italic:{feature:d.formatting().ui(),command:"italic",type:"general"},underline:{feature:d.formatting().ui(),
command:"underline",type:"general"},bookmark:{feature:d.bookmark().ui(),command:"bookmark",type:"general"},strikethrough:k,superscript:z,subscript:x,ul:f,ol:s,removeformat:{feature:d.formatting().ui(),command:"removeformat",type:"general"},alignment:{feature:d.alignindent().ui(),command:"alignment",type:"dropdown"},outdent:{feature:d.alignindent().ui(),command:"outdent",type:"general"},indent:{feature:d.alignindent().ui(),command:"indent",type:"general"},blockquote:{feature:d.alignindent().ui(),command:"blockquote",
type:"general"},"font-menu":{name:"font",textkey:u.key("font.menu-button"),menuTextkey:u.key("font.menu"),type:"submenu",contentFocus:!0,commands:[{category:"Font-menu",items:[G,R,m,z,x,k]}]},"font-face":G,"font-size":R,"font-color":m,fullscreen:c,find:{feature:d.findreplace().ui(),command:"find",type:"general"},accessibility:l,usersettings:{name:"usersettings",textkey:u.key("cog.menu-button"),menuTextkey:u.key("cog.menu"),type:"submenu",flatten:wo.never(),contentFocus:!0,commands:[{category:"a",
items:[t]},{category:"b",items:[n,na,q]},{caetgory:"",items:[r]}]}}}function cw(){var a={id:"insert",label:u.key("insert.menu-button"),menuLabel:u.key("insert.menu"),items:[["link","bookmark","fileupload","media","table"],["specialchar","hr"]]};return{undo:{label:u.key("category.undo"),items:["undo","redo"]},insert:{label:u.key("category.insert"),items:[a]},style:{label:u.key("category.style"),items:["styles"]},language:{label:u.key("category.language"),items:["language","ltrdir","rtldir"]},emphasis:{label:u.key("category.emphasis"),
items:["bold","italic","underline"]},align:{label:u.key("category.align"),items:["alignment"]},listindent:{label:u.key("category.listindent"),items:["ul","ol","outdent","indent","blockquote"]},format:{label:u.key("category.format"),items:["font-menu","removeformat"]},tools:{label:u.key("category.tools"),items:["find","accessibility","fullscreen","usersettings"]},"table-tools":{label:u.key("category.table"),items:["table-tools"]},"image-tools":{label:u.key("category.image"),items:["image-tools","crop-tools"]}}}
function ek(a){return{closeMenus:function(b){b=b?b.target():a;dw.target(b,"mousedown")}}}function TQ(a){return function(b,c){var d=E.bind(a,"touchmove",b.move),e=E.bind(a,"touchend",b.drop);return{element:f.constant(a),start:f.noop,stop:f.noop,destroy:function(){d.unbind();e.unbind()}}}}function ew(a,b,c,d){var e=xa(h.none());c=fk.mode({compare:xo.compare,extract:xo.extract,sink:c,mutate:function(a,c){e.get().each(function(a){xo.resize(b,a,c)})}});var g=Dh.transform({},{mode:c}),l=E.bind(a,"touchstart",
function(a){"img"===A.name(a.target())&&2===a.raw().touches.length&&(e.set(h.some(a.target())),g.on(),g.go(b))});g.events.stop.bind(function(){e.get().each(function(a){t.remove(a,"transform")});d()});return{destroy:function(){l.unbind();g.destroy()}}}function UQ(a,b,c){var d=c.toolbar.element(),e=fw.tag(),g=[],l=q.fromDom(document),p=ek(d),s=null,z=pc.api(),x=h.none(),M=function(){z.run(function(a){a.toEditing()})},G=function(){p.closeMenus()},R=function(){a.getSelection().each(function(a){a=a.collapsed()?
"0px":"23px";t.set(d,"margin-top",a)})},m=function(a){t.set(d,"margin-top","0px")},na=function(){var c=[E.bind(d,"touchmove",p.closeMenus)];g=a.doc().map(function(a){return b||!0===VQ?[]:[E.bind(a,"selectionchange",R),E.bind(l,"focusin",m)]}).getOr([]).concat(c)},r=function(){k.each(g,function(a){a.unbind()})};return{enter:function(){a.body().each(function(b){a.doc().each(function(c){a.win().each(function(d){T.focus(b);s=eg.onChange();var e=TQ(c),e=ew(c,b,e,f.noop);x=h.some(e);d=WQ.setup(window,d);
z.set(d);a.events.toEditing.bind(M);s.events.change.bind(G)})})});n.add(d,"ephox-polish-mobile-show");c.toolbar.refresh();e.maximize();na()},exit:function(){z.clear();a.events.toEditing.unbind(M);s.events.change.unbind(G);null!==s&&s.destroy();e.restore();r()},destroy:function(){x.each(function(a){a.destroy()});r()}}}function gw(){var a=q.fromTag("div");n.add(a,w.resolve("disabled-mask"));var b=!1,c=P.div();n.add(c,w.resolve("content-container"));var d=P.div();O.hidden(d,!0);n.add(d,w.resolve("tap-icon"));
v.append(c,d);var e=P.div();n.add(e,w.resolve("disclosure"));v.append(e,q.fromText(u.translate("taptoedit")));v.append(c,e);v.append(a,c);O.textButton(a,c);var g=D.create({fullscreen:r([])}),l=function(b){var c=a.dom().getClientRects()[0];return k.forall(b,function(a){return a.pageY>=c.top&&a.pageY<=c.top+c.height&&a.pageX>=c.left&&a.pageX<=c.left+c.width})},p=[E.bind(a,"touchmove",function(a){b=!0}),E.bind(a,"touchend",function(a){var c=a.raw().changedTouches;l(c)&&!b&&(a.kill(),g.trigger.fullscreen())}),
E.bind(a,"touchstart",function(a){b=!1}),E.bind(a,"click",function(a){a.kill();g.trigger.fullscreen()})];return{element:f.constant(a),events:g.registry,destroy:function(){k.each(p,function(a){a.unbind()});B.remove(d);B.remove(e);B.remove(c);B.remove(a)},show:function(){t.remove(a,"display")},hide:function(){t.set(a,"display","none")}}}function hw(a,b,c,d,e,g){var l=g.element(),f=UQ(a,e.fillscreen,g),s=function(){f.enter();d.actions().maximize()},h=function(){var a=gw();v.append(g.element(),a.element());
a.events.fullscreen.bind(function(a){d.actions().maximize()})};return{init:function(){g.socket(a);a.events.scrollToCursor.bind(function(){rf.cursorIntoView(a)})},loaded:function(){var a=!0===e.fillscreen;(n.has(l,w.resolve("fullscreen-maximized"))||a?s:h)()},restoreEditor:function(){d.actions().restore();f.exit()},destroy:function(){a.body().each(T.blur)}}}function XQ(a,b,c,d,e){var g=d.toolbar.items,l=function(l){var f=hw(a,b,c,e,d,l),h=bw();l=Ih.config({items:[["back"]].concat(g),contextual:[]},
{back:{feature:h.ui(),command:"back",type:"general"}},{allowLocalImages:d.allowLocalImages});h.events.back.bind(function(){f.restoreEditor()});return{init:f.init,loaded:f.loaded,config:l,destroy:function(){f.destroy();h.destroy()}}};return{tabbed:l,full:l,destroy:f.noop}}function YQ(a,b,c,d,e){var g=d.toolbar.items,l=function(l){var f=hw(a,b,c,e,d,l);l=Ih.config({items:g,contextual:[]},{},{allowLocalImages:d.allowLocalImages});return{init:f.init,loaded:f.loaded,config:l,destroy:function(){f.destroy()}}};
return{tabbed:l,full:l,destroy:f.noop}}function ZQ(a,b,c,d){b=function(b){return{init:function(){b.socket(a);a.events.scrollToCursor.bind(function(){rf.cursorIntoView(a)});a.events.toEditing.bind(a.focus)},loaded:f.noop,config:Ih.config(d.toolbar,{},{allowLocalImages:d.allowLocalImages}),destroy:f.noop}};return{tabbed:b,full:b,destroy:f.noop}}function $Q(a,b){var c=fw.tag(),d=h.none(),e=gw();return{maximize:function(){d=h.some(document.body.scrollTop);t.set(e.element(),"display","none");n.add(a,w.resolve("fullscreen-maximized"));
iw.clobberStyles(a,b);c.maximize()},restore:function(){iw.restoreStyles();n.remove(a,w.resolve("fullscreen-maximized"));c.restore();t.remove(e.element(),"display");d=d.bind(function(a){document.body.scrollTop=a;return h.none()})},destroy:function(){e.destroy()},mask:f.constant(e)}}function aR(a,b){var c=a.document,d=q.fromTag("div");n.add(d,pd.resolve("unfocused-selections"));v.append(q.fromDom(c.documentElement),d);var e=E.bind(d,"touchstart",function(c){c.prevent();yo.resume(a,b);l()}),g=function(a){var b=
q.fromTag("span");ea.add(b,[pd.resolve("layer-editor"),pd.resolve("unfocused-selection")]);t.setAll(b,{left:a.left+"px",top:a.top+"px",width:a.width+"px",height:a.height+"px"});return b},l=function(){B.empty(d)};return{update:function(){l();var b=zo.getRectangles(a),b=k.map(b,g);J.append(d,b)},isActive:function(){return 0<y.children(d).length},destroy:function(){e.unbind();B.remove(d)},clear:l}}function bR(a){var b=xa(Xd.pure({}));return{start:function(c){var d=Xd.nu(function(b){return a(c).get(b)});
d.get(f.identity);b.set(d)},idle:function(a){b.get().get(function(){a()})}}}function cR(a){return function(b,c){var d=E.bind(a,"touchmove",b.move),e=E.bind(a,"touchend",b.drop),g=E.bind(a,"gesturestart",function(a){"img"===A.name(a.target())&&a.prevent()});return{element:f.constant(a),start:f.noop,stop:f.noop,destroy:function(){d.unbind();e.unbind();g.unbind()}}}}function dR(a,b,c,d,e,g,l,f){var s=[],z=g.toolbar.element(),x=g.banners(),M=g.viewport(),G=h.none(),R=ek(z),m=null,na=pc.api(),r=h.none(),
u=cc.event(M),v=C.immutableBag("cWin ceBody socket toolstrip toolbar contentElement cursor keyboardType isScrolling".split(" "),[]),y=function(){na.run(function(a){a.highlightSelection()})},A=function(){na.run(function(a){a.refreshSelection()})},B=function(a){var b=Ja.absolute(a).top()-M.dom().scrollTop;na.run(function(c){c.scrollIntoView(b,b+ha.get(a))})},CO=function(){jw.insertAtCursor(d,a,function(a){var b=a.absolute().top()-M.dom().scrollTop;na.run(function(c){c.scrollIntoView(b,b+a.height())})})},
D=function(a){CO();na.run(function(a){a.syncHeight()})},F=function(a){var b=ha.get(z);na.run(function(a){a.setViewportOffset(b)});A();D()},H=function(a){B(a.element())},J=oc.adaptable(D,300),K=function(){R.closeMenus()},N=function(){U();var a=setInterval(function(){0===window.pageYOffset&&(clearInterval(a),D())},100)},P=function(){na.run(function(a){a.clearSelection()})},O=function(){P();J.throttle()},Q=function(){na.run(function(a){a.toEditing()})},S=function(){na.run(function(a){a.toReading()})},
V=function(a){na.run(function(b){b.onToolbarTouch(a)})},U=function(){(eg.get().isPortrait()?n.remove:n.add)(g.element(),w.resolve("mobile-landscape"))},W=function(a){var b=t.get(a,"background-color");void 0!==b&&""!==b&&t.set(a,"-webkit-tap-highlight-color",b)},X=function(b){var c=a.win().getOrDie(),d=function(a){T.focus(b);a=a.raw().changedTouches[0];Ea.getAtPoint(c,a.pageX,a.pageY).each(function(a){Ea.setExact(c,a.start(),a.soffset(),a.finish(),a.foffset())})},e=a.doc().map(function(a){var c=cR(a),
c=ew(a,b,c,D);r=h.some(c);var e=q.fromDom(a.dom().documentElement);return[E.bind(a,"touchend",function(a){(L.eq(e,a.target())||L.eq(b,a.target()))&&d(a)})]}).getOr([]),g=[E.capture(z,"touchstart",function(a){y();V(a)}),E.bind(b,"touchstart",P),gk.handle(b,Y),E.bind(z,"touchmove",R.closeMenus)];s=e.concat(g)},Y=function(a){a.kill()};return{exit:function(){a.body().each(function(b){t.remove(x,"display");t.set(g.viewport(),"overflow","hidden");G=G.bind(function(a){a.unbind();return h.none()});n.remove(z,
w.resolve("mobile-show"));na.clear();T.blur(b);t.remove(b,"padding-top");k.each(s,function(a){a.unbind()});l.restore();a.events.keyup.unbind(O);a.events.domChanged.unbind(J.throttle);a.events.scrollToCursor.unbind(J.throttle);a.events.scrollToElement.unbind(H);a.events.domChanged.unbind(A);a.events.nodeChanged.unbind(A);a.events.toEditing.unbind(Q);a.events.toReading.unbind(S);m.events.change.unbind(K);m.events.ready.unbind(N);g.toolbar.events.transitionend.unbind(F);null!==m&&m.destroy()})},enter:function(b){a.body().each(function(b){a.win().each(function(d){m=
eg.onChange();l.maximize();X(b);T.focus(b);G=h.some(kw.exclusive(c,"."+cc.scrollable()));t.getRaw(z,"overflow-x").is("auto")&&I.descendant(z,".ephox-chameleon-toolbar").each(function(a){kw.markAsHorizontal(a);cc.register(a)});W(b);U();document.body.scrollTop=0;n.add(z,w.resolve("mobile-show"));g.toolbar.refresh();t.set(x,"display","block");I.descendant(z,".ephox-chameleon-toolbar").each(function(c){na.set(eR.setup(v({cWin:d,ceBody:b,socket:M,toolstrip:z,toolbar:c,contentElement:a.element(),cursor:a.cursor(),
keyboardType:fR.stubborn,isScrolling:u.isScrolling})))});a.events.keyup.bind(O);a.events.domChanged.bind(J.throttle);a.events.scrollToCursor.bind(J.throttle);a.events.scrollToElement.bind(H);a.events.domChanged.bind(A);a.events.nodeChanged.bind(A);a.events.toEditing.bind(Q);a.events.toReading.bind(S);m.events.change.bind(K);m.events.ready.bind(N);g.toolbar.events.transitionend.bind(F);D()})})},destroy:function(){r.each(function(a){a.destroy()});G.each(function(a){a.unbind()});u.destroy()}}}function lw(a,
b,c,d,e){var g=$Q(e.element(),a),l=q.fromDom(document),p=a.element(),s=f.constant(!0===d.fillscreen),h=dR(a,b,l,c,p,e,g,s),x=function(a){var b=y.children(a),c;if(!(c=0===b.length)){if(b=1===b.length)b=ua.get(a),b=10===b.charCodeAt(0)&&10===b.charCodeAt(1);c=b}c&&(b=q.fromHtml("<p><br></p>"),v.append(a,b));h.enter()},k=function(a){v.append(e.element(),g.mask().element());g.mask().events.fullscreen.bind(function(a){h.enter()})},G=function(a){(s()?x:k)(a)};return{init:function(){e.socket(a)},loaded:function(){a.body().each(G)},
restoreEditor:function(){a.body().each(T.blur);a.element().dom().focus();a.element().dom().blur();h.exit();T.focus(g.mask().element())},destroy:function(){a.body().each(T.blur);h.destroy();g.destroy()}}}function gR(a,b,c,d){var e=d.toolbar.items;return{tabbed:function(g){var l=lw(a,b,c,d,g),f=bw();g=Ih.config({items:[["back"]].concat(e),contextual:[]},{back:{feature:f.ui(),command:"back",type:"general"}},{allowLocalImages:d.allowLocalImages});f.events.back.bind(function(){l.restoreEditor()});return{init:l.init,
loaded:l.loaded,config:g,destroy:function(){l.destroy();f.destroy()}}},full:f.die("mobile does not support fullscreen layout"),destroy:f.noop}}function hR(a,b,c,d){var e=d.toolbar.items;return{tabbed:function(g){var l=lw(a,b,c,d,g);g=Ih.config({items:e,contextual:[]},{},{allowLocalImages:d.allowLocalImages});return{init:l.init,loaded:l.loaded,config:g,destroy:function(){l.restoreEditor();l.destroy()}}},full:f.die("mobile does not support fullscreen layout"),destroy:f.noop}}function iR(a,b,c,d,e){return(mw.deviceType.isiOS()?
!0===e.fillscreen?hR:gR:mw.deviceType.isAndroid()?!0===e.fillscreen?YQ:XQ:ZQ)(a,b,c,e,d)}function Jh(a,b){var c=Ao.readOr(a,b),d=xa(c),e=function(a){d.set(a)};return{setAndCache:function(b){e(b);Ao.write(a,b)},set:e,get:function(){return d.get()}}}function jR(a){var b=Jh("native.spelling",a.nativeSpelling),c=Jh("spelling",a.spelling),d=Jh("autocorrect",a.autocorrect),e=Jh("linkpreviews",a.linkpreviews),g=Jh("capitalisation",a.capitalisation);return{spelling:f.constant(c),nativeSpelling:f.constant(b),
autocorrect:f.constant(d),linkpreviews:f.constant(e),capitalisation:f.constant(g),state:function(){return{nativeSpelling:b.get(),spelling:c.get(),autocorrect:d.get(),linkpreviews:e.get(),capitalisation:g.get()}},destroy:f.noop}}function kR(a,b,c){var d=b.all();d.on();var e=[];d.events.backspace.bind(function(){Bo.get(a,e,Kh.left).each(B.remove)});b=function(b){var d=b.stopper();Bo.get(a,e,Kh.left).each(function(b){d();nw.upOrLeft(a,c,b)})};d.events.right.bind(function(b){var d=b.stopper();Bo.get(a,
e,Kh.right).each(function(b){d();nw.right(a,c,b)})});d.events.left.bind(b);d.events.up.bind(b);return{registerSkip:function(a){e.push(a)},destroy:function(){d.destroy()}}}function lR(a,b){(b.error?h.some(b.error):h.none()).map(function(a){return xh(Yd.get(a.name,[a]))}).each(a.displayBanner);return{destroy:f.noop}}function ow(a){return{elementFromPoint:function(b,c){return q.fromPoint(q.fromDom(a.document),b,c)},getRect:function(a){return a.dom().getBoundingClientRect()},getRangedRect:function(b,
c,d,e){b=Vb.exact(b,c,d,e);return Ea.getFirstRect(a,b).map(function(a){return W.map(a,f.apply)})},getSelection:function(){return Ea.get(a).map(function(b){return fg.convertToRange(a,b)})},fromSitus:function(b){b=Vb.relative(b.start(),b.finish());return fg.convertToRange(a,b)},situsFromPoint:function(b,c){return Ea.getAtPoint(a,b,c).map(function(a){return{start:f.constant(da.on(a.start(),a.soffset())),finish:f.constant(da.on(a.finish(),a.foffset()))}})},clearSelection:function(){Ea.clear(a)},setSelection:function(b){Ea.setExact(a,
b.start(),b.soffset(),b.finish(),b.foffset())},setRelativeSelection:function(b,c){Ea.setRelative(a,b,c)},selectContents:function(b){Ea.setToElement(a,b)},getInnerHeight:function(){return a.innerHeight},getScrollY:function(){return Ga.get(q.fromDom(a.document)).top()},scrollBy:function(b,c){Ga.by(b,c,q.fromDom(a.document))}}}function mR(a,b,c,d){var e=h.none(),g=function(){e=h.none()};return{mousedown:function(a){d.clear(b);e=pw(a.target(),c)},mouseover:function(g){e.each(function(e){d.clear(b);pw(g.target(),
c).each(function(g){Ce.identify(e,g,c).each(function(c){var l=c.boxes().getOr([]);if(1<l.length||1===l.length&&!L.eq(e,g))d.selectRange(b,l,c.start(),c.finish()),a.selectContents(g)})})})},mouseup:function(){e.each(g)}}}function nR(a){var b=function(b){return!a.isRoot(b)&&(Lh.isBlock(b)||"li"===A.name(b))},c=function(a){return A.isText(a)&&0===Fa.get(a).trim().length},d=function(b,c,d,e){return sa.closest(b,function(b){return y.parent(b).exists(a.isRoot)},a.isRoot).fold(function(){return S.point(b,
c)},function(a){return d(a,b,c)?e(a):S.point(b,c)})},e=function(e,g){var l=function(b){return Kb.before(b,a.isRoot).fold(function(){return S.point(e,g)},function(a){return c(a)?l(a):S.point(a,ja.getEnd(a))})};return sa.closest(e,function(a){return b(a)&&y.prevSibling(a).isSome()},a.isRoot).fold(function(){return d(e,g,tf.isAtLeftEdge,l)},function(a){return b(e)||tf.isAtLeftEdge(a,e,g)?l(a):S.point(e,g)})},g=function(e,g){var l=function(b){return Kb.after(b,a.isRoot).fold(function(){return S.point(e,
g)},function(a){return c(a)?l(a):S.point(a,0)})};return sa.closest(e,function(a){return b(a)&&y.nextSibling(a).isSome()},a.isRoot).fold(function(){return d(e,g,tf.isAtRightEdge,l)},function(a){return b(e)||tf.isAtRightEdge(a,e,g)?l(a):S.point(e,g)})},l=function(a,b){return L.eq(a.element(),b.element())?a.offset()<=b.offset():wc.after(a.element(),a.offset(),b.element(),b.offset())};return{getSelection:function(a){return a.getSelection().bind(function(a){var b;b=a.startContainer();var c=a.endContainer();
L.eq(b,c)?(c=y.child(b,a.startOffset()),b=y.child(b,a.endOffset()),b=c.filter(fa.isList).isSome()||b.filter(fa.isList).isSome()):b=!0;if(b){if(wc.after(a.startContainer(),a.startOffset(),a.endContainer(),a.endOffset()))return b=Ka.toLeaf(a.startContainer(),a.startOffset()),a=Ka.toLeaf(a.endContainer(),a.endOffset()),b=ja.isStart(b.element(),b.offset())?e(b.element(),b.offset()):S.point(b.element(),b.offset()),a=ja.isEnd(a.element(),a.offset())?g(a.element(),a.offset()):S.point(a.element(),a.offset()),
a=l(b,a)?h.some(Zb(b.element(),b.offset(),a.element(),a.offset())):h.some(Zb(a.element(),a.offset(),b.element(),b.offset())),a;b=Ka.toLeaf(a.startContainer(),a.startOffset());a=Ka.toLeaf(a.endContainer(),a.endOffset());b=ja.isEnd(b.element(),b.offset())?g(b.element(),b.offset()):S.point(b.element(),b.offset());a=ja.isStart(a.element(),a.offset())?e(a.element(),a.offset()):S.point(a.element(),a.offset());a=l(b,a)?h.some(Zb(a.element(),a.offset(),b.element(),b.offset())):h.some(Zb(b.element(),b.offset(),
a.element(),a.offset()));return a}return h.some(a)})}}}function oR(a,b,c){pR.configure(b);var d=nR(c),e=D.create({beforeScan:r([]),afterScan:r([])}),g=qw.byClass(od);b=function(){c.body().each(function(a){c.getSelection().each(function(b){Zd.sharedOne(Xa.table,[b.startContainer(),b.endContainer()]).fold(function(){g.clear(a)},f.noop)})})};(rw.browser.isChrome()||rw.browser.isSafari())&&c.events.contextmenu.bind(b);c.events.nodeChanged.bind(b);var l=xa([]);c.runOrOnLoaded(function(b){var d=y.defaultView(b).dom(),
p=sw.mouse(d,b,c.isRoot,g),s=sw.keyboard(d,b,c.isRoot,g);l.set([hk.leftDown.bind(b,p.mousedown),hk.leftPressedOver.bind(b,p.mouseover),hk.leftUp.bind(b,p.mouseup),E.bind(b,"keyup",function(a){a.raw().shiftKey&&Qc.isNavigation(a.raw().which)&&c.getSelection().each(function(b){s.keyup(a,b.startContainer(),b.startOffset(),b.endContainer(),b.endOffset()).each(function(b){h(a,b)})},f.noop)}),E.bind(b,"keydown",function(b){c.getSelection().each(function(c){e.trigger.beforeScan();var d=a.directionAt(c.endContainer()).isRtl()?
Qc.rtl:Qc.ltr;s.keydown(b,c.startContainer(),c.startOffset(),c.endContainer(),c.endOffset(),d).each(function(a){h(b,a)});e.trigger.afterScan()})})]);var h=function(a,b){b.kill()&&a.kill();b.selection().each(function(a){c.setRelativeSelection(a.start(),a.finish())})}});var p=function(a){return{win:a.win,doc:a.doc,execCommand:a.execCommand,getSelection:function(){return d.getSelection(a)},setSelection:a.setSelection,setRelativeSelection:a.setRelativeSelection,focus:a.focus}},s=function(a,b){return{doc:b.doc,
win:b.win,execCommand:b.execCommand,focus:b.focus,setSelection:f.noop,setRelativeSelection:f.noop,getSelection:function(){return h.some(z(a))}}},z=function(a){return{startContainer:f.constant(a),startOffset:f.constant(0),endContainer:f.constant(a),endOffset:f.constant(ja.getEnd(a))}};return{get:function(){return c.on(function(a){return c.body().fold(qb.none,function(b){return tw.retrieve(b,od.selectedSelector()).fold(function(){return a.getSelection().fold(qb.none,function(b){b=d.getSelection(a).getOr(b);
return qb.single(b,p(a))})},function(b){var c=k.map(b,function(b){return s(b,a)});return qb.multiple(b,c)})})}).getOrThunk(qb.none)},surround:z,events:e.registry,destroy:function(){var a=l.get();k.each(a,function(a){a.unbind()})}}}function qR(a){a=Z.merge({scopes:[q.fromDom(document)],shortcuts:[],swallow:!1},a);var b=zh(a),c=[],d=[];k.each(a.scopes,function(a){c.push(E.bind(a,"keydown",b.keydown).unbind);d.push(E.bind(a,"keypress",b.keypress).unbind)});return{off:b.off,on:b.on,destroy:function(){k.each(c,
f.apply);k.each(d,f.apply)},events:b.events,swallowShortcuts:b.swallowShortcuts,yieldShortcuts:b.yieldShortcuts,swallowChars:b.swallowChars,yieldChars:b.yieldChars,swallowKeys:b.swallowKeys,yieldKeys:b.yieldKeys}}function rR(a,b){var c=D.create({undo:r([]),redo:r([]),context:r([]),toolbar:r([]),plaincode:r([]),bold:r([]),italic:r([]),underline:r([]),indent:r([]),outdent:r([]),link:r([]),blockquote:r([]),search:r([]),help:r([]),fullscreen:r([])}),d=sR(c),e=[d.undo,d.redo,d.context,d.toolbar],g=[d.plaincode,
d.bold,d.italic,d.underline,d.indent,d.outdent,d.link,d.search,d.blockquote,d.help,d.fullscreen],e=(d=!0===b.features)?e.concat(g):e,l=k.bind(e,function(a){return a.keys()}),p=k.map(e,function(a){return tR(a.keys(),a.trigger())}),s=h.none();a.onCanvas(function(a){a=qR({scopes:[a],shortcuts:l});s=h.some(a);a.swallowShortcuts(l);a.events.command.bind(function(a){var b=a.command();$a.findMap(p,function(a){return a(b)}).each(f.apply)});a.on()});return{isHelpShortcutEnabled:f.constant(d),events:c.registry,
destroy:function(){s.each(function(a){a.destroy()})}}}function uR(){var a=[],b=function(){a=k.filter(a,function(a){return Sb.isVisible(a.popup().panel())})};return{recalculate:function(){b();k.map(a,function(a){a.anchor().recalculate(a.popup())})},dismiss:function(){b();k.map(a,function(a){a.anchor().isAnchored()||a.popup().close()})},update:function(b,d){a=vR.put(a,b,d,wR,function(a){return a.popup()===b})},destroy:function(){}}}function xR(a,b,c,d){var e=uR(),g=a.isInline()?f.noop:xb.cached(function(){var b=
function(b){e.dismiss();a.focus()},c=!0===d.autoresize?q.fromDom(document):a.doc().getOrDie();l=uw.bind(c,b);!0!==d.autoresize&&!0===d.toolbar.sticky&&(p=uw.bind(q.fromDom(document),b))}),l=null,p=null,s=P.div();ea.add(s,[w.resolve("ui-container"),w.resolve("layer-above-editor")]);d.editorName.each(function(a){m.set(s,"data-ephox-editor",a)});var h=E.bind(s,"keydown",function(a){var b;if(b=k.contains(N.BACKSPACE(),a.raw().which))b=a.target(),b=f.curry(qa.is,b),b=!k.exists(["textarea","input",'[contenteditable="true"]'],
b);b&&a.kill()});return{uiContainer:f.constant(s),uiOrigin:function(){return gg.relativeOrigin(s)},refresh:e.recalculate,bounds:b,show:function(a,b){g();e.update(a,b);b.place(a)},destroy:function(){null!==l&&l.unbind();null!==p&&l.unbind();e.destroy();h.unbind();B.remove(s)}}}function yR(a,b,c){a=Iu(c,a);c=function(){var a=setTimeout(function(){clearTimeout(a);d.trigger.expired()},b);return{clear:function(){clearTimeout(a)}}};var d=D.create({expired:r([]),close:r([])}),e=0<b?c():{clear:f.noop};a.events.close.bind(function(){e.clear();
d.trigger.close()});return{element:a.element,action:a.action,destroy:a.destroy,events:d.registry}}function zR(a,b,c,d,e,g,l,p){var s=l.layout.build(a,b,c,d,e,g,l,p);b=function(a){db.closest(a.target(),'input,div[contenteditable="true"],textarea,.ephox-polish-dialog.ephox-polish-help-modal,select,.ephox-polish-bottom-bar,.ephox-polish-side-bar')||a.prevent()};var h=[E.bind(s.element(),"mousedown",b),E.bind(c.uiContainer(),"mousedown",b)];(function(){var b=n.toggler(s.element(),w.resolve("content-ltr")),
c=n.toggler(s.element(),w.resolve("content-rtl")),d=n.toggler(s.uiContainerParent(),w.resolve("content-ltr")),e=n.toggler(s.uiContainerParent(),w.resolve("content-rtl")),l=function(){b.off();d.off()},p=function(){b.on();d.on()},h=function(){c.off();e.off()},z=function(){c.on();e.on()},k=function(){var a=g.uiDirection().isRtl(),b=a?z:h;(a?l:p)();b()};a.events.uiStale.bind(function(){xv.readDir(a).fold(k,function(a){a.ltrdir().fold(l,f.noop,p);a.rtldir().fold(h,f.noop,z);b.isOn()===c.isOn()&&k()})})})();
return{element:s.element,connect:s.connect,viewport:s.viewport,uiContainerParent:s.uiContainerParent,socket:s.socket,showMessage:function(a,b,c){a=yR(a,b,c);b=f.curry(s.hideBanner,a);a.events.expired.bind(b);s.displayBanner(a);return b},displayBanner:s.displayBanner,hideBanner:s.hideBanner,init:s.init,refocus:s.tabstrip.refocus,tabstrip:s.tabstrip,refresh:s.refresh,position:s.position,state:s.state,destroy:function(){s.destroy();k.each(h,function(a){a.unbind()})},dialogContainer:s.dialogContainer}}
function Mh(a){var b=void 0!==a?a.slice(0):[];return{pop:function(){return h.from(b.pop())},push:function(a){b.push(a)},peek:function(){return h.from(b[b.length-1])},pushAll:function(a){b=b.concat(a)},clear:function(){b=[]},isEmpty:function(){return 0===b.length},size:function(){return b.length},state:function(){return b.slice(0)}}}function vw(a){var b=D.create({changed:r([]),reset:r([])}),c=a.initial,d=Mh(a.undo),e=Mh(a.redo),g=function(a){d.isEmpty()&&d.push(c);d.push(a);b.trigger.changed()},l=
function(a,b){b(d.peek().getOr(c),a)?(d.pop(),d.push(a)):(g(a),e.clear())};return{save:l,checkChanged:function(a,b){return!b(d.peek().getOr(c),a)},undo:function(a,c){l(a,c);return d.pop().bind(function(a){d.isEmpty()||(e.push(a),b.trigger.changed());return d.peek()})},redo:function(a,b){b(d.peek().getOr(c),a)||e.clear();return e.pop().bind(function(a){g(a);return d.peek()})},reset:function(a){c=a;d.clear();e.clear();b.trigger.reset()},state:function(){return{initial:c,undo:d.state(),redo:e.state()}},
rewrite:function(a){var g=a(c),l=k.map(d.state(),a);a=k.map(e.state(),a);c=g;d=Mh(l);e=Mh(a);d.isEmpty()&&e.isEmpty()||b.trigger.changed()},events:b.registry}}function AR(a,b,c,d,e){var g=BR.fromState(ww(e,CR)),l=D.create({changed:K([],g.events.changed),reset:K([],g.events.reset),undo:r([]),redo:r([])}),p=function(b,c){var d;if(!(d=""===b.raw()&&DR.isDefaultEmpty(c.raw()))){d=a.filterHtml(a.internal(),b.raw());var e=a.filterHtml(a.internal(),c.raw());d=d===e}return d},s=function(){var c=a.filterHtml(a.history(),
b.getContent()),d=a.filterHtml(a.history(),b.serialize());return ik(c,d)},h=function(a){return b.deserialize(a.marked())};e=function(){var a=s();g.undo(a,p).each(h);b.domChanged();b.toEditing();l.trigger.undo()};var x=function(){var a=s();g.redo(a,p).each(h);b.domChanged();b.toEditing();l.trigger.redo()},k=Lc.tap(function(a,b){if(a()){var c=s();g.save(c,b)}}),G=function(){k.instance(function(){return b.getSelectionStart().exists(ca.inBody)},p)},m=function(a){var b=k.control.isBlocked();k.control.block();
a=a();b||k.control.unblock();return a},Da=c.editor();Da.events.enter.bind(G);Da.on();d.events.undo.bind(e);d.events.redo.bind(x);b.events.undoChanged.bind(G);b.events.loiter.bind(G);c=Za.ui({"undo.general":{toggle:!1,value:"undo",textkey:u.key("action.undo"),action:e,shortcut:!0,updateGeneral:f.identity,tooltip:Va.get},"redo.general":{toggle:!1,value:"redo",textkey:u.key("action.redo"),action:x,shortcut:!0,updateGeneral:f.identity,tooltip:Va.get}});return{undo:e,redo:x,save:G,checkChanged:function(){var a=
s();return g.checkChanged(a,p)},reset:function(a){g.reset(ik(a,a))},destroy:function(){Da.off();Da.destroy()},state:function(){return ww(g.state(),ER)},rewrite:function(a,b){var c=function(c){return c.replace(a,b)};g.rewrite(function(a){return ik(c(a.raw()),c(a.marked()))})},transaction:function(a){G();a=m(a);G();return a},disable:m,replaceTop:function(){k.instance(f.constant(!0),f.constant(!0))},ui:c,events:l.registry}}function FR(a,b){var c=pc.unbindable(),d=D.create({onChange:r([])}),e=oc.last(function(){d.trigger.onChange()},
1E3),g=function(){a.runOrOnLoaded(function(d){(b?h.some(q.fromDom(document)):a.doc()).each(function(a){c.set(E.bind(a,"scroll",function(a){e.throttle()}));e.throttle()})})};a.isInline()||g();var l=function(){return a.body().bind(function(c){return(b?h.some(window):a.win()).map(function(d){var e=a.element().dom().getBoundingClientRect(),g=d.innerHeight,l=y.children(c);return k.findIndex(l,function(a){if(!A.isElement(a))return!1;a=a.dom().getBoundingClientRect();var c=b?a.bottom+e.top:a.bottom;return(b?
a.top+e.top:a.top)<g&&0<c}).map(function(a){var c=k.findIndex(l.slice(a+1),function(a){if(!A.isElement(a))return!1;a=a.dom().getBoundingClientRect();var c=b?a.bottom+e.top:a.bottom;return!((b?a.top+e.top:a.top)<g&&0<c)}).map(function(b){return a+1+b}).getOr(l.length);return l.slice(a,c)}).getOr([c])})}).getOr([])};return{sections:function(){return l()},setOn:g,setOff:function(){c.clear()},viewport:function(){return{assess:function(b){if(!A.isElement(b))return uf.inView(b);var c=a.win().map(function(a){return a.innerHeight}).getOr(0),
d=b.dom().getBoundingClientRect();c=0>d.bottom?uf.aboveView:d.top>c?uf.belowView:uf.inView;return c(b)}}},destroy:function(){c.clear();e.cancel()},events:d.registry}}function xw(){var a=yw.single(),b=D.create({upload:r(["assets"])});a.events.upload.bind(function(a){qd.multiple(a.files()).get(function(a){b.trigger.upload(a)})});return{element:a.element,open:a.open,destroy:a.destroy,events:b.registry}}function Co(a){var b=h.none(),c=function(c){d();c=xh(c);c.events.close.bind(function(){b=h.none()});
b=h.some(c);a().displayBanner(c)},d=function(){b.each(a().hideBanner);b=h.none()};return{show:c,showKey:function(a){var b=Yd.get.apply(void 0,arguments);c(b)},hide:d,reset:function(){b=h.none()}}}function zw(a,b){var c=Z.merge({layerClass:void 0,zindex:void 0,padding:"0px"},a),d=D.create({exiting:r([])}),e=q.fromTag("div");O.presentation(e);n.add(e,Bb.resolve("modal"));n.add(e,Bb.resolve("modal-hidden"));t.setAll(e,{position:"fixed",left:c.padding,top:c.padding,right:c.padding,bottom:c.padding});
void 0!==c.background&&t.set(e,"background",c.background);void 0!==c.zindex&&t.set(e,"z-index",c.zindex);void 0!==c.layerClass&&n.add(e,c.layerClass);var g=void 0!==b?b:I.first("body").getOrDie();v.append(g,e);return{element:function(){return e},content:function(a){B.empty(e);v.append(e,a)},show:function(){n.add(g,Bb.resolve("modal-active"));n.remove(e,Bb.resolve("modal-hidden"));n.add(e,Bb.resolve("modal-show"))},hide:function(){n.remove(g,Bb.resolve("modal-active"));n.add(e,Bb.resolve("modal-hidden"));
n.remove(e,Bb.resolve("modal-show"))},destroy:function(){B.remove(e);n.remove(g,Bb.resolve("modal-active"))},events:d.registry}}function GR(a,b){var c=eg.onChange(),d=D.create({exiting:r([])}),e=Z.merge({layerClass:null,zindex:null,padding:"0px",background:"rgba(0, 0, 0, 0.5)"},a),g=q.fromTag("div");O.presentation(g);n.add(g,Bb.resolve("moodal"));n.add(g,Bb.resolve("moodal-hidden"));t.setAll(g,{left:e.padding,top:e.padding,right:e.padding,bottom:e.padding});e.background&&t.set(g,"background",e.background);
e.zindex&&t.set(g,"z-index",e.zindex);e.layerClass&&n.add(g,e.layerClass);var l=void 0!==b?b:I.first("body").getOrDie();v.append(l,g);var p=q.fromTag("div");O.presentation(p);n.add(p,Bb.resolve("moodal-flexor"));v.append(g,p);var s=function(){t.setAll(p,{top:window.scrollY+"px",height:window.innerHeight+"px"})},h=function(){x.unbind();c.destroy();B.remove(g);n.remove(l,Bb.resolve("modal-active"))},x=E.bind(g,"click",function(){d.trigger.exiting();h()});c.events.ready.bind(function(){s()});return{element:f.constant(g),
content:function(a){B.empty(p);v.append(p,a)},show:function(){n.add(l,Bb.resolve("moodal-active"));n.remove(g,Bb.resolve("moodal-hidden"));n.add(g,Bb.resolve("moodal-show"));s()},hide:function(){n.remove(l,Bb.resolve("moodal-active"));n.add(g,Bb.resolve("moodal-hidden"));n.remove(g,Bb.resolve("moodal-show"))},destroy:h,events:d.registry}}function HR(a){var b=Z.deepMerge({layerClass:void 0,zindex:void 0,modal:{}},a);a=void 0!==a.container?a.container:I.first("body").getOrDie();var c=(Y.detect().os.isiOS()?
GR:zw)(b.modal,a),d=c.element(),e=D.create({exiting:K([],c.events.exiting)});void 0!==b.zindex&&t.set(d,"z-index",b.zindex);void 0!==b.layerClass&&n.add(d,b.layerClass);n.add(d,Bb.resolve("centered-dialog"));v.append(a,d);return{content:c.content,show:function(){c.show()},hide:function(){c.hide()},destroy:function(){B.remove(d);c.destroy()},events:e.registry}}function IR(){var a=function(a,b){n.add(a,w.resolve(b));return a},b=a(P.div(),"dialog"),c=a(P.div(),"top"),d=a(P.span(),"dialog-title"),e=a(P.span(),
"dialog-close"),g=a(P.div(),"dialog-content"),l=a(P.div(),"dialog-controls");m.set(b,"tabindex",-1);m.set(e,"tabindex",-1);O.button(e,u.translate("button.close"));var f=E.bind(e,"click",function(){s.trigger.close()});J.append(b,[c,g,l]);J.append(c,[d,e]);var s=D.create({close:r([])});return{element:function(){return b},focus:function(){T.focus(b)},setTitle:function(a){B.empty(d);v.append(d,q.fromText(a));JR||(O.dialog(b,a),a=Ma.generate("ephox-aria"),m.set(d,"id",a),O.labelledBy(b,a))},setContent:function(a){B.empty(g);
v.append(g,a);a=Ma.generate("ephox-aria");m.set(g,"id",a);O.describedBy(b,a)},setControls:function(a){B.empty(l);v.append(l,a)},close:function(){s.trigger.close()},destroy:function(){B.remove(b);f.unbind()},events:s.registry}}function $d(a){var b=IR(),c=h.none(),d=HR({container:a,layerClass:w.resolve("layer-dialog"),modal:{layerClass:w.resolve("layer-below-dialog")}});d.content(b.element());d.events.exiting.bind(function(){cc.unlock([ca.body()]);b.close()});var e=function(){d.hide();cc.unlock([ca.body()])};
return{element:b.element,destroy:function(){b.destroy();c.each(function(a){a.unbind()});e();d.destroy()},setTitle:b.setTitle,setContent:b.setContent,setControls:b.setControls,show:function(){d.content(b.element());d.show();b.focus();KR.deviceType.isTouch()&&(c=h.some(E.bind(b.element(),"click",function(a){a.stop()})));cc.lock([ca.body()])},hide:e,events:b.events}}function Aw(a,b,c,d,e,g){var l=Rc.okCancel("file-upload"),f=d(e),s=null,h=Y.detect(),x=D.create({close:r([]),analytics:r(["message"]),escaped:r([]),
insertAssets:r(["assets"]),opened:r([])}),k=function(){s.unbind();m.hide();x.trigger.close();x.trigger.analytics("insert_image_closed");G()},G=function(){f.reset();l.ok().disable()},m=$d(c);m.setTitle(u.translate("fileupload.title"));m.setContent(f.element());m.setControls(l.element());m.events.close.bind(k);n.add(m.element(),w.resolve("imageupload-dialog"));var Da=g(m.element(),f.keylayouts(),pa.dialog({cancel:l.cancel().element(),ok:l.ok().element(),execute:ob.click,index:0}));f.events.upload.bind(function(a){x.trigger.insertAssets(a.assets());
k()});f.events.dragndrop.bind(function(a){x.trigger.insertAssets(a.assets());k()});f.events.success.bind(function(a){l.ok().enable()});f.events.lookup.bind(function(a){l.ok().disable()});f.events.setActive.bind(function(a){G()});l.events.ok.bind(function(){f.selected().each(function(a){x.trigger.insertAssets([a]);k()})});l.events.cancel.bind(k);G();return{show:function(){h.deviceType.isiOS()&&(O.hidden(b.element(),!0),setTimeout(function(){f.focus();O.hidden(b.element(),!1)},250));m.show();Da.enter();
x.trigger.analytics("insert_image_opened");x.trigger.opened();var c=q.fromDom(window);s=E.bind(c,"orientationchange",function(){a.foreground()})},element:m.element,events:x.registry,destroy:function(){Da.exit();Da.destroy();m.hide();m.destroy();f.destroy();l.destroy()}}}function LR(a){var b=D.create({success:r(["assets"]),invalidUrl:r(["url"]),empty:r([]),lookup:r([])}),c=[],d=P.div(),e=n.toggler(d,ib.resolve("url-indicator-loading")),g=to();g.events.start.bind(function(){e.on()});g.events.fail.bind(function(a){e.off();
b.trigger.invalidUrl(a.url());c=[]});g.events.success.bind(function(a){e.off();var d=$.get(z);a.url()===d?qd.fromImages([a.image()]).get(function(a){c=a;b.trigger.success(c)}):g.go(d)});var l=P.div();n.add(l,ib.resolve("url-selector"));var p=q.fromTag("label");a=q.fromText(a("fileupload.web.url"));var s=Ma.generate(ib.resolve("input-id"));m.set(p,"for",s);n.add(p,ib.resolve("url-input-label"));v.append(p,a);var z=q.fromTag("input");m.setAll(z,{id:s,type:"url",placeholder:"http://www.example.com/image.jpg"});
n.add(z,ib.resolve("url-input"));Bw.os.isAndroid()&&m.set(z,"autofocus","true");Bw.browser.isSafari()&&m.setAll(z,{autocomplete:"off",autocorrect:"off",autocapitalize:"off",spellcheck:"false"});O.required(z);a=q.fromHtml("<span role=presentation>*</span>");n.add(a,ib.resolve("url-input-required"));v.append(p,a);J.append(l,[p,z,d]);var x=oc.adaptable(function(a){""!==a&&g.go(a)},1E3),k=E.bind(z,"input",function(){var a=$.get(z);""===a.trim()?(b.trigger.empty(),x.throttle("")):(b.trigger.lookup(),x.throttle(a))});
return{element:f.constant(l),input:f.constant(z),events:b.registry,reset:function(){e.off();$.set(z,"")},focus:function(){T.focus(z)},selected:function(){return h.from(c[0])},destroy:function(){k.unbind()}}}function Cw(a){var b=D.create({lookup:r([]),success:r([])}),c=P.span(),d=q.fromHtml('<div role=presentation><span role=presentation class="'+ib.resolve("url-input-required")+'">*</span> '+a("fileupload.weburlhelp")+"</div>"),e=Ma.generate(ib.resolve("help-message"));m.set(d,"id",e);n.add(d,ib.resolve("fileupload-weburl-help"));
var g=q.fromHtml("<div role=presentation><div role=presentation>"+a("fileupload.invalid1")+"</div><div role=presentation>"+a("fileupload.invalid2")+"</div><div role=presentation>"+a("fileupload.invalid3")+"</div></div>");n.add(g,ib.resolve("fileupload-weburl-help"));n.add(g,ib.resolve("fileupload-weburl-help-invalid"));var l=function(a){B.empty(x);v.append(x,a)},p=function(a){var b=q.fromTag("img");v.append(x,b);MR.previewAsset(a,b)},s=P.div();n.add(s,ib.resolve("web-url-container"));var h=LR(a),
x=P.div();n.add(x,ib.resolve("image-preview-container"));a=Ma.generate("ephox-hermes-url-state");O.live(x,a,"polite");O.controls(h.input(),a);O.describedBy(h.input(),e);e=P.div();n.add(e,ib.resolve("hbox"));J.append(e,[h.element(),x,d]);v.append(s,e);h.events.lookup.bind(function(a){b.trigger.lookup();B.empty(x)});h.events.success.bind(function(a){k.each(a.assets(),p);b.trigger.success()});h.events.invalidUrl.bind(function(){l(g)});h.events.empty.bind(function(){l(c)});l(c);return{element:f.constant(s),
selected:h.selected,input:h.input,events:b.registry,focus:h.focus,reset:function(){l(c);h.reset()},destroy:function(){h.destroy()}}}function NR(a){a=P.div();var b=Cw(u.translate),c=D.create({upload:r(["assets"]),dragndrop:r(["assets"]),dragover:r([]),dragleave:r([]),drop:r([]),setActive:r(["item"]),lookup:K([],b.events.lookup),success:K([],b.events.success)}),d=[function(){var a=b.input();return ba.input(a,pa.input({}))}()];v.append(a,b.element());return{element:f.constant(a),events:c.registry,keylayouts:f.constant(d),
reset:function(){b.reset()},focus:b.focus,selected:b.selected,destroy:function(){b.destroy()}}}function OR(a,b,c,d,e){var g=D.create({insertAsset:r(["asset"]),open:r([]),done:r([]),abort:r([])}),l=q.fromDom(document);d=ab.mainmenu(l,"file-upload-menu",[]);var p=function(a,b){var c=ab.item(l,a,u.get(b)+"...");O.menuItem(c,h.some(u.get(b)),h.none());return c},s=p("from-url",u.key("image.from-url")),p=p("from-camera",u.key("image.from-camera")),s=!0===e.allowLocalImages?[s,p]:[s],z=xw();z.events.upload.bind(function(a){h.from(a.assets()[0]).each(function(a){M();
g.trigger.insertAsset(a)})});var x=function(a){a=a.assets();k.each(a,function(a){g.trigger.insertAsset(a)})},M=function(){dw.target(c.uiContainer(),"mousedown")};J.append(d,s);d={name:"image",textkey:u.key("image.menu-button"),menuTextkey:u.key("image.menu"),icon:h.none,tooltip:Va.get,contentFocus:!1,toggle:!1};s=[[{handlers:f.constant({"from-url":function(d){g.trigger.open();var l=Aw(a,b,c.uiContainer(),NR,e,ba.dialog);l.events.insertAssets.bind(x);d=function(){a.focus();l.destroy()};l.events.opened.bind(M);
l.events.close.bind(d);l.events.escaped.bind(d);l.show()},"from-camera":function(){g.trigger.open();z.open()}}),destroyer:f.noop,refreshMenu:f.noop,structure:f.constant({}),submenus:f.constant([]),items:f.constant(s),events:g.registry}]];d=Qd.menu(d,s,u.get,Bh.menu({focusActive:!0}));s={label:f.constant(!1),hasDialog:!0};return Z.merge(d,s)}function PR(a){var b=q.fromTag("button");m.set(b,"type","button");n.add(b,Ta.resolve("independent-button"));return Tn(b,h.none(),a)}function QR(a){var b=yw.multiple(),
c=P.div();n.add(c,ib.resolve("drop-container"));var d=Dw.register(c,h.some(ib.resolve("drop-active")),!1),e=PR();e.content(mc(a("fileupload.chooseimage")));n.add(e.element(),ib.resolve("default-action"));n.add(e.element(),ib.resolve("file-selector-trigger"));var g=q.fromTag("p");n.add(g,ib.resolve("help-text-drop-icon"));var l=q.fromTag("p");n.add(l,ib.resolve("help-text-drop"));ga.disable(l);v.append(l,q.fromText(a("fileupload.dropimages")));J.append(c,[g,l,e.element(),b.element()]);return{container:f.constant(c),
dropper:f.constant(d),picker:f.constant(b),button:f.constant(e),focus:function(){T.focus(e.element())},destroy:function(){b.destroy();d.destroy();e.destroy()}}}function RR(a){var b=QR(a);a=b.picker();var c=b.container(),d=b.dropper(),e=b.button(),g=D.create({upload:r(["assets"]),dragndrop:r(["assets"]),dragover:K([],d.events.dragover),dragleave:K([],d.events.dragleave),drop:K([],d.events.drop)}),l=function(a){return function(b){qd.multiple(b.files()).get(function(b){a(b)})}};a.events.upload.bind(l(g.trigger.upload));
d.events.dragndropimages.bind(l(g.trigger.dragndrop));e.events.click.bind(a.open);return{element:f.constant(c),button:f.constant(e),input:a.element,focus:b.focus,events:g.registry,destroy:function(){b.destroy()}}}function Ew(a,b,c){var d=[],e=C.immutable("view","item","container"),g=D.create({setActive:r(["item"])}),l=P.div();n.add(l,Ta.resolve("tablayout-wrapper"));n.add(l,Ta.resolve("tablayout-wrapper-"+a));void 0!==c&&n.add(l,c);var p=P.div();n.add(p,Ta.resolve("tablayout-body"));var s=q.fromTag("div");
n.add(s,Ta.resolve("tablayout-menu"));J.append(l,[s,p]);var h=function(a){var b=Un(a);b.content(mc(a));n.add(b.element(),Ta.resolve("tablayout-item"));return b},x=[],M=k.map(b,function(a){var b=h(a.heading());m.set(b.element(),"data-ephox-pastry-tablayout-tab",a.heading());v.append(s,b.element());var c=q.fromTag("div");n.add(c,Ta.resolve("tablayout-content"));m.set(c,"data-ephox-pastry-tablayout-view",a.heading());v.append(p,c);x.push(c);var g=e(a,b,c);d.push(g);b.events.click.bind(function(){G(g)});
return b}),G=function(a){k.each(d,function(b){var c=b.view(),d=b.item(),e=b.container();b===a?(n.add(e,Ta.resolve("tablayout-active")),d.select(),c.renderer().render(e),g.trigger.setActive(d)):(n.remove(e,Ta.resolve("tablayout-active")),d.deselect())})};G(d[0]);return{element:function(){return l},tabs:f.constant(M),body:f.constant(p),menu:f.constant(s),tabContent:f.constant(x),destroy:function(){k.each(M,function(a){a.destroy()})},events:g.registry}}function Fw(a){return{render:function(b){B.empty(b);
v.append(b,a)}}}function SR(a){var b=P.div(),c=RR(u.translate),d=Cw(u.translate),e=function(a,b){var c=u.translate(a),d=Fw(b);return vf(c,d)},g=e("fileupload.tabweburl",d.element());a=(a.allowLocalImages?[e("fileupload.tablocal",c.element())]:[]).concat(g);var l=Ew(Do.top(),a,"file-upload");O.hidden(c.input(),!0);e=function(){var a=c.button();n.add(a.element(),w.resolve("dialog-button-default"));var b=Y.detect().browser.isFirefox(),d={execute:ob.button},b=b?Z.merge(d,{process:f.noop}):d,b=pa.button(b);
return ba.button(a.element(),b)}();O.tabList(l.menu());var g=function(){var a=d.input();return ba.input(a,pa.input({}))}(),p=ba.flow(l.menu(),{item:f.constant(".ephox-pastry-statebutton")},pa.flow({trigger:ob.button,executeOnArrow:!0})),e=[p].concat(e).concat(g),s=l.tabs();k.each(l.tabContent(),function(a){O.tabPanel(a)});k.each(a,function(a,b){var c=s[b];O.tabButton(c.element(),a.heading());n.add(c.element(),w.resolve("tab-button"));c.events.click.bind(function(){p.clickFocus(c.element())})});k.each(l.tabContent(),
function(a,b){var c=s[b],d=Ma.generate("ephox-aria");m.set(c.element(),"id",d);O.labelledBy(a,d)});a=D.create({upload:K(["assets"],c.events.upload),dragndrop:K(["assets"],c.events.dragndrop),dragover:K([],c.events.dragover),dragleave:K([],c.events.dragleave),drop:K([],c.events.drop),lookup:K([],d.events.lookup),success:K([],d.events.success),setActive:K(["item"],l.events.setActive)});l.events.setActive.bind(function(a){a=m.get(a.item().element(),"data-ephox-pastry-tablayout-tab");a===u.translate("fileupload.tablocal")?
c.focus():a===u.translate("fileupload.tabweburl")&&d.focus()});v.append(b,l.element());return{element:f.constant(b),events:a.registry,focus:d.focus,keylayouts:f.constant(e),reset:function(){d.reset()},selected:d.selected,destroy:function(){l.destroy();c.destroy();d.destroy()}}}function id(a,b,c){a=parseFloat(a);a>c?a=c:a<b&&(a=b);return a}function De(a,b){var c,d,e,g,l=[],f=Array(10);for(c=0;5>c;c++){for(d=0;5>d;d++)l[d]=b[d+5*c];for(d=0;5>d;d++){for(e=g=0;5>e;e++)g+=a[d+5*e]*l[e];f[d+5*c]=g}}return f}
function Eo(a,b){b=id(b,0,1);return a.map(function(a,d){a=0===d%6?1-(1-a)*b:a*b;return id(a,0,1)})}function jk(a,b){return a.toCanvas().then(function(c){var d=a.getType(),e=bc.get2dContext(c),g=e.getImageData(0,0,c.width,c.height),l=g.data,f,s,h,x,k,G=b[0],m=b[1],n=b[2],q=b[3],r=b[4],t=b[5],u=b[6],v=b[7],w=b[8],y=b[9],A=b[10],B=b[11],D=b[12],C=b[13],E=b[14],I=b[15],F=b[16],H=b[17],J=b[18],L=b[19];for(k=0;k<l.length;k+=4)f=l[k],s=l[k+1],h=l[k+2],x=l[k+3],l[k]=f*G+s*m+h*n+x*q+r,l[k+1]=f*t+s*u+h*v+x*
w+y,l[k+2]=f*A+s*B+h*D+x*C+E,l[k+3]=f*I+s*F+h*H+x*J+L;e.putImageData(g,0,0);return rd.fromCanvas(c,d)})}function Gw(a,b){return a.toCanvas().then(function(c){return TR(c,a.getType(),b)})}function TR(a,b,c){var d=bc.get2dContext(a),e,g;e=d.getImageData(0,0,a.width,a.height);g=d.getImageData(0,0,a.width,a.height);g=function(a,b,c){function d(a,b,c){a>c?a=c:a<b&&(a=b);return a}var e,g,f,h,k,m,n,q,r,t,u,v,w,y;f=Math.round(Math.sqrt(c.length));h=Math.floor(f/2);e=a.data;g=b.data;w=a.width;y=a.height;for(k=
0;k<y;k++)for(a=0;a<w;a++){for(t=m=n=q=0;t<f;t++)for(r=0;r<f;r++)u=d(a+r-h,0,w-1),v=d(k+t-h,0,y-1),u=4*(v*w+u),v=c[t*f+r],m+=e[u]*v,n+=e[u+1]*v,q+=e[u+2]*v;u=4*(k*w+a);g[u]=d(m,0,255);g[u+1]=d(n,0,255);g[u+2]=d(q,0,255)}return b}(e,g,c);d.putImageData(g,0,0);return rd.fromCanvas(a,b)}function Hw(a){return function(b,c){return b.toCanvas().then(function(d){var e=b.getType(),g=bc.get2dContext(d),l,f=Array(256);for(l=0;l<f.length;l++)f[l]=a(l,c);l=g.getImageData(0,0,d.width,d.height);var s=l.data,h;
for(h=0;h<s.length;h+=4)s[h]=f[s[h]],s[h+1]=f[s[h+1]],s[h+2]=f[s[h+2]];g.putImageData(l,0,0);return rd.fromCanvas(d,e)})}}function hg(a){return function(b,c){return jk(b,a(ae.identity(),c))}}function Iw(a){return function(b){return Gw(b,a)}}function Jw(a,b,c){var d=ig.getWidth(a),e=ig.getHeight(a),d=b/d,g=c/e,e=!1;if(0.5>d||2<d)d=0.5>d?0.5:2,e=!0;if(0.5>g||2<g)g=0.5>g?0.5:2,e=!0;a=UR(a,d,g);return e?a.then(function(a){return Jw(a,b,c)}):a}function UR(a,b,c){return new Ud(function(d){var e=ig.getWidth(a),
g=ig.getHeight(a),l=Math.floor(e*b),f=Math.floor(g*c),s=bc.create(l,f);bc.get2dContext(s).drawImage(a,0,0,e,g,0,0,l,f);d(s)})}function VR(a,b,c,d,e){var g=a.content(),l=a.smartview(),p=a.ui().tabstrip,s=Co(a.ui),h=Nh.processResults(s.showKey),k=function(d){a.undo().save();d=WR.validate(d);(d.failure()?f.curry(s.showKey,"fileupload.invalidimages"):s.hide)();c.assets(d.assets()).map(h).get(function(a){Fo.insertAssets(g,b,a)})},M=function(a){k(a.assets())};d.events.insertAssets.bind(function(a){e.allowLocalImages?
k(a.assets()):Yd.getOrLog("errors.dragdrop.images.disallowed")});var G=g.cursor();d=D.create({analytics:r(["message"])});return{ui:Za.ui({"fileupload.general":f.constant({value:"image",textkey:u.key("insert.image"),icon:!0,updateGeneral:f.identity,action:function(){var b=Aw(g,p,l.uiContainer(),SR,e,ba.dialog);b.events.insertAssets.bind(M);b.events.close.bind(function(){g.focus();b.destroy()});b.events.escaped.bind(function(){g.focus();b.destroy()});a.content().hideInlineSelection();b.show()},hasDialog:!0}),
"fileupload.menu":function(){var c=OR(g,p,l,a.ui(),e);c.events.insertAsset.bind(function(a){G.get().bind(function(c){Fo.insertMobileAssets(g,c,b,[a.asset()])})});c.events.open.bind(function(a){g.getSelection().each(G.save)});return c},"camera.general":function(){var a=xw();a.events.upload.bind(function(a){G.get().bind(function(c){Fo.insertMobileAssets(g,c,b,a.assets())})});return{value:"image",textkey:u.key("image.from-camera"),icon:!0,updateGeneral:f.identity,action:function(){g.getSelection().each(G.save);
g.toReading();a.open()},hasDialog:!0}}},f.identity),events:d.registry,destroy:function(){}}}function Kw(a,b,c){var d=function(){b.counter.update(0,0)},e=function(e){e.all.fold(d,function(d){b.counter.update(e.pos+1,d.length);d=d[e.pos][0];a.setSelection(d,0,d,0);c.element(d)})},g=function(){c.cursor();d()},l=function(a,b,c){be.clear(a);be.search(a,b,c).fold(g,e);return h.some(b)},p=function(a,b){var c=(!0===b?be.prev:be.next)(a);c.fold(g,e);return c},s=function(b){a.body().each(function(c){be.replace(c,
b).fold(g,e);a.domChanged();a.undoChanged()})},z=h.none(),k=function(){z=h.none()};b.events.search.bind(function(b){a.body().each(function(a){l(a,b.term(),b.matchcase())})});b.events.next.bind(function(){a.body().each(function(a){p(a,!1)})});b.events.prev.bind(function(){a.body().each(function(a){p(a,!0)})});b.events.replace.bind(function(a){s(a.value())});b.events.replaceAll.bind(function(b){a.body().each(function(c){be.replaceAll(c,b.value()).fold(g,e);a.undoChanged()})});b.events.interactive.bind(function(b){a.body().each(function(a){z=
l(a,b.term(),b.matchcase())})});b.events.encase.bind(function(b){a.body().each(function(a){z.each(function(c){l(a,c,b.matchcase())})})});b.events.clear.bind(function(b){a.body().each(function(a){be.clear(a);k()})});return{zeroCount:d,updateMatch:e,enterSearchAction:function(c,d){a.body().each(function(a){var e=b.getCase();z=z.filter(function(a){return c===a}).fold(function(){return l(a,c,e)},function(b){return p(a,d.isShift()).fold(function(){return l(a,c,e)},f.constant(z))})});(0===c.length?b.counter.hide:
b.counter.show)()},enterReplaceAction:s,clearLastSearch:k}}function Lw(a){var b=a.content();a=function(a){b.elementIntoView(a)};var c=function(){b.cursorIntoView()};a={element:Mw?a:f.curry(rf.elementIntoView,b),cursor:Mw?c:f.curry(rf.cursorIntoView,b)};return{get:f.constant(a)}}function Nw(){var a=P.div();n.add(a,w.resolve("search-widget"));var b=kk.searchField(),c=(Lb.isSmallTouch()?kk.dummyCounter:kk.counter)(b.input()),d=kk.replaceDrawer(),e=d.element(),g=D.create({next:K([],b.events.next),prev:K([],
b.events.previous),replace:r(["value"]),replaceAll:r(["value"]),search:r(["term","matchcase","isShift"]),interactive:r(["term","matchcase"]),encase:r(["matchcase"]),clear:r([])});ga.setPressed(d.matchcase.element(),d.matchcase.selected());var l=Tu(e);O.linkElements(b.moreToggle.element(),e);Ow(l.visible(),b.moreToggle.element(),e);b.moreToggle.events.click.bind(function(){(l.visible()?l.hide:l.show)()});b.events.input.bind(function(){var a=$.get(b.input()),d=ha.get(b.element());t.set(c.element(),
"height",d+"px");a.length>=XR?s.throttle(a):(g.trigger.clear(),c.hide(),c.update(0,0))});d.replace.events.click.bind(function(){var a=$.get(d.input.element());g.trigger.replace(a)});d.replaceAll.events.click.bind(function(){var a=$.get(d.input.element());g.trigger.replaceAll(a)});d.matchcase.events.click.bind(function(){ga.setPressed(d.matchcase.element(),d.matchcase.selected());g.trigger.encase(p())});var p=function(){return d.matchcase.selected()},s=oc.adaptable(function(a){c.show();g.trigger.interactive(a,
p())},500),h=E.bind(e,"transitionend",function(a){"opacity"===a.raw().propertyName&&n.remove(e,"ephox-chameleon-toolbar-more-open");Ow(l.visible(),b.moreToggle.element(),e)});J.append(a,[c.element(),b.element(),d.element()]);return{element:f.constant(a),search:b,focus:function(){b.focus()},drawer:d,counter:c,getCase:p,destroy:function(){h.unbind();b.destroy();d.destroy();c.destroy();l.destroy();B.remove(a)},events:g.registry}}function YR(a){var b=a.content(),c=Nw();a=Lw(a);var d=Kw(b,c,a.get()),e=
function(a){var c=a.endContainer();a=a.endOffset();b.setSelection(c,a,c,a)};a=pa.button({execute:ob.button});a=[ba.input(c.search.input(),pa.input({execute:function(a,b){d.enterSearchAction(a,b)}})),ba.button(c.search.previous(),a),ba.button(c.search.next(),a),ba.button(c.search.moreToggle.element(),a),ba.input(c.drawer.input.element(),pa.input({execute:function(a,b){d.enterReplaceAction(a)}})),ba.button(c.drawer.matchcase.element(),a),ba.button(c.drawer.replace.element(),a),ba.button(c.drawer.replaceAll.element(),
a)];var g=D.create({done:r([])});return{element:c.element,anchorName:f.constant("search-widget-anchor"),textkey:f.constant("action.search"),dialogTextkey:f.constant("search.menu"),destroy:function(){c.destroy()},keylayouts:f.constant(a),openWidget:function(){d.enterSearchAction($.get(c.search.input()),Sc.shiftKeyState(!1))},closeWidget:function(){b.body().each(function(a){b.getSelection().each(e);be.clear(a)});d.clearLastSearch()},events:g.registry}}function ZR(a,b){var c=a.content(),d=Nw(),e=Lw(a),
g=Kw(c,d,e.get()),e=D.create({toEditor:r([])}),l=Oh.text(d.search.element(),d.search.input());return{element:d.element,addEscape:function(a){v.append(d.search.element(),a.element())},open:function(){g.enterSearchAction($.get(d.search.input()),Sc.shiftKeyState(!1));setTimeout(d.focus,250)},close:function(){c.body().each(function(a){be.clear(a).fold(g.zeroCount,g.updateMatch)});g.clearLastSearch()},execute:function(a){if(T.hasFocus(d.search.input())){a=Sc.shiftKeyState(!0===a.raw().shiftKey);var b=
$.get(d.search.input());g.enterSearchAction(b,a)}else a=$.get(d.drawer.input.element()),g.enterReplaceAction(a)},type:f.constant(l),events:e.registry,destroy:function(){d.destroy()}}}function lk(a,b){$R(b);var c=a.content(),d=a.ui().tabstrip.element();n.add(b.element(),w.resolve("slick-widget"));aS.browser.isSafari()&&k.each(X.descendants(b.element(),"input,textarea"),function(a){m.setAll(a,{autocomplete:"off",autocorrect:"off",autocapitalize:"off",spellcheck:"false"})});var e=function(){var a=X.descendants(b.element(),
"input,textarea");k.findIndex(a,T.hasFocus).each(function(b){b=(b+1)%a.length;0<=b&&b<a.length&&T.focus(a[b])})},g=Oh.cata(b.type(),function(a,c){n.add(a,w.resolve("slick-widget-field"));n.add(c,w.resolve("slick-widget-input"));var d=E.bind(b.element(),"keydown",function(a){var c={original:f.constant(a)};hd.isEnter(c)?(b.execute(a),a.kill()):hd.isTab(c)?(e(),a.kill()):hd.isEscape(c)&&(M(),a.kill())}),g=E.bind(c,"blur",function(a){h.from(a.raw().relatedTarget).each(function(a){!0===sa.ancestor(q.fromDom(a),
function(a){return n.has(a,"ephox-polish-mobile-toolbar-hide")}).isSome()&&Go.refreshInput(c)})});return{destroy:function(){d.unbind();g.unbind()}}}),l=Yb("shizniz"),p=u.translate("toolbar.backbutton"),s=Nd([ia.resolve("icon")]);l.content(s);m.set(l.element(),"title",p);O.toolbarButton(l.element(),p,!1,!1);b.addEscape(l);var z=xa(!1);v.prepend(d,b.element());var x=D.create({done:r([]),abort:r([]),open:r([]),close:r([])}),M=function(){R();c.toEditing()};b.events.toEditor.bind(M);var G=xb.cached(function(a){return X.children(d,
"."+ia.resolve("toolbar"))}),R=function(){b.close();z.set(!1);k.each(G(),function(a){n.remove(a,w.resolve("mobile-toolbar-hide"))});n.remove(b.element(),w.resolve("mobile-toolbar-show"));n.add(b.element(),w.resolve("mobile-toolbar-hide"));x.trigger.close()};c.events.mousedown.bind(R);R();l.events.click.bind(function(){M();x.trigger.abort()});return{element:b.element,destroy:function(){c.events.mousedown.unbind(R);g.destroy();b.destroy()},events:x.registry,open:function(){var a=E.bind(d,"transitionend",
function(){b.open();x.trigger.open();a.unbind()});z.set(!0);k.each(G(),function(a){n.remove(a,w.resolve("mobile-toolbar-show"));n.add(a,w.resolve("mobile-toolbar-hide"))});n.remove(b.element(),w.resolve("mobile-toolbar-hide"));n.add(b.element(),w.resolve("mobile-toolbar-show"))},close:R,isOpen:function(){return z.get()}}}function bS(a){var b=a.filter();Sc.configure(b);var c=D.create({analytics:r(["message"])}),d=xb.cached(function(){var b=cS(a);b.events.open.bind(function(){c.trigger.analytics("search_tool_open")});
b.events.abort.bind(b.close);return b}),b=function(){var a=d();(a.isOpen()?a.close:a.open)()};a.shortcuts().events.search.bind(b);return{ui:Za.ui({"find.general":{toggle:!1,hasPopup:!1,value:Ho,textkey:u.key("action.search"),action:b,updateGeneral:function(a){n.add(a.element(),w.resolve(Ho))},icon:!0,tooltip:Va.get}}),events:c.registry,destroy:function(){d().destroy()}}}function Ph(a,b){var c=Yb();ea.add(c.element(),a);O.button(c.element(),u.translate(b));m.set(c.element(),"title",u.translate(b));
return c}function dS(a,b){var c=eS(mk.configuration()),d=c.i18nNamespace(),e=c.cssNamespace(),g=P.div();n.add(g,w.resolve("fontsize-widget"));var l=P.span();n.add(l,w.resolve("fontsize-widget-field"));var p=P.div();n.add(p,w.resolve("fontsize-widget-exit"));var s=q.fromTag("input");n.add(s,w.resolve("fontsize-widget-input"));O.label(s,u.translate(d+".stepper.input"));var h=function(b){n.remove(s,w.resolve("slick-widget-invalid-input"));O.invalid(s,!1);$.set(s,b);Ee.partialSize(a.content(),a.undo(),
a.selections(),b);Oa.speak(ca.body(),b)},k=function(){n.add(s,w.resolve("slick-widget-invalid-input"));O.invalid(s,!0);Oa.speak(ca.body(),u.translate("aria.input.invalid"));T.focus(s)},M=function(a){return function(){var b=$.get(s),b=a(c.specials(),b);Fe.validate(b,c.tag(),c.property()).fold(k,h)}},G=M(nk.decrease),M=M(nk.increase),m=function(a,b){return Ph([w.resolve(e+a),w.resolve("stepper-button")],d+b)},Da=m("-stepper-decrease",".stepper.decrease"),m=m("-stepper-increase",".stepper.increase");
Da.events.click.bind(G);m.events.click.bind(M);J.append(l,[Da.element(),s,m.element()]);v.append(g,l);v.append(g,p);var l=Oh.text(l,s),na=D.create({toEditor:r([]),size:r(["value"])}),t=function(){$.set(s,"")},y=function(a){a=Fe.sanitise(a);Fe.validate(a,c.tag(),c.property()).fold(k,function(a){n.remove(s,w.resolve("slick-widget-invalid-input"));O.invalid(s,!1)});$.set(s,a)};return{element:f.constant(g),addEscape:function(a){v.append(p,a.element())},open:function(){T.focus(s)},close:f.noop,execute:function(){var a=
$.get(s);Fe.validate(a,c.tag(),c.property()).fold(k,function(a){h(a);na.trigger.toEditor()})},destroy:f.noop,type:f.constant(l),represent:function(a){a.fold(t,y,y)},events:na.registry}}function fS(a,b){var c=a.content(),d=xa(h.none()),e=function(){var c=dS(a,b),e=lk(a,c),c={represent:c.represent,refreshValue:c.refreshValue,open:e.open,close:e.close,isOpen:e.isOpen};d.set(h.some(c));return c},g={toggle:!1,value:"size",textkey:u.key("font.size"),action:function(){var b=d.get().getOrThunk(e);if(b.isOpen())b.close();
else{var g=ok.getState(a.selections(),c);b.open();b.represent(g.readState.size())}},updateGeneral:f.noop,icon:!0,shortcut:!1,hasPopup:!1,hasDialog:!1};return{general:f.constant(g)}}function Pw(a){var b=a.hex(),c=q.fromTag("span");n.add(c,w.resolve("palette-detail-action"));m.set(c,"title",u.get(a.name()));O.option(c,u.get(a.name()),!1,!1);var d=D.create({selected:r(["value"])}),e=E.bind(c,"click",function(){T.focus(c);d.trigger.selected(b)});return{element:function(){return c},value:f.constant(b),
destroy:function(){e.unbind();B.remove(c)},events:d.registry}}function gS(){var a=[],b=P.div(),c=q.fromTag("span");O.listBox(c);n.add(c,w.resolve("palette-detail-actions"));n.add(c,w.resolve("palette-color-options"));O.label(c,u.translate("aria.font.palette"));v.append(b,c);var d=Ej.create(),e=D.create({selected:r(["value"])});return{element:function(){return b},add:function(b){a.push(b.destroy);v.append(c,b.element());d.bind(b.events.selected,function(a){e.trigger.selected(a.value())})},remove:function(a){B.remove(a.element());
d.unbind(a.events.selected)},show:function(){n.add(b,w.resolve("palette-detail-active"));ga.showPanel(b);t.remove(b,"display")},hide:function(){n.remove(b,w.resolve("palette-detail-active"));ga.hidePanel(b);t.set(b,"display","none")},count:function(){return a.length},destroy:function(){k.each(a,f.apply);B.remove(b);a=[]},events:e.registry}}function Qw(a,b){var c=Qh.makeLayout(b,hS,{isValid:iS}),d=c.layout();return{isFocused:d.isFocused,enterGrid:d.enter,grid:d,refresh:c.refresh,destroy:d.destroy,
clear:d.clear}}function jS(){var a=q.fromTag("div");kS()?O.presentation(a):O.menuItem(a,h.none(),h.none());n.add(a,w.resolve("color-widget"));var b=q.fromTag("div");n.add(b,w.resolve("color-widget-controls"));O.tabList(b);var c=q.fromTag("div");n.add(c,w.resolve("color-widget-palettes"));O.toolbarGroup(c);var d=dd("text-color");n.add(d.element(),w.resolve("tab-button"));d.content(mc(u.translate("font.color")));O.tabButton(d.element(),u.translate("aria.font.color"));var e=dd("highlight-color");n.add(e.element(),
w.resolve("tab-button"));e.content(mc(u.translate("font.highlight")));O.tabButton(e.element(),u.translate("aria.font.highlight"));v.append(b,d.element());v.append(b,e.element());v.append(a,b);v.append(a,c);return{element:f.constant(a),colorToggle:f.constant(d),highlightToggle:f.constant(e),content:f.constant(c),controls:f.constant(b),destroy:function(){d.destroy();e.destroy();B.remove(c);B.remove(b)}}}function lS(a){var b=Qh.create(a.colors.buttons),c=Qh.create(a.colors.buttons),d=D.create({color:K(["value"],
b.events.selected),highlight:K(["value"],c.events.selected),abort:r([])}),e=jS(),g=e.colorToggle(),l=e.highlightToggle();O.linkTabToPanel(g.element(),b.element());O.linkTabToPanel(l.element(),c.element());v.append(e.content(),b.element());v.append(e.content(),c.element());var p=Qw(e,b.element()),s=Qw(e,c.element()),h=ba.flow(e.controls(),{item:f.constant(".ephox-pastry-statebutton")},pa.flow({trigger:function(a,b){return I.descendant(a,".ephox-pastry-button").map(function(a){a.dom().click();return a})},
executeOnArrow:!0})),k=ba.multiple(e.element(),[h,p.grid,s.grid]);k.events.exit.bind(function(a){d.trigger.abort()});var M=function(){c.hide();g.select();l.deselect();ga.tabSelected(g.element(),[l.element()]);p.refresh();s.refresh();b.show()};g.events.click.bind(function(){h.clickFocus(g.element());M()});l.events.click.bind(function(){h.clickFocus(l.element());b.hide();g.deselect();ga.tabSelected(l.element(),[g.element()]);c.show()});return{element:e.element,destroy:function(){b.destroy();k.destroy();
c.destroy();e.destroy()},open:function(){k.clear();k.refresh();g.click();M();k.enter()},close:function(){k.exit()},events:d.registry}}function mS(){var a=h.none(),b=function(b){a.each(function(a){a[b]()})};return{enter:f.curry(b,"enter"),exit:f.curry(b,"exit"),destroy:f.curry(b,"destroy"),set:function(b){a=h.some(b)}}}function nS(a,b){var c=b.i18nNamespace(),d=b.cssNamespace(),e=D.create({plus:r([]),minus:r([]),validate:r([]),abort:r([])}),g=Yb(),l=Yb(),p=P.div(),s=P.div(),z=q.fromTag("input");O.label(z,
u.translate(c+".stepper.input"));O.toolbarButton(g.element(),u.translate(c+".stepper.increase"),!1,!1);O.toolbarButton(l.element(),u.translate(c+".stepper.decrease"),!1,!1);m.set(z,"tabindex","-1");m.set(g.element(),"tabindex","-1");m.set(l.element(),"tabindex","-1");n.add(s,w.resolve(d+"-stepper-input"));n.add(p,w.resolve(d+"-stepper-options"));n.add(g.element(),w.resolve("stepper-button"));g.content(Nd([w.resolve(d+"-stepper-increase")]));n.add(l.element(),w.resolve("stepper-button"));l.content(Nd([w.resolve(d+
"-stepper-decrease")]));v.append(s,z);J.append(p,[g.element(),l.element()]);J.append(a,[s,p]);g.events.click.bind(function(){T.focus(g.element());e.trigger.plus()});l.events.click.bind(function(){T.focus(l.element());e.trigger.minus()});var k=function(){z.dom().setSelectionRange(0,$.get(z).length)},M=E.capture(a,"click",function(a){L.eq(a.target(),s)&&G.enter()}),G=mS(),R=n.toggler(z,w.resolve("invalid-"+d+"-size"));return{destroy:function(){g.destroy();l.destroy();G.destroy();M.unbind();B.remove(z)},
highlight:function(){R.on();m.set(z,"title",u.translate("aria.stepper.input.invalid"));Oa.shout(z,u.translate("aria.stepper.input.invalid"))},dehighlight:function(){R.off();m.remove(z,"title")},input:f.constant(z),focus:function(){T.focus(z);k()},enter:G.enter,exit:G.exit,initLayout:function(){var b=ba.single(z,[U.basic(N.ENTER()[0],function(){e.trigger.validate();return h.some(!0)})],h.none());b.events.enter.bind(k);var c=pa.button({execute:function(a){a.dom().click();T.focus(a);return h.some(a)}}),
b=ba.multiple(a,[b,ba.button(g.element(),c),ba.button(l.element(),c)]);b.events.exit.bind(function(){y.parent(s).each(T.focus);e.trigger.abort()});G.set(b)},events:e.registry}}function pk(a){var b=oS(a),c=P.div(),d=nS(c,b);n.add(c,w.resolve(b.cssNamespace()+"-size-widget"));var e=function(){return $.get(d.input())},g=function(a){var b=e();a=a(b);a=Fe.sanitise(a);$.set(d.input(),a);l.trigger.action(a);d.dehighlight()};d.events.validate.bind(function(a){a=e();Fe.validate(a,b.tag(),b.property()).fold(function(){d.highlight()},
function(a){$.set(d.input(),a);l.trigger.action(a);d.dehighlight();l.trigger.close()})});d.events.plus.bind(function(a){g(f.curry(nk.increase,b.specials()))});d.events.minus.bind(function(a){g(f.curry(nk.decrease,b.specials()))});var l=D.create({close:r([]),action:r(["value"]),abort:K([],d.events.abort)}),p=E.bind(c,"click",function(a){(L.eq(a.target(),c)||L.eq(a.target(),d.input()))&&d.enter()});return{element:f.constant(c),input:d.input,getCurrentValue:e,focus:d.focus,enter:d.enter,initLayout:d.initLayout,
destroy:function(){p.unbind();d.destroy();B.remove(c)},updateInlineWidget:function(a,e){var g=function(a){Fe.validate(a,b.tag(),b.property()).each(function(a){$.set(d.input(),a);d.dehighlight()})};a.size().fold(function(){g(e);n.add(c,w.resolve("default-"+b.cssNamespace()+"-size"))},f.noop,function(a){g(a);n.remove(c,w.resolve("default-"+b.cssNamespace()+"-size"))})},open:f.noop,close:f.noop,events:l.registry}}function pS(a,b,c,d){var e=c();c=Rc.okCancel("font-size");var g=$d(b),l=null,f=D.create({close:r([]),
open:r([]),analytics:r(["message"]),ok:r(["value"])});b=function(){l.unbind();g.hide();f.trigger.close()};g.setTitle(u.translate("font.size"));g.setContent(e.element());g.setControls(c.element());g.events.close.bind(b);c.events.ok.bind(function(){f.trigger.ok(e.getCurrentValue())});c.events.cancel.bind(b);n.add(g.element(),w.resolve("widget-dialog"));return{show:function(){g.show();var b=q.fromDom(window);l=E.bind(b,"orientationchange",function(){a.foreground()});f.trigger.open()},element:g.element,
contents:e,events:f.registry,destroy:function(){g.hide();g.destroy();e.destroy()}}}function qS(a,b){var c=a.content(),d=a.undo(),e={},g=function(a){return k.map(a.split(/,\s?/g),function(a){return a.trim().replace(/^[\'\"](.*)[\'\"]$/,"$1")}).join(",")},l=(0===b.faces.length?h.none():h.some(b.faces)).fold(Rw.faces,function(a){return k.map(a,function(a){var b=g(a.value);e[b]=a.value;return jg.face(u.raw(a.text),b,h.none())})}),p=Y.detect().deviceType.isiOS(),s=D.create({analytics:r(["message","properties"])}),
z=h.some(uv.face),x=function(a){var b=g(a);a=k.find(l,function(a){return a.value()===b});var c=jg.face(u.raw(b),b,h.none());return a.getOr(c)},M=p?rS:sS,p=fS(a,b);return{ui:Za.ui({"fontface.dropdown":f.constant({name:"fontface",textkey:u.key("font.face"),menuTextkey:u.key("font.menu"),updateDropdown:function(b){var c=tS.face(a.selections()).map(x);b.populate([{label:h.none,items:f.constant(l)}]);Qj.updateMenu(b,c,oa.on(),l,z)},action:function(b){b=e.hasOwnProperty(b)?e[b]:b;Ee.face(c,d,a.selections(),
b)},values:l,render:z,describe:function(a){return u.translate("font.describe",u.get(a.textkey()))},hasPopup:!0}),"fontcolor.widget":function(c){return uS.widget(a,b)},"fontsize.widget":function(b){return M.widget(a,b)},"fontsize.general":p.general},f.identity),events:s.registry,destroy:f.noop}}function Sw(a,b,c){var d=Ew(a,b,c);O.tabList(d.menu());k.map(d.tabs(),function(a){var b='.ephox-pastry-tablayout-content[data-ephox-pastry-tablayout-view="'+a.name()+'"]';m.set(a.element(),"tabindex","-1");
n.add(a.element(),w.resolve("tab-button"));I.descendant(d.body(),b).each(function(b){var c=Ma.generate("ephox-aria");m.set(a.element(),"id",c);O.tabButton(a.element(),a.name());O.tabPanel(b);O.linkTabToPanel(a.element(),b);O.labelledBy(b,c)})});return{element:d.element,tabs:d.tabs,body:d.body,menu:d.menu,destroy:d.destroy,events:d.events}}function vS(a){var b=2===W.keys(a.integration).length,c=Ge.aboutTags(b,a.integration);return{content:function(a){return k.foldl(c,function(a,b){return a.replace(b.str(),
b.replace())},a)},dom:b?function(a){I.descendant(a,".ephox-polish-help-integration").each(function(a){t.set(a,"display","block")})}:f.noop}}function Rh(a,b,c){var d=h.none(),e=h.none(),g=wS(c),l=function(a,c){var e=b.content(c.trim());d=h.some(e);p(a,e)},p=function(a,c){var d=q.fromHtml(c.trim());b.dom(d);B.empty(a);n.remove(a,w.resolve("tablayout-loading"));s(d);var e=q.fromTag("div");O.document(e);v.append(e,d);v.append(a,e)},s=function(a){k();e=I.descendant(a,".ephox-license-link").map(function(a){return E.bind(a,
"click",function(a){window.open(g,"","height=700,width=620,resizable=yes,scrollbars=yes")})})},z=function(b){a.get(function(a){a.fold(function(a){b("&nbsp;");console.error("Unable to download help article",a)},b)})},k=function(){e.each(function(a){a.unbind()})};return{render:function(a){d.fold(function(){n.add(a,w.resolve("tablayout-loading"));z(f.curry(l,a))},function(b){p(a,b)})},destroy:function(){k()}}}function xS(a){var b={content:f.identity,dom:f.noop},c=Y.detect(),d;!0===a.source?(d=a.baseUrl+
"/help/"+ce.get()+"/",d={about:sd.get(d+"about.html",td.text(),jd.xhr()),accessibility:sd.get(d+"accessibility.html",td.text(),jd.xhr()),a11ycheck:sd.get(d+"a11ycheck.html",td.text(),jd.xhr()),markdown:sd.get(d+"markdown.html",td.text(),jd.xhr()),shortcuts:sd.get(d+"shortcuts.html",td.text(),jd.xhr())}):d=yS(a.baseUrl+"/help_"+ce.get()+".js?"+Ge.resourceParam());c=!c.deviceType.isTouch();a=[Sh(c,vf(u.translate("help.dialog.shortcuts"),Rh(d.shortcuts,b,a))),Sh(c,vf(u.translate("help.dialog.accessibility"),
Rh(d.accessibility,b,a))),Sh(!0,vf(u.translate("help.dialog.markdown"),Rh(d.markdown,b,a))),Sh(c,vf(u.translate("help.dialog.a11ycheck"),Rh(d.a11ycheck,b,a))),Sh(!0,vf(u.translate("help.dialog.about"),Rh(d.about,vS(a),a)))];return $a.cat(a)}function zS(a,b){var c=D.create({close:r([])}),d=$d(a),e=xS(b),g=Sw(Do.left(),e,"help");m.set(g.body(),"tabindex","-1");n.add(d.element(),w.resolve("help-modal"));var l=y.children(g.element());k.each(l,cc.register);d.setTitle(u.translate("cog.help"));d.setContent(g.element());
var f=AS(g),l=BS(g),s=ba.multiple(d.element(),[f,l]);g.events.setActive.bind(function(a){f.clickFocus(a.item().element())});var h=function(){d.hide()};d.events.close.bind(function(){s.exit();h()});s.events.exit.bind(function(){h();c.trigger.close()});return{element:d.element,open:function(){d.show();s.enter()},destroy:function(){g.destroy();d.destroy();s.destroy();k.each(e,function(a){a.renderer().destroy()})},hide:h,events:c.registry}}function CS(a,b){var c=zS(a,b),d=function(){e.trigger.analytics("help_screen_hide");
e.trigger.close();g()},e=D.create({close:r([]),analytics:r(["message"])});c.events.close.bind(d);var g=function(){c.events.close.unbind(d);c.destroy()};return{show:function(){e.trigger.analytics("help_screen_show");c.open()},destroy:g,events:e.registry}}function DS(a,b){var c=a.content(),d=a.smartview(),e=a.shortcuts(),g=D.create({analytics:r(["message"])}),l=pc.destroyable(),p=function(){var e=CS(d.uiContainer(),b);l.set(e);e.events.close.bind(function(){c.toEditing();l.clear()});e.events.analytics.bind(function(a){g.trigger.analytics(a.message())});
c.toReading();a.content().hideInlineSelection();e.show()};e.events.help.bind(p);return{ui:Za.ui({"help.general":{toggle:!1,value:"help",textkey:u.key("cog.help"),action:p,updateGeneral:f.noop,icon:!0,hasPopup:!1,hasDialog:!0,tooltip:Va.get}}),events:g.registry,destroy:function(){l.clear()}}}function ES(a,b,c){var d=a.filter(),e=a.content(),g=a.operations();de.configure(d);var l=void 0===c.external?[]:k.map(c.external,function(a){return FS(a.prefix,a.suffix,a.style)});k.each(l,function(a){var c=xu(a.prefix(),
a.suffix(),function(b){var c=q.fromTag("span");ea.add(c,[de.highlightClass()]);t.setAll(c,a.style());var d=q.fromTag("div");v.append(c,q.fromText(a.prefix()+b+a.suffix()));v.append(d,c);return ua.get(d)});b.customMacros().add(c)});a=function(a){e.getSelection().each(function(b){a.prev().each(function(a){I.ancestor(a,"."+de.placeholderClass()).each(function(a){Tw.rehighlight(g,l,a)})});I.ancestor(b.startContainer(),"."+de.highlightClass()).each(function(a){Tw.unhighlight(g,a)})})};return 0<l.length?
(e.events.nodeChanged.bind(a),{run:function(){GS.run(e,l)},destroy:f.noop}):{run:f.noop,destroy:f.noop}}function HS(a){var b=a.content();return{ui:Za.ui({"horizontalrule.general":{toggle:!1,value:"horizontalrule",textkey:u.key("insert.horizontalrule"),action:function(){xc.insertAtCursor(b,[q.fromTag("hr")]).each(function(a){a=da.after(a.element());b.setRelativeSelection(a,a);b.toEditing()})},updateGeneral:f.noop,icon:!0,shortcut:!1,hasPopup:!1}}),destroy:f.noop}}function Uw(a){var b=w.resolve("dialog-float-selected"),
c=q.fromTag("fieldset");m.set(c,"role","radiogroup");a=q.fromHtml("<legend>"+u.translate(a)+"</legend>");var d=Ma.generate("ephox-aria");m.set(a,"id",d);m.set(c,"aria-labelledby",d);var e=P.div();n.add(e,w.resolve("dialog-float-options"));J.append(c,[a,e]);var g=function(){k.each(l,function(a){n.remove(a.element(),b);ga.checked(a.element(),!1)})},l=k.map(["none","center","left","right"],function(a){var c=Yb(),d=u.translate("align."+a);m.setAll(c.element(),{tabindex:"-1","data-float-value":a,title:d,
"aria-label":d,role:"radio"});a=P.div();var d=P.div(),e=P.div(),l=P.div();O.hidden(a,!0);n.add(d,w.resolve("dialog-float-icon-inner-left"));n.add(e,w.resolve("dialog-float-icon-inner-center"));n.add(l,w.resolve("dialog-float-icon-inner-right"));J.append(a,[d,e,l]);c.events.click.bind(function(){g();n.add(c.element(),b);ga.checked(c.element(),!0);T.focus(c.element())});n.add(c.element(),w.resolve("dialog-float-container"));n.add(a,w.resolve("dialog-float-icon"));v.append(c.element(),a);return c});
J.append(e,k.map(l,function(a){return a.element()}));var p=ob.radio(c,"."+w.resolve("dialog-float-container"),"."+w.resolve("dialog-float-selected"));return{element:function(){return c},get:function(){return I.child(e,"."+b).map(function(a){return m.get(a,"data-float-value")})},select:function(a){g();a.each(function(a){I.child(e,'span[data-float-value="'+a+'"]').or(y.firstChild(e)).each(function(a){n.add(a,b);ga.checked(a,!0)})});p.refresh()},keylayout:f.constant(p),destroy:function(){k.each(l,function(a){a.destroy()})}}}
function IS(){var a=P.div(),b=P.div(),c=P.div(),d=P.div();n.add(c,w.resolve("image-url-controls"));n.add(d,w.resolve("image-size-controls"));var e=Uw("image.dialog.fields.align"),g=dc.input("image-url","image.dialog.fields.url"),l=dc.input("image-alt","image.dialog.fields.alt"),p=dc.input("image-width","image.dialog.fields.width"),s=dc.input("image-height","image.dialog.fields.height"),z=q.fromTag("input");m.set(z,"type","hidden");var k=dd("lock");n.add(k.element(),w.resolve("dialog-button"));var M=
Nd([w.resolve("icon"),w.resolve("image-lock-button")]);m.set(k.element(),"title",u.translate("image.dialog.fields.constrain.on"));O.toolbarButton(k.element(),u.translate("image.dialog.fields.constrain.label"),!1,!0);ga.press(k.element());k.select();k.content(M);k.events.click.bind(function(){T.focus(k.element());var a=k.selected()?"on":"off";m.set(k.element(),"title",u.translate("image.dialog.fields.constrain."+a));(k.selected()?ga.press:ga.release)(k.element())});M=P.div();n.add(M,w.resolve("form-group"));
n.add(M,w.resolve("form-group-lock"));var G=q.fromHtml("<label>"+u.translate("image.dialog.fields.constrain.label")+"</label>"),R="constrain"+Ma.generate("");m.set(k.element(),"id",R);m.set(G,"for",R);var r=function(a){a.isLocal()?(m.set(g.input(),"disabled","disabled"),$.set(g.input(),u.translate("image.dialog.fields.urllocal"))):(m.remove(g.input(),"disabled"),$.set(g.input(),a.url()))},na=function(a,b,c){var d=parseFloat($.get(z));a=$.get(a);$.set(b,c(d,a).getOrThunk(function(){return $.get(b)}));
Wb.dehighlight(b)},R=function(a){Wb.validateField(a.target(),"width",h.some("px")).fold(function(){Wb.highlight(a.target())},function(b){Wb.dehighlight(a.target());b=a.target();k.selected()&&(L.eq(b,p.input())?na(p.input(),s.input(),Io.fromWidth):L.eq(b,s.input())&&na(s.input(),p.input(),Io.fromHeight))})},t=function(a){if(m.has(a.target(),"placeholder")){var b=m.get(a.target(),"placeholder");""===$.get(a.target())&&$.set(a.target(),b)}},v=E.bind(p.input(),"input",R),y=E.bind(s.input(),"input",R),
A=E.bind(p.input(),"focus",t),B=E.bind(s.input(),"focus",t);J.append(M,[G,k.element()]);J.append(b,[e.element()]);J.append(c,[g.element(),l.element()]);J.append(d,[p.element(),s.element(),M]);J.append(a,[c,d,b]);b=[ba.input(g.input(),pa.input({})),ba.input(l.input(),pa.input({})),ba.input(p.input(),pa.input({})),ba.input(s.input(),pa.input({})),ba.button(k.element(),pa.button({execute:ob.button})),e.keylayout()];return{element:f.constant(a),destroy:function(){k.destroy();v.unbind();y.unbind();A.unbind();
B.unbind();e.destroy()},dehighlight:f.curry(Wb.clearHighlights,a),highlight:Wb.highlight,keylayouts:f.constant(b),set:function(a){r(a);$.set(l.input(),a.alt());$.set(p.input(),a.width());$.set(s.input(),a.height());var b=a.computedWidth().bind(function(b){return a.computedHeight().bind(function(a){return Io.calculate(b,a)})}).getOr(1);a.computedWidth().each(f.curry(m.set,p.input(),"placeholder"));a.computedHeight().each(f.curry(m.set,s.input(),"placeholder"));$.set(z,b);e.select(a.align())},get:function(){return Wb.validate([Wb.rule(p.input(),
"width",h.some("px")),Wb.rule(s.input(),"height",h.some("px"))]).map(function(a){return qk.properties({url:$.get(g.input()),alt:$.get(l.input()),width:a.width(),height:a.height(),isLocal:m.has(g.input(),"disabled"),align:e.get()})})}}}function JS(a){var b=D.create({ok:r(["image","properties"]),close:r([])}),c=xa(h.none()),d=$d(a),e=Rc.okCancel("image-properties"),g=IS();d.setContent(g.element());n.add(d.element(),w.resolve("dialog-narrow"));a=function(){var a=g.get();g.dehighlight();a.fold(function(a){g.highlight(a)},
function(a){c.get().each(function(c){b.trigger.ok(c,a)})})};e.events.ok.bind(a);e.events.cancel.bind(function(){d.hide();b.trigger.close()});d.setTitle(u.translate("image.dialog.title"));d.setControls(e.element());d.events.close.bind(function(){b.trigger.close()});var l=ob.setup(d,e,g.keylayouts());return{element:d.element,open:function(){d.show();l.enter()},hide:function(){l.exit();d.hide()},destroy:function(){d.destroy();l.destroy();e.destroy();g.destroy()},represent:function(a){var b=qk.divine(a);
c.set(h.some(a));g.set(b)},execute:a,events:b.registry}}function KS(a,b){var c=Vw.image(a.content().imageExcludes),d=D.create({changed:r(["image"]),contextmenu:K(["image"],c.events.contextmenu)}),e=function(b){var c=a.content(),e=JS(a.smartview().uiContainer()),f=Ww.generate(a.keyboard(),e,["image","properties"]);f.events.ok.bind(function(a){qk.apply(a.image(),a.properties());d.trigger.changed(a.image());f.destroy();c.domChanged();c.focus();c.uiChanged()});f.events.close.bind(function(a){f.destroy();
c.focus()});f.represent(b);f.open()};c.events.properties.bind(function(a){e(a.image())});return{destroy:f.noop,situation:c.situation,handle:c.handle,assign:c.assign,events:d.registry}}function LS(a){var b=function(b){return sd.get(b,td.blob(),jd.xhr(),a.newHeaders())},c=function(a){return!(Jo.local(a)||Jo.sameDomain(a,String(He.location)))};return{getImage:function(d){var e=m.get(d,"src");return(c(e)?a.proxy(e):h.none()).fold(function(){return Pa.fromPromise(Th.imageToBlob(d.dom()))},b)}}}function MS(a,
b,c){var d=h.none();return{setTarget:function(a){d=h.some(a)},clearTarget:function(){d=h.none()},mutate:function(e,g){d.each(function(d){var f=eb.delta({top:g,left:e}),s=wf.updatePosition(c,function(b){return d(a,b,f)});wf.drawAtOrigin(c,a);b.update(s)})}}}function NS(a){var b=D.create({reposition:r(["direction","delta"])}),c=Ie("top","n",h.none()),d=Ie("bottom","s",h.none()),e=Ie("right","e",h.none()),g=Ie("left","w",h.none()),l=Ie("top-left","nw",h.some(a("image.crop.handle.nw"))),p=Ie("top-right",
"ne",h.some(a("image.crop.handle.ne"))),s=Ie("bottom-right","se",h.some(a("image.crop.handle.se"))),z=Ie("bottom-left","sw",h.some(a("image.crop.handle.sw"))),k=Xd.nu(function(a){setTimeout(function(){t.reflow(c);var b=ra.get(c),d=ha.get(c);a(f.constant(3*b+2*d))},0)}),M=b.trigger.reposition;a=[c,d,e,g,p,l,s,z];M=[ba.single(l,Uh.navigation("nw",M),h.none()),ba.single(p,Uh.navigation("ne",M),h.none()),ba.single(s,Uh.navigation("se",M),h.none()),ba.single(z,Uh.navigation("sw",M),h.none())];return{elements:f.constant(a),
keylayouts:f.constant(M),events:b.registry,refresh:function(a,b){var f=Xw.calculate(a,b);Je(c,f.n());Je(d,f.s());Je(e,f.e());Je(g,f.w());Je(l,f.nw());Je(z,f.sw());Je(s,f.se());Je(p,f.ne());k.get(function(a){Yw([c,d],b.width,a);Yw([e,g],b.height,a)})}}}function OS(){var a=rk("left"),b=rk("top"),c=rk("right"),d=rk("bottom");return{elements:f.constant([a,b,c,d]),refresh:function(e,g){var l=PS.derive(e,g);sk(a,l.leftRim());sk(b,l.topRim());sk(c,l.rightRim());sk(d,l.bottomRim())}}}function QS(a,b,c,d){var e=
q.fromTag("div");n.add(e,Zw.magicBox());xf.base(e,d("image.crop.begin"));tk.effect(e,"execute");var g=q.fromTag("div");m.set(g,"role","row");var l=OS(),p=NS(d),s=function(a){t.setAll(e,{top:a.top()+"px",left:a.left()+"px"})};d=function(b){var c=a();s(c);l.refresh(c,b);p.refresh(c,b);z.trigger.updated(b)};J.append(g,k.flatten([l.elements(),[b],p.elements()]));v.append(e,g);var z=D.create({updated:r(["newBounds"]),reposition:K(["direction","delta"],p.events.reposition)});d(c);b=p.keylayouts();return{element:f.constant(e),
bitsbox:f.constant(g),keylayouts:f.constant(b),move:s,update:d,destroy:function(){B.remove(e)},events:z.registry,tryMovement:function(a){return I.closest(a,"."+Ya.resolve("corner-wrapper")).bind(function(a){a=m.get(a,"data-"+Ya.resolve("direction"));return void 0!==uk[a]?h.some(uk[a]):h.none()})}}}function RS(a,b,c,d){var e=q.fromTag("div");ea.add(e,[Ya.resolve("panel-central"),Ya.resolve("side-panel")]);m.set(e,"tabindex","-1");xf.cell(e,d("image.crop.handle.shade"));tk.grab(e,!1);var g=SS(a());
wf.writePosition(e,g);wf.drawAtOrigin(e);var l=QS(a,e,g,d);v.append(b,l.element());var p=MS(a(),l,e),s=Dh.transform(p),z=E.bind(e,"dblclick",function(){t.trigger.apply()}),x=TS.bind(l.element(),function(a){l.tryMovement(a).orThunk(function(){return I.closest(a,"."+Ya.resolve("panel-central")).map(function(){return uk.translate})}).each(M)}),M=function(a){s.off();p.clearTarget();p.setTarget(a);s.on();s.go(c)},G=function(b,c){var d=wf.updatePosition(e,function(d){return uk[b](a(),d,c)});wf.drawAtOrigin(e);
l.update(d)};d=k.flatten([l.keylayouts(),[ba.single(e,Uh.navigation("translate",G),h.none())]]);var R=function(){var c=a();return E.bind(y.defaultView(b),"resize",function(){var b=a();if(b.height()!==c.height()||b.width()!==c.width())t.trigger.cancel();else if(b.top()!==c.top()||b.left()!==c.left())l.move(b),c=b})}(),g=function(a){return function(){T.active(y.owner(b)).each(function(b){tk.grab(b,a)})}},n=g("true"),na=g("false");k.each(d,function(a){a.events.enter.bind(n);a.events.exit.bind(na)});
l.events.reposition.bind(function(a){G(a.direction(),a.delta())});var t=D.create({updated:K(["newBounds"],l.events.updated),apply:r([]),cancel:r([])});return{element:l.element,keylayouts:f.constant(d),destroy:function(){s.destroy();R.unbind();x.unbind();z.unbind();l.destroy()},boxes:function(){return{box:a,magic:l.element,shade:f.constant(e)}},get:function(){return wf.readPosition(e)},events:t.registry}}function US(a,b,c,d,e){var g=f.curry(VS,a),l=RS(g,b,c,e);return{element:l.element,keylayouts:l.keylayouts,
crop:function(){var b;b=l.get();var c=ra.get(a),e=ha.get(a);b=WS({cropX:b.left(),cropY:b.top(),cropWidth:b.width(),cropHeight:b.height(),displayWidth:c,displayHeight:e});return d.animate(l.boxes().magic(),a,l.boxes(),b)},destroy:function(){l.destroy()},events:l.events}}function XS(a){var b=a.content(),c=D.create({ok:r(["cropAction","image","cleanup"])}),d=pc.value(),e=pc.value(),g=function(a){var g=b.body().getOrDie();Oa.speak(ca.body(),u.translate("image.crop.announce"));var f=y.documentElement(a),
h=US(a,f,f,YS.slide(),u.translate),k=oc.adaptable(function(a,b){Oa.speak(ca.body(),u.translate("aria.image.crop.size",a,b))},500);h.events.updated.bind(function(a){a=a.newBounds();k.throttle(a.width(),a.height())});var M=function(){d.clear();t.exit();t.destroy();v.unbindAll();r.clear()},G=function(){M();e.clear();h.destroy()},m=function(){G();ee.select(b,a)},n=function(){M();h.crop().get(function(b){r.clear();Oa.speak(ca.body(),u.translate("image.crop.apply"));var d=kg.crop(b.cropX(),b.cropY(),b.cropWidth(),
b.cropHeight()),e=Ko.changedBounds(a);c.trigger.ok(function(a){return Nh.resampleAction(e,a,d)},a,function(a){G();return a})})};d.set(n);e.set(G);ZS(b,a);var q=function(){Oa.speak(ca.body(),u.translate("image.crop.cancel"));m()},r=pc.unbindable();setTimeout(function(){r.set(E.bind(g,"focus",function(a){q()}))});var t=ba.inlineDialog(f,h.keylayouts(),pa.inlineDialog({ok:n,cancel:q}));t.enter();var v=Ej.create();v.bind(b.events.domChanged,m);v.bind(b.events.nodeChanged,function(a){ca.inBody(a.node())&&
m()});v.bind(h.events.apply,n);v.bind(h.events.cancel,m)};return{apply:function(){d.on(f.apply)},open:function(){Jb.detect(b.getSelection()).each(function(a){g(a.image())})},destroy:function(){e.on(f.apply)},isActive:d.isSet,events:c.registry}}function $S(a){a=aT.parse(a.preferredWidth,a.preferredHeight);var b=a.fold(bT,Nh.instance),c=a.fold(cT,function(){return dT(b)});return{assets:function(a){return Ic.mapM(a,b)},correlated:function(a){return Ic.mapM(a,c)}}}function eT(a,b,c){var d=LS(a.communication()),
e=Co(a.ui),g=a.content(),l=function(c){return function(d){d.fold(function(a){a=Lo.diagnoseImageEdit(a,m.get(c,"src"));e.show(a.bannerMessage());console.error("Image edit operation failed: ",a.consoleMessage())},function(c){b.uploadAssets([c]);g.focus();a.undo().save();g.domChanged()});ee.select(g,c);return d}},p=function(b,c){a.undo().save();var e=Mo.applyEdit(b);return Mo.run(d,c,e)(b)},s=XS(a);s.events.ok.bind(function(a){var b=a.image(),c=a.cropAction();a=a.cleanup();var d=fe.updater(fe.keepCrop,
b);p(b,c).map(d).map(a).get(l(b))});var h=function(){return Jb.detectForEditing(g.getSelection(),g.imageExcludes)},k=function(a,b){return function(){h().each(function(c){c=c.image();var d=f.identity,e=fe.updater(b,c);p(c,a).map(e).map(d).get(l(c))})}},M=[lg.make("crop-begin","image.crop.begin",s.open),lg.make("rotate-left","image.toolbar.rotateleft",k(kg.rotateLeft,fe.keepRotate)),lg.make("rotate-right","image.toolbar.rotateright",k(kg.rotateRight,fe.keepRotate)),lg.make("flip-horizontal","image.toolbar.fliphorizontal",
k(kg.flipHorizontal,fe.keepFlip)),lg.make("flip-vertical","image.toolbar.flipvertical",k(kg.flipVertical,fe.keepFlip))],G=[lg.make("crop-apply","image.crop.apply",s.apply)],k=Za.ui({"edit.palette":f.curry($w.edit,a.ui().refresh,h,s.isActive,M),"crop.palette":f.curry($w.crop,a.ui().refresh,s.isActive,G)},f.identity),M=Vw.imageEdit(s.isActive,G,M,g.imageExcludes);c=$S(c);return{destroy:function(){s.destroy()},ui:k,insertResample:f.constant(c),situation:M.situation,handle:M.handle,assign:M.assign,name:f.constant("imageEdit")}}
function fT(a,b){var c=w.resolve("cursor-pointer"),d=b.os.isOSX(),e=h.none(),g=function(b){return a.isInline()?Ja.absolute(b).top():0},l=function(b){var c=m.get(b,"href");if("top"===m.get(b,Wa.bookmarkAnchorDataAttr()))a.doc().each(function(b){a.body().each(function(a){var c=Ga.get(b);Ga.to(c.left(),g(a),b)})});else if("bottom"===m.get(b,Wa.bookmarkAnchorDataAttr()))a.win().each(function(b){a.doc().each(function(c){a.body().each(function(a){var d=g(a),e=Ga.get(c);a=d+ha.get(a)-b.innerHeight;Ga.to(e.left(),
a,c)})})});else if(/^#/.test(c)){var d=c.substr(1);a.body().each(function(b){Pc.anchorTarget(b,d).each(function(b){a.win().each(function(a){Ga.setToElement(a,b)})})})}else window.open(c)},f=function(a,b){var c=d?N.META():N.CTRL();k.contains(c,a)&&b()},s=q.fromDom(window),z=h.none();a.events.ready.bind(function(a){a=a.api().body();var b=gk.handle(a,function(a){var b=a.target();(d?a.raw().metaKey:a.raw().ctrlKey)&&I.closest(b,"a[href]").bind(function(b){a.prevent();l(b)})});z=h.some(b);e=h.some(n.toggler(a,
c))});var x=function(){e.each(function(a){a.on()})},M=function(){e.each(function(a){a.off()})},G=function(a){f(a.original().raw().which,M)};a.events.keyup.bind(G);var R=E.bind(s,"keyup",function(a){f(a.raw().which,M)}),r=function(a){f(a.original().raw().which,x)};a.events.keydown.bind(r);var t=E.bind(s,"keydown",function(a){f(a.raw().which,x)});return{follow:l,destroy:function(){z.each(function(a){a.unbind()});a.events.keyup.unbind(G);a.events.keydown.unbind(r);R.unbind();t.unbind()}}}function gT(a,
b,c,d){var e=q.fromTag("div");O.dialog(e,u.get(d));ea.add(e,[w.resolve("expandable-inline-popup")]);d=P.div();n.add(d,w.resolve("inline-popup-content"));var g=P.div();ea.add(g,[w.resolve("inline-popup-content-expand"),Vh]);var l=P.div();n.add(l,w.resolve("inline-popup-controls"));var p=P.div();n.add(p,w.resolve("inline-popup-expand-button-wrapper"));var s=q.fromTag("span");ea.add(s,[w.resolve("inline-popup-expand-button"),w.resolve("icon")]);var h=u.translate("aria.label.more");m.set(s,"title",h);
O.button(s,h);O.group(g);O.linkElements(s,g);v.append(p,s);h=P.div();n.add(h,w.resolve("inline-popup-body"));J.append(h,[d,g,p]);J.append(e,[h,l]);J.append(d,a);J.append(g,b);J.append(l,c);n.add(e,Vh);var k="0px",M=function(){n.remove(e,Vh);n.add(g,w.resolve("expand-close"));O.hidden(g,!0);t.setAll(g,{opacity:"0",height:"0px",visibility:"hidden"});ga.collapsed(s)},G=E.bind(g,"transitionend",function(a){ea.remove(g,[w.resolve("expand-close"),w.resolve("expand-open")])}),R=E.bind(s,"click",function(a){n.has(e,
Vh)?M():(n.add(e,Vh),n.add(g,w.resolve("expand-open")),O.hidden(g,!1),t.setAll(g,{opacity:"1",height:k,visibility:"visible"}),ga.expanded(s))});a=[ba.button(s,pa.button({execute:ob.click}))];return{element:f.constant(e),keylayouts:f.constant(a),destroy:function(){B.remove(e);R.unbind();G.unbind()},show:function(){k=ha.getOuter(g)+"px";M();t.reflow(e);n.add(e,w.resolve("enable-transition"))}}}function hT(a){var b=iT();a.url().each(function(a){$.set(b.input(),a)});var c=dc.input("text-to-display","link.properties.text.label"),
d=xa(!1);n.add(c.element(),w.resolve("text-to-display"));m.setAll(c.input(),{placeholder:u.translate("link.properties.text.placeholder"),autocomplete:"off",autocorrect:"off"});a.text().each(function(a){$.set(c.input(),a)});var e=dc.input("title-text","link.properties.title.label");n.add(e.element(),w.resolve("title-container"));m.setAll(e.input(),{placeholder:u.translate("link.properties.title.placeholder"),autocomplete:"off",autocorrect:"off"});a.title().each(function(a){$.set(e.input(),a)});var g=
jT.target(a),l=E.bind(c.input(),"input",function(){d.set(!0)});return{url:f.constant(b),text:f.constant(c),textChanged:d.get,title:f.constant(e),target:f.constant(g),keylayouts:function(){return[ba.input(b.input(),pa.input({})),ba.input(c.input(),pa.input({})),ba.input(e.input(),pa.input({})),ba.button(g.input(),pa.button({execute:ob.click,process:f.noop}))]},destroy:function(){l.unbind()}}}function kT(a){var b=Q.isNumber(a)?a:lT,c=Ao.access("local.linkCache");a=c.read();var d=function(a){return 0>
b-a.length?a.slice(0,b):a}(Q.isArray(a)?a:[]),e=function(a){d.splice(a,1)},g=function(){return d.slice(0)};return{add:function(a){"#"!==a.charAt(0)&&(d.length>=b&&d.pop(),k.indexOf(d,a).each(e),d.unshift(a))},state:g,destroy:function(){c.write(g())}}}function mT(a,b){return{position:function(c,d){var e=c.isRtl()?mg.allRtl():mg.all(),g=ag(0,0),l=gg.element(a,d);vk.simple(l,b,g,e,{})}}}function nT(a,b,c,d){var e=D.create({change:r([])}),g=function(){var a=b.body().map(Pc.all).getOr([]),a=k.bind(a,function(a){var b=
m.get(a,"href");return aa.startsWith(b,"#")||m.has(a,Wa.bookmarkAnchorDataAttr())?[]:[b]}),a=d.state().concat(a),a=oT.stringArray(a);return k.map(a,function(a){var b=h.none();return pT(a,f.constant(!1),b,f.noop)})},l=function(a,b,c){var d=Pc.getAnchorValue(a,Wj.generate("textbox-heading"));return h.some(ax("#"+d,c,function(){m.set(b,"id",d)}))},p=function(a){var b="h1"!==A.name(a),c=nb.get(a);return m.has(a,"id")||m.has(a,"name")?(a=m.has(a,"id")?m.get(a,"id"):m.get(a,"name"),h.some(ax("#"+a,b,f.noop))):
0===c.trim().length?h.none():l(c,a,b)},s=function(a){m.remove(a,Wa.bookmarkAnchorDataAttr())},z=function(a){var b=Wa.reservedUrls()[a.toLowerCase()];return function(a){m.set(a,Wa.bookmarkAnchorDataAttr(),b)}},x=function(){var a=b.body().map(Pc.findLinkTargets).getOr([]),c=a.length>qT,a=k.map(a,function(a){return p(a).map(function(b){var d=(c?Pc.linkTargetFastText:Pc.linkTargetText)(No,a);return Oo(b.url(),b.indent(),b.action(),d.before(),d.innerText(),d.after())})}),a=$a.cat(a),d=function(a){return"\u2014 "+
a+" \u2014"},e=z(Wa.topAnchorUrl()),e=Oo(Wa.topAnchorUrl(),!1,e,"",d(Wa.topAnchorUrl()),""),g=z(Wa.bottomAnchorUrl()),d=Oo(Wa.bottomAnchorUrl(),!1,g,"",d(Wa.bottomAnchorUrl()),"");return[e].concat(a).concat([d])};return{predict:function(b,d,l){var f=xb.cached(function(){var a=g(),d=x(),a=wk.config({container:c,translate:u.translate,sections:[wk.section({id:"recent",highlight:"strong",contentLimit:No,items:a,itemLimit:10,render:bx.anchors,extractors:[Wh.title,Wh.url]}),wk.section({id:"anchors",highlight:"strong",
contentLimit:No,items:d,render:bx.standard,extractors:[Wh.innerText,Wh.url]})]}),e=wk.init(b,a);ea.add(e.element(),[w.resolve("layer-menus"),w.resolve("tarot-inline")]);e.events.click.bind(function(a){e.hide();m(b,a.item())});a=ra.get(b);t.setAll(e.element(),{"min-width":a+"px","box-sizing":"border-box"});return e}),p=xa(h.none()),m=function(a,b){var c=b.url();$.set(a,c);rT&&a.dom().click();p.set(h.some(b));e.trigger.change()},n=l.container(b);n.swallowKeys([N.UP(),N.DOWN()]);n.events.up.bind(function(a){a.stopper()();
a=f();r(a);a.moveup()});n.events.down.bind(function(a){a.stopper()();a=f();r(a);a.movedown()});n.events.escape.bind(function(a){var b=f();b.isShowing()&&(b.hide(),a.stopper()())});n.events.enter.bind(function(a){f().getSelectedData().each(function(c){a.stopper()();var d=f();d.hide();d.reset();m(b,c)})});n.on();var r=function(c){if(!c.isShowing()){var d=$.get(b);""===d?c.resetFull():c.filter(d);c.isShowing()||c.show(a.uiDirection())}},q=[E.bind(b,"input",function(c){e.trigger.change();c=f();p.set(h.none());
var d=$.get(b);0<d.length?(c.filter(d),c.isShowing()||c.show(a.uiDirection())):(c.reset(),c.hide())}),E.bind(b,"focus",function(a){f()}),E.bind(b,"blur",function(a){var c=f().hide;T.active().fold(c,function(a){L.eq(a,b)||c()})}),E.bind(c,"click",function(a){f().hide()}),E.bind(d,"click",function(a){a.stop();a=f();a.isShowing()?a.hide():r(a)})];return{destroy:function(){f().destroy();n.destroy();k.each(q,function(a){a.unbind()})},getSelectedValue:function(){return p.get().fold(function(){var a=$.get(b),
c=Wa.isReservedUrl(a)?z(a):s;return cx(a,c)},function(a){return cx(a.url(),a.action())})}}},events:e.registry}}function sT(a,b,c,d,e,g,l){var p=kT(1337),s=hT(g),z=l();l=[s.url().element()];var x=[s.text().element(),s.title().element(),s.target().element()],M=gT(l,x,z.elements(),z.dialogTitle());n.add(M.element(),w.resolve("inline-link-dialog"));var G=Qd.popup(d.uiContainer,d.bounds,a,[],pf.editorContainer()).initMenu(M.element());n.add(G.element(),w.resolve("bubble-box"));l=G.element();l=nT(a,c,l,
p);var R=l.predict(s.url().input(),s.url().dropArrow(),b);g.invalid()&&(s.url().showInvalid(),l.events.change.bind(function(){s.url().hideInvalid()}));var q={before:function(){t.set(G.panel(),"visibility","hidden");G.open()},after:function(){t.remove(G.panel(),"visibility");t.remove(G.panel(),"display")}},na=D.create({remove:K([],z.events().remove),cancel:r([]),execute:K([],z.events().execute)}),u=function(a){var b=a.command();a=a.data();m.has(a,Wa.bookmarkAnchorDataAttr())||"insertLink"!==b&&"updateLink"!==
b||(b=m.get(a,"href"),p.add(b))};e.events.internal.bind(u);b=function(){na.trigger.cancel()};z.events().cancel.bind(b);G.events.close.bind(b);b=k.flatten([s.keylayouts(),M.keylayouts(),z.keylayouts()]);var v=ba.inlineDialog(M.element(),b,pa.inlineDialog({ok:z.execute.click,cancel:f.noop}));v.events.exit.bind(function(){G.close();na.trigger.cancel()});return{showPopup:function(b){q.before();cg.preserve(function(){b.showExpandable(a,c,d,G,M);q.after();M.show();v.enter()},M.element())},hide:function(){G.closed()||
v.exit()},getValues:function(){var a=R.getSelectedValue(),b=$.get(s.text().input()).trim(),c=$.get(s.title().input());return ng.properties({url:""===a.url()?h.none():h.some(a.url()),textChanged:s.textChanged(),text:h.some(b),title:h.some(c),target:Po.getValue(s.target().input()),action:h.some(a.action()),invalid:!1})},destroy:function(){p.destroy();e.events.internal.unbind(u);R.destroy();s.destroy();v.destroy();z.destroy();G.destroy();M.destroy()},events:na.registry}}function tT(a,b){var c=a.filter(),
d=a.content(),e=a.smartview(),g=dx.enabled(d),l=a.internalevents(),p=Y.detect();ng.configure(c);var s=fT(d,p),c=function(){d.getSelection().each(function(a){d.setSelection(a.startContainer(),a.startOffset(),a.endContainer(),a.endOffset())})},k=p.browser.isIE()?c:f.noop,x=D.create({insert:r(["properties"]),update:r(["properties"]),unlink:r([])}),M=pc.destroyable(),G=function(b,c){var g=sT(a.region(),a.keyboard(),d,e,l,b,c);g.events.remove.bind(function(a){x.trigger.unlink();R()});g.events.cancel.bind(function(a){d.focus();
R();k()});M.set(g);d.events.mousedown.bind(R);return g},R=function(){M.clear();d.events.mousedown.unbind(R)},q=function(a){var b=G(a,ex.update);b.events.execute.bind(function(a){x.trigger.update(b.getValues());R()});b.showPopup(Qo)};g.events.properties.bind(function(a){a=a.link();var b=m.has(a,Wa.bookmarkAnchorDataAttr())?Wa.getReservedUrl(m.get(a,Wa.bookmarkAnchorDataAttr())):m.get(a,"href"),c=h.from(nb.get(a).trim());a=ng.properties({url:h.from(b),textChanged:!1,text:c,title:h.from(m.get(a,"title")),
target:h.from(m.get(a,"target")),action:h.none(),invalid:n.has(a,ud.validationHighlight())});q(a)});g.events.follow.bind(function(a){d.focus();setTimeout(function(){s.follow(a.link())},0)});g.events.ignore.bind(function(a){b.ignore(a.link())});g.events.remove.bind(function(){x.trigger.unlink()});return{showContext:q,showInsert:function(a){var b=G(a,ex.insert);b.events.execute.bind(function(a){x.trigger.insert(b.getValues());R()});b.showPopup(Qo)},situation:g.situation,handle:g.handle,assign:g.assign,
events:x.registry,destroy:function(){R();s.destroy()}}}function uT(a){var b=xa(h.none());a=P.div();n.add(a,w.resolve("link-widget"));var c=P.span();n.add(c,w.resolve("link-widget-field"));var d=q.fromTag("input");n.add(d,w.resolve("link-widget-input"));O.label(d,u.translate("link.properties.url.placeholder"));v.append(c,d);m.set(d,"type","url");m.set(d,"placeholder",u.translate("link.dialog.tooltip"));var e=Oh.text(c,d),g=Ph([w.resolve("link-widget-insert")],"insert.link"),l=Ph([w.resolve("link-widget-update")],
"link.dialog.update"),p=Ph([w.resolve("link-widget-remove")],"link.dialog.remove");v.append(a,c);var s=D.create({insert:r(["properties"]),update:r(["properties"]),unlink:r([]),toEditor:r([])}),z=function(a,b){return ng.properties({url:h.some(a),textChanged:b.isSome(),text:b,title:h.none(),target:h.none(),action:h.none(),invalid:!1})},x=function(){var a=$.get(d),c=b.get().fold(function(){return z(a,a)},function(b){return b.text().fold(function(){return z(a,h.some(a))},function(b){b=h.from(b).filter(function(a){return""!==
a.trim()});return z(a,b)})});s.trigger.insert(c);b.set(h.none());s.trigger.toEditor()},M=function(){var a=$.get(d);s.trigger.update(z(a,h.none()));b.set(h.none());s.trigger.toEditor()};g.events.click.bind(x);l.events.click.bind(M);p.events.click.bind(function(){s.trigger.unlink();s.trigger.toEditor()});return{element:f.constant(a),addEscape:function(a){v.append(c,a.element())},type:f.constant(e),execute:function(){Sb.isVisible(g.element())?x():Sb.isVisible(l.element())&&M()},open:function(){T.focus(d)},
close:f.noop,destroy:f.noop,represent:function(a){k.each([g.element(),l.element(),p.element()],B.remove);a.url().fold(function(){$.set(d,"http://");v.after(d,g.element())},function(a){J.after(d,[l.element(),p.element()]);$.set(d,a)});b.set(h.some(a))},events:s.registry}}function vT(a){var b=uT(a),c=lk(a,b);a=dx.disabled();var d=D.create({insert:r(["properties"]),update:r(["properties"]),unlink:r([])});b.events.insert.bind(function(a){d.trigger.insert(a.properties())});b.events.update.bind(function(a){d.trigger.update(a.properties())});
b.events.unlink.bind(function(a){d.trigger.unlink()});return{showContext:function(a){b.represent(a);c.open()},showInsert:function(a){b.represent(a);c.open()},situation:a.situation,handle:a.handle,assign:a.assign,events:d.registry,destroy:function(){c.close();c.destroy()}}}function wT(a,b){var c=a.content(),d=a.undo(),e=a.shortcuts(),g=Y.detect().deviceType.isTouch()?vT(a):tT(a,b),l=D.create({analytics:r(["message"])});g.events.insert.bind(function(b){d.transaction(function(){var d=Ro.insert(c,b.properties());
a.internalevents().input(d)});c.domChanged();c.cursorIntoView();l.trigger.analytics("link_inserted")});g.events.update.bind(function(a){d.transaction(function(){var b=a.properties();Ro.update(c,b)});c.domChanged();c.cursorIntoView()});g.events.unlink.bind(function(a){d.save();Ro.unlink(c);c.domChanged();c.cursorIntoView()});var p=function(){c.getSelection().each(function(a){Pc.sharedLinkOrClosest(a,c.isRoot).fold(function(){c.selectWord();var a=c.getSelectedText().map(function(a){return a.trim()});
g.showInsert(ng.properties({url:h.none(),textChanged:!1,text:a,title:h.none(),target:h.none(),action:h.none(),invalid:!1}))},function(a){var b=h.from(nb.get(a).trim());g.showContext(ng.properties({url:h.from(m.get(a,"href")),textChanged:!1,text:b,title:h.from(m.get(a,"title")),target:h.from(m.get(a,"target")),action:h.none(),invalid:n.has(a,ud.validationHighlight())}))})})},s=Za.ui({"link.general":{toggle:!1,value:"link",textkey:u.key("insert.link"),action:p,updateGeneral:f.noop,icon:!0,shortcut:!0,
hasPopup:!1,hasDialog:!0}});e.events.link.bind(p);return{ui:s,situation:g.situation,handle:g.handle,assign:g.assign,events:l.registry,destroy:function(){g.destroy()}}}function xT(a,b,c){var d=Yj(c),e=Zj.get("ephox.link.service.one",fx.one(),a+"/1/check?url=${url}&fresh=${fresh}",b),g=Zj.post("ephox.link.service.many",fx.many(),a+"/1/check",b),l=function(a){return{url:a.url,result:gx.derive(a.url,a.result)}};return{checkOne:function(a,b){var c=Gh.now(),c=ak.single(function(b,c){return e.execute({url:encodeURIComponent(a),
fresh:c})},d,a,c,void 0!==b?b:!1);return Vd.mapSync(c,l)},checkMany:function(a,b){var c=Gh.now(),c=ak.multiple(function(a,b){return g.execute({urls:a})},d,a,function(a){return yT(a.results,"url")},function(a){return a.url},c,void 0!==b?b:!1);return Vd.mapSync(c,function(a){return W.map(a,l)})},dumpCache:d.dump}}function zT(a){var b=a.slice(0),c=function(a){var c=m.get(a,"href");if(aa.startsWith(c,"#")||m.has(a,Wa.bookmarkAnchorDataAttr()))a=H.error(a);else{var g;g=y.owner(a).dom().baseURI;g=h.from(g).getOr(window.location);
g=hx.resolve(g,a.dom().href);if(k.contains(b,g))a=H.error(a);else{var l=og.parse(g).protocol;a="https"===l||"http"===l?H.value(AT(c,g)):H.error(a)}}return a};return{extract:c,ignore:function(a){c(a).each(function(a){b.push(a.resolved())})},state:function(){return b.slice(0)}}}function BT(a,b,c){var d=a.content(),e=a.filter(),g=a.communication(),l=a.undo(),p=a.viewablearea(),s=p.viewport(),z=zT(b.ignore),x=ud.validationHighlight(),M=ud.invalidLink(),m=ud.unknownLink();ud.configure(e);var R=xT(c.url,
g.newHeaders(),b.cache),q=function(a){a=k.map(a,function(a){return uf.cata(s.assess(a),h.none,f.compose(h.some,z.extract),h.none)});a=$a.cat(a);a=Xh.partition(a);k.each(a.errors,w);var b=CT.generate(a.values);a=W.keys(b);a=k.map(a,function(a){return{url:a}});a=R.checkMany(a);t(a,function(a){W.each(a,function(a){var c=b[a.url];void 0===c?console.warn("Link validator response from server was unknown: ",a.url,a.result):k.each(c,function(b){A(a.result,b)})})})};a=function(){var a=p.sections(),a=Pc.many(a),
a=k.filter(a,function(a){return!n.has(a,qo.embedChecking())});q(a)};var r=oc.adaptable(a,500).throttle;p.events.onChange.bind(r);d.events.domChanged.bind(r);var t=function(a,b){Vd.handle(a,function(a){console.error("Link Validation server failure: ",a)},function(a){b(a)})},u=function(a){return d.body().map(function(b){return Pc.hrefUrl(b,a)})},v=function(a,b){u(a).each(function(a){k.each(a,function(a){n.has(a,ud.validationHighlight())||ea.add(a,[x,b])})})},w=function(a){n.has(a,ud.validationHighlight())&&
ea.remove(a,ud.allClasses())},y=function(a){u(a).each(function(a){k.each(a,w)})},A=function(a,b){gx.cata(a,function(a){v(b,M)},function(a){v(b,m)},function(a){y(b)})};l.events.undo.bind(a);l.events.redo.bind(a);return{destroy:f.noop,refresh:r,ignore:function(a){l.save();z.ignore(a);r();d.focus();d.domChanged();d.cursorIntoView()},state:function(){return{ignore:z.state(),cache:R.dumpCache()}}}}function DT(a,b,c){return{patterns:function(){return[RegExp("(\\W)(\\w+)(\\W*)$","gi"),RegExp("(^)(\\w+)(\\W*)$",
"gi")]},useCursor:f.constant(!0),generate:function(a,b){var g=q.fromText(b.text());return cd.species({elements:f.constant([g]),cursor:h.none,dictation:f.constant(h.some(function(){return c(b.text())})),notify:h.none})},derive:function(a){var c=a.index+a[1].length,g=c+a[2].length;return b(a[2]).map(function(a){return{startIndex:f.constant(c),finishIndex:f.constant(g),text:f.constant(a)}})},label:a}}function So(a,b){var c=cb.sanitise(a);return{patterns:function(){return[RegExp("("+c+")","gi")]},useCursor:f.constant(!0),
generate:function(a,c){var g=q.fromTag("span",a.dom());g.dom().innerHTML=b;return cd.species({elements:f.constant([g]),cursor:h.none,dictation:h.none,notify:h.none})},derive:function(a){var b=a.index;a=b+a[0].length;return h.some({startIndex:f.constant(b),finishIndex:f.constant(a)})}}}function yf(a,b,c){var d=cb.sanitise(b);return{patterns:function(){return[RegExp("^("+d+"\\s)(.+)","gi")]},useCursor:f.never,generate:function(b,d){var l=q.fromTag(a,b.dom());t.set(l,"list-style-type",c);var p=q.fromTag("li",
b.dom()),s=q.fromTag("li",b.dom());v.append(s,q.fromTag("br",b.dom()));J.append(l,[p,s]);J.append(p,d.clones());return cd.species({elements:f.constant([l]),cursor:f.constant(h.some(S.point(s,0))),dictation:h.none,notify:h.none})},derive:function(a){var b=a[1];return h.some({startIndex:f.constant(a.index),finishIndex:f.constant(a.index+b.length)})}}}function xk(a,b,c,d){var e=cb.sanitise(b),g=cb.sanitise(c);return{patterns:function(){return[RegExp(e+"([^\\s].*?[^\\s])"+g,"gi"),RegExp(e+"([^\\s])"+
g,"gi")]},useCursor:f.always,generate:function(a,b){var c=q.fromTag(d,a.dom()),e=q.fromText(b.text());v.append(c,e);return cd.species({elements:f.constant([c]),cursor:h.none,dictation:h.none,notify:h.none})},derive:function(a){return h.some({startIndex:f.constant(a.index),finishIndex:f.constant(a.index+a[0].length),text:f.constant(a[1])})}}}function ET(a,b){var c=cb.sanitise(a);return{patterns:function(){return[RegExp("("+c+")","gi")]},useCursor:f.always,generate:function(a,c){return cd.species({elements:f.constant([q.fromTag(b,
a.dom())]),cursor:h.none,dictation:h.none,notify:h.none})},derive:function(a){return h.some({startIndex:f.constant(a.index),finishIndex:f.constant(a.index+a[0].length)})}}}function FT(a,b,c){var d=c.allowed.fold(GT,function(a){return function(b,c){return k.contains(a,b)?c:[]}}),e=function(a){return{derive:a.derive,generate:a.generate,patterns:a.patterns,useCursor:a.useCursor,allowed:f.constant(!0)}},g=function(a,b){return{derive:a.derive,generate:a.generate,patterns:a.patterns,useCursor:a.useCursor,
allowed:function(a){return!1===db.closest(a,b)}}};c=d(HT,[e(pg.spaced("######","h6")),e(pg.spaced("#####","h5")),e(pg.spaced("####","h4")),e(pg.spaced("###","h3")),e(pg.spaced("##","h2")),e(pg.spaced("#","h1"))]);var l=d(IT,[e(yf("ul","*","disc")),e(yf("ol","1.","decimal")),e(yf("ol","a.","lower-alpha")),e(yf("ol","i.","lower-roman")),e(yf("ol","1)","decimal")),e(yf("ol","a)","lower-alpha")),e(yf("ol","i)","lower-roman"))]),p=d(JT,[e(xk("bold","**","**","strong")),e(xk("bold","__","__","strong")),
e(xk("italic","*","*","em")),e(xk("italic","_","_","em"))]),s=d(KT,[e(So("(c)","&copy;")),e(So("--","&mdash;")),e(So("-","&mdash;"))]),h=[e(ix.normalise()),e(ix.capitalise())],x=function(a){return u.translate("aria.autocorrect.announce",a)};a=a.hasAutocorrect()?[e(DT("autocorrect",a.lookup,x))]:[];var x=d(LT,[e(ET("---","hr"))]),M=xb.cached(function(a){a.runOrOnLoaded(function(b){var c=xb.cached(function(){y.owner(b).dom().execCommand("AutoUrlDetect",!1,!1)});a.events.focus.bind(function(){c()})});
return d(MT,[g(NT,"a")])});return{headings:f.constant(c),semantics:f.constant(p),entities:f.constant(s),cases:f.constant(h),lists:f.constant(l),dynCustoms:function(){var a=b.get();return k.map(a,e)},link:M,hr:f.constant(x),corrections:f.constant(a)}}function OT(a,b,c,d,e,g,l,p){var s=h.none(),z=h.none(),x=FT(e,g,p),M=k.flatten([x.link(b),x.hr(),x.semantics(),x.entities()]),m=function(){return k.flatten([M,a.autocorrect().get()?x.corrections():[],a.capitalisation().get()?x.cases():[],x.dynCustoms()])},
n=x.headings().concat(x.lists()),r=function(a,b,c,d){var e=jx.descend(b,c),g=PT.get(e.element(),e.offset());c=k.filter(d,function(a){return a.allowed(b)});return $a.findMap(c,function(b){return a(g,b,e.element(),e.offset())})},q=function(a,c){b.undoOperation(function(){a(function(){return c.execute(b,l)}).each(function(a){b.setSelection(a.element(),a.offset(),a.element(),a.offset())});b.domChanged()})};return{spaceDown:function(){b.getSelection().map(function(a){a.collapsed()&&(s=r(To.inline,a.startContainer(),
a.startOffset(),m()))})},spaceUp:function(){var a=f.curry(q,d.run);s.each(a);s=h.none()},enterDown:function(){b.getSelection().map(function(a){a.collapsed()&&(z=r(To.block,a.startContainer(),a.startOffset(),n.concat()));z=z.orThunk(function(){return r(To.inline,a.startContainer(),a.startOffset(),m())})})},enterUp:function(){var a=f.curry(q,f.apply);z.each(a);z=h.none()}}}function QT(a,b,c,d){var e=a.profile(),g=a.content(),l=a.undo(),p=a.context(),s=a.operations(),h=a.internalevents(),k=D.create({analytics:r(["message"])}),
M=Rn(c.customs),m=OT(e,g,l,s,b,M,h,d);g.events.keydown.bind(function(a){hd.isSpace(a)&&m.spaceDown()});g.events.keyup.bind(function(a){hd.isSpace(a)&&m.spaceUp()});p.events.preLinebreak.bind(function(a){m.enterDown()});p.events.postLinebreak.bind(function(a){m.enterUp()});var n=function(a){return function(){var b=a.get();a.setAndCache(!b)}},q=function(a){return function(b){(!0===a.get()?b.select:b.deselect)()}};b=function(a,b,c){return{toggle:!0,value:a,textkey:u.key(b),action:n(c),updateGeneral:q(c),
icon:!1,tooltip:Va.get}};return{ui:Za.ui({"capitalisation.general":b("capitalisation","cog.capitalisation",a.profile().capitalisation()),"autocorrect.general":b("autocorrect","cog.autocorrect",a.profile().autocorrect())}),destroy:f.noop,events:k.registry,customMacros:f.constant(M),state:function(){return{customs:M.state()}}}}function RT(){var a=D.create({insert:r(["embed"]),input:r(["raw"])}),b=q.fromTag("span"),c=dc.textarea("media-embed","media.embed"),d=u.translate("media.placeholder"),e=Oa.describe(c.textarea(),
d);v.append(c.element(),e);e=P.span();O.hidden(e,!0);n.add(e,w.resolve("media-icon"));m.set(e,"alt",u.translate("media.insert"));var g=Yb(),l=u.translate("media.insert");g.content(mc(l));n.add(g.element(),[w.resolve("media-insert")]);Rc.makeDefault(g.element());O.button(g.element(),l);m.set(c.textarea(),"placeholder",d);kx(g);a.registry.input.bind(function(){var a=$.get(c.textarea());g.disabled()?""!==a&&(g.enable(),ga.enable(g.element())):""===a&&kx(g)});var p=E.bind(c.textarea(),"input",a.trigger.input);
J.append(b,[e,c.element(),g.element()]);var s=function(){var b=$.get(c.textarea());a.trigger.insert(b);ST&&T.blur(c.textarea())},d=[ba.input(c.textarea(),pa.input({})),ba.button(g.element(),pa.button({execute:ob.click}))];g.events.click.bind(function(){s()});return{element:f.constant(b),execute:s,empty:function(){$.set(c.textarea(),"")},keylayouts:f.constant(d),events:a.registry,destroy:function(){p.unbind();g.destroy();B.remove(b)}}}function TT(a){var b=a.region(),c=a.content(),d=a.smartview(),e=
RT(),g=ba.inlineDialog(e.element(),e.keylayouts(),pa.inlineDialog({ok:e.execute,cancel:f.noop}));O.dialog(e.element(),u.translate("insert.media"));var l=Qd.popup(d.uiContainer,d.bounds,b,[],pf.editorContainer()).initMenu(e.element());ea.add(e.element(),[w.resolve("media-embed-dialog"),w.resolve("inline-dialog")]);g.events.exit.bind(function(){p()});var p=function(){l.closed()||(l.close(),e.empty(),c.focus(),g.exit())};a=D.create({insert:K(["embed"],e.events.insert)});return{element:e.element,showPopup:function(a){l.open();
a.show(b,c,d,l,e);g.enter()},isClosed:l.closed,events:a.registry,destroy:function(){p();g.destroy();e.destroy();l.destroy()}}}function UT(a){a=P.div();n.add(a,w.resolve("media-widget"));var b=P.span();n.add(b,w.resolve("media-widget-field"));var c=q.fromTag(Lb.isLarge()?"textarea":"input");n.add(c,w.resolve("media-widget-input"));var d=u.translate("media.placeholder");m.set(c,"placeholder",d);m.set(c,"title",d);v.append(b,c);d=Ph([w.resolve("media-widget-insert")],"insert.media");v.append(b,d.element());
v.append(a,b);var e=Oh.text(b,c),g=D.create({insert:r(["embed"]),toEditor:r([])}),l=function(){var a=$.get(c),a=VT?a.replace(/=\u201c([^\u201d]*)\u201d/g,'="$1"'):a;g.trigger.insert(a);g.trigger.toEditor()};d.events.click.bind(function(){l()});return{element:f.constant(a),addEscape:function(a){v.append(b,a.element())},open:function(){$.set(c,"");T.focus(c)},close:f.noop,execute:function(){l()},destroy:f.noop,type:f.constant(e),events:g.registry}}function WT(a){var b=a.content(),c=function(){var c=
pc.destroyable(),d=function(){c.clear();b.events.mousedown.unbind(d)};return{open:function(){var e=TT(a);e.events.insert.bind(function(c){c=c.embed();a.insertFilteredHtmlAtCursor(c);b.cursorIntoView();d()});e.showPopup(Qo);b.events.mousedown.bind(d);c.set(e)},destroy:function(){d()}}},d=function(){var c=UT(a);c.events.insert.bind(function(c){c=c.embed();a.insertFilteredHtmlAtCursor(c);b.cursorIntoView()});return lk(a,c)},e=(Y.detect().deviceType.isTouch()?d:c)();return{ui:Za.ui({"media.general":{toggle:!1,
value:"media",textkey:u.key("insert.media"),action:e.open,updateGeneral:f.noop,icon:!0,shortcut:!1,hasPopup:!1,hasDialog:!0}}),destroy:function(){e.destroy()}}}function XT(a,b){var c=q.fromTag("div");n.add(c,w.resolve("mentions-business-card"));var d=a.initMenu(c),e=null,g=function(a,b,e){B.empty(c);v.append(c,e);d.open();a(b,d)};return{showFull:function(a){return function(b,c){clearTimeout(e);e=setTimeout(function(){g(a,b,c)},YT)}}(b.showUnder),showMini:f.curry(g,b.showAtSide),hide:function(){clearTimeout(e);
d.close()},destroy:function(){clearTimeout(e);d.destroy()}}}function ZT(a){var b=h.none();return{fetch:function(b,d){a.fetch(b,function(a,b){var c=lx("fetch()",a,b);d(c)})},fetchExtra:function(b,d,e){a.menuExtra(b,d,function(a,b){var c=lx("menuExtra()",a,b);e(c)})},menuHover:function(c,d){b=h.some(c.userid);a.menuHover(c,function(a){a=Uo("menuHover() callback",a);b.is(c.userid)&&d(a)})},hover:function(b,d){a.hover(b.dom(),function(a){a=Uo("hover() callback",a);d(a)})},menuComplete:function(b){b=a.menuComplete(b);
return Uo("menuComplete result",b)},hoverSelector:function(){return a.hoverSelector},isTrigger:function(a){return 64===a}}}function $T(a){var b=ab.mainmenu(q.fromDom(document),w.resolve("mentions-list"),[]),c=xa({}),d=function(a){return a.userid},e=function(a){return a.name},g=function(a,b){I.child(a,".ephox-gopher-item-text").each(function(a){ua.set(a,b)})},l=function(a){return k.map(a,function(a){var b=ab.item(q.fromDom(document),a.userid,a.name);g(b,a.name);return b})},p=function(a){return k.foldr(a,
function(a,b){var c={};c[b.userid]=b;return Z.merge(a,c)},{})},s=function(a,b){var c=l(a),d=k.map(b,function(a){return ab.item(q.fromDom(document),a.key,a.value)});return c.concat(d)},z=function(a){var b=m.get(a,"data-ephox-gopher-item-value"),d=c.get();return void 0!==d[b]?Vo.fetched(d[b].userid,d[b].name,d[b].rawname,d[b],a):k.contains([mx,nx],b)?Vo.none(a):Vo.extra(b,a)};return{element:f.constant(b),selected:function(){return I.descendant(b,".ephox-gopher-item-selected")},setData:function(d,e){var g=
p(d);c.set(Z.merge(c.get(),g));g=0===d.length?[{userid:nx,name:a.get("mentions.lookahead.noresults")}]:d;g=s(g,e);B.empty(b);J.append(b,g)},getInfo:z,getUserId:function(a){return z(a).fold(h.none,h.none,f.compose(h.some,d))},setLoading:function(){var c=[{userid:mx,name:a.get("mentions.lookahead.searching")}],c=s(c,[]);B.empty(b);J.append(b,c)},getName:function(a){return z(a).fold(h.none,h.none,f.compose(h.some,e))},refind:function(a){a=m.get(a,"data-ephox-gopher-item-value");return void 0!==a&&null!==
a?I.descendant(b,'[data-ephox-gopher-item-value="'+a+'"]'):h.none()},isOpen:function(){return Sb.isVisible(b)}}}function aU(a,b,c){var d=function(a){Oa.speak(ca.body(),a)},e=$T(c);a.setView(e.element());var g=xa(""),l=function(b){s(b.rawData(),b.extra());a.reposition(h.none())},p=function(a){var b=e.selected();a();return b.bind(e.refind)},s=function(b,g){d(c.get("mentions.lookahead.open"));a.updateItems(p,function(){e.setData(b,g)})},k=function(a){return e.isOpen()&&2<=a.length?Wo.refetch(a):2<=a.length?
Wo.open(a):Wo.nothing()},x=function(a){a.fold(G,l)},m=D.create({accept:r(["information"]),menuHover:r(["element","info"]),none:r([])}),G=function(){a.cancel()};return{setData:s,isOpen:function(){return e.isOpen()},lookup:function(c,d){var l=aa.startsWith(c,"@")?c.substring(1):c;g.set(l);var p=f.noop;k(l).fold(p,function(a){b.fetch(a,x)},function(c){e.setLoading();a.open(d);b.fetch(c,x)})},close:function(){a.close()},onClick:function(a){e.getInfo(a).fold(function(){m.trigger.none()},function(a,c){b.fetchExtra(a,
g.get(),x)},function(a,b,d,e,g){Oa.speak(ca.body(),c.get("mentions.lookahead.selected",d));m.trigger.accept(e)})},onHover:function(a){d(nb.get(a));e.getInfo(a).fold(f.noop,f.noop,function(a,b,c,d,e){m.trigger.menuHover(e,d)})},events:m.registry}}function bU(a,b,c,d){var e=q.fromTag("div");n.add(e,w.resolve("mentions-lookahead-container"));var g=c.initMenu(e),l=xa(h.none()),p=D.create({close:r([])}),s=function(){return Sb.isVisible(e)};c=function(){l.set(h.none());g.close()};g.events.close.bind(function(){b.close();
p.trigger.close()});a.events.mousedown.bind(c);return{element:f.constant(e),destroy:function(){l.set(h.none());g.destroy()},setView:function(a){B.empty(e);v.append(e,a)},updateItems:function(a,c){a(c).fold(function(){b.setActiveMenu(e)},function(a){b.select(a)})},reposition:function(a){a.isSome()&&l.set(a);s()&&l.get().each(function(a){d.showUnder(a,g)})},open:function(c){a.body().each(function(a){g.open();d.showUnder(c,g);l.set(h.some(c));b.open([b.sandbox()],a)})},isOpen:s,cancel:function(){l.set(h.none());
p.trigger.close()},close:c,events:p.registry}}function cU(a,b,c,d,e,g){var l=bU(a,b,c,d),f=aU(l,e,g);a=D.create({menuHover:K(["element","info"],f.events.menuHover),accept:K(["information"],f.events.accept),close:K([],l.events.close)});f.events.none.bind(l.close);return{onHover:f.onHover,onClick:f.onClick,close:function(){f.isOpen()&&f.close();l.isOpen()&&l.cancel()},isOpen:l.isOpen,lookup:function(a,b){l.reposition(h.some(b));f.lookup(a,b)},destroy:function(){l.destroy()},events:a.registry}}function dU(a,
b){var c=xa([]),d=null,e=null,g=D.create({contentHover:r(["target"]),stopHover:r([]),menuHover:r(["info"])});a.runOrOnLoaded(function(a){c.set([E.bind(a,"mouseover",function(a){z(a)}),E.bind(ca.body(),"mouseover",function(a){I.closest(a.target(),Xo).each(f)}),E.bind(a,"mouseout",function(a){x(a)}),E.bind(ca.body(),"mouseout",function(a){m(a)})])});var l=function(a){clearTimeout(d);clearTimeout(e);d=setTimeout(function(){g.trigger.contentHover(a)},300)},f=function(){clearTimeout(e)},s=function(){clearTimeout(d);
e=setTimeout(function(){g.trigger.stopHover()},300)},z=function(a){I.closest(a.target(),b).each(function(a){l(a);g.trigger.contentHover(a)})},x=function(a){if(!db.closest(a.target(),b))return!1;h.from(a.raw().relatedTarget||a.raw().toElement).map(q.fromDom).filter(function(a){return db.closest(a,b)}).isNone()&&s()},m=function(a){if(!db.closest(a.target(),Xo))return!1;h.from(a.raw().relatedTarget||a.raw().toElement).map(q.fromDom).filter(function(a){return db.closest(a,Xo)}).isNone()&&s()};return{destroy:function(){k.each(c.get(),
function(a){a.unbind()})},events:g.registry}}function eU(a){return{get:function(b){var c=a[b];return Q.isString(c)?fU(c,Array.prototype.slice.call(arguments,1)):u.translate.apply(void 0,arguments)}}}function ox(a){return{show:function(b,c,d,e,g){c=ag(0,0);b=b.directionAt(a);b=yk.mainmenu(d,f.constant(a),c,b);d.show(e,b);e.setComponents([a,g.element()])},showWith:function(b,c,d,e,g){b=b.directionAt(a);b=yk.submenu(d,f.constant(a),b);d.show(e,b);e.setComponents([a,g.element()])}}}function gU(a,b,c,
d){return{showAtSide:function(d,g){ox(d).showWith(a,b,c,g,{element:f.constant(g.element())})},showUnder:function(d,g){ox(d).show(a,b,c,g,{element:f.constant(g.element())})}}}function hU(a,b){var c=eU(b.aria),d=a.content(),e=a.smartview(),g=a.region(),l=a.operations(),p=ZT(b),s=Qd.menuSystem(e.uiContainer,f.constant("mentions"),Bh.menu({focusActive:!1}));t.set(s.sandbox(),"z-index",String(void 0!==b.zIndex?b.zIndex:iU));var h=Qd.popup(s.sandbox,e.bounds,g,[],pf.editorContainer()),e=gU(g,d,e,s.sandbox()),
x=cU(d,s,h,e,p,c),m=XT(h,e);jU.configure(a.filter());var G=dU(d,p.hoverSelector());x.events.menuHover.bind(function(a){p.menuHover(a.info(),function(b){b.fold(f.noop,function(b){Sb.isVisible(a.element())&&m.showMini(a.element(),b)})})});G.events.contentHover.bind(function(a){p.hover(a.target(),function(b){b.fold(f.noop,function(b){x.close();m.showFull(a.target(),b)})})});G.events.stopHover.bind(function(a){m.hide()});s.events.itemHover.bind(function(a){a=a.item();x.onHover(a);d.backupSelection();
T.focus(a);d.focus()});s.events.itemAction.bind(function(a){x.onClick(a.item())});d.events.nodeChanged.bind(function(a){d.getSelection().each(function(b){b.collapsed()&&(qg.detectOn(b,p).fold(x.close,x.close,f.noop,x.close),a.prev().each(function(a){Yo.validatePrevious(a,b.startContainer())}))})});d.events.keyup.bind(function(a){d.getSelection().each(function(b){b.collapsed()&&(k.contains(n,a.original().raw().which)||qg.withinIncomplete(b.startContainer()).each(function(a){var b=lc.descendants(a,
A.isText),b=k.map(b,Fa.get).join("");x.lookup(b,a);m.hide()}))})});d.events.keypress.bind(function(a){var b=a.original();p.isTrigger(b.raw().which)&&d.getSelection().each(function(a){px.isValidMention(a.startContainer(),a.startOffset())&&(a=function(){var a=Yo.create();xc.insertAtCursor(d,[a]).each(function(a){d.setSelection(a.element(),a.offset(),a.element(),a.offset())});b.kill();Oa.speak(ca.body(),c.get("mentions.initiated"))},qg.detect(d,p).fold(a,a,f.noop,f.noop))})});var n=k.flatten([N.ENTER(),
N.DOWN(),N.UP()]);a.context().events.preLinebreak.bind(function(a){r(function(b,c){x.isOpen()?a.handler().handle():y()},f.noop)});d.events.keydown.bind(function(a){var b=a.original().raw().which;k.contains(N.ESCAPE(),b)?r(function(){y();a.original().kill()},f.noop):k.contains(n,b)&&x.isOpen()&&(s.simulateKey(a.original()),a.original().kill())});var r=function(a,b){qg.detect(d,p).fold(b,b,a,b)},u=function(a){r(function(b,c){p.menuComplete(a).each(function(a){v.after(c,a);B.remove(c);var b=q.fromText(Ua.zeroWidth());
v.after(a,b);d.setRelativeSelection(da.after(b),da.after(b));w()})},w)},w=function(){m.hide();x.close()},y=function(){r(function(a,b){Oa.speak(ca.body(),c.get("mentions.lookahead.cancelled"));l.atomic(function(){Yo.cancel(b)});w()},w)};x.events.close.bind(y);x.events.accept.bind(function(a){u(a.information())});return{destroy:function(){x.destroy();m.destroy();G.destroy();s.destroy()}}}function kU(a){var b=function(a){var b;b={zh:"zh_cn",pt:"pt_br"};b=void 0===b[a]?a:b[a];b=u.has("parlance."+b)?u.key("parlance."+
b):u.raw(b);return lU(b,a,h.none())},c=k.map(a.languages,b);return{build:function(d){return d.filter(function(b){return!k.contains(a.languages,b)}).fold(function(){return c},function(a){return c.concat([b(a)])})}}}function mU(a,b,c){var d=a.content(),e=a.undo(),g=kU(c),l=function(){return d.on(function(a){return zf.language(a).fold(oa.off,oa.on)}).getOrThunk(oa.unchanged)};return{ui:Za.ui({"parlance.dropdown":f.constant({name:"parlance",textkey:u.key("parlance.set"),menuTextkey:u.key("parlance.menu"),
updateDropdown:function(a){var b=l(),c=b.fold(h.none,h.none,h.some),c=g.build(c);a.populate([{label:h.none,items:f.constant(c)}]);b.fold(a.deactivate,f.noop,a.activate);b.fold(a.untick,f.noop,a.tick)},action:function(c){var g=function(a){return vc.language(d.isRoot,a,c)};b.lock(function(){qb.cata(a.selections().get(),f.noop,Tj.multiple(d,e,g),Tj.single(d,e,g));d.getSelection().each(function(a){b.check(a.startContainer(),a.startOffset(),a.endContainer(),a.endOffset())})});setTimeout(function(){d.uiChanged()},
0)},values:g.build(h.none()),render:h.none(),toggle:!1,describe:function(){return u.key("parlance.set")}})},f.identity),destroy:f.noop}}function nU(){var a=q.fromTag("textarea");O.label(a,u.translate("plaincode.dialog.editor"));O.textarea(a);return{element:f.constant(a)}}function oU(a){var b=D.create({execute:r(["html"]),close:r([])}),c=$d(a);n.add(c.element(),w.resolve("plaincode-modal"));c.setTitle(u.translate("plaincode.dialog.title"));var d=function(){e();b.trigger.close()},e=function(){c.hide()},
g=nU();c.setContent(g.element());a=Rc.okCancel("plaincode");a.events.ok.bind(function(){b.trigger.execute($.get(g.element()));d()});a.events.cancel.bind(function(){d()});c.events.close.bind(function(){l.exit();d()});c.setControls(a.element());var l=ob.setup(c,a,[ba.single(g.element(),[U.rule(U.is(N.ENTER()[0]),function(a){a.raw().stopPropagation();return h.none()})],h.none())]);return{element:c.element,open:function(){c.show();l.enter()},setHtml:function(a){$.set(g.element(),a)},destroy:function(){c.destroy();
l.destroy()},hide:e,events:b.registry}}function pU(a){var b=oU(a),c=function(){d.trigger.close();b.events.close.unbind(c);b.events.execute.unbind(e);b.destroy()},d=D.create({execute:r(["html"]),close:r([])}),e=function(a){d.trigger.execute(a.html())};b.events.close.bind(c);b.events.execute.bind(e);return{show:function(){b.open()},setHtml:b.setHtml,events:d.registry}}function qU(a,b){var c=a.content(),d=a.shortcuts(),e=a.smartview(),g=b.setContent,l=b.getContent;d.events.plaincode.bind(function(){p()});
var p=function(){var a=pU(e.uiContainer());a.events.close.bind(function(){c.toEditing()});a.events.execute.bind(function(a){g(a.html())});c.toReading();a.setHtml(l());a.show()};return{destroy:f.noop}}function rU(){var a=D.create({grow:r(["x","y"])}),b=1,c=1,d=h.none(),e=function(a){return t.getRaw(a,"width").bind(function(a){return aa.endsWith(a,"px")?h.some(parseInt(a,10)):h.none()}).getOrThunk(function(){return ra.get(a)})};return{setTarget:function(a){d=h.some(a);c=ra.get(a)/(ha.get(a)+0)},setMultiplier:function(a){b=
a},clearTarget:function(){d=h.none()},mutate:function(g,l){d.each(function(d){var f=e(d)+b*g,h=1===f?1:Math.floor(f/c);5<=f&&5<=h&&(ra.set(d,f),ha.set(d,h));a.trigger.grow(g,l)})},events:a.registry,destroy:f.noop}}function sU(a){var b=h.none(),c=rU();c.events.grow.bind(function(){g()});var d=Dh.transform(c,{layerClass:w.resolve("layer-below-dialog")});d.events.stop.bind(function(){b.each(function(a){l.trigger.stop(a)})});n.add(d.element(),w.resolve("resize-eph-block"));var e=tU.create();e.events.click.bind(function(b){c.setMultiplier(b.multiplier());
a.body().each(function(a){d.go(y.documentElement(a))})});var g=function(){e.clear();b.each(Zo.clean)},l=D.create({stop:r(["target"])});return{showHandles:function(a){var g=y.documentElement(a);c.setTarget(a);b=h.some(a);d.on();e.refresh(g,a)},hideHandles:g,events:l.registry,destroy:function(){e.destroy();c.destroy();d.destroy();b=h.none()}}}function uU(a){var b=a.content(),c=a.undo();a=a.filter();Zo.configure(a);var d=sU(b),e=function(a){Jb.detect(b.getSelection()).each(function(d){c.save();ee.remove(b,
d.image());b.domChanged();c.save();a.original().kill()})},g=function(a){Jb.detect(b.getSelection()).each(function(c){b.setRelativeSelection(da.before(c.image()),da.before(c.image()));a.original().kill()})},l=function(a){Jb.detect(b.getSelection()).each(function(c){b.setRelativeSelection(da.after(c.image()),da.after(c.image()));a.original().kill()})},p=function(){Jb.detectForEditing(b.getSelection(),b.imageExcludes).fold(function(){d.hideHandles()},function(a){a=a.image();d.showHandles(a);ee.reselect(b,
a)})};b.events.loaded.bind(p);b.events.domChanged.bind(p);b.events.paint.bind(p);b.events.nodeChanged.bind(p);b.events.selectionchange.bind(function(a){Jb.detect(b.getSelection()).fold(p,f.noop)});var s=h.none();b.events.ready.bind(function(a){a=a.api().body();s=h.some(gk.handle(a,function(a){"img"===A.name(a.target())&&ee.select(b,a.target())}))});b.events.mousedown.bind(function(a){a=a.original().target();"img"===A.name(a)&&Zo.disableNativeResize(a)});b.events.keydown.bind(function(a){hd.isDel(a)||
hd.isBackspace(a)?e(a):hd.isLeftOrUp(a)?g(a):hd.isRightOrDown(a)&&l(a)});d.events.stop.bind(function(a){a=a.target();d.showHandles(a);ee.reselect(b,a)});return{destroy:function(){d.destroy();s.each(function(a){a.unbind()})}}}function vU(a,b){var c=a.content(),d=a.filter(),e=a.selections(),g=f.curry(d.filterDom,d.output());c.events.ready.bind(function(a){a=a.api();var b=wU(a,d),s=function(a,l){qb.cata(e.get(),f.noop,function(c){xU(c,g).each(function(d){b(a,d.text,d.html,f.curry(l,function(){yU(c)}))})},
function(e,g){zU(e,g,d).each(function(d){b(a,d.text,d.html,f.curry(l,function(){c.insertHtmlAtCursor("")}))})})};a.events.cut.bind(function(a){s(a.original(),f.apply)});a.events.copy.bind(function(a){s(a.original(),f.noop)})});return{destroy:f.noop}}function AU(a,b){var c=function(a,b,c){a(c,b);return h.some({element:f.constant(b),cleanup:function(){B.remove(b)},splits:f.constant([])})},d=function(a){return{none:h.none,start:f.curry(c,v.before,a),end:f.curry(c,v.after,a),middle:function(b,d,e){return c(v.after,
a,d)}}},e=function(a){var b=function(a){return function(b,c){v.appendAt(b,c,a)}};return{prepend:f.curry(c,v.prepend,a),before:f.curry(c,v.before,a),after:f.curry(c,v.after,a),insertAt:function(d,e){return c(b(e),a,d)},append:f.curry(c,v.append,a)}};return{before:{text:d(a),element:{hasPrevious:e(a).insertAt,first:e(a).prepend,empty:e(a).before,otherwise:e(a).append}},after:{text:d(b),element:{hasNext:e(b).insertAt,rightEdge:e(b).append,empty:e(b).after,otherwise:e(b).append}},general:{insertBefore:e(a).before,
insertAfter:e(b).after}}}function BU(a){var b=zk.fromUnsafe(a),c=q.fromTag("span"),d=q.fromTag("span");k.each([c,d],a.markAsEphemeral);var e=AU(c,d);return{backup:function(){a.getSelection().each(function(g){g.collapsed()?(xc.insertAtCursor(a,[c]),B.unwrap(d),b.begin()):qx.both(e,g.startContainer(),g.startOffset(),g.endContainer(),g.endOffset())})},insert:function(e,l,f){a.setRelativeSelection(da.after(c),ca.inBody(d)?da.before(d):da.after(c));xc.insertAtCursorWith(a,e,l,f).each(function(b){!db.ancestor(b.element(),
"table")||"td"!==A.name(b.element())&&"th"!==A.name(b.element())?a.setRelativeSelection(da.after(b.element()),da.after(b.element())):a.setSelection(b.element(),0,b.element(),0)});b.end();rf.cursorIntoView(a);k.each([c,d],B.unwrap)},cancel:function(){k.each([c,d],B.unwrap)}}}function rx(a,b){var c=D.create({cancel:r([]),error:r(["message"]),insert:r(["elements","assets","correlated","isInternal"])}),d=function(d,e,f){d=sx.choose(a,b,d);d.capture()&&f();f=k.map(d.steps(),function(a){return a(e)});sx.run(f,
d.input()).get(function(a){var b=a.bundle().isInternal().getOr(!1);La.cata(a.response(),function(a){c.trigger.error(a)},function(a,d){c.trigger.insert(a,tx(d),d,b)},function(){c.trigger.cancel()},function(a,d,e){c.trigger.insert(a,tx(d),d,b);c.trigger.error(e)})})},e=Lc.tap(function(a){Ea.getExact(a.target.ownerDocument.defaultView).each(function(b){n.has(b.start(),ux.bin())||(b=CU.fromEvent(a),vx.willBlock()&&(e.control.block(),a.preventDefault()),d(b,e.control,function(){a.preventDefault()}))})});
return{paste:e.instance,pasteCustom:function(a){var b=Lc.tap(f.noop);d(a,b.control,f.noop)},isBlocked:e.control.isBlocked,destroy:f.noop,events:c.registry}}function Ak(){return function(a,b){return wa.sync(function(a){var d=function(){wa.call(a,{response:b.response(),bundle:b.bundle()})},e=function(d,e){Ic.mapM(d,DU).get(function(d){wa.call(a,{response:e(d),bundle:b.bundle()})})};La.cata(b.response(),d,function(a,b){e(b,function(b){return La.paste(a,b)})},d,function(a,b,c){e(b,function(b){return La.incomplete(a,
b,c)})})})}}function wx(a){return function(b,c){return wa.sync(function(b){var e=function(){wa.call(b,{response:c.response(),bundle:c.bundle()})},g=function(a){var e=EU(a),g=Ic.mapM(e,function(a){return a.asset()}),l=k.map(e,function(a){return a.image()});g.get(function(e){e=ge.updateSources(e,l);wa.call(b,{response:La.paste(a,e),bundle:c.bundle()})})},l=function(l,f,h){!1===a.allowLocalImages?(f=k.filter(xx(l),yx),k.each(f,B.remove),wa.call(b,{response:0<f.length?FU(l):c.response(),bundle:c.bundle()})):
0===f.length?g(l):e()};La.cata(c.response(),e,l,e,l)})}}function zx(a){var b=a.translations,c=D.create({insert:r(["elements","correlated"]),incomplete:r(["elements","correlated","message"])});return{events:c.registry,processRtf:function(a,e,g,l){g=he.images(g);var f=Yh.find(a);GU.convert(f,g,function(b,g){var f=y.children(a),p=b.concat(e);g?c.trigger.incomplete(f,p,"errors.imageimport.failed"):c.trigger.insert(f,p);l()},b)}}}function HU(a,b){var c=D.create({insert:r(["elements","correlated"]),incomplete:r(["elements",
"correlated","message"])}),d=zx(b);d.events.incomplete.bind(function(a){c.trigger.incomplete(a.elements(),a.correlated(),a.message())});d.events.insert.bind(function(a){c.trigger.insert(a.elements(),a.correlated())});return{events:c.registry,gordon:function(e,g){var l=function(a){d.processRtf(e,g,a.rtf(),a.hide())},f=function(a){var b=Yh.find(e);k.each(b,B.remove);c.trigger.incomplete(y.children(e),g,a)},h=function(){var a=Yh.find(e);k.each(a,B.remove);c.trigger.insert(y.children(e),g)},z=function(a){f(a.message())};
if(!0===b.allowLocalImages&&!0===b.enableFlashImport){var x=a(b);x.events.response.bind(l);x.events.cancel.bind(h);x.events.failed.bind(z);x.events.error.bind(z);x.open()}else f("errors.local.images.disallowed")}}}function Ax(a,b){var c=HU(a,b),d=xa(h.none()),e=function(a){d.get().each(function(b){wa.call(b,{response:a,bundle:pb.nu({})})})};c.events.insert.bind(function(a){e(La.paste(a.elements(),a.correlated()))});c.events.incomplete.bind(function(a){e(La.incomplete(a.elements(),a.correlated(),a.message()))});
return function(a,b){return wa.sync(function(a){var e=function(){wa.call(a,{response:b.response(),bundle:b.bundle()})},g=function(b,g,l){d.set(h.some(a));var f=q.fromTag("div");J.append(f,b);Yh.exists(f)?c.gordon(f,g,l):e()};La.cata(b.response(),e,g,e,g)})}}function IU(a,b){var c=b.translations,d=function(a,b,c){c(h.some(Z.merge(b,{officeStyles:a,htmlStyles:a})))},e=function(b,e){var f=q.fromTag("div");n.add(f,zc.resolve("styles-dialog-content"));var s=q.fromTag("p"),k=Ld.fromHtml(c("cement.dialog.paste.instructions"));
J.append(s,k);v.append(f,s);var s={text:c("cement.dialog.paste.clean"),tabindex:0,className:zc.resolve("clean-styles"),click:function(){x.destroy();d(!1,b,e)}},k={text:c("cement.dialog.paste.merge"),tabindex:1,className:zc.resolve("merge-styles"),click:function(){x.destroy();d(!0,b,e)}},x=a(!0);x.setTitle(c("cement.dialog.paste.title"));x.setContent(f);x.setButtons([s,k]);x.events.close.bind(function(){e(h.none());x.destroy()});x.show()};return{get:function(a,c){var f=b[a?"officeStyles":"htmlStyles"];
"clean"===f?d(!1,b,c):"merge"===f?d(!0,b,c):e(b,c)},destroy:f.noop}}function JU(a){return{play:function(b,c,d){var e=q.fromTag("div"),g=q.fromTag("iframe");t.setAll(e,{display:"none"});var l=E.bind(g,"load",function(){l.unbind();Vv.write(g,b);var a=g.dom().contentWindow.document;if(void 0===a)throw"sandbox iframe load event did not fire correctly";var h=q.fromDom(a),a=a.body;if(void 0===a)throw"sandbox iframe does not have a body";a=q.fromDom(a);h=c(h,a);B.remove(e);setTimeout(f.curry(d,h),0)});v.append(e,
g);v.append(a,e)}}}function Bx(a,b,c){return function(c,e,g){var l=function(a){c.receive(a)},f=function(a,b,c){c=void 0!==c?c:a.type()===bb.END_ELEMENT_TYPE;return bb.token(b,c,{})},h={emit:l,emitTokens:function(a){k.each(a,l)},receive:function(b){a(h,b,f)},document:window.document};b(h);return h}}function $o(a,b,c){return{pred:a,action:b,label:f.constant(c)}}function Cx(a,b,c){var d=Dx(a+" :: FALLBACK --- ",c);c=function(c,g,l){k.find(b,function(a){return a.pred(g,l)}).fold(f.constant(d),function(b){var c=
b.label();return void 0===c?b.action:Dx(a+" :: "+c,b.action)})(c,g,l)};c.toString=function(){return"Handlers for "+a};return c}function KU(a,b){var c=Cb.state(0,void 0,[],[]),d=function(c){k.each(c.result(),function(c){c=c(b);a.emit(c)})};return{closeAllLists:function(){var a=Ex.closeAllLists(c,0);c=a.state();d(a)},openItem:function(a,b,l){l&&("UL"===l.tag&&LU[a-1]===l.type&&(l={tag:"UL"}),a=Ex.openItem(c,a,b,l),c=a.state(),d(a))},getCurrentListType:function(){return c.type()},getCurrentLevel:function(){return c.level()}}}
function MU(a,b,c,d,e){return function(g,l){var f=ec.asEvent(g).getOrDie("Must pass through event type").nativeEvent(),h=e(),k=l.response();return wa.sync(function(e){var g=a(c);g.events.after.bind(function(a){a=a.container();if(ap.browser.isSafari()&&db.descendant(a,'img[src^="webkit-fake-url"]'))a=ap.deviceType.isWebView()?"webview.imagepaste":"safari.imagepaste",wa.call(e,{response:La.error(a),bundle:pb.nu({})});else{b(a);n.add(a,Fx.binStyle());var c=NU.isWord(ap,a),g=y.children(a),g=d.findClipboardTags(g).isSome();
wa.call(e,{response:k,bundle:pb.nu({isWord:c,isInternal:g,proxyBin:a,backgroundAssets:h})})}});h.convert(f);g.run()})}}function OU(a,b){var c=zx(a),d=xa(h.none()),e=function(a){d.get().each(function(b){wa.call(b,{response:a,bundle:pb.nu({})})})};c.events.insert.bind(function(a){e(La.paste(a.elements(),a.correlated()))});c.events.incomplete.bind(function(a){e(La.incomplete(a.elements(),a.correlated(),a.message()))});return function(g,l){var p=ec.asWord(g).getOrDie("Word input required for rtf data"),
s=function(a){return wa.sync(function(b){var g=function(){wa.call(b,{response:l.response(),bundle:l.bundle()})},p=function(g,l){d.set(h.some(b));var p=q.fromTag("div");J.append(p,g);a.fold(function(){var a=function(){k.each(c,B.remove);var a=y.children(p);e(La.incomplete(a,l,"errors.local.images.disallowed"))},b=function(){var a=y.children(p);e(La.paste(a,l))},c=Yh.find(p);return 0<c.length?a():b()},function(a){c.processRtf(p,l,a,f.noop)})};La.cata(l.response(),g,p,g,p)})};return Bk.match(p.rtf(),
{getFromFlash:function(a){return b(g,l)},disabled:function(){return s(h.none())},fromClipboard:function(b){return s(!0===a.allowLocalImages?h.some(b.rtf()):h.none())}})}}function PU(a,b,c){var d=q.fromTag("div"),e="flashbin-wrapper-"+(QU.os.isOSX()?"cmd":"ctrl");n.add(d,zc.resolve(e));var g;try{g=void 0!==navigator.plugins["Shockwave Flash"]}catch(l){g=!1}a=(g?RU:SU)(d,a,b,c.translations);return{element:f.constant(d),reset:a.reset}}function TU(a,b,c){var d=function(a){return k.forall(b,function(b){return Q.isFunction(a[b])})},
e=!0,g=setInterval(function(){var b=a.dom();Q.isFunction(b.PercentLoaded)&&100===b.PercentLoaded()&&d(b)&&(l(),c())},500),l=function(){e&&(clearInterval(g),e=!1)};return{stop:l}}function UU(a){var b=D.create({response:r(["rtf"]),spin:r([]),cancel:r([]),error:r(["message"]),reset:r([]),hide:r([]),failed:r(["message"])}),c=!1,d=q.fromTag("div");n.add(d,zc.resolve("flashbin-target"));var e=VU.responsive();e.events.crashed.bind(function(){b.trigger.failed("flash.crashed")});e.events.timeout.bind(function(){b.trigger.failed("flash.crashed")});
var g=function(){G.stop();if(!c){c=!0;try{var a=x.dom();W.each(z,function(b,c){var d=a[c];if(void 0===d)throw'Flash object does not have the method "'+c+'"';d.call(a,b)});b.trigger.reset();clearTimeout(u);n.remove(d,zc.resolve("flash-activate"));m();R()}catch(e){console.log("Flash dialog - Error during load: ",e)}}},l=Ke.permanent(g),p=function(){return!ca.inBody(x)},h=function(){return!x.dom().SetVariable},z={setSpinCallback:Ke.permanent(function(){e.start(1E3,10,p,h);b.trigger.spin()}),setPasteCallback:Ke.permanent(function(a){e.stop();
setTimeout(function(){""===a?b.trigger.error("flash.crashed"):b.trigger.response(unescape(a))},0)}),setEscapeCallback:Ke.permanent(b.trigger.cancel),setErrorCallback:Ke.permanent(function(a){e.stop();b.trigger.error(a)}),setStartPasteCallback:Ke.permanent(f.noop)},x=function(){var b=a.replace(/^https?:\/\//,"//"),c='    <param name="allowscriptaccess" value="always">    <param name="wmode" value="opaque">    <param name="FlashVars" value="onLoad='+l+'">';if(bp.browser.isIE()&&10===bp.browser.version.major){var d=
Ma.generate("flash-bin");return q.fromHtml('<object classid="clsid:d27cdb6e-ae6d-11cf-96b8-444553540000" id="'+d+'"><param name="movie" value="'+b+'">'+c+"</object>")}return q.fromHtml('<object type="application/x-shockwave-flash" data="'+b+'">'+c+"</object>")}(),m=function(){t.setAll(x,{width:"2px",height:"2px"})};m();var G=TU(x,W.keys(z),g);v.append(d,x);var R=function(){bp.browser.isFirefox()&&window.getSelection().removeAllRanges();T.focus(x)},u=null,w=function(){n.add(d,zc.resolve("flash-activate"));
t.remove(x,"height");t.remove(x,"width");b.trigger.hide()},y=function(){t.set(d,"display","none");WU.each(function(a){k.each(a,function(a){a.unbind()})})};return{focus:R,element:function(){return d},activate:function(){u=setTimeout(w,3E3);b.trigger.spin();t.set(d,"display","block");R()},deactivate:y,destroy:function(){y();k.each(W.values(z),function(a){Ke.unregister(a)});Ke.unregister(l);G.stop()},events:b.registry}}function XU(a,b){var c=b.translations,d=D.create({response:r(["rtf","hide"]),cancel:r([]),
error:r(["message"]),failed:r(["message"])});return{open:function(){var e=UU(b.swf);e.deactivate();var g=q.fromDom(window),l=E.bind(g,"mouseup",e.focus),f=function(){x()},g=function(){x();d.trigger.cancel()};e.events.cancel.bind(g);e.events.response.bind(function(a){d.trigger.response(a.rtf(),f)});e.events.error.bind(function(a){x();d.trigger.error(a.message())});e.events.failed.bind(function(a){x();d.trigger.failed(a.message())});var h=a();h.setTitle(c("cement.dialog.flash.title"));var k=PU(e,h.reflow,
b);k.reset();h.setContent(k.element());h.events.close.bind(g);h.show();e.activate();var x=function(){l.unbind();e.destroy();h.destroy()}},events:d.registry}}function Gx(a,b,c,d){var e=L.eq(a,c)&&b===d;return{startContainer:f.constant(a),startOffset:f.constant(b),endContainer:f.constant(c),endOffset:f.constant(d),collapsed:f.constant(e)}}function YU(a){var b=q.fromTag("br"),c=h.none();return{cleanup:function(){B.remove(b)},toOn:function(b,e){var g=y.owner(e).dom().defaultView;c.each(function(b){a.set(g,
b)})},toOff:function(d,e){var g=y.owner(e).dom().defaultView;v.append(e,b);c=a.get(g,Gx);a.set(g,Gx(b,0,b,0))}}}function ZU(a,b){var c=q.fromTag("div");m.setAll(c,b);m.setAll(c,{contenteditable:"true","aria-hidden":"true"});t.setAll(c,{position:"fixed",top:"0px",width:"100px",height:"100px",overflow:"hidden",opacity:"0"});ea.add(c,[Hx,Ix]);var d=function(a){return n.has(a,Ix)};return{attach:function(a){B.empty(c);t.set(c,"left",$U(a));v.append(a,c)},focus:function(){I.ancestor(c,"body").each(function(b){a.toOff(b,
c)})},contents:function(){aV.consolidate(c,d);var a=C.immutable("elements","html","container"),b=y.children(c),l=ua.get(c);return a(b,l,c)},container:function(){return c},detach:function(){B.remove(c)}}}function bV(a,b,c){var d=ZU(a,c),e=function(){a.cleanup();var b=d.contents();d.detach();l.trigger.after(b.elements(),b.html(),d.container())},g=Lc.tap(function(){l.trigger.before();d.attach(b);d.focus();vx.run(y.owner(b),g,e)}),l=D.create({before:r([]),after:r(["elements","html","container"])});c=
f.noop;return{instance:f.constant(function(){g.instance()}),destroy:c,events:l.registry}}function cV(a){return function(b){var c=D.create({after:r(["container"])}),d=YU(dV),e=bV(d,b,a);e.events.after.bind(function(a){d.toOn(b,a.container());c.trigger.after(a.container())});return{run:function(){e.instance()()},events:c.registry}}}function eV(){return rx([Af.text()],Af.none())}function fV(a,b){return function(c){var d=D.create({close:r([])}),e=$d(a);e.events.close.bind(function(){d.trigger.close()});
n.add(e.element(),w.resolve("external-dialog"));c&&n.add(e.element(),w.resolve("dialog-vertical-controls"));var g=q.fromTag("div"),l=xa([]),p=function(a){var b=Yb();if(void 0===a.text)throw"dialog button did not specify text";b.content(mc(a.text));O.button(b.element(),a.text);void 0!==a.tabindex&&m.set(b.element(),"tabindex",a.tabindex);void 0!==a.className&&n.add(b.element(),a.className);void 0!==a.click&&b.events.click.bind(a.click);n.add(b.element(),w.resolve("dialog-button"));return b};return{element:e.element,
events:d.registry,setTitle:e.setTitle,setContent:e.setContent,setButtons:function(a){B.empty(g);a=k.map(a,p);J.append(g,k.map(a,function(a){return a.element()}));l.set(a);e.setControls(g)},reflow:f.noop,show:function(){b.hideInlineSelection();e.show();var a=k.map(l.get(),function(a){return ba.button(a.element(),pa.button({execute:ob.click}))}),c=ba.multipleAll(e.element(),a);c.events.exit.bind(function(){d.trigger.close()});setTimeout(function(){c.enter()},0)},destroy:function(){k.each(l.get(),function(a){a.destroy()});
l.set([]);e.destroy()}}}}function gV(a,b,c){var d={"errors.imageimport.unsupported":"errors.images.import.unsupported","errors.imageimport.invalid":"errors.images.import.invalid"};return{baseUrl:c.baseUrl,enableFlashImport:c.enableFlashImport,swf:c.swf,officeStyles:c.officeStyles,htmlStyles:c.htmlStyles,translations:function(b){var c=Array.prototype.slice.call(arguments,1);return a.translate.apply(void 0,[void 0!==d[b]?d[b]:b].concat(c))},allowLocalImages:c.allowLocalImages,intraFlag:b}}function hV(a,
b,c,d){var e=a.filter(),g=a.content(),l=a.undo(),f=a.smartview(),s=a.region(),z=a.internalevents(),x=!0===d.forceText?eV:iV(f,e,d,g),M=h.none(),G=D.create({analytics:r(["message"])}),n=function(a){var b=k.contains(["flash.clipboard.no.rtf","safari.imagepaste"],a.message())?"info":"error";t(a.message(),b)},t=function(b,c){Yd.getOrLog(b,[]).each(function(b){b=xh(b,c);a.ui().displayBanner(b)});u()},u=function(){cc.unblock();g.focus()};e.add(e.history(),Fx.binStyle(),Ca.remove);e.addSelector(e.history(),
"[data-ephox-polish-cement-inserted]",Ca.removeAttr("data-ephox-polish-cement-inserted"));g.events.ready.bind(function(a){var d=cp.get(g,f,a.api().doc()),r=jV.rules(g,s,d),v=BU(g),w=a.api(),B=x(w.body());M=h.some(B);w.events.paste.bind(function(a){w.getSelection().filter(function(a){return k.forall(Zh.ignoreSelectors(),function(b){return!1===db.closest(a.startContainer(),b,g.isRoot)})}).each(function(b){B.isBlocked()||(v.backup(),cc.block());B.paste(a.original().raw())})});B.events.cancel.bind(function(){u();
v.cancel()});var D=Nh.processResults(t);B.events.error.bind(n);B.events.insert.bind(function(a){c.correlated(a.correlated()).map(D).get(function(c){u();l.save();var d=q.fromTag("div");J.append(d,a.elements());e.filterDom(e.input(),d);d=y.children(d);k.each(d,function(a){A.isElement(a)&&m.set(a,"data-ephox-polish-cement-inserted",!0)});v.insert(d,[r.collapsed()],[r.ranged()]);g.body().each(function(a){a=X.descendants(a,"[data-ephox-polish-cement-inserted]");k.each(a,function(a){m.remove(a,"data-ephox-polish-cement-inserted")});
z.input(a)});g.domChanged();G.trigger.analytics("paste_action");b.pasteUpload();b.uploadAssets(c)})})});return{destroy:function(){M.each(function(a){a.destroy()})},events:G.registry}}function kV(a,b,c,d){var e=vU(a,d.copy),g=hV(a,b,c,d.paste);return{destroy:function(){e.destroy();g.destroy()}}}function lV(){var a={latin:[{start:"A",finish:"Z"},{start:"a",finish:"z"},{start:"\u00c0",finish:"\u00ff"}],punctuation:[{start:"!",finish:"/"},{start:":",finish:"@"},{start:"[",finish:"`"},{start:"{",finish:"~"},
{start:"\u00a1",finish:"\u00bf"},{start:"\u2010",finish:"\u2027"},{start:"\u2030",finish:"\u205e"}],currency:[Le("$"),{start:"\u00a2",finish:"\u00a5"},{start:"\u20a0",finish:"\u20bd"},Le("\u5186"),Le("\u5143"),Le("\u5713"),Le("\u5706")],"extended-latin-a":[{start:"\u0100",finish:"\u017f"}],"extended-latin-b":[{start:"\u0180",finish:"\u024f"}],arrows:[{start:"\u2190",finish:"\u21ff"},Le("\u2794"),{start:"\u2798",finish:"\u27af"},{start:"\u27b1",finish:"\u27be"}],mathematical:[{start:"\u2795",finish:"\u2797"},
{start:"\u2200",finish:"\u22ff"}],miscellaneous:[{start:"\u2701",finish:"\u275e"},{start:"\u2761",finish:"\u2793"},Le("\u27b0"),Le("\u27bf")]},b={};W.each(a,function(a,d,e){b[d]=k.bind(a,mV)});return b}function nV(a){var b=D.create({insert:r(["string"]),close:r([])}),c=$d(a);a=lV();a=oV.generateItems(a);var d=dc.input("specialchar","specialchar.selects"),e=Sw(Do.left(),a,w.resolve("specialchars"));n.add(e.body(),w.resolve("specialchar-body"));n.add(c.element(),w.resolve("specialchar-dialog"));k.each(y.children(e.element()),
cc.register);var g=E.bind(c.element(),"click",function(a){a=a.target();I.closest(a,"[data-ephox-polish-special-char]").each(function(a){T.focus(a);var b=m.get(a,"data-ephox-polish-special-char");a=d.input();b=$.get(a)+b;$.set(a,b)})}),l=pV.controls("specialchar");c.setTitle(u.translate("specialchar.dialog"));c.setContent(e.element());c.setControls(l.element());v.after(e.element(),d.element());a=function(){c.hide();$.set(d.input(),"");b.trigger.close()};var f=qV(e),h=rV(e),z=ob.setup(c,l,[f,h,ba.input(d.input(),
pa.input({}))]);e.events.setActive.bind(function(a){f.clickFocus(a.item().element())});c.events.close.bind(function(){z.exit();b.trigger.close()});l.events.cancel.bind(a);c.events.close.bind(a);l.events.insert.bind(function(){b.trigger.insert($.get(d.input()))});return{element:c.element(),events:b.registry,open:function(){c.show();z.enter()},destroy:function(){g.unbind();c.destroy();e.destroy();l.destroy();z.destroy()},close:function(){c.hide();$.set(d.input(),"")}}}function sV(a,b){var c=nV(b),d=
D.create({insert:K(["string"],c.events.insert),close:r([])}),e=function(){d.trigger.close();c.close()};c.events.close.bind(e);return{show:function(){a.toReading();c.open()},close:e,destroy:function(){c.events.close.unbind(e);c.destroy()},events:d.registry}}function tV(a){var b=a.content(),c=a.smartview(),d=function(a){a=q.fromText(a.string());xc.insertAtCursor(b,[a]).each(function(a){a=da.after(a.element());b.setRelativeSelection(a,a);b.focus();b.toEditing()})},e=pc.destroyable(),g=function(){e.clear()};
return{ui:Za.ui({"specialchar.general":{toggle:!1,value:"specialchar",textkey:u.key("specialchar.open"),action:function(){var l=sV(b,c.uiContainer());e.set(l);l.events.close.bind(function(){b.focus();g()});l.events.insert.bind(function(a){d(a);g()});a.content().hideInlineSelection();l.show()},updateGeneral:f.noop,icon:!0,shortcut:!1,hasPopup:!1,hasDialog:!0}}),destroy:g}}function uV(a,b,c,d,e){var g=a.content(),l=a.profile().nativeSpelling(),p=function(a){m.set(a,"spellcheck","false")},s=function(a){m.set(a,
"spellcheck","true")};g.runOrOnLoaded(function(){var a=l.get()?s:p;g.body().each(a)});a=Za.ui({"spelling.general":{toggle:!0,value:"spellcheck",textkey:u.key("cog.spellcheck"),action:function(){var a=!l.get();l.setAndCache(a);a=a?s:p;g.body().each(a)},updateGeneral:function(a){(l.get()?a.select:a.deselect)()},icon:!0,tooltip:Va.get}});return Sn({events:Kc(["analytics"]),init:f.noop,hasDropdown:f.constant(!1),hasAutocorrect:f.constant(!1),check:f.noop,scanView:f.noop,lock:f.apply,situation:kf.noSituation,
handle:f.noop,assign:f.noop,destroy:function(){g.body().each(function(a){m.remove(a,"spellcheck")})},state:f.constant({}),ui:a,lookup:f.constant(h.none()),name:f.constant("spelling-disabled")})}function vV(a){var b={},c=function(a){return b.hasOwnProperty(a)&&void 0!==b[a]?b[a]:{}},d=function(a,d){var e=c(a);d(e);b[a]=e},e=function(a,b){var d=c(a);return b(d)},g=function(a,b,c){d(a,function(a){var d=rg.clean(b);a.hasOwnProperty(d)&&void 0!==a[d]||(a[d]=Jx(h.some(c),!1))})},l=function(a,b){d(a,function(a){var c=
rg.clean(b),d=a.hasOwnProperty(c)?a[c]:void 0,d=void 0!==d?d.suggestions():h.none(),d=Jx(d,!0);a[c]=d})};W.each(void 0!==a?a:{},function(a,b){W.each(a,function(a,c){!0===a.ignore&&l(b,c);void 0!==a.suggestions&&g(b,c,a.suggestions)})});return{add:g,get:function(a,b){return e(a,function(a){var c=rg.clean(b);return a.hasOwnProperty(c)?h.from(a[c]):h.none()})},ignore:l,suggestions:function(a,b){return e(a,function(a){var c=rg.clean(b);return(a.hasOwnProperty(c)?h.from(a[c]):h.none()).bind(function(a){return a.suggestions()})})},
state:function(){return W.map(b,function(a,b){return W.map(a,function(a,b){return{ignore:a.ignore(),suggestions:a.suggestions().getOr([])}})})},destroy:function(){b={}}}}function wV(a,b,c){var d=D.create({change:r(["language"])});a=c?xV(a,d):yV(a,b,d);return{ui:Za.ui(a),hasDropdown:f.constant(c),events:d.registry}}function zV(){var a=[],b=!1,c=function(){b=!0;h.from(a.shift()).fold(function(){b=!1},function(a){a.f()(a.area(),c)})};return{enqueue:function(d,e){a.push(AV(d,e));b||c()},destroy:function(){a=
[]}}}function BV(a,b){var c=xa(a),d=zV(),e=function(a,d,e,f){e=Ck.cata(e,function(a){return ca.inBody(a)?Dk.single(a,c.get(),b):Dk.empty()},function(a,d,e,g){return ca.inBody(a)&&ca.inBody(e)?Dk.range(a,d,e,g,c.get(),b):Dk.empty()});d(a,e,c.get(),f)};return{run:function(a,b,c){e(a,b,c,f.identity)},setLang:c.set,schedule:function(a,b,c,f){d.enqueue(c,function(c,d){void 0!==f&&f()?d():e(a,b,c,d)})},destroy:function(){d.destroy()}}}function CV(a,b){var c=function(b){return k.map(b,function(b){var c=
Kx.getInCache(a,b.lang(),b.words());return{zone:f.constant(b),words:f.constant(c),lang:b.lang}})},d=function(a,b,c){k.each(b,function(b){DV.highlight(a,b.zone(),b.words(),c)})};return{local:function(a,b,l,f){b=b.zones();b=c(b);d(a,b,l);f()},remote:function(c,g,l,f){g=g.zones();EV.scan(a,b,g).get(function(a){d(c,a,l);f()})},destroy:f.noop}}function FV(a,b,c){var d=Lx.initCaches(c),e=Zj.post("ephox.spelling.service.many",GV.many(),a,b);return{checkMany:function(a,b,c){c=Gh.now();return Lx.execute(e,
d,a,b,c)},dumpCache:function(){return W.map(d,function(a){return a.dump()})}}}function HV(a,b,c,d,e){var g=IV.spelling(b),l=FV(g+"correction",a.newHeaders(),e),p=D.create({failed:r(["resource"])}),h=sd.get(g+"autocorrect?language="+c,td.json(),jd.xhr(),a.newHeaders()),k=Xd.nu(function(a){h.get(function(b){b.fold(function(){a(b)},function(b){l.checkMany(c,["startup"],!0).get(a)})})});k.get(function(a){a.fold(function(a){console.error("Unable to communicate with the spelling service:",Lo.consoleMessage(a));
p.trigger.failed(b)},f.noop)});return{correction:function(a,b,e,g){k.get(function(f){f.fold(g,function(){l.checkMany(d?b:c,a.words).get(function(a){a.fold(function(a){console.error("Error response from the spelling service:",Lo.consoleMessage(a));g(a)},function(a){e(a)})})})})},autocorrect:f.constant(h),events:p.registry,state:function(){return l.dumpCache()}}}function JV(a){var b=a.content(),c=a.profile(),d=HV(a.communication(),a.url(),a.language(),a.multilingual(),a.fromServiceState()),e=a.autocorrectOn()?
Mx.active(d):Mx.inactive(),g=D.create({failed:r(["resource"])}),l=function(a){g.trigger.failed(a.resource())};d.events.failed.bind(l);var f=BV(a.language(),a.viewable().viewport()),h=CV(a.cache(),d),k=function(a){b.body().each(function(b){dk.filterDom(b,[vo("."+a,Ca.unwrap)])})},x=function(){return!ie.isOn(c.spelling().get())},m=function(){k("ephox-cram-annotation-wrap")};return{run:function(a,b){var d=c.spelling().get();ie.isOn(d)&&(f.setLang(d),f.run(a,h.local,b),f.schedule(a,h.remote,b,x))},refresh:function(){var a=
c.spelling().get();ie.isOn(a)||m()},clear:m,lookup:e.lookup,destroy:function(){d.events.failed.unbind(l);f.destroy();h.destroy()},state:d.state,events:g.registry}}function KV(){var a=D.create({incorrect:r(["substitution"])}),b=h.none(),c={};c[vd.spelling()]=function(c){b.each(function(b){b=dp.substitute(b,m.get(c,vd.value()));a.trigger.incorrect(b)})};return{assign:function(a){b=a},run:function(a){var b=m.get(a,vd.type()),b=c[b];void 0!==b&&b(a)},events:a.registry}}function LV(a,b,c){var d=KV();d.events.incorrect.bind(function(c){b.save();
a.focus();a.domChanged();c.substitution().each(function(b){Nx.selectEnd(a,b)})});var e=f.curry(function(a,b,c,d){return a.marker(d).bind(a.detail).bind(function(a){return c(a).map(function(a){return k.map(a,function(a){var c={};c[vd.type()]=b;c[vd.value()]=a;return MV(a,a,c)})})})},dp,vd.spelling(),function(a){return c.suggestions(a.lang(),a.word())});return{assign:d.assign,handle:function(a){d.run(a)},situation:function(a){a=e(a).getOr([]);return NV.generate(a,OV)},destroy:f.noop}}function PV(a,
b){var c=D.create({lookup:r(["element"])}),d=function(b){a.getSelection().each(b)},e=function(){d(function(a){c.trigger.lookup(a.startContainer())})};a.events.keyup.bind(function(a){hd.isSpace(a)&&e()});a.events.nodeChanged.bind(function(a){a.prev().each(c.trigger.lookup)});return{events:c.registry,destroy:f.noop}}function QV(a,b,c,d,e,g,l,p,h){var k=LV(b,e,p),x=PV(b,c),m=function(a){b.getSelection().each(function(b){var c=Ka.toLeaf(b.endContainer(),b.endOffset()),e=Ka.toLeaf(b.startContainer(),b.startOffset()),
g;(g=b.collapsed())||(g=!Ox.isIE())||(g=wc.after(b.endContainer(),b.endOffset(),b.startContainer(),b.startOffset()));b=g&&!Ox.isFirefox()?Zb(e.element(),e.offset(),c.element(),c.offset()):b;return(g?d.lightweightWith:f.apply)(a,b)})},G=Lc.tap(function(a){a=a.element();"body"!==A.name(a)&&(a=Ck.single(a),n(a))});x.events.lookup.bind(function(a){G.instance(a)});var n=function(a){h.run(m,a)};return{destroy:function(){k.destroy();x.destroy()},scan:n,situation:k.situation,lock:function(a){var b=G.control.isBlocked();
G.control.block();a();b||G.control.unblock()},assign:k.assign,handle:k.handle}}function RV(a,b,c,d,e){e=b.language.getOr(e);var g=a.communication(),l=a.profile(),p=a.filter(),s=a.content(),z=a.operations(),x=a.undo(),M=a.smartview(),G=a.shortcuts(),n=a.context(),q=a.viewablearea();ep.configure(p);a.profile().spelling().set(e);var t=vV(b.words),u=JV(SV({communication:g,profile:l,content:s,undo:x,viewable:q,cache:t,url:c.url,autocorrectOn:c.autocorrect,language:d,fromServiceState:b.service,multilingual:c.multilingual})),
v=h.none();b=D.create({analytics:r(["message"])});u.events.failed.bind(function(b){b=Yd.get("error.code.spelling.not.found",[b.resource()]);b=xh(b);a.ui().displayBanner(b)});s.events.ready.bind(function(a){s.body().each(function(a){m.set(a,"spellcheck",!1)});a=a.api().doc();a=QV(a,s,n,z,x,G,M,t,u);u.refresh();v=h.some(a)});d=wV(a,d,c.menu);d.events.change.bind(function(a){(ie.isOn(a.language())?A:u.clear)();s.uiChanged();s.domChanged()});var w=function(a){k.each(a,function(a){a=Ck.single(a);B(a)})},
A=c.scanView?function(){var a=q.sections();w(a)}:u.clear;c.scanView&&q.events.onChange.bind(A);var B=function(a){v.each(function(b){b.scan(a)})};return Sn({events:b.registry,destroy:function(){s.body().each(function(a){m.remove(a,"spellcheck")});v.each(function(a){a.destroy()});t.destroy();u.destroy()},state:function(){return{words:t.state(),service:u.state(),language:h.some(a.profile().spelling().get())}},init:f.noop,hasDropdown:d.hasDropdown,hasAutocorrect:f.constant(c.autocorrect),ui:d.ui,check:function(a,
b,c,d){a=ep.isWrap(a)?Ka.toLeaf(a,b):S.point(a,b);c=ep.isWrap(c)?Ka.toLeaf(c,d):S.point(c,d);c=Ck.range(a.element(),a.offset(),c.element(),c.offset());B(c)},scanView:A,situation:function(a){var b={primary:f.constant([]),secondary:f.constant([]),submenus:f.constant({})};return v.fold(f.constant(b),function(b){return b.situation(a)})},lock:function(a){return v.fold(function(){return a()},function(b){return b.lock(a)})},assign:function(a){v.each(function(b){b.assign(a.bind(y.firstChild).or(a))})},handle:function(a){v.each(function(b){b.handle(a)})},
lookup:u.lookup,name:f.constant("spelling")})}function TV(a,b,c,d,e){return(!0===c.service?RV:uV)(a,b,c,d,e)}function Px(a){var b=dd(a);n.add(b.element(),w.resolve("choice-button"));var c=P.span();m.set(b.element(),"title",u.translate("table."+a));m.set(b.element(),"tabindex","-1");O.button(b.element(),u.translate("table."+a),!1);var d=Oa.describe(b.element(),u.translate("aria.table.headerdescription"));v.append(b.element(),d);b.events.click.bind(function(){T.focus(b.element());ga.pressed(b)});ea.add(c,
[w.resolve(a),"ephox-pastry-icon-content","ephox-polish-icon"]);b.content({element:f.constant(c)});return b}function UV(a,b){var c=!1,d=function(a,b,c){var d=c.full();d.row()===b.rows()&&d.column()===b.columns()||a.setSize(d.row(),d.column());a=a.setSelection(c.selection().row(),c.selection().column());T.focus(a)};return{on:function(){c=!0},off:function(){c=!1},mousemove:function(e,g,l,f){if(c){var h;h=ra.get(e.element());var k=ha.get(e.element());h=ya.dimensions(h,k);k=Ja.absolute(e.element());k=
ya.coords(k.left(),k.top());l=ya.coords(l,f);l=a.pickerCell(k,h,g,l);l=Qx.resize(l,b);d(e,g,l)}},manual:function(a,g,l,f){c&&(l=Qx.grow(g,l,f,b),d(a,g,l))}}}function VV(a,b,c){var d=D.create({select:r(["rows","cols","rowHeaders","columnHeaders"])}),e=q.fromTag("table");O.presentation(e);O.hidden(e,!0);n.add(e,Bf.table());var g=q.fromTag("tbody");v.append(e,g);var l=0,p=0,h=function(a,b){l=b;p=a;z()},z=function(){B.empty(g);var a=c.ids();kd.repeat(p,function(b){var c=q.fromTag("tr");n.add(c,Bf.row());
var d=kd.repeat(l,function(c){var d=q.fromTag("td");n.add(d,Ac.resolve("cell-"+c+"-"+b));n.add(d,Bf.cell());var e=q.fromTag("button");m.set(e,"type","button");m.set(e,"aria-labelledby",a[b][c]);n.add(e,Bf.button());v.append(d,e);return d});J.append(c,d);v.append(g,c)})},x=function(a,b){var c=Me.cells(e);k.each(c,function(a){n.remove(a,Ac.resolve("picker-selected"))});c=Me.rows(e).slice(0,a);k.each(c,function(a,c){var d=Me.cells(a).slice(0,b);k.each(d,function(a,b){var d=Me.grid(e,"data-picker-header-row",
"data-picker-header-col"),d=c<d.rows()||b<d.columns()?[Ac.resolve("picker-selected"),Ac.resolve("picker-header")]:[Ac.resolve("picker-selected")];ea.add(a,d)})});m.set(e,"data-picker-col",b-1);m.set(e,"data-picker-row",a-1);c=Me.cells(c[c.length-1]).slice(0,b);return Me.button(c[c.length-1])},M=function(){var a=parseInt(m.get(e,"data-picker-col"),10)+1,b=parseInt(m.get(e,"data-picker-row"),10)+1;return ya.grid(b,a)},G={element:f.constant(e),setSelection:x,setSize:h},R=UV(a,b),t=E.bind(e,"mousemove",
function(a){R.mousemove(G,ya.grid(p,l),a.raw().pageX,a.raw().pageY)}),u=function(a,b){R.manual(G,M(),a,b)},w=hk.realClick.bind(e,function(a){y();a.raw().preventDefault()}),y=function(){var a=Me.grid(e,"data-picker-row","data-picker-col"),b=Me.grid(e,"data-picker-header-row","data-picker-header-col");d.trigger.select(a.rows()+1,a.columns()+1,b.rows(),b.columns())};return{element:function(){return e},destroy:function(){w.unbind();t.unbind();B.remove(e)},setSize:h,setHeaders:function(a,b){m.set(e,"data-picker-header-row",
a);m.set(e,"data-picker-header-col",b)},setSelection:x,on:R.on,off:R.off,reset:function(){h(b.minRows,b.minCols);var a=x(1,1);T.focus(a)},refresh:function(){var a=M();z();return x(a.rows(),a.columns())},events:d.registry,sendLeft:f.curry(u,a.isRtl()?1:-1,0),sendRight:f.curry(u,a.isRtl()?-1:1,0),sendUp:f.curry(u,0,-1),sendDown:f.curry(u,0,1),sendExecute:y}}function WV(a,b){var c=xf.createHelp(b.maxRows,b.maxCols,{row:function(a){return u.translate("table.picker.rows",a)},col:function(a){return u.translate("table.picker.cols",
a)}}),d=VV(a,b,c);O.label(d.element(),u.translate("table.picker.label"));var e=Oa.describe(d.element(),u.translate("table.picker.describepicker")),g=q.fromTag("div");m.set(g,"tabIndex","-1");O.group(g);ea.add(g,[w.resolve("insert-table"),w.resolve("toolbar-menu")]);var l=q.fromTag("div");n.add(l,w.resolve("table-controls"));O.toolbarGroup(l,u.translate("table.picker.header"));var p=Px("row-header"),s=Px("column-header");J.append(l,[p.element(),s.element()]);J.append(g,[l,d.element(),e,c.help()]);
var k=function(){d.setHeaders(p.selected()?1:0,s.selected()?1:0);var a=T.active(),b=d.refresh();a.each(function(a){T.hasFocus(a)||T.focus(b)})},c=function(a,b){return function(){b();return h.some(!0)}},c=ba.single(d.element(),[U.basic(N.LEFT()[0],c("left",d.sendLeft)),U.basic(N.RIGHT()[0],c("right",d.sendRight)),U.basic(N.UP()[0],c("up",d.sendUp)),U.basic(N.DOWN()[0],c("down",d.sendDown)),U.rule(U.inSet(N.SPACE().concat(N.ENTER())),c("execute",d.sendExecute))],h.none());c.events.enter.bind(function(){T.focus(d.element())});
var x=ba.flow(l,{item:f.constant(".ephox-pastry-statebutton")},pa.flow({trigger:function(a){return I.descendant(a,".ephox-pastry-button").map(function(a){a.dom().click();return a})}})),M=ba.multiple(g,[c,x]);p.events.click.bind(function(){x.clickFocus(p.element());k()});s.events.click.bind(function(){x.clickFocus(s.element());k()});l=D.create({select:K(["rows","cols","rowHeaders","columnHeaders"],d.events.select),exit:K([],M.events.exit)});return{element:function(){return g},destroy:function(){M.destroy();
p.destroy();s.destroy();d.destroy()},setSize:d.setSize,setSelection:d.setSelection,on:function(){d.on();M.enter()},off:function(){d.off();M.isFocused()&&M.exit()},reset:function(){d.setHeaders(0,0);p.deselect();ga.release(p.element());s.deselect();ga.release(s.element());d.reset()},events:l.registry}}function XV(a,b){var c=D.create({enabled:r(["enabled"]),select:r(["rows","cols","rowHeaders","columnHeaders"]),insert:r(["table"]),done:r([]),abort:r([])}),d=Z.merge({minCols:7,maxCols:10,minRows:4,maxRows:10},
b),e=WV(a,d);e.events.select.bind(function(a){Y.detect().browser.isIE()?(c.trigger.select(a.rows(),a.cols(),a.rowHeaders(),a.columnHeaders()),c.trigger.done(),g()):(g(),c.trigger.done(),c.trigger.select(a.rows(),a.cols(),a.rowHeaders(),a.columnHeaders()))});e.events.exit.bind(function(){g();c.trigger.abort()});var g=function(){e.off()};return{element:e.element,open:function(){e.reset();e.on()},close:g,destroy:function(){e.destroy()},events:c.registry}}function YV(){var a=q.fromTag("fieldset"),b=q.fromHtml("<legend>"+
u.translate("table.border")+"</legend>");v.append(a,b);var c=Ma.generate(""),b=function(a){var b=q.fromTag("input");m.setAll(b,{type:"radio",id:"tableborder"+a+c,value:a,name:c});return b},d=b("1"),e=b("0");J.append(a,[d,q.fromHtml('<label for="tableborder1'+c+'">'+u.translate("border.on")+"</label>"),e,q.fromHtml('<label for="tableborder0'+c+'">'+u.translate("border.off")+"</label>")]);var g=ob.radio(a,'input[type="radio"]',"input:checked");return{element:function(){return a},get:function(){return $h.find(a).map(function(a){return $.get(a)})},
select:function(a){$h.set(e,!1);$h.set(d,!1);a.each(function(a){"0"===a?$h.set(e,!0):"1"===a&&$h.set(d,!0)});g.refresh()},keylayout:f.constant(g),destroy:function(){B.remove(a)}}}function ZV(){var a=P.div();n.add(a,w.resolve("table-size-controls"));var b=dc.input("table-width","table.width"),c=dc.input("table-height","table.height");k.map([b,c],function(a){m.set(a.input(),"placeholder","Auto")});J.append(a,[b.element(),c.element()]);var d=[ba.input(b.input(),pa.input({})),ba.input(c.input(),pa.input({}))],
e=function(a){var b=a.target();Wb.validateField(b,"width",h.some("px")).fold(function(){Wb.highlight(b)},function(a){Wb.dehighlight(b)})},g=[E.bind(b.input(),"input",e),E.bind(c.input(),"input",e)];return{element:function(){return a},get:function(){return Wb.validate([Wb.rule(b.input(),"width",h.some("px")),Wb.rule(c.input(),"height",h.some("px"))])},set:function(a){a.width().bind(f.curry($.set,b.input()));a.height().bind(f.curry($.set,c.input()))},keylayouts:f.constant(d),highlight:Wb.highlight,
dehighlight:f.curry(Wb.clearHighlights,a),destroy:function(){B.remove(a);k.each(g,function(a){a.unbind()})}}}function $V(a,b){var c=D.create({ok:r(["properties"]),close:r([])}),d=$d(b);d.setTitle(u.translate("table.dialog"));n.add(d.element(),w.resolve("dialog-narrow"));var e=P.div(),g=Uw("table.float"),l=dc.input("tablesummary","table.summary"),p=dc.input("tablecaption","table.caption"),s=ZV(),k=YV();J.append(e,[p.element(),l.element(),k.element(),s.element(),g.element()]);var x=Rc.okCancel("table");
x.events.ok.bind(function(){t()});x.events.cancel.bind(function(){d.hide();c.trigger.close()});d.events.close.bind(function(){d.hide();c.trigger.close()});d.setContent(e);d.setControls(x.element());var m=ob.setup(d,x,[ba.input(p.input(),pa.input({})),ba.input(l.input(),pa.input({})),k.keylayout()].concat(s.keylayouts()).concat([g.keylayout()])),G=function(){return s.get().map(function(a){a={width:f.constant(h.some(a.width())),height:f.constant(h.some(a.height()))};return fp.properties({floatval:g.get(),
caption:q(p.input()),summary:q(l.input()),border:k.get(),dimensions:a})})},q=function(a){return $.get(a).trim()},t=function(){G().fold(function(a){s.highlight(a)},function(a){c.trigger.ok(a)})};return{element:d.element,events:c.registry,open:function(){d.show();m.enter()},represent:function(b){b=fp.divine(a,b);g.select(b.floatval());void 0!==b.summary()&&$.set(l.input(),b.summary());void 0!==b.caption()&&$.set(p.input(),b.caption());s.set(b.dimensions());k.select(b.border())},execute:t,destroy:function(){g.destroy();
s.destroy();k.destroy();x.destroy();d.destroy();m.destroy()},hide:function(){m.exit();d.hide()}}}function aW(a,b,c,d,e,g,l,p){var s=h.none(),z={"tablemenu-delete-table":Mb.erase,"delete-row":Mb.execute(b,Db.eraseRows,f.noop,p),"delete-column":Mb.execute(b,Db.eraseColumns,f.noop,p),"make-header-column":Mb.execute(b,Db.makeColumnHeader,f.noop,p),"make-header-row":Mb.execute(b,Db.makeRowHeader,f.noop,p),"unmake-header-column":Mb.execute(b,Db.unmakeColumnHeader,f.noop,p),"unmake-header-row":Mb.execute(b,
Db.unmakeRowHeader,f.noop,p),"insert-row-before":Mb.execute(b,Db.insertRowBefore,f.noop,p),"insert-row-after":Mb.execute(b,Db.insertRowAfter,f.noop,p),"insert-column-before":Mb.execute(b,Db.insertColumnBefore,gp.halve,p),"insert-column-after":Mb.execute(b,Db.insertColumnAfter,gp.halve,p),"tablemenu-table-properties":function(b,d,f){b=$V(a,l);var p=Ww.generate(e,b,["properties"]);p.events.ok.bind(function(a){c.activate();s.each(function(b){Xa.table(b.element(),c.isRoot).each(function(b){Tc.runTransaction(c,
g,function(){fp.apply(b,a.properties())})})});p.destroy()});p.events.close.bind(function(a){p.destroy();c.activate();c.focus()});c.deactivate();p.represent(d);p.open();return h.none()},"cell-merge":Mb.execute(b,Db.mergeCells,f.noop,p),"cell-unmerge":Mb.execute(b,Db.unmergeCells,f.noop,p),"cell-split-cols":Mb.execute(b,Db.splitCellIntoColumns,gp.halve,p),"cell-split-rows":Mb.execute(b,Db.splitCellIntoRows,f.noop,p)},x=C.immutable("value","text","attrs"),M=qw.byClass(od);return{handle:function(a){c.doc().each(function(b){s.each(function(b){var d=
b.element();Xa.table(d,c.isRoot).each(function(d){var e=m.get(a,"data-ephox-gopher-item-value"),l=z[e];void 0!==l&&Tc.runTransaction(c,g,function(){l(c,d,b).each(function(a){c.setSelection(a.startContainer(),a.startOffset(),a.endContainer(),a.endOffset());M.clear(d)})})})})})},assign:function(a){s=a.bind(function(a){return Xa.cell(a,c.isRoot).bind(function(a){return I.ancestor(a,"table").map(function(b){return Ek.forMenu(d,b,a)})}).orThunk(function(){return Xa.notCell(a,c.isRoot).map(function(a){return Ek.notCell(a)})})})},
situation:function(a){a=s.map(function(a){var b=a.element(),b=Xa.cell(b,c.isRoot).isSome();return k.flatten([b?[x("tablemenu-row",u.translate("table.context.row.menu"),{})]:[],b?[x("tablemenu-column",u.translate("table.context.column.menu"),{})]:[],[x("tablemenu-table",u.translate("table.context.table.menu"),{})],a.mergable().isSome()?[x("cell-merge",u.translate("table.context.cell.merge"),{})]:[],a.unmergable().isSome()?[x("cell-unmerge",u.translate("table.context.cell.unmerge"),{})]:[],b&&1===a.selection().length&&
a.mergable().isNone()&&a.unmergable().isNone()?[x("cell-split-cols",u.translate("table.context.cell.split-cols"),{}),x("cell-split-rows",u.translate("table.context.cell.split-rows"),{})]:[]])}).getOr([]);var b=s.map(function(a){var b=a.element();a=function(a,c,d){var e=a+"-menu",g="th"===A.name(b)?"unmake":"make",l="make"===g?"header":"normal";c=[x("insert-"+a+"-before",u.translate("table.context."+a+"."+c),{}),x("insert-"+a+"-after",u.translate("table.context."+a+"."+d),{}),x("delete-"+a,u.translate("table.context.common.delete"),
{}),x(g+"-header-"+a,u.translate("table.context.common."+l),{})];return{textkey:f.constant(u.key("table.context."+a+".title")),value:f.constant(e),items:f.constant(c)}};var c={textkey:f.constant(u.key("table.context.table.title")),value:f.constant("table-menu"),items:f.constant([x("tablemenu-table-properties",u.translate("table.context.table.properties"),{}),x("tablemenu-delete-table",u.translate("table.context.common.delete"),{})])};return k.flatten([[a("row","insertabove","insertbelow")],[a("column",
"insertleft","insertright")],[c]])}).getOr([]);return{primary:f.constant(a),secondary:f.constant(b),submenus:f.constant({"tablemenu-row":"row-menu","tablemenu-column":"column-menu","tablemenu-table":"table-menu"})}},destroy:f.noop}}function bW(){var a=D.create({drag:r(["xDelta","yDelta"])});return{mutate:function(b,c){a.trigger.drag(b,c)},events:a.registry}}function cW(){var a=D.create({drag:r(["xDelta","yDelta","target"])}),b=h.none(),c=bW();c.events.drag.bind(function(c){b.each(function(b){a.trigger.drag(c.xDelta(),
c.yDelta(),b)})});return{assign:function(a){b=h.some(a)},get:function(){return b},mutate:c.mutate,events:a.registry}}function dW(a,b,c){var d=cW(),e=Dh.transform(d,{}),g=h.none(),l=function(a,b){return h.from(m.get(a,b))};d.events.drag.bind(function(a){l(a.target(),"data-row").each(function(b){b=Uc.getInt(a.target(),"top");t.set(a.target(),"top",b+a.yDelta()+"px")});l(a.target(),"data-column").each(function(b){b=Uc.getInt(a.target(),"left");t.set(a.target(),"left",b+a.xDelta()+"px")})});var p=function(a,
b){var c=Uc.getInt(a,b),d=parseInt(m.get(a,"data-initial-"+b),10);return c-d};e.events.stop.bind(function(){d.get().each(function(d){g.each(function(e){l(d,"data-row").each(function(a){var b=p(d,"top");m.remove(d,"data-initial-top");G.trigger.adjustHeight(e,b,parseInt(a,10))});l(d,"data-column").each(function(a){var b=p(d,"left");m.remove(d,"data-initial-left");G.trigger.adjustWidth(e,b,parseInt(a,10))});wd.refresh(a,e,c,b)})})});var s=function(b,c){G.trigger.startAdjust();d.assign(b);m.set(b,"data-initial-"+
c,parseInt(t.get(b,c),10));n.add(b,eW);t.set(b,"opacity","0.2");e.go(a.parent())},k=E.bind(a.parent(),"mousedown",function(a){wd.isRowBar(a.target())&&s(a.target(),"top");wd.isColBar(a.target())&&s(a.target(),"left")}),x=function(b){return L.eq(b,a.view())},M=E.bind(a.view(),"mouseover",function(d){"table"===A.name(d.target())||db.closest(d.target(),"table",x)?(g="table"===A.name(d.target())?h.some(d.target()):I.ancestor(d.target(),"table",x),g.each(function(d){wd.refresh(a,d,c,b)})):ca.inBody(d.target())&&
wd.destroy(a)}),G=D.create({adjustHeight:r(["table","delta","row"]),adjustWidth:r(["table","delta","column"]),startAdjust:r([])});return{destroy:function(){k.unbind();M.unbind();e.destroy();wd.destroy(a)},refresh:function(d){wd.refresh(a,d,c,b)},on:e.on,off:e.off,hideBars:f.curry(wd.hide,a),showBars:f.curry(wd.show,a),events:G.registry}}function fW(a,b){var c=ai.height,d=dW(a,b,c),e=D.create({beforeResize:r(["table"]),afterResize:r(["table"]),startDrag:r([])});d.events.adjustHeight.bind(function(a){e.trigger.beforeResize(a.table());
var b=c.delta(a.delta(),a.table());hp.adjustHeight(a.table(),b,a.row(),c);e.trigger.afterResize(a.table())});d.events.startAdjust.bind(function(a){e.trigger.startDrag()});d.events.adjustWidth.bind(function(a){e.trigger.beforeResize(a.table());var c=b.delta(a.delta(),a.table());hp.adjustWidth(a.table(),c,a.column(),b);e.trigger.afterResize(a.table())});return{on:d.on,off:d.off,hideBars:d.hideBars,showBars:d.showBars,destroy:d.destroy,events:e.registry}}function gW(a,b){var c=a.content(),d=a.keyboard(),
e=a.undo(),g=a.smartview(),l=function(){return t.getOr(ip.only(c.element()))},p=aW(a.filter(),a.region(),c,a.selections(),d,e,g.uiContainer(),l),s=function(a,b,d){e.save();k.each(b,function(b){a(b,d)});e.save();c.focus()},z=f.curry(s,Rx.setBackgroundColor),s=f.curry(s,Rx.setBorderColor),z=Za.ui({"table.widget":f.curry(hW.widget,a,b),"cell.palette":f.constant({items:[{type:"widget",build:f.curry(Sx.widget,a,b,{action:z,shortname:"background",name:"cellbackgroundcolor",textkey:"table.cell.color.background",
menuTextkey:"table.cell.color.background"})},{type:"widget",build:f.curry(Sx.widget,a,b,{action:s,shortname:"border",name:"cellbordercolor",textkey:"table.cell.color.border",menuTextkey:"table.cell.color.border"})},{type:"widget",build:f.curry(iW.widget,a)},{type:"dropdown",build:f.curry(jW.widget,a)}],updatePalette:function(b){var d=je.selectedCells(a.selections(),c.isRoot),e=f.curry(b.show,h.some(u.translate("table.context.palette.show")));b=f.curry(b.hide,h.some(u.translate("table.context.palette.hide")));
(0<d.length?e:b)()&&a.ui().refresh()}})},f.identity),x=function(b){var d=b.stopper();Pj.context(c).bind(function(e){Pj.cata(e,function(e){Xa.cell(e.startContainer(),c.isRoot).each(function(e){(b.shift()?Tx.backward:Tx.forward)(a.region(),c,e,l).fold(d,function(a){d();c.setSelection(a.startContainer(),a.startOffset(),a.endContainer(),a.endOffset())})})},f.noop)})},m=function(a){Ux.upOrLeft(c)},G=function(a){Ux.right(c)},n=d.editor();n.on();n.events.tab.bind(x);n.events.left.bind(m);n.events.up.bind(m);
n.events.right.bind(G);var r=c.cursor(),q=h.none(),t=h.none();c.events.ready.bind(function(b){b=cp.get(c,g,b.api().doc());t=h.some(b);var d=jv(a.region().directionAt),l=fW(b,d);l.events.beforeResize.bind(e.save);l.events.afterResize.bind(function(){c.focus();e.save();c.domChanged();r.restore()});l.on();l.events.startDrag.bind(r.save);q=h.some(l);b=a.selections();b.events.beforeScan.bind(function(){l.hideBars()});b.events.afterScan.bind(function(){l.showBars()})});return{ui:z,destroy:function(){p.destroy();
q.each(function(a){a.destroy()});n.off();n.events.tab.unbind(x);n.events.left.unbind(m);n.events.up.unbind(m);n.events.right.unbind(G);n.destroy()},handle:p.handle,assign:p.assign,situation:p.situation,name:f.constant("table")}}function kW(){var a=D.create({pasteUpload:r([]),uploadAssets:r(["assets"])});return{destroy:f.noop,events:a.registry,pasteUpload:a.trigger.pasteUpload,uploadAssets:a.trigger.uploadAssets}}function lW(a,b){var c=a().uiContainer(),d=D.create({close:r([])}),e=$d(c);e.setTitle(u.translate("wordcount.dialog"));
ea.add(e.element(),[w.resolve("dialog-wordcount"),w.resolve("dialog-narrow")]);var c=b().body().getOrDie(),g=sg.toText(c,f.constant(!1)),l=nb.get(c),c=b().getSelectedText().getOr(""),g=Vx.count(g),l=l.length,c=Vx.count(c),p=q.fromHtml(aa.supplant('<table class="ephox-polish-tabular ephox-polish-wordcount-table" tabindex="-1">    <thead>        <tr>            <th scope="col"> ${headerCounts}&nbsp;</th>            <th scope="col"> ${headerDocument}&nbsp;</th>            <th scope="col"> ${headerSelection}&nbsp;</th>        </tr>    </thead>    <tbody>        <tr>            <td>${wordCountLabel}&nbsp;</td>            <td class="ephox-polish-wordcount-document-words">${documentCountWords}&nbsp;</td>            <td class="ephox-polish-wordcount-selection-words">${selectionCountWords}&nbsp;</td>        </tr>        <tr>            <td>${wordCountCharsNoSpacesLabel}&nbsp;</td>            <td class="ephox-polish-wordcount-document-charsnospaces">${documentCharactersNoSpaces}&nbsp;</td>            <td class="ephox-polish-wordcount-selection-charsnospaces">${selectionCharactersNoSpaces}&nbsp;</td>        </tr>        <tr>            <td>${wordcountCharsLabel}&nbsp;</td>            <td class="ephox-polish-wordcount-document-chars">${documentCountCharsWithSpaces}&nbsp;</td>            <td class="ephox-polish-wordcount-selection-chars">${selectionCountCharsWithSpaces}&nbsp;</td>        </tr>    </tbody></table>',
{headerCounts:u.translate("wordcount.counts"),headerDocument:u.translate("wordcount.document"),headerSelection:u.translate("wordcount.selection"),wordCountLabel:u.translate("wordcount.words"),wordCountCharsNoSpacesLabel:u.translate("wordcount.charactersnospaces"),wordcountCharsLabel:u.translate("wordcount.characters"),documentCountWords:g.words(),selectionCountWords:c.words(),documentCharactersNoSpaces:g.characters().withoutSpaces(),selectionCharactersNoSpaces:c.characters().withoutSpaces(),documentCountCharsWithSpaces:l,
selectionCountCharsWithSpaces:c.characters().withSpaces()}));e.setContent(p);var h=ba.multiple(e.element(),[]),c=function(){k();d.trigger.close()},k=function(){e.hide()};e.events.close.bind(c);h.events.exit.bind(c);return{element:e.element,events:d.registry,open:function(){e.show();h.enter();T.focus(p)},destroy:function(){h.destroy();e.destroy()},hide:k}}function mW(a,b){var c=lW(a,b),d=D.create({close:r([])});c.events.close.bind(function(){d.trigger.close();c.destroy()});return{show:function(){c.open()},
events:d.registry}}function nW(a){var b=a.content,c=a.smartview;return{ui:Za.ui({"wordcount.general":{toggle:!1,value:"wordcount",textkey:u.key("wordcount.open"),action:function(){var d=mW(c,b);d.events.close.bind(function(){a.ui().tabstrip.focused()||b().focus()});a.content().hideInlineSelection();d.show()},updateGeneral:f.noop,icon:!0,shortcut:!1,hasPopup:!1,hasDialog:!0}}),destroy:f.noop}}function Fk(a,b,c){var d=function(a,b,c,d){return b.bundled?a.apply(void 0,d.concat([b])):c()},e=oW(a,b,c);
b=d(CP,a.formatting,Aa.basic,[e]);var g=d(AP,a.alignindent,Aa.basic,[e]),l=d(QP,a.bookmark,Aa.basic,[e]),p=d(SP,a.directionality,Aa.basic,[e]),s=d(gW,a.table,Aa.table,[e]),z=d(NP,a.blocktag,Aa.basic,[e]),x=d(qS,a.font,Aa.basic,[e]),M=d(nW,a.wordcount,Aa.basic,[e]),G=d(WT,a.media,Aa.basic,[e]),n=d(tV,a.specialchar,Aa.basic,[e]),q=d(BT,a.linkvalidator,Aa.linkvalidator,[e,c.linkvalidator]),t=d(wT,a.link,Aa.basic,[e,q]),u=d(HS,a.horizontalrule,Aa.basic,[e]),v=d(DS,a.help,Aa.dialog,[e]),w=function(b,c,
d,g){var l=a.ui.locale.code,l=void 0!==l?l:ce.get();return(!0===c.bundled?ie.determine(l):h.none()).fold(function(){return d()},function(a){var d=e.profile().spelling().get(),d=!0!==c.menu&&d!==ie.offKey()||!1===d?a:d;return b.apply(void 0,g.concat([c,a,d]))})}(TV,a.spelling,Aa.spelling,[e,c.spelling]),A=d(mU,a.parlance,Aa.basic,[e,w]),B=d(uU,a.resize,Aa.basic,[e]),C=d(QT,a.macros,Aa.macros,[e,w,c.macros]),E=d(ES,a.highlighter,Aa.highlighter,[e,C]),I=d(TP,a.draganddrop,Aa.draganddrop,[e]),F=kW(),
H=d(eT,a.imageEdit,Aa.imageEdit,[e,F]),J=d(KS,a.image,Aa.image,[e]),L=d(VR,a.fileupload,Aa.dialog,[e,F,H.insertResample(),I]),N=d(kV,a.smartclipboard,Aa.basic,[e,F,H.insertResample()]),P=d(hU,a.mentions,Aa.basic,[e]),O=d(bS,a.findreplace,Aa.basic,[e]),Q=d(vP,a.accessibility,Aa.basic,[e]),S=d(YP,a.embed,Aa.basic,[e,c.embed]);c=function(){var a=e.content();return a.body().fold(a.getContent,function(a){a=ac.deep(a);return bi.output(e.filter(),a)})};var T=function(a){var b=e.filter(),c=e.content();a=
b.filterHtml(b.input(),a);c.resetContent(a);E.run();q.refresh();w.scanView();return a},d=d(qU,{getContent:c,setContent:T,bundled:a.plaincodeview.bundled},Aa.basic,[e]);e.contextmenu().register("table",s);e.contextmenu().register("imageEdit",H);e.contextmenu().register("image",J);e.contextmenu().register("spelling",w);e.contextmenu().register("link",t);var V=pW({formatting:b,alignindent:g,bookmark:l,directionality:p,table:s,font:x,imageEdit:H,parlance:A,blocktag:z,wordcount:M,specialchar:n,media:G,
link:t,linkvalidator:q,horizontalrule:u,help:v,fileupload:L,findreplace:O,accessibility:Q,plaincodeview:d,macros:C,spelling:w});e.content().events.ready.bind(function(){e.ui().init(e.keyboard(),e.undo(),V);w.init(e.content());E.run();q.refresh()});e.content().events.loaded.bind(function(){setTimeout(function(){U.trigger.loaded();X()},0)});var U=D.create({loaded:r([]),ready:K([],e.content().events.ready),focus:r([]),change:r([]),dirty:K([],e.laundry().events.dirty),internal:r(["command","data"]),paint:r(["dimensions"])}),
X=e.content().isInline()?f.noop:function(){e.content().body().each(function(a){a=y.documentElement(a);var b=e.content().element();U.trigger.paint(Gu({width:ra.get(b),docWidth:ra.get(a),height:ha.get(b),docHeight:ha.get(a)}))})};e.undo().events.changed.bind(function(){U.trigger.change()});e.undo().events.reset.bind(function(){U.trigger.change()});e.content().events.paint.bind(X);e.content().events.nodeChanged.bind(X);e.content().events.focus.bind(function(){U.trigger.focus()});e.internalevents().events.internal.bind(function(a){var b=
a.command();"insertLink"===b&&(a=m.get(a.data(),"href"),U.trigger.internal(b,a))});d=e.content().isInline()?function(){var a=e.ui(),b=e.content(),c=a.state(),c=void 0!==c.toolbar&&void 0!==c.toolbar.drag?c.toolbar.drag.isSome():!1;b.activate();b.focus();e.viewablearea().setOn();c||a.position();a.refresh()}:f.noop;b=e.content().isInline()?function(){e.content().deactivate();e.content().blur();e.viewablearea().setOff()}:f.noop;return uh.internal({activateInline:d,deactivateInline:b,element:e.ui().element,
viewport:e.ui().viewport,connect:e.ui().connect,focus:e.content().focus,blur:e.content().blur,getContent:c,toTransfer:f.compose(we.changed,c),setContent:function(a){var b=e.undo();b.disable(function(){var c=T(a);b.reset(c)});e.laundry().setDirty(!1)},insertHtmlAtCursor:e.insertFilteredHtmlAtCursor,isDirty:e.laundry().isDirty,setDirty:e.laundry().setDirty,fromTransfer:function(a){var b=e.undo();we.cata(a,function(a){b.disable(function(){T(a)});b.replaceTop()},function(a){T(a);b.save()})},uploader:f.constant(F),
state:function(){var a=e.state();return Z.merge(a,{spelling:w.state(),macros:C.state(),filters:e.filter().customFilters().state(),linkvalidator:q.state(),embed:S.state()})},destroy:function(){e.content().deactivate();var a=k.map(W.values(V),f.apply);k.each(a.concat([S,J,H,w,B,C,E,F,N,P,e,I]),function(a){a.destroy()})},events:U.registry,communication:e.communication,fullscreen:e.fullscreen,content:e.content,ui:e.ui,undo:e.undo,smartview:e.smartview,keyboard:e.keyboard,filter:e.filter,operations:e.operations,
macros:f.constant(C),getMode:yb.pencil,isPrettyPrinting:function(){return!0===a.content.prettyprint}})}function qW(a,b){var c=Aa.state(b),d=xa(null),e=q.fromTag("div"),g=function(){ua.set(e,'<div class="e-p-s-img"></div>');l()},l=void 0===a.content.inline?f.noop:function(){if(!1===a.ui.toolbar.visible)t.set(e,"display","none");else{var b={isInline:f.constant(!0),element:f.constant(a.content.inline)},b=uc.offsetFrom(b,e,ha.get(e),a.ui);t.setAll(e,{position:"absolute",left:b.left+"px",top:b.top-4+"px"})}},
p=null,s=f.die("API unavailable while the editor is loading"),k={body:f.constant(h.none()),doc:s,execCommand:s,getSelectedText:s,focus:s,deactivate:f.noop,blur:f.noop},x=void 0===a.content.inline?d.get:function(){return ua.get(a.content.inline)};return uh.internal({activateInline:l,blur:s,communication:f.constant(Lv(a)),connect:function(a){p=setTimeout(g,1E3);v.append(a,e);jp.add();return!1},content:f.constant(k),deactivateInline:f.noop,destroy:function(){clearTimeout(p);jp.remove();B.remove(e)},
element:f.constant(e),events:Mc.events(),failure:function(){clearTimeout(p);jp.remove();ua.set(e,"<p>Unable to load editor. See browser console for details.</p>")},filter:c.filter,focus:s,fromTransfer:function(a){we.cata(a,d.set,d.set)},fullscreen:Aa.fullscreen,getContent:x,getMode:s,insertHtmlAtCursor:s,isDirty:c.laundry.isDirty,isPrettyPrinting:function(){return!0===a.content.prettyprint},keyboard:Mc.keyboard,macros:c.macros,operations:Mc.operations,setContent:function(b){void 0===a.content.inline?
d.set(b):ua.set(a.content.inline,b);c.laundry.setDirty(!1)},setDirty:c.laundry.setDirty,smartview:Mc.smartview,state:function(){var a=ke.isEmpty(x())?{}:{content:{}};return c.getState(a)},toTransfer:f.compose(we.unchanged,x),ui:Mc.ui,undo:f.constant(Aa.undo()),uploader:f.constant(Aa.uploader()),viewport:f.constant(e)})}function rW(a,b){return(!0===b.bundled?sW:tW)(a,b)}function uW(a,b){var c=D.create({change:r(["type"])}),d=le.removeClasses([w.resolve(yb.none()),w.resolve(yb.wait()),w.resolve(yb.pencil()),
w.resolve(yb.code())]),e=P.div();O.hidden(e,"true");ea.add(e,[w.resolve("html-switch-wrapper"),w.resolve("layer-editor")]);var g=P.div();ea.add(g,[w.resolve("html-switch"),w.resolve("icon")]);v.append(e,g);var l=function(a){d(g);n.add(g,w.resolve(a));m.set(g,"data-icon",a);m.remove(g,"title")},f=function(a,b){var c=m.get(g,"data-icon");a!==c&&(q=c,l(a),m.set(g,"title",b))},h=function(a){b.showButton&&a!==yb.none()?f(a,u.translate("toolbar.switch-"+a)):l(yb.none());x.control.unblock()},k=pc.unbindable(),
x=Lc.tap(function(){c.trigger.change(m.get(g,"data-icon"))});b.showButton&&k.set(E.bind(e,"click",x.instance));var M=function(a){v.append(a,e)},G=Od.onDirection("right","left"),q=yb.none();h(q);return{render:M,destroy:function(){B.remove(e);k.clear()},switchto:h,spin:function(){f(yb.wait(),u.translate("loading.wait"));x.control.block()},stopSpin:function(){"spin"!==q&&h(q)},init:function(b){var c=a.get();M(c.viewport());c.events.paint.bind(function(a){var b=a.dimensions();a=G(c.element());b="left"===
a&&(Wx.isFirefox()||Wx.isChrome())?0:b.width()-b.docWidth();t.set(e,a,b+"px")});h(yb.none())},events:c.registry}}function vW(a,b,c,d,e,g){var l=q.fromTag("div"),p=c.uiContainer(),h=P.div();d.updateUi(l);d=[pf.editorContainer(),"ephox-textbox-font",w.resolve("layer-editor"),w.resolve("editor-main"),w.resolve("fullscreen-maximized")];ea.add(l,d);m.set(l,"lang",ce.get());kp.addClasses(l);v.append(l,p);var z=Zu(a,l,{}),x=Qd.toolbar(z,u.translate);b.events.toolbar.bind(x.enter);x.events.exit.bind(a.focus);
var M=Yu(),G=ca.body(),r=P.div();n.add(r,w.resolve("socket"));var t=k.map(["dragover","drop"],function(a){return E.bind(r,a,function(a){a.kill()})}),y=P.div();n.add(y,w.resolve("widget-container"));z.integrate(l,x,M,r,y);hv.build(l,e.sideBar,e.bottomBar);var A=zw({layerClass:w.resolve("layer-below-editor"),background:"rgba(255, 255, 255, 0.92)"}),C=w.resolve("body-fullscreen");a.events.paint.bind(function(a){x.repaint();c.refresh()});return{element:f.constant(l),socket:function(a){v.append(r,a.element())},
viewport:f.constant(r),uiContainerParent:f.constant(h),connect:function(a){A.show();n.add(G,C);v.append(a,l);vh.detect(l);return!0},destroy:function(){k.each(t,function(a){a.unbind()});x.destroy();n.remove(G,C);B.remove(l);B.remove(h);A.destroy();M.destroy()},banners:M.element,displayBanner:M.display,hideBanner:M.hide,position:function(){z.init(x,M,r,y,e,g)},refresh:function(){z.update();x.refresh()},toolbar:x,dialogContainer:f.constant(y)}}function wW(a){var b=h.none(),c=h.none(),d=D.create({maximize:r([]),
restore:r([])}),e=function(c){b=y.parent(a.get().element());b.getOrDie("maximize called on editor that is not in the DOM.");a.swap(Fk,{ui:{layout:xW,isFullScreen:!0,autoresize:!1},fullscreen:{layout:void 0!==c.layout()?c.layout():lp},content:{autoresize:!1}}).destroy();var e=a.get();e.fullscreen().select();e.connect(ca.body());e.events.ready.bind(function(){e.focus();d.trigger.maximize()})},g=function(c){a.swap(Fk,{ui:{layout:void 0!==c.layout()?c.layout():lp,isFullScreen:!1}}).destroy();var e=a.get();
e.fullscreen().deselect();c=b.getOrDie("restore called on editor that was not previously in the DOM.");a.get().connect(c);e.events.ready.bind(function(){e.focus();d.trigger.restore()})};return{init:function(b){if(Gk.goingToDesign(b)){b=a.get();var d=a.get().element();c.each(function(a){if(L.eq(a,d))throw"Fullscreen init called twice on the same instance";});c=h.some(d);b.fullscreen().events.maximize.bind(e);b.fullscreen().events.restore.bind(g)}},destroy:function(){},events:d.registry}}function yW(){var a=
[];return{setCallback:function(b){Q.isFunction(b)&&a.push(b)},done:function(b){k.each(a,function(a){a.apply(null,[b])});a=[]}}}function zW(a){var b=function(){var b=a.url,c=b.lastIndexOf("/"),b=0<c?b.substr(0,c):b,b=void 0===a.basePath?b:a.basePath;return aa.endsWith(b,"/")?b:b+"/"}(),c=function(c,e,g){var l=ci.getFilename(c,e);e=!0===a.credentials?jd.xhr():jd.none();c=Xx.file(ci.buildData("image",c,l));sd.post(a.url,c,td.text(),e).map(function(a){a.fold(function(a){g(H.error(ci.failureObject(a.message(),
a.status(),a.responseText())))},function(a){var c;try{var d=Vc.parse(a);if(Q.isString(d.location))c=d.location;else{g(H.error(ci.failureObject("JSON response did not contain a string location",500,a)));return}}catch(e){c=a}a=c.split(/\s+/);a=hx.resolve(b,1===a.length&&""!==a[0]?a[0]:l);g(H.value({location:a}))})})};return{upload:function(a,b,g){a=a.imageresult();qc.imageResultToBlob(a).then(function(a){c(a,b,g)})}}}function AW(a){var b=function(b,d,e,g){var l=function(a){g(H.error(a))},f=function(a){Q.isString(a)?
g(H.value({location:a})):(console.error("Image upload result was not a string"),l(""))},h=ci.getFilename(b,e),k=BW(e,h,b,d);setTimeout(function(){a(k,f,l)},0)};return{upload:function(a,d,e){var g=a.imageresult();qc.imageResultToBlob(g).then(function(a){b(a,qc.imageResultToDataURL(g),d,e)})}}}function CW(){var a={},b=function(a){Ne.revokeObjectURL(a.objurl())};return{add:function(b,d,e){d=DW(b,d,e);return a[b]=d},get:function(b){return h.from(a[b])},remove:function(c){var d=a[c];delete a[c];void 0!==
d&&b(d)},lookupByData:function(b){return W.find(a,function(a){return qc.imageResultToDataURL(a.imageresult())===b})},destroy:function(){W.each(a,b);a={}}}}function EW(){var a=[],b=[],c=D.create({complete:r(["response"])}),d=function(d){a=k.filter(a,function(a,b){return a!==d});!1===e()&&(c.trigger.complete(b),b=[])},e=function(){return 0<a.length};return{findById:FW,findAll:GW,register:function(b,c){m.set(b,Hk,c);a.push(c)},report:function(a,c,e){k.each(c,function(a){m.remove(a,Hk);b.push({success:e,
element:a.dom()})});d(a)},inProgress:e,isActive:function(b){return k.contains(a,b)},events:c.registry}}function HW(a,b){var c=CW(),d=yW(),e=EW(),g=Co(a.ui),l=IW.choose(b,g,a.communication()),f=l.uploader(),s=l.errors(),z=JW.instance(b,c),x=D.create({begin:r([]),finish:r([])}),m=function(a){x.trigger.finish();d.done(a)};e.events.complete.bind(function(a){m(a.response())});var G=function(a,b,d,g){di.handleUpload(f,e,c,a,b,d,function(a){a.fold(function(a){g(a)},q)})},n=function(d){a.content().body().each(function(a){var e=
s.instance(),g=di.registerAssets(c,a,d.assets()),g=Xh.partition(g);k.each(g.errors,function(a){console.error(a)});0<g.values.length&&!0===b.immediate&&(x.trigger.begin(),k.each(g.values,function(b){t(a,b,e)}))})},q=function(b,c,d){a.undo().rewrite(d.objurl(),b.location)},t=function(a,c,d){!1!==b.bundled&&di.prepareForUpload(e,c.blobInfo().id(),c.image()).each(function(b){G(a,b,c.blobInfo(),d)})},u=function(a){k.each(a,function(a){e.report(a,h.none(),!1)})},v=function(a,b){var c=Xh.partition(b),d=
c.values;u(c.errors);var e=s.instance();z(d).get(function(b){b=Xh.partition(b);0<b.errors.length&&(g.showKey("imageedit.generic"),console.error("Image resample on upload errors: ",b.errors),u(b.errors));k.each(b.values,function(b){t(a,b,e)})})},w=function(g){Q.isFunction(g)&&d.setCallback(g);x.trigger.begin();!0!==b.bundled?m([]):a.content().body().fold(function(){m([])},function(a){var b=di.findBlobs(e,c,a);0!==b.length||e.inProgress()?v(a,b):m([])})};return{init:function(d){Gk.goingToDesign(d)&&
(d=a.filter(),KW.configure(d,c),a.uploader().events.uploadAssets.bind(n),a.uploader().events.pasteUpload.bind(function(){!0===b.immediate&&w()}));g.reset()},events:x.registry,reconstitute:w,destroy:function(){c.destroy()}}}function LW(a,b,c,d){var e=wW(a),g=HW(b,c.imageupload),l=rW(a,c.codeview),f=uW(a,c.codeview),h=[e,g,f],z=h.concat([l]);e.events.restore.bind(function(){d.restore();m(z,yb.code())});e.events.maximize.bind(function(){d.save();m(h,yb.code())});g.events.begin.bind(f.spin);g.events.finish.bind(f.stopSpin);
l.events.change.bind(function(c){a.get().events.loaded.bind(function(){b.focus()});b.reconnect()});f.events.change.bind(function(a){x(a.type())});l.events.ready.bind(function(a){f.switchto(a.type())});var x=function(b){g.reconstitute(function(){a.get().getMode()!==b&&(f.spin(),l.setMode(b))})},m=function(a,b){k.each(a,function(a){a.init(b)})};b.events.connected.bind(function(){m(z,Gk.alternate(b.getMode()))});return{setMode:x,uploadImages:g.reconstitute,destroy:function(){f.destroy();a.destroy();
k.each(z,function(a){a.destroy()})}}}function MW(a){var b=NW(a);return{directionAt:function(a){return"rtl"===(A.isText(a)?y.parent(a):h.some(a)).map(Od.getDirection).getOr("ltr")?Yx:Zx},uiDirection:function(){return b?Yx:Zx},updateUi:function(a){m.set(a,"dir",b?"rtl":"ltr")},destroy:f.noop}}function OW(a,b){var c=D.create({create:r(["instance"]),loaded:r([]),focus:r([]),dirty:r([]),change:r([]),internal:r(["command","data"])}),d=xb.cached(function(){c.trigger.loaded()}),e=function(a){a.events.focus.bind(function(){c.trigger.focus()});
a.events.dirty.bind(function(){c.trigger.dirty()});a.events.change.bind(function(){c.trigger.change()});a.events.internal.bind(function(a){c.trigger.internal(a.command(),a.data())});a.events.loaded.bind(d)};e(a);var g=a,l=f.compose(MW,ce.get);return{get:function(){return g},swap:function(a,d){var h=g,k=Z.deepMerge(b,d),m=h.state(),k=a(k,l(),m);e(k);c.trigger.create(k);g=k;return{old:f.constant(h),nu:f.constant(k),destroy:function(){h.destroy()}}},destroy:function(){g.destroy()},events:c.registry}}
function mp(a,b){var c=PW(a);ei.setLanguage(c.ui.locale.code);var d=Z.deepMerge($x.state(),b),e=cc.capture(q.fromDom(document),window),g=qW(c,d),l=OW(g,c),f=cP(l),d=LW(l,f,c,e),e=D.create({loaded:K([],l.events.loaded),focus:K([],l.events.focus),dirty:K([],l.events.dirty),change:K([],l.events.change),connected:K([],f.events.connected),internal:K(["command","data"],l.events.internal)});ei.waitForLoad().get(function(a){a=ei.getFailures(a);if(0===a.length){a=l.swap("code"===c.codeview.mode?Eu:Fk);f.reconnect();
var b=function(a){ke.isEmpty(a)||f.setContent(a)},d=a.old().toTransfer();we.cata(d,b,b);a.destroy()}else k.each(a,function(a){console.error(a)}),console.error("Required resources are not available. Cancelling editor load."),g.failure()});return uh.external({activateInline:f.activateInline,communication:Mc.communication,connect:f.connect,content:f.content,deactivateInline:f.deactivateInline,element:f.element,events:e.registry,filter:f.filter,focus:f.focus,getContent:f.getContent,getMode:f.getMode,
insertHtmlAtCursor:f.insertHtmlAtCursor,isDirty:f.isDirty,isPrettyPrinting:f.isPrettyPrinting,keyboard:f.keyboard,macros:f.macros,operations:f.operations,setContent:f.setContent,setDirty:f.setDirty,smartview:f.smartview,state:f.state,ui:f.ui,undo:f.undo,setMode:d.setMode,uploadImages:d.uploadImages,destroy:d.destroy})}function QW(a){a=void 0!==a?a:{};return Z.deepMerge(RW(a),SW(a))}function TW(a,b,c){n.add(b,ed.base());return{toolbarShow:function(){n.add(b,ed.active());t.set(a(),"display","block")},
toolbarHide:function(){n.remove(b,ed.active());t.set(a(),"display","none")},isVisible:function(){return n.has(b,ed.active())},restore:function(){ea.remove(b,[ed.base(),ed.active()]);m.setAll(b,c)}}}function UW(a){var b=!1;return{submit:function(){b=!0;a.submit[0]?a.submit[0].click():a.submit.click?a.submit.click():a.submit();b=!1},inprogress:function(){return b}}}function VW(a){var b=function(b,d){var e=xb.cached(function(){var b=Z.deepMerge(QW(d),a);return ay.setupResources(b)});return{constructors:f.constant(b),
options:e}};return{classic:function(a){return b(WW,a)},inline:function(a){a=Z.deepMerge({ui:{toolbar:{draggable:!0}}},a);return b(XW,a)}}}function YW(a){var b=iO(),c=VW(a),d=function(a,c){var d;d=Q.isString(a)?qa.one(a).getOrThunk(f.die("Selector did not match any elements: "+a)):q.fromDom(a);return b.getOrCreate(d,c)},e=function(a,b){Q.isString(a)?console.error("Selector did not match a "+b+": ",a):console.error("Element was not a "+b+": ",a);throw Error("Unable to create textbox.io editor");},g=
Y.detect(),l=function(a){Q.isString(a)||lb(a,[V.domElement("element")]);return Q.isString(a)?qa.all(a):k.map(a,q.fromDom)},p=function(a,c){var d=l(a),d=k.map(d,function(a){return b.getOrCreate(a,c)});return $a.cat(d)};return Fj.makeReadOnly({replace:function(a,b){lb(arguments,[V.stringOrDom("element"),Ik.object("options")]);return d(a,c.classic(b)).getOrThunk(f.curry(e,a,"div or textarea"))},replaceAll:function(a,b){lb(arguments,[V.stringOrArray("elements"),Ik.object("options")]);return p(a,c.classic(b))},
inline:function(a,b){if(g.deviceType.isTouch())throw Error("Mobile does not not support inline editing");lb(arguments,[V.stringOrDom("element"),Ik.object("options")]);return d(a,c.inline(b)).getOrThunk(f.curry(e,a,"supported tag for inline editing"))},inlineAll:function(a,b){if(g.deviceType.isTouch())throw Error("Mobile does not not support inline editing");lb(arguments,[V.stringOrArray("elements"),Ik.object("options")]);return p(a,c.inline(b))},get:function(a){lb(arguments,[V.string("selector")]);
return b.get(a)},getActiveEditor:function(){return b.getActiveEditor().getOr(null)},definePlugin:function(a,b){lb(arguments,[V.string("namespace"),V.object("code")]);Pn.get(a).each(function(){throw Error("namespace "+a+" is already defined");});if(void 0===b.initialize||!Q.isFunction(b.initialize))throw Error("plugin does not have an initialize function");return Pn.register(a,b)},version:su,isSupported:f.always})}var np=function(a){return function(){return a}},ZW=np(!1),$W=np(!0),f={noop:function(){for(var a=
0;a<arguments.length;a++);},noarg:function(a){return function(){for(var b=0;b<arguments.length;b++);return a()}},compose:function(a,b){return function(){for(var c=0;c<arguments.length;c++);return a(b.apply(null,arguments))}},constant:np,identity:function(a){return a},tripleEquals:function(a,b){return a===b},curry:function(a){for(var b=1;b<arguments.length;b++);for(var c=Array(arguments.length-1),b=1;b<arguments.length;b++)c[b-1]=arguments[b];return function(){for(var b=0;b<arguments.length;b++);for(var b=
Array(arguments.length),e=0;e<b.length;e++)b[e]=arguments[e];b=c.concat(b);return a.apply(null,b)}},not:function(a){return function(){for(var b=0;b<arguments.length;b++);return!a.apply(null,arguments)}},die:function(a){return function(){throw Error(a);}},apply:function(a){return a()},call:function(a){a()},never:ZW,always:$W},fi=f.never,op=f.always,Cf=function(){return pp},pp=function(){var a=function(a){return a.isNone()},b=function(a){return a()},c=function(a){return a},a={fold:function(a,b){return a()},
is:fi,isSome:fi,isNone:op,getOr:c,getOrThunk:b,getOrDie:function(a){throw Error(a||"error: getOrDie called on none.");},or:c,orThunk:b,map:Cf,ap:Cf,each:function(){},bind:Cf,flatten:Cf,exists:fi,forall:op,filter:Cf,equals:a,equals_:a,toArray:function(){return[]},toString:f.constant("none()")};Object.freeze&&Object.freeze(a);return a}(),Jk=function(a){var b=function(){return a},c=function(){return e},d=function(b){return b(a)},e={fold:function(b,c){return c(a)},is:function(b){return a===b},isSome:op,
isNone:fi,getOr:b,getOrThunk:b,getOrDie:b,or:c,orThunk:c,map:function(b){return Jk(b(a))},ap:function(b){return b.fold(Cf,function(b){return Jk(b(a))})},each:function(b){b(a)},bind:d,flatten:b,exists:d,forall:d,filter:function(b){return b(a)?e:pp},equals:function(b){return b.is(a)},equals_:function(b,c){return b.fold(fi,function(b){return c(a,b)})},toArray:function(){return[a]},toString:function(){return"some("+a+")"}};return e},h={some:Jk,none:Cf,from:function(a){return null===a||void 0===a?pp:Jk(a)}},
Oe=function(a){return function(b){if(null===b)b="null";else{var c=typeof b;b="object"===c&&Array.prototype.isPrototypeOf(b)?"array":"object"===c&&String.prototype.isPrototypeOf(b)?"string":c}return b===a}},Q={isString:Oe("string"),isObject:Oe("object"),isArray:Oe("array"),isNull:Oe("null"),isBoolean:Oe("boolean"),isUndefined:Oe("undefined"),isFunction:Oe("function"),isNumber:Oe("number")},by=function(){var a=Array.prototype.indexOf,b=function(b,c){return a.call(b,c)},c=function(a,b){var c;a:{c=0;
for(var l=a.length;c<l;++c)if(a[c]===b)break a;c=-1}return c};return void 0===a?c:b}(),cy=function(a,b){return-1<by(a,b)},dy=function(a,b){for(var c=a.length,d=Array(c),e=0;e<c;e++)d[e]=b(a[e],e,a);return d},ey=function(a,b){for(var c=0,d=a.length;c<d;c++)b(a[c],c,a)},fy=function(a,b){for(var c=a.length-1;0<=c;c--)b(a[c],c,a)},gy=function(a,b){for(var c=[],d=0,e=a.length;d<e;d++){var g=a[d];b(g,d,a)&&c.push(g)}return c},hy=function(a,b){for(var c=0,d=a.length;c<d;c++)if(b(a[c],c,a))return h.some(c);
return h.none()},aX=Array.prototype.push,iy=function(a){for(var b=[],c=0,d=a.length;c<d;++c){if(!Array.prototype.isPrototypeOf(a[c]))throw Error("Arr.flatten item "+c+" was not an array, input: "+a);aX.apply(b,a[c])}return b},jy=function(a,b){for(var c=0,d=a.length;c<d;++c)if(!0!==b(a[c],c,a))return!1;return!0},qp=Array.prototype.slice,bX=Q.isFunction(Array.from)?Array.from:function(a){return qp.call(a)},k={map:dy,each:ey,eachr:fy,partition:function(a,b){for(var c=[],d=[],e=0,g=a.length;e<g;e++){var l=
a[e];(b(l,e,a)?c:d).push(l)}return{pass:c,fail:d}},filter:gy,groupBy:function(a,b){if(0===a.length)return[];for(var c=b(a[0]),d=[],e=[],g=0,l=a.length;g<l;g++){var f=a[g],h=b(f);h!==c&&(d.push(e),e=[]);c=h;e.push(f)}0!==e.length&&d.push(e);return d},indexOf:function(a,b){var c=by(a,b);return-1===c?h.none():h.some(c)},foldr:function(a,b,c){fy(a,function(a){c=b(c,a)});return c},foldl:function(a,b,c){ey(a,function(a){c=b(c,a)});return c},find:function(a,b){for(var c=0,d=a.length;c<d;c++){var e=a[c];
if(b(e,c,a))return h.some(e)}return h.none()},findIndex:hy,flatten:iy,bind:function(a,b){var c=dy(a,b);return iy(c)},forall:jy,exists:function(a,b){return hy(a,b).isSome()},contains:cy,equal:function(a,b){return a.length===b.length&&jy(a,function(a,d){return a===b[d]})},reverse:function(a){a=qp.call(a,0);a.reverse();return a},chunk:function(a,b){for(var c=[],d=0;d<a.length;d+=b){var e=a.slice(d,d+b);c.push(e)}return c},difference:function(a,b){return gy(a,function(a){return!cy(b,a)})},mapToObject:function(a,
b){for(var c={},d=0,e=a.length;d<e;d++){var g=a[d];c[String(g)]=b(g,d)}return c},pure:function(a){return[a]},sort:function(a,b){var c=qp.call(a,0);c.sort(b);return c},range:function(a,b){for(var c=[],d=0;d<a;d++)c.push(b(d));return c},head:function(a){return 0===a.length?h.none():h.some(a[0])},last:function(a){return 0===a.length?h.none():h.some(a[a.length-1])},from:bX},He="undefined"!==typeof window?window:Function("return this;")(),ky=function(a,b){for(var c=void 0!==b&&null!==b?b:He,d=0;d<a.length&&
void 0!==c&&null!==c;++d)c=c[a[d]];return c},ly=function(a,b){for(var c=void 0!==b?b:He,d=0;d<a.length;++d){var e=a[d];if(void 0===c[e]||null===c[e])c[e]={};c=c[e]}return c},xd={path:ky,resolve:function(a,b){var c=a.split(".");return ky(c,b)},forge:ly,namespace:function(a,b){var c=a.split(".");return ly(c,b)}},Ub={getOrDie:function(a,b){var c=xd.resolve(a,b);if(void 0===c||null===c)throw a+" not available on this browser";return c}},gi={isPrototypeOf:function(a){var b=xd.resolve("ownerDocument.defaultView",
a);return Ub.getOrDie("HTMLElement",b).prototype.isPrototypeOf(a)}},hi=function(a,b,c,d,e,g){return{name:f.constant(a),output:f.constant(g||a),required:f.constant(d),validate:function(d){if(!c(d))throw d=e(a,b),Error(d);}}},ii=function(a,b){return'value of "'+a+'" is not a '+b},Df=function(a,b){return'value of "'+a+'" is not an '+b},me=function(a,b,c){return function(d,e){return hi(d,a,b,!0,c,e)}},my=function(a){return gi.isPrototypeOf(a)},cX=function(a){return Q.isString(a)||Q.isArray(a)||Q.isObject(a)},
rp=me("array",Q.isArray,Df),dX=me("boolean",Q.isBoolean,ii),eX=me("function",Q.isFunction,ii),fX=me("number",Q.isNumber,ii),gX=me("object",Q.isObject,Df),hX=me("string",Q.isString,ii),iX=me("DOM element",my,ii),jX=me("string or an array",function(a){return Q.isString(a)||Q.isArray(a)},Df),kX=me("string or a DOM element",function(a){return Q.isString(a)||my(a)},Df),V={arrayOfStrings:function(a){return hi(a,"array of strings",function(b){rp(a,void 0).validate(b);return k.forall(b,Q.isString)},!0,Df,
void 0)},arrayOfObjects:function(a){return hi(a,"array of objects",function(b){rp(a,void 0).validate(b);return k.forall(b,Q.isObject)},!0,Df,void 0)},arrayOfToolbarGroups:function(a){return hi(a,"array of toolbar groups",function(b){rp(a,void 0).validate(b);return k.forall(b,cX)},!0,Df,void 0)},bool:dX,domElement:iX,func:eX,number:fX,object:gX,string:hX,stringOrArray:jX,stringOrDom:kX,param:hi},ny={paramList:function(){return[V.object("aria"),V.func("fetch"),V.func("menuComplete"),V.func("menuExtra"),
V.func("menuHover"),V.string("hoverSelector"),V.func("hover")]},encodeWithEditorApi:function(){return["menuComplete"]}},oy=function(a){return function(){for(var b=Array(arguments.length),c=0;c<b.length;c++)b[c]=arguments[c];if(0===b.length)throw Error("Can't merge zero objects");for(var c={},d=0;d<b.length;d++){var e=b[d],g;for(g in e)e.hasOwnProperty(g)&&(c[g]=a(c[g],e[g]))}return c}},py=oy(function(a,b){return Q.isObject(a)&&Q.isObject(b)?py(a,b):b}),lX=oy(function(a,b){return b}),Z={deepMerge:py,
merge:lX},sp=function(){var a=Object.keys,b=function(a){var b=[],e;for(e in a)a.hasOwnProperty(e)&&b.push(e);return b};return void 0===a?b:a}(),Kk=function(a,b){for(var c=sp(a),d=0,e=c.length;d<e;d++){var g=c[d];b(a[g],g,a)}},qy=function(a,b){var c={};Kk(a,function(d,e){var g=b(d,e,a);c[g.k]=g.v});return c},ry=function(a,b){var c=[];Kk(a,function(a,e){c.push(b(a,e))});return c},sy=function(a){return ry(a,function(a){return a})},W={bifilter:function(a,b){var c={},d={};Kk(a,function(a,g){(b(a,g)?c:
d)[g]=a});return{t:c,f:d}},each:Kk,map:function(a,b){return qy(a,function(a,d,e){return{k:d,v:b(a,d,e)}})},mapToArray:ry,tupleMap:qy,find:function(a,b){for(var c=sp(a),d=0,e=c.length;d<e;d++){var g=c[d],l=a[g];if(b(l,g,a))return h.some(l)}return h.none()},keys:sp,values:sy,size:function(a){return sy(a).length}},tp=function(a,b,c){return k.map(a,function(a){return b(a,c)})},up=function(a,b){if(Q.isString(a))return a;if(Q.isArray(a))return tp(a,up,b);if(Q.isObject(a)&&void 0!==a.action){var c=f.compose(a.action,
b);return Z.merge(a,{action:c})}c=tp(a.items,up,b);return Z.deepMerge(a,{items:c})},tu={mentions:function(a,b){var c=ny.encodeWithEditorApi();return W.map(a,function(a,e){return k.contains(c,e)?function(c){return a(b(),c)}:a})},toolbar:function(a,b){return void 0===a.items?a:{items:tp(a.items,up,b)}}},Lk=function(a){return{is:function(b){return a===b},isValue:f.always,isError:f.never,getOr:f.constant(a),getOrThunk:f.constant(a),getOrDie:f.constant(a),or:function(b){return Lk(a)},orThunk:function(b){return Lk(a)},
fold:function(b,c){return c(a)},map:function(b){return Lk(b(a))},each:function(b){b(a)},bind:function(b){return b(a)},exists:function(b){return b(a)},forall:function(b){return b(a)},toOption:function(){return h.some(a)}}},vp=function(a){return{is:f.never,isValue:f.never,isError:f.always,getOr:f.identity,getOrThunk:function(a){return a()},getOrDie:function(){return f.die(String(a))()},or:function(a){return a},orThunk:function(a){return a()},fold:function(b,c){return b(a)},map:function(b){return vp(a)},
each:f.noop,bind:function(b){return vp(a)},exists:f.never,forall:f.always,toOption:h.none}},H={value:Lk,error:vp},VN=function(){var a=(new Date).getTime();return String(a).slice(-6)},ji=function(a){if(null===a||void 0===a)throw Error("Node cannot be null or undefined");return{dom:f.constant(a)}},q={fromHtml:function(a,b){var c=(b||document).createElement("div");c.innerHTML=a;if(!c.hasChildNodes()||1<c.childNodes.length)throw console.error("HTML does not have a single root node",a),"HTML must have a single root node";
return ji(c.childNodes[0])},fromTag:function(a,b){var c=(b||document).createElement(a);return ji(c)},fromText:function(a,b){var c=(b||document).createTextNode(a);return ji(c)},fromDom:ji,fromPoint:function(a,b,c){return h.from(a.dom().elementFromPoint(b,c)).map(ji)}},qa={all:function(a,b){var c=void 0===b?document:b.dom();return 1!==c.nodeType&&9!==c.nodeType||0===c.childElementCount?[]:k.map(c.querySelectorAll(a),q.fromDom)},is:function(a,b){var c=a.dom();if(1!==c.nodeType)return!1;if(void 0!==c.matches)return c.matches(b);
if(void 0!==c.msMatchesSelector)return c.msMatchesSelector(b);if(void 0!==c.webkitMatchesSelector)return c.webkitMatchesSelector(b);if(void 0!==c.mozMatchesSelector)return c.mozMatchesSelector(b);throw Error("Browser lacks native selectors");},one:function(a,b){var c=void 0===b?document:b.dom();return 1!==c.nodeType&&9!==c.nodeType||0===c.childElementCount?h.none():h.from(c.querySelector(a)).map(q.fromDom)}},ty=function(a){return a.dom().nodeName.toLowerCase()},wp=function(a){return a.dom().nodeType},
xp=function(a){return function(b){return wp(b)===a}},mX=xp(1),nX=xp(3),oX=xp(9),A={name:ty,type:wp,value:function(a){return a.dom().nodeValue},isElement:mX,isText:nX,isDocument:oX,isComment:function(a){return 8===wp(a)||"#comment"===ty(a)}},jO={one:function(a,b,c){var d=A.name(a);return h.from(b[d]).map(function(b){return b.replace(a,c)})}},bk={documentPositionPreceding:function(a,b){var c=Ub.getOrDie("Node").DOCUMENT_POSITION_PRECEDING;return 0!==(a.compareDocumentPosition(b)&c)},documentPositionContainedBy:function(a,
b){var c=Ub.getOrDie("Node").DOCUMENT_POSITION_CONTAINED_BY;return 0!==(a.compareDocumentPosition(b)&c)}},xb={cached:function(a){var b=!1,c;return function(){b||(b=!0,c=a.apply(null,arguments));return c}}},uy=function(){return yp(0,0)},yp=function(a,b){return{major:a,minor:b}},Mk={nu:yp,detect:function(a,b){var c=String(b).toLowerCase();if(0===a.length)c=uy();else{var d;a:{for(d=0;d<a.length;d++){var e=a[d];if(e.test(c)){d=e;break a}}d=void 0}c=d?yp(Number(c.replace(d,"$1")),Number(c.replace(d,"$2"))):
{major:0,minor:0}}return c},unknown:uy},tg=function(a,b){return function(){return b===a}},vy=function(a){var b=a.current;return{current:b,version:a.version,isEdge:tg("Edge",b),isChrome:tg("Chrome",b),isIE:tg("IE",b),isOpera:tg("Opera",b),isFirefox:tg("Firefox",b),isSafari:tg("Safari",b)}},pX=function(){return vy({current:void 0,version:Mk.unknown()})};f.constant("Edge");f.constant("Chrome");f.constant("IE");f.constant("Opera");f.constant("Firefox");f.constant("Safari");var Ef=function(a,b){return function(){return b===
a}},wy=function(a){var b=a.current;return{current:b,version:a.version,isWindows:Ef("Windows",b),isiOS:Ef("iOS",b),isAndroid:Ef("Android",b),isOSX:Ef("OSX",b),isLinux:Ef("Linux",b),isSolaris:Ef("Solaris",b),isFreeBSD:Ef("FreeBSD",b)}},qX=function(){return wy({current:void 0,version:Mk.unknown()})};f.constant("Windows");f.constant("iOS");f.constant("Android");f.constant("Linux");f.constant("OSX");f.constant("Solaris");f.constant("FreeBSD");var xy=function(a,b){var c=String(b).toLowerCase();return k.find(a,
function(a){return a.search(c)})},yy={detectBrowser:function(a,b){return xy(a,b).map(function(a){var d=Mk.detect(a.versionRegexes,b);return{current:a.name,version:d}})},detectOs:function(a,b){return xy(a,b).map(function(a){var d=Mk.detect(a.versionRegexes,b);return{current:a.name,version:d}})}},Nk={addToStart:function(a,b){return b+a},addToEnd:function(a,b){return a+b},removeFromStart:function(a,b){return a.substring(b)},removeFromEnd:function(a,b){return a.substring(0,a.length-b)}},zy={first:function(a,
b){return a.substr(0,b)},last:function(a,b){return a.substr(a.length-b,a.length)},head:function(a){return""===a?h.none():h.some(a.substr(0,1))},tail:function(a){return""===a?h.none():h.some(a.substring(1))}},Ay=function(a,b,c){return""===b?!0:a.length<b.length?!1:a.substr(c,c+b.length)===b},zp=function(a,b){return Ay(a,b,0)},Ap=function(a,b){return Ay(a,b,a.length-b.length)},aa={supplant:function(a,b){return a.replace(/\${([^{}]*)}/g,function(a,d){var e=b[d],g=typeof e;return"string"===g||"number"===
g?e:a})},startsWith:zp,removeLeading:function(a,b){return zp(a,b)?Nk.removeFromStart(a,b.length):a},removeTrailing:function(a,b){return Ap(a,b)?Nk.removeFromEnd(a,b.length):a},ensureLeading:function(a,b){return zp(a,b)?a:Nk.addToStart(a,b)},ensureTrailing:function(a,b){return Ap(a,b)?a:Nk.addToEnd(a,b)},endsWith:Ap,contains:function(a,b){return-1!==a.indexOf(b)},trim:function(a){return a.replace(/^\s+|\s+$/g,"")},lTrim:function(a){return a.replace(/^\s+/g,"")},rTrim:function(a){return a.replace(/\s+$/g,
"")},capitalize:function(a){return zy.head(a).bind(function(b){return zy.tail(a).map(function(a){return b.toUpperCase()+a})}).getOr(a)}},Bp=/.*?version\/\ ?([0-9]+)\.([0-9]+).*/,Pe=function(a){return function(b){return aa.contains(b,a)}},rX=[{name:"Edge",versionRegexes:[/.*?edge\/ ?([0-9]+)\.([0-9]+)$/],search:function(a){return aa.contains(a,"edge/")&&aa.contains(a,"chrome")&&aa.contains(a,"safari")&&aa.contains(a,"applewebkit")}},{name:"Chrome",versionRegexes:[/.*?chrome\/([0-9]+)\.([0-9]+).*/,
Bp],search:function(a){return aa.contains(a,"chrome")&&!aa.contains(a,"chromeframe")}},{name:"IE",versionRegexes:[/.*?msie\ ?([0-9]+)\.([0-9]+).*/,/.*?rv:([0-9]+)\.([0-9]+).*/],search:function(a){return aa.contains(a,"msie")||aa.contains(a,"trident")}},{name:"Opera",versionRegexes:[Bp,/.*?opera\/([0-9]+)\.([0-9]+).*/],search:Pe("opera")},{name:"Firefox",versionRegexes:[/.*?firefox\/\ ?([0-9]+)\.([0-9]+).*/],search:Pe("firefox")},{name:"Safari",versionRegexes:[Bp,/.*?cpu os ([0-9]+)_([0-9]+).*/],search:function(a){return(aa.contains(a,
"safari")||aa.contains(a,"mobile/"))&&aa.contains(a,"applewebkit")}}],sX=[{name:"Windows",search:Pe("win"),versionRegexes:[/.*?windows\ nt\ ?([0-9]+)\.([0-9]+).*/]},{name:"iOS",search:function(a){return aa.contains(a,"iphone")||aa.contains(a,"ipad")},versionRegexes:[/.*?version\/\ ?([0-9]+)\.([0-9]+).*/,/.*cpu os ([0-9]+)_([0-9]+).*/,/.*cpu iphone os ([0-9]+)_([0-9]+).*/]},{name:"Android",search:Pe("android"),versionRegexes:[/.*?android\ ?([0-9]+)\.([0-9]+).*/]},{name:"OSX",search:Pe("os x"),versionRegexes:[/.*?os\ x\ ?([0-9]+)_([0-9]+).*/]},
{name:"Linux",search:Pe("linux"),versionRegexes:[]},{name:"Solaris",search:Pe("sunos"),versionRegexes:[]},{name:"FreeBSD",search:Pe("freebsd"),versionRegexes:[]}],By={browsers:f.constant(rX),oses:f.constant(sX)},tX={detect:function(a){var b=By.browsers(),c=By.oses(),b=yy.detectBrowser(b,a).fold(pX,vy),c=yy.detectOs(c,a).fold(qX,wy),d=c.isiOS()&&!0===/ipad/i.test(a),e=c.isiOS()&&!d,g=c.isAndroid()&&3===c.version.major,l=c.isAndroid()&&4===c.version.major,g=d||g||l&&!0===/mobile/i.test(a),p=(l=c.isiOS()||
c.isAndroid())&&!g;a=b.isSafari()&&c.isiOS()&&!1===/safari/i.test(a);a={isiPad:f.constant(d),isiPhone:f.constant(e),isTablet:f.constant(g),isPhone:f.constant(p),isTouch:f.constant(l),isAndroid:c.isAndroid,isiOS:c.isiOS,isWebView:f.constant(a)};return{browser:b,os:c,deviceType:a}}},Y={detect:xb.cached(function(){return tX.detect(navigator.userAgent)})},Cy=function(a,b){return a.dom()===b.dom()},uX=function(a,b){var c=a.dom(),d=b.dom();return c===d?!1:c.contains(d)},vX=function(a,b){return bk.documentPositionContainedBy(a.dom(),
b.dom())},wX=Y.detect().browser.isIE()?vX:uX,L={eq:Cy,isEqualNode:function(a,b){return a.dom().isEqualNode(b.dom())},member:function(a,b){return k.exists(b,f.curry(Cy,a))},contains:wX,is:qa.is},Dy=function(a){a=a.dom().body;if(null===a||void 0===a)throw"Body is not available yet";return q.fromDom(a)},ca={body:xb.cached(function(){return Dy(q.fromDom(document))}),getBody:Dy,inBody:function(a){a=A.isText(a)?a.dom().parentNode:a.dom();return void 0!==a&&null!==a&&a.ownerDocument.body.contains(a)}},Ey=
function(a,b,c){a=a.dom();for(c=Q.isFunction(c)?c:f.constant(!1);a.parentNode;){a=a.parentNode;var d=q.fromDom(a);if(b(d))return h.some(d);if(c(d))break}return h.none()},Fy=function(a,b){return k.find(a.dom().childNodes,f.compose(b,q.fromDom)).map(q.fromDom)},Gy=function(a,b){var c=function(a){for(var e=0;e<a.childNodes.length;e++){if(b(q.fromDom(a.childNodes[e])))return h.some(q.fromDom(a.childNodes[e]));var g=c(a.childNodes[e]);if(g.isSome())return g}return h.none()};return c(a.dom())},sa={first:function(a){return Gy(ca.body(),
a)},ancestor:Ey,closest:function(a,b,c){return uu(function(a){return b(a)},Ey,a,b,c)},sibling:function(a,b){var c=a.dom();return c.parentNode?Fy(q.fromDom(c.parentNode),function(c){return!L.eq(a,c)&&b(c)}):h.none()},child:Fy,descendant:Gy},Bc={any:function(a){return sa.first(a).isSome()},ancestor:function(a,b,c){return sa.ancestor(a,b,c).isSome()},closest:function(a,b,c){return sa.closest(a,b,c).isSome()},sibling:function(a,b){return sa.sibling(a,b).isSome()},child:function(a,b){return sa.child(a,
b).isSome()},descendant:function(a,b){return sa.descendant(a,b).isSome()}},ug=function(a){return a.slice(0).sort()},yd={sort:ug,reqMessage:function(a,b){throw Error("All required keys ("+ug(a).join(", ")+") were not specified. Specified keys were: "+ug(b).join(", ")+".");},unsuppMessage:function(a){throw Error("Unsupported keys for object: "+ug(a).join(", "));},validateStrArr:function(a,b){if(!Q.isArray(b))throw Error("The "+a+" fields must be an array. Was: "+b+".");k.each(b,function(b){if(!Q.isString(b))throw Error("The value "+
b+" in the "+a+" fields was not a string.");})},invalidTypeMessage:function(a,b){throw Error("All values need to be of type: "+b+". Keys ("+ug(a).join(", ")+") were not.");},checkDupes:function(a){var b=ug(a);k.find(b,function(a,d){return d<b.length-1&&a===b[d+1]}).each(function(a){throw Error("The field: "+a+" occurs more than once in the combined fields: ["+b.join(", ")+"].");})}},C={immutable:function(){for(var a=[],b=0;b<arguments.length;b++)a[b]=arguments[b];return function(){for(var b=[],d=
0;d<arguments.length;d++)b[d]=arguments[d];if(a.length!==b.length)throw Error('Wrong number of arguments to struct. Expected "['+a.length+']", got '+b.length+" arguments");var e={};k.each(a,function(a,d){e[a]=f.constant(b[d])});return e}},immutableBag:function(a,b){var c=a.concat(b);if(0===c.length)throw Error("You must specify at least one required or optional field.");yd.validateStrArr("required",a);yd.validateStrArr("optional",b);yd.checkDupes(c);return function(d){var e=W.keys(d);k.forall(a,function(a){return k.contains(e,
a)})||yd.reqMessage(a,e);var g=k.filter(e,function(a){return!k.contains(c,a)});0<g.length&&yd.unsuppMessage(g);var l={};k.each(a,function(a){l[a]=f.constant(d[a])});k.each(b,function(a){l[a]=f.constant(Object.prototype.hasOwnProperty.call(d,a)?h.some(d[a]):h.none())});return l}}},Hy={toArray:function(a,b){var c=[],d=function(a){c.push(a);return b(a)},e=b(a);do e=e.bind(d);while(e.isSome());return c}},Iy=function(a){return q.fromDom(a.dom().ownerDocument)},Cp=function(a){a=a.dom();return h.from(a.parentNode).map(q.fromDom)},
Jy=function(a){a=a.dom();return h.from(a.previousSibling).map(q.fromDom)},Ky=function(a){a=a.dom();return h.from(a.nextSibling).map(q.fromDom)},Ok=function(a){a=a.dom();return k.map(a.childNodes,q.fromDom)},Dp=function(a,b){var c=a.dom().childNodes;return h.from(c[b]).map(q.fromDom)},Ly=C.immutable("element","offset"),y={owner:Iy,defaultView:function(a){a=a.dom().ownerDocument.defaultView;return q.fromDom(a)},documentElement:function(a){a=Iy(a);return q.fromDom(a.dom().documentElement)},parent:Cp,
findIndex:function(a){return Cp(a).bind(function(b){b=Ok(b);return k.findIndex(b,function(b){return L.eq(a,b)})})},parents:function(a,b){for(var c=Q.isFunction(b)?b:f.constant(!1),d=a.dom(),e=[];null!==d.parentNode&&void 0!==d.parentNode;){var d=d.parentNode,g=q.fromDom(d);e.push(g);if(!0===c(g))break}return e},siblings:function(a){return Cp(a).map(Ok).map(function(b){return k.filter(b,function(b){return!L.eq(a,b)})}).getOr([])},prevSibling:Jy,offsetParent:function(a){a=a.dom();return h.from(a.offsetParent).map(q.fromDom)},
prevSiblings:function(a){return k.reverse(Hy.toArray(a,Jy))},nextSibling:Ky,nextSiblings:function(a){return Hy.toArray(a,Ky)},children:Ok,child:Dp,firstChild:function(a){return Dp(a,0)},lastChild:function(a){return Dp(a,a.dom().childNodes.length-1)},childNodesCount:function(a){return a.dom().childNodes.length},hasChildNodes:function(a){return a.dom().hasChildNodes()},leaf:function(a,b){var c=Ok(a);return 0<c.length&&b<c.length?Ly(c[b],0):Ly(a,b)}},My=function(a){a.dom().focus()},Ep=function(a){a=
void 0!==a?a.dom():document;return h.from(a.activeElement).map(q.fromDom)},T={hasFocus:function(a){var b=y.owner(a).dom();return a.dom()===b.activeElement},focus:My,blur:function(a){a.dom().blur()},active:Ep,search:function(a){return Ep(y.owner(a)).filter(function(b){return a.dom().contains(b.dom())})},focusInside:function(a){var b=y.owner(a);Ep(b).filter(function(b){return Bc.closest(b,f.curry(L.eq,a))}).fold(function(){My(a)},f.noop)}},Pk=function(a,b){y.parent(a).each(function(c){c.dom().insertBefore(b.dom(),
a.dom())})},ki=function(a,b){a.dom().appendChild(b.dom())},v={before:Pk,after:function(a,b){y.nextSibling(a).fold(function(){y.parent(a).each(function(a){ki(a,b)})},function(a){Pk(a,b)})},prepend:function(a,b){y.firstChild(a).fold(function(){ki(a,b)},function(c){a.dom().insertBefore(b.dom(),c.dom())})},append:ki,appendAt:function(a,b,c){y.child(a,c).fold(function(){ki(a,b)},function(a){Pk(a,b)})},wrap:function(a,b){Pk(a,b);ki(b,a)}},J={before:function(a,b){k.each(b,function(b){v.before(a,b)})},after:function(a,
b){k.each(b,function(c,d){v.after(0===d?a:b[d-1],c)})},prepend:function(a,b){k.each(b.slice().reverse(),function(b){v.prepend(a,b)})},append:function(a,b){k.each(b,function(b){v.append(a,b)})}},Fp=function(a){a=a.dom();null!==a.parentNode&&a.parentNode.removeChild(a)},B={empty:function(a){a.dom().textContent="";k.each(y.children(a),function(a){Fp(a)})},remove:Fp,unwrap:function(a){var b=y.children(a);0<b.length&&J.before(a,b);Fp(a)}},Ny=function(a,b,c){if(Q.isString(c)||Q.isBoolean(c)||Q.isNumber(c))a.setAttribute(b,
c+"");else throw console.error("Invalid call to Attr.set. Key ",b,":: Value ",c,":: Element ",a),Error("Attribute value was not simple");},Oy=function(a,b,c){Ny(a.dom(),b,c)},Py=function(a,b){var c=a.dom().getAttribute(b);return null===c?void 0:c},Gp=function(a,b){var c=a.dom();return c&&c.hasAttribute?c.hasAttribute(b):!1},m={clone:function(a){return k.foldl(a.dom().attributes,function(a,c){a[c.name]=c.value;return a},{})},set:Oy,setAll:function(a,b){var c=a.dom();W.each(b,function(a,b){Ny(c,b,a)})},
get:Py,has:Gp,remove:function(a,b){a.dom().removeAttribute(b)},hasNone:function(a){a=a.dom().attributes;return void 0===a||null===a||0===a.length},transfer:function(a,b,c){A.isElement(a)&&A.isElement(b)&&k.each(c,function(c){Gp(a,c)&&!Gp(b,c)&&Oy(b,c,Py(a,c))})}},Md={isSupported:function(a){return void 0!==a.style}},Hp=function(a,b,c){if(!Q.isString(c))throw console.error("Invalid call to CSS.set. Property ",b,":: Value ",c,":: Element ",a),Error("CSS value must be a string: "+c);Md.isSupported(a)&&
a.style.setProperty(b,c)},Ip=function(a,b,c){a=a.dom();Hp(a,b,c)},Qy=function(a,b){return Md.isSupported(a)?a.style.getPropertyValue(b):""},Qk=function(a,b){var c=a.dom(),c=Qy(c,b);return h.from(c).filter(function(a){return 0<a.length})},xX=function(a,b,c){Qk(a,c).each(function(a){Qk(b,c).isNone()&&Ip(b,c,a)})},t={copy:function(a,b){var c=a.dom(),d=b.dom();Md.isSupported(c)&&Md.isSupported(d)&&(d.style.cssText=c.style.cssText)},set:Ip,preserve:function(a,b){var c=m.get(a,"style"),d=b(a);(void 0===
c?m.remove:m.set)(a,"style",c);return d},setAll:function(a,b){var c=a.dom();W.each(b,function(a,b){Hp(c,b,a)})},setOptions:function(a,b){var c=a.dom();W.each(b,function(a,b){a.fold(function(){Md.isSupported(c)&&c.style.removeProperty(b)},function(a){Hp(c,b,a)})})},remove:function(a,b){var c=a.dom();Md.isSupported(c)&&c.style.removeProperty(b);m.has(a,"style")&&""===aa.trim(m.get(a,"style"))&&m.remove(a,"style")},get:function(a,b){var c=a.dom(),d=window.getComputedStyle(c).getPropertyValue(b),c=""!==
d||ca.inBody(a)?d:Qy(c,b);return null===c?void 0:c},getRaw:Qk,getAllRaw:function(a){var b={};a=a.dom();if(Md.isSupported(a))for(var c=0;c<a.style.length;c++){var d=a.style.item(c);b[d]=a.style[d]}return b},isValidValue:function(a,b,c){a=q.fromTag(a);Ip(a,b,c);return Qk(a,b).isSome()},reflow:function(a){return a.dom().offsetWidth},transfer:function(a,b,c){A.isElement(a)&&A.isElement(b)&&k.each(c,function(c){xX(a,b,c)})}},hO={blur:function(){var a=q.fromHtml('<input type="text" />');t.setAll(a,{"z-index":"-666",
background:"transparent",border:"0px",height:"50px",position:"absolute",top:"25%",left:"50%"});v.append(q.fromDom(document.body),a);T.focus(a);B.remove(a)}},yX=function(a){return[W.map(a,function(a){return a()})]},YN={create:function(){var a=[];return{eventRegistry:{addListener:function(b){lb(arguments,[V.func("handler")]);a.push(b)},removeListener:function(b){k.indexOf(a,b).each(function(b){a.splice(b,1)})}},eventTrigger:function(b){k.each(a,function(a){var d=yX(b);a.apply(null,d)})}}}},Ej={create:function(){var a=
[],b=[];return{bind:function(c,d){if(k.contains(a,c))throw"Invalid key, key already exists.";a.push(c);b.push(d);c.bind(d)},unbind:function(c){k.indexOf(a,c).fold(function(){throw"Invalid key, does not exist.";},function(d){a.splice(d,1);d=b.splice(d,1)[0];c.unbind(d)})},unbindAll:function(){k.each(a,function(a,d){a.unbind(b[d])});a.splice(0,a.length);b.splice(0,b.length)}}}},Ry=function(a){Object.freeze(a);W.each(a,function(a){Q.isObject(a)&&Ry(a)});return a},Fj={makeReadOnly:Ry},Jp=function(a){var b=
h.none(),c=[],d=function(a){e()?g(a):c.push(a)},e=function(){return b.isSome()},g=function(a){b.each(function(b){setTimeout(function(){a(b)},0)})};a(function(a){b=h.some(a);k.each(c,g);c=[]});return{get:d,map:function(a){return Jp(function(b){d(function(c){b(a(c))})})},isReady:e}},Xd={nu:Jp,pure:function(a){return Jp(function(b){b(a)})}},zX={bounce:function(a){return function(){var b=Array.prototype.slice.call(arguments),c=this;setTimeout(function(){a.apply(c,b)},0)}}},li=function(a){var b=function(b){a(zX.bounce(b))};
return{map:function(a){return li(function(d){b(function(b){b=a(b);d(b)})})},bind:function(a){return li(function(d){b(function(b){a(b).get(d)})})},anonBind:function(a){return li(function(d){b(function(b){a.get(d)})})},toLazy:function(){return Xd.nu(b)},get:b}},va={nu:li,pure:function(a){return li(function(b){b(a)})}},AX={par:function(a,b){return b(function(b){var d=[],e=0,g=function(g){return function(f){d[g]=f;e++;e>=a.length&&b(d)}};0===a.length?b([]):k.each(a,function(a,b){a.get(g(b))})})}},Sy=
function(a){return AX.par(a,va.nu)},Ic={par:Sy,mapM:function(a,b){var c=k.map(a,b);return Sy(c)},compose:function(a,b){return function(c){return b(c).bind(a)}}},Ty={install:function(a){var b=f.curry(xd.namespace,a);xd.namespace("callbacks",b());var c=function(a){var b=void 0===a.count?0:a.count;a.count=b+1;return"callback_"+b},d=function(d,l){var f=b(),h=c(f);f.callbacks[h]=function(){l||e(h);d.apply(null,arguments)};return a+".callbacks."+h},e=function(a){a=a.substring(a.lastIndexOf(".")+1);var c=
b();void 0!==c.callbacks[a]&&delete c.callbacks[a]};return{ephemeral:function(a){return d(a,!1)},permanent:function(a){return d(a,!0)},unregister:e}}},BX=function(a,b,c,d,e,g,l){return{target:f.constant(a),x:f.constant(b),y:f.constant(c),stop:d,prevent:e,kill:g,raw:f.constant(l)}},CX=function(a,b){return function(c){if(a(c)){var d=q.fromDom(c.target),e=function(){c.stopPropagation()},g=function(){c.preventDefault()},l=f.compose(g,e),d=BX(d,c.clientX,c.clientY,e,g,l,c);b(d)}}},Uy=function(a,b,c,d,
e){c=CX(c,d);a.dom().addEventListener(b,c,e);return{unbind:f.curry(DX,a,b,c,e)}},DX=function(a,b,c,d){a.dom().removeEventListener(b,c,d)},Kp={bind:function(a,b,c,d){return Uy(a,b,c,d,!1)},capture:function(a,b,c,d){return Uy(a,b,c,d,!0)}},Vy=f.constant(!0),E={bind:function(a,b,c){return Kp.bind(a,b,Vy,c)},capture:function(a,b,c){return Kp.capture(a,b,Vy,c)}},EX=Ty.install("ephox.henchman.features"),aO={download:function(a){return Xd.nu(function(b){var c=function(){e.unbind();g.unbind()},d=q.fromTag("script");
m.set(d,"src",a);m.set(d,"type","text/javascript");m.set(d,"async","async");m.set(d,"data-main",EX.ephemeral(function(a){b(H.value(a))}));var e=E.bind(d,"error",function(){c();b(H.error("Error loading external script tag "+a))}),g=E.bind(d,"load",c);v.append(q.fromDom(document.head),d)})}},Wy={addStylesheet:function(a,b){var c=b||q.fromDom(document),d=q.fromTag("link",c.dom());m.setAll(d,{rel:"stylesheet",type:"text/css",href:a});c=q.fromDom(c.dom().head);v.append(c,d);return d}},$N={download:function(a,
b){return Xd.nu(function(c){var d=function(b){k.each(g,function(a){a.unbind()});c(b.fold(function(b){return H.error(b+'Unable to download editor stylesheets from "'+a+'"')},H.value))},e=Wy.addStylesheet(a),g=[E.bind(e,"load",function(a){var c;a:{try{var e=a.target().dom().sheet.cssRules;c=Q.isObject(e)&&0===e.length;break a}catch(g){}c=!1}c?d(H.error("")):b(d)}),E.bind(e,"error",f.curry(d,H.error("")))]})}},Xy=vu(),Rk={addStylesheet:function(a,b){return Xy.addStylesheet(a,b)},addScript:function(a,
b){return Xy.addScript(a,b)}},Sk=C.immutable("str","replace"),Yy=function(a,b){return"2.4.1"!==a?h.some(b+(void 0===a?"":" version "+a)+" appears to be cached, as it does not match editor version 2.4.1."):h.none()},Ge={aboutTags:function(a,b){var c=[Sk("@@FULL_VERSION@@","2.4.1.66"),Sk("@@CLIENT_VERSION@@","2.4.1.129")],d=a?[Sk("@@INTEGRATION_TYPE@@",b.type),Sk("@@INTEGRATION_VERSION@@",b.version)]:[];return k.flatten([c,d])},strictMatch:Yy,weakMatch:function(a,b){return Yy(a,b).map(function(a){return a+
" This may produce unexpected results."})},resourceParam:f.constant("version=2.4.1"),fullParam:f.constant("version=2.4.1.66")},xa=function(a){var b=a;return{get:function(){return b},set:function(a){b=a},clone:function(){return xa(b)}}},FX=function(a){a.each(function(a){Ge.weakMatch(a.version,"Code view").each(function(a){console.warn(a)});Zy.set(a.codemirror());$y.set(a.jsbeautify())});return a},Zy=xa(null),$y=xa(null),Gj={use:{codemirror:Zy.get,jsbeautify:$y.get},load:{codeview:function(a){a=a+"/codeview.js?"+
Ge.resourceParam();return Rk.addScript(a,FX)}}},Fu={beautify:function(a){return Gj.use.jsbeautify().html(a,{indent_size:"2",indent_char:" ",max_preserve_newlines:"5",preserve_newlines:!0,keep_array_indentation:!1,break_chained_methods:!1,indent_scripts:"normal",brace_style:"collapse",space_before_conditional:!0,unescape_strings:!1,jslint_happy:!1,end_with_newline:!1,wrap_line_length:0,indent_inner_html:!1,comma_first:!1,e4x:!1})}},GX=function(a){return a.map(function(a){return a.dom()}).getOr(null)},
Jc={documentElement:function(a){if(a.content().isInline())throw Error("documentElement called on inline mode");return GX(a.content().doc())},insertHtmlAtCursor:function(a,b){lb(arguments,[V.object("polish"),V.string("html")]);a.content().focus();a.insertHtmlAtCursor(b)},uploadImages:function(a,b){lb(arguments,[V.object("polish"),V.func("callback")]);return a.uploadImages(b)},get:function(a){var b=null!==Gj.use.jsbeautify()&&a.isPrettyPrinting();a=a.getContent();return b?Fu.beautify(a):a},set:function(a,
b){lb(arguments,[V.object("polish"),V.string("html")]);a.setContent(b)},isDirty:function(a){lb(arguments,[V.object("polish")]);return a.isDirty()},setDirty:function(a,b){lb(arguments,[V.object("polish"),V.bool("state")]);a.setDirty(b)}},la={generate:function(a){if(!Q.isArray(a))throw Error("cases must be an array");if(0===a.length)throw Error("there must be at least one case");var b=[],c={};k.each(a,function(d,e){var g=W.keys(d);if(1!==g.length)throw Error("one and only one name per case");var l=
g[0],f=d[l];if(void 0!==c[l])throw Error("duplicate key detected:"+l);if("cata"===l)throw Error("cannot have a case named cata (sorry)");if(!Q.isArray(f))throw Error("case arguments must be an array");b.push(l);c[l]=function(){var c=arguments.length;if(c!==f.length)throw Error("Wrong number of arguments to case "+l+". Expected "+f.length+" ("+f+"), got "+c);for(var d=Array(c),c=0;c<d.length;c++)d[c]=arguments[c];return{fold:function(){if(arguments.length!==a.length)throw Error("Wrong number of arguments to fold. Expected "+
a.length+", got "+arguments.length);return arguments[e].apply(null,d)},match:function(a){var c=W.keys(a);if(b.length!==c.length)throw Error("Wrong number of arguments to match. Expected: "+b.join(",")+"\nActual: "+c.join(","));if(!k.forall(b,function(a){return k.contains(c,a)}))throw Error("Not all branches were specified when using match. Specified: "+c.join(", ")+"\nRequired: "+b.join(", "));return a[l].apply(null,d)},log:function(a){console.log(a,{constructors:b,constructor:l,params:d})}}}});return c}},
HX=la.generate([{inputSelector:["selector","callback"]},{outputSelector:["selector","callback"]},{inputPredicate:["predicate","callback"]},{outputPredicate:["predicate","callback"]}]),sh=Z.merge(HX,{cata:function(a,b,c,d,e){return a.fold(b,c,d,e)}}),wu=function(a){return function(b){b=k.map(b,function(a){return a.dom()});a(b)}},cO=function(a){return function(b){return a(b.dom())}},Ua={zeroWidth:function(){return"\ufeff"}},Lp="\\w'\\-\\u0100-\\u017F\\u00C0-\\u00FF"+Ua.zeroWidth()+"\\u2018\\u2019",
IX="[^"+Lp+"]",JX="["+Lp+"]",mi={chars:f.constant(Lp),wordbreak:f.constant(IX),wordchar:f.constant(JX)},Tk={token:function(a){return Nn(a,f.constant(0),f.constant(0),h.none())},word:function(a){a="((?:^'?)|(?:"+mi.wordbreak()+"+'?))"+a+"((?:'?$)|(?:'?"+mi.wordbreak()+"+))";return Nn(a,function(a){return 1<a.length?a[1].length:0},function(a){return 2<a.length?a[2].length:0},h.none())}},Mp=function(a){return a.replace(/[-\[\]{}()*+?.,\\\^$|#\s]/g,"\\$&")},Np={sanitise:Mp,word:function(a){a=Mp(a);return Tk.word(a)},
token:function(a){a=Mp(a);return Tk.token(a)}},cb={safeword:function(a){return Np.word(a)},safetoken:function(a){return Np.token(a)},custom:function(a,b,c,d){return Nn(a,b,c,d)},unsafeword:function(a){return Tk.word(a)},unsafetoken:function(a){return Tk.token(a)},sanitise:function(a){return Np.sanitise(a)},chars:function(){return mi.chars()},wordbreak:function(){return mi.wordbreak()},wordchar:function(){return mi.wordchar()}},bz=function(a,b){return az(a,b,{validate:Q.isFunction,label:"function"})},
az=function(a,b,c){if(0===b.length)throw Error("You must specify at least one required field.");yd.validateStrArr("required",b);yd.checkDupes(b);return function(d){var e=W.keys(d);k.forall(b,function(a){return k.contains(e,a)})||yd.reqMessage(b,e);a(b,e);var g=k.filter(b,function(a){return!c.validate(d[a],a)});0<g.length&&yd.invalidTypeMessage(g,c.label);return d}},cz=f.noop,Eb={exactly:f.curry(bz,function(a,b){var c=k.filter(b,function(b){return!k.contains(a,b)});0<c.length&&yd.unsuppMessage(c)}),
ensure:f.curry(bz,cz),ensureWith:f.curry(az,cz)},KX=Eb.ensure(["elements","cursor","dictation","notify"]),LX=Eb.ensure(["elements","cursor","dictation","range","notify"]),cd={species:KX,applicator:LX},Ld={fromHtml:function(a,b){var c=(b||document).createElement("div");c.innerHTML=a;return y.children(q.fromDom(c))},fromTags:function(a,b){return k.map(a,function(a){return q.fromTag(a,b)})},fromText:function(a,b){return k.map(a,function(a){return q.fromText(a,b)})},fromDom:function(a){return k.map(a,
q.fromDom)}},Au={addSimpleMacro:function(a,b,c,d){lb(arguments,[V.object("polish"),V.string("startString"),V.string("endString"),V.func("callback")]);var e=xu(b,c,d);return a.macros().customMacros().add(e)},removeMacro:function(a,b){a.macros().customMacros().remove(b)}},dz=["error","info","warning"],gO={message:function(a,b,c,d){if(!k.contains(dz,b))throw'Message level: "'+b+'" is not supported. Supported levels are: ['+dz.join(", ")+"].";lb(arguments,[V.object("polish"),V.string("level"),V.number("timeout"),
V.string("msg")]);var e=a.ui().showMessage(b,c,d);return{hide:function(){e()}}}},MX=f.constant("pencil"),NX=f.constant("code"),OX=f.constant("spin"),PX=f.constant("none"),yb={pencil:MX,code:NX,wait:OX,none:PX},zu={get:function(a){return a.getMode()===yb.pencil()?"design":"code"},set:function(a,b){lb(arguments,[V.object("polish"),V.string("mode")]);var c=b.toLowerCase();if("code"!==c&&"design"!==c)throw Error('Editor mode "'+b+'" not supported. Must be either design or code.');a.setMode("design"===
c?yb.pencil():yb.code())}},eO="body p div article aside figcaption figure footer header nav section ol ul li table thead tbody tfoot caption tr td th h1 h2 h3 h4 h5 h6 blockquote pre address".split(" "),Op=function(a,b){var c=[];k.each(y.children(a),function(a){b(a)&&(c=c.concat([a]));c=c.concat(Op(a,b))});return c},lc={all:function(a){return Op(ca.body(),a)},ancestors:function(a,b,c){return k.filter(y.parents(a,c),b)},siblings:function(a,b){return k.filter(y.siblings(a),b)},children:function(a,b){return k.filter(y.children(a),
b)},descendants:Op},X={all:function(a){return qa.all(a)},ancestors:function(a,b,c){return lc.ancestors(a,function(a){return qa.is(a,b)},c)},siblings:function(a,b){return lc.siblings(a,function(a){return qa.is(a,b)})},children:function(a,b){return lc.children(a,function(a){return qa.is(a,b)})},descendants:function(a,b){return qa.all(b,a)}},ez=function(a,b,c){return sa.ancestor(a,function(a){return qa.is(a,b)},c)},I={first:function(a){return qa.one(a)},ancestor:ez,sibling:function(a,b){return sa.sibling(a,
function(a){return qa.is(a,b)})},child:function(a,b){return sa.child(a,function(a){return qa.is(a,b)})},descendant:function(a,b){return qa.one(b,a)},closest:function(a,b,c){return uu(qa.is,ez,a,b,c)}},Pp=yu(A.isText,"text"),Fa={get:function(a){return Pp.get(a)},getOption:function(a){return Pp.getOption(a)},set:function(a,b){Pp.set(a,b)}},QX=C.immutable("element","offset"),RX=C.immutable("element","deltaOffset"),SX=C.immutable("element","start","finish"),TX=C.immutable("begin","end"),UX=C.immutable("element",
"text"),S={point:QX,delta:RX,range:SX,points:TX,text:UX},Uk=f.constant(!1),VX=f.constant(!0),Qp=function(a){return{isBoundary:function(){return a(VX,Uk,Uk)},fold:a,toText:function(){return a(h.none,h.none,function(a,c){return h.some(a)})},is:function(b){return a(Uk,Uk,function(a,d){return d.eq(a,b)})},len:function(){return a(f.constant(0),f.constant(1),function(a,c){return c.property().getText(a).length})}}},Vk={text:function(a,b){return Qp(function(c,d,e){return e(a,b)})},boundary:function(a,b){return Qp(function(c,
d,e){return c(a,b)})},empty:function(a,b){return Qp(function(c,d,e){return d(a,b)})},cata:function(a,b,c,d){return a.fold(b,c,d)}},WX={boundAt:function(a,b,c,d){b=k.findIndex(a,f.curry(d,b)).getOr(0);c=k.findIndex(a,f.curry(d,c)).map(function(a){return a+1}).getOr(a.length);return a.slice(b,c)}},XX={sliceby:function(a,b){var c=k.findIndex(a,b).getOr(-1);return a.slice(0,c)}},Rp=la.generate([{include:["item"]},{excludeWith:["item"]},{excludeWithout:["item"]}]),vg={include:Rp.include,excludeWith:Rp.excludeWith,
excludeWithout:Rp.excludeWithout,cata:function(a,b,c,d){return a.fold(b,c,d)}},fz=function(a,b){var c=[],d=[];k.each(a,function(a){var g=b(a);vg.cata(g,function(){d.push(a)},function(){0<d.length&&c.push(d);c.push([a]);d=[]},function(){0<d.length&&c.push(d);d=[]})});0<d.length&&c.push(d);return c},gz={splitby:function(a,b){return fz(a,function(a){return b(a)?vg.excludeWithout(a):vg.include(a)})},splitbyAdv:fz},hz={splitby:function(a,b){return gz.splitby(a,b)},splitbyAdv:function(a,b){return gz.splitbyAdv(a,
b)},sliceby:function(a,b){return XX.sliceby(a,b)},boundAt:function(a,b,c,d){return WX.boundAt(a,b,c,d)}},Wk={count:function(a){return k.foldr(a,function(a,c){return c.len()+a},0)},dropUntil:function(a,b){return hz.sliceby(a,function(a){return a.is(b)})},gen:function(a,b){return a.fold(h.none,function(a){return h.some(S.range(a,b,b+1))},function(c){return h.some(S.range(c,b,b+a.len()))})},justText:function(a){return k.bind(a,function(a){return a.fold(f.constant([]),f.constant([]),function(a){return[a]})})}},
Xk=function(a,b,c){if(a.property().isText(b))return[Vk.text(b,a)];if(a.property().isEmptyTag(b))return[Vk.empty(b,a)];if(a.property().isElement(b)){var d=a.property().children(b),e=a.property().isBoundary(b)?[Vk.boundary(b,a)]:[];b=void 0!==c&&c(b)?[]:k.bind(d,function(b){return Xk(a,b,c)});return e.concat(b).concat(e)}return[]},iz=function(a,b,c,d,e){a=Xk(a,d,e);b=Wk.dropUntil(a,b);b=Wk.count(b);return S.point(d,b+c)},wg={typed:Xk,items:function(a,b,c){a=Xk(a,b,c);var d=function(a,b){return a};return k.map(a,
function(a){return a.fold(d,d,d)})},extractTo:function(a,b,c,d,e){return a.up().predicate(b,d).fold(function(){return S.point(b,c)},function(d){return iz(a,b,c,d,e)})},extract:function(a,b,c,d){return a.property().parent(b).fold(function(){return S.point(b,c)},function(e){return iz(a,b,c,e,d)})}},YX=function(a,b){return"img"===b.property().name(a)?" ":"\n"},ZX={from:function(a,b,c){b=wg.typed(a,b,c);return k.map(b,function(b){return b.fold(f.constant("\n"),YX,a.property().getText)}).join("")}},$X=
{make:function(a,b,c){return k.foldl(a,function(a,c){return b(c,a.len).fold(f.constant(a),function(b){return{len:b.finish(),list:a.list.concat([b])}})},{len:void 0!==c?c:0,list:[]}).list}},jz=function(a,b){return b>=a.start()&&b<=a.finish()},kz=function(a,b){return k.findIndex(a,function(a){return a.start()===b})},aY=function(a,b){return a[a.length-1]&&a[a.length-1].finish()===b?a.length+1:-1},Yk={get:function(a,b){return k.find(a,function(a){return jz(a,b)})},find:function(a,b){return k.find(a,b)},
inUnit:jz,sublist:function(a,b,c){b=kz(a,b);var d=kz(a,c);return b.bind(function(b){var g=d.getOr(aY(a,c));return-1<g?h.some(a.slice(b,g)):h.none()}).getOr([])}},lz={translate:function(a,b){return k.map(a,function(a){return Z.merge(a,{start:f.constant(a.start()+b),finish:f.constant(a.finish()+b)})})}},bY=function(a,b,c){b=c(a,b);return lz.translate(b,a.start())},cY={splits:function(a,b,c){return 0===b.length?a:k.bind(a,function(a){var e=k.bind(b,function(b){return Yk.inUnit(a,b)?[b-a.start()]:[]});
return 0<e.length?bY(a,e,c):[a]})}},Wc={generate:function(a,b,c){return $X.make(a,b,c)},get:function(a,b){return Yk.get(a,b)},find:function(a,b){return Yk.find(a,b)},splits:function(a,b,c){return cY.splits(a,b,c)},translate:function(a,b){return lz.translate(a,b)},sublist:function(a,b,c){return Yk.sublist(a,b,c)}},dY={find:function(a,b,c,d){a=wg.typed(a,b,d);a=Wc.generate(a,Wk.gen);return Wc.get(a,c).map(function(a){return S.point(a.element(),c-a.start())})}},Qe={extract:function(a,b,c,d){return wg.extract(a,
b,c,d)},extractTo:function(a,b,c,d,e){return wg.extractTo(a,b,c,d,e)},all:function(a,b,c){return wg.items(a,b,c)},from:function(a,b,c){return wg.typed(a,b,c)},find:function(a,b,c,d){return dY.find(a,b,c,d)},toText:function(a,b,c){return ZX.from(a,b,c)}},xg=Sa(),sg={extract:function(a,b,c){return Qe.extract(xg,a,b,c)},extractTo:function(a,b,c,d){return Qe.extractTo(xg,a,b,c,d)},all:function(a,b){return Qe.all(xg,a,b)},from:function(a,b){return Qe.from(xg,a,b)},find:function(a,b,c){return Qe.find(xg,
a,b,c)},toText:function(a,b){return Qe.toText(xg,a,b)}},mz=function(a){var b=Object.create(null);W.each(a,function(a,d){b[d]=a});return b},eY=mz({img:!0,br:!0,hr:!0,input:!0}),fY=mz({script:!0,style:!0,noscript:!0}),gY=/[<>&\u00A0]/g,hY={"<":"&lt;",">":"&gt;","&":"&amp;","\u00a0":"&nbsp;"},iY=/["<>&]/g,jY={'"':"&quot;","<":"&lt;",">":"&gt;","&":"&amp;"},nz=function(a,b,c){return a.replace(b,function(a){return c[a]||a})},oz=function(a,b){for(var c="<"+a,d="",e=0;e<b.length;e++){var g=b[e];g.specified&&
"_moz_dirty"!==g.name&&(d+=" "+g.name+'="'+nz(g.value,iY,jY)+'"')}return c+d},qz=function(a){var b="";k.each(a,function(a){b+=pz(a)});return b},kY=function(a){var b="";k.each(a,function(a){b+=a.textContent});return b},pz=function(a){var b=a.nodeType;if(1===b){var b=a.nodeName.toLowerCase(),c=a.childNodes;a=a.attributes;0===c.length&&eY[b]?b=oz(b,a)+" />":(c=fY[b]?kY(c):qz(c),b=oz(b,a)+">"+c+"</"+b+">");return b}if(3===b)return nz(a.textContent,gY,hY);if(8==b)return"\x3c!--"+a.data+"--\x3e";throw"unsupported node type "+
a.nodeType;},Zk={writeNode:function(a){if(!Q.isObject(a))throw"sugarNode parameter must be an object";return pz(a.dom())},writeChildren:function(a){if(!Q.isObject(a))throw"sugarNode parameter must be an object";return qz(a.dom().childNodes)}},rz=function(a){var b=RegExp(Ua.zeroWidth(),"g");return a.replace(b,"")},bi={output:function(a,b){a.filterDom(a.output(),b);var c=Zk.writeChildren(b);return rz(c)},zeroWidth:rz},$k={toText:function(a){a=k.map(a,function(a){return sg.toText(a,f.constant(!1))}).join("");
return bi.zeroWidth(a.trim())},toHtml:function(a){a=k.map(a,Zk.writeNode).join("");return bi.zeroWidth(a)}},sz=function(a){return a.dom().innerHTML},ua={get:sz,set:function(a,b){var c=y.owner(a).dom(),d=q.fromDom(c.createDocumentFragment()),c=Ld.fromHtml(b,c);J.append(d,c);B.empty(a);v.append(a,d)},getOuter:function(a){var b=q.fromTag("div");a=q.fromDom(a.dom().cloneNode(!0));v.append(b,a);return sz(b)}},nb={get:function(a){return a.dom().textContent},set:function(a,b){a.dom().textContent=b}},tz=
function(a,b){return Fj.makeReadOnly({getAttributes:function(){return Fj.makeReadOnly(a.getFilteredAttributes(b))},setAttributes:function(c){lb(arguments,[V.object("attributes")]);W.each(c,function(a,b){if(!Q.isString(a))throw Error("attribute key "+b+" does not have a string value: "+a);});m.setAll(b,c);a.domChanged();a.undoChanged()},getText:function(){return $k.toText([b])},setText:function(a){lb(arguments,[V.string("text")]);nb.set(b,a)},getHtml:function(){return a.getFilteredContents(b)},setHtml:function(a){lb(arguments,
[V.string("html")]);ua.set(b,a)},replaceElement:function(c){lb(arguments,[V.string("html")]);var d=Ld.fromHtml(c);if(1!==d.length)throw Error("replacement html must be a single node");d=d[0];a.replaceElement(b,d);return tz(a,d)}})},On={getText:function(a){return a.content().getSelectedText().getOr("")},getHtml:function(a){return a.content().getSelectedHtml().getOr("")},findTagAtCursor:function(a,b){var c=a.content();return c.findTagAtCursor(b).map(function(a){return tz(c,a)}).getOr(null)}},uz={},
vz=function(a){return h.from(uz[a])},Pn={get:vz,register:function(a,b){return uz[a]=b},hookup:function(a,b){vz(b).fold(function(){console&&console.error&&console.error('textbox.io Could not find plugin "'+b+'". Have you declared it?')},function(b){a.events.loaded.addListener(function(){b.initialize(a)})})}},wz={attached:function(a,b){var c=b||q.fromDom(document.documentElement);return sa.ancestor(a,f.curry(L.eq,c)).isSome()},windowOf:function(a){var b=a.dom();return b===b.window?a:A.isDocument(a)?
b.defaultView||b.parentWindow:null}},Ba=function(a,b){return{left:f.constant(a),top:f.constant(b),translate:function(c,d){return Ba(a+c,b+d)}}},al=function(a,b){return void 0!==a?a:void 0!==b?b:0},xz=function(a){var b=a.dom(),c=b.ownerDocument,d=c.body,c=q.fromDom(c.documentElement);if(d===b)return Ba(d.offsetLeft,d.offsetTop);if(!wz.attached(a,c))return Ba(0,0);a=b.getBoundingClientRect();return Ba(a.left,a.top)},Ja={absolute:function(a){var b=a.dom().ownerDocument,c=b.body,d=wz.windowOf(q.fromDom(b)),
e=b.documentElement,b=al(d.pageYOffset,e.scrollTop),d=al(d.pageXOffset,e.scrollLeft),g=al(e.clientTop,c.clientTop),c=al(e.clientLeft,c.clientLeft);return xz(a).translate(d-c,b-g)},relative:function(a){a=a.dom();return Ba(a.offsetLeft,a.offsetTop)},viewport:xz},lY=Y.detect().browser.isSafari(),bl=function(a){a=void 0!==a?a.dom():document;return Ba(a.body.scrollLeft||a.documentElement.scrollLeft,a.body.scrollTop||a.documentElement.scrollTop)},cl=function(a,b,c){(void 0!==c?c.dom():document).defaultView.scrollTo(a,
b)},Sp=function(a,b){lY&&Q.isFunction(a.dom().scrollIntoViewIfNeeded)?a.dom().scrollIntoViewIfNeeded(!1):a.dom().scrollIntoView(b)},Ga={get:bl,to:cl,by:function(a,b,c){(void 0!==c?c.dom():document).defaultView.scrollBy(a,b)},preserve:function(a,b){var c=bl(a);b();var d=bl(a);c.top()===d.top()&&c.left()===d.left()||cl(c.left(),c.top(),a)},capture:function(a){var b=h.none(),c=function(){b=h.some(bl(a))};c();return{save:c,restore:function(){b.each(function(b){cl(b.left(),b.top(),a)})}}},intoView:Sp,
intoViewIfNeeded:function(a,b){var c=b.dom().getBoundingClientRect(),d=a.dom().getBoundingClientRect();d.top<c.top?Sp(a,!0):d.bottom>c.bottom&&Sp(a,!1)},setToElement:function(a,b){var c=Ja.absolute(b),d=q.fromDom(a.document);cl(c.left(),c.top(),d)},scrollBarWidth:function(){var a=q.fromHtml('<div style="width: 100px; height: 100px; overflow: scroll; position: absolute; top: -9999px;"></div>');v.after(ca.body(),a);var b=a.dom().offsetWidth-a.dom().clientWidth;B.remove(a);return b}},yz={withOptions:function(a,
b){return m.has(a,"tabindex")?Z.deepMerge(b,{content:{tabindex:m.get(a,"tabindex")}}):b}},zz=Y.detect(),mY=zz.browser.isIE()&&10===zz.browser.version.major,Tp=function(a,b){var c=t.getRaw(a,b).getOrThunk(function(){return t.get(a,b)});return mY&&"0px"===c?"auto":c},ni=function(a,b,c){a=Tp(a,b);return void 0===a?c:h.some(a)},nY=function(a){return{width:ni(a,"width",h.none()),"max-width":ni(a,"max-width",h.some("none")),"min-width":ni(a,"min-width",h.some("none")),"max-height":ni(a,"max-height",h.some("none")),
"min-height":ni(a,"min-height",h.some("1em"))}},dl=function(a,b,c){var d=t.getRaw(b,"display"),e=Tp(b,"height");t.set(b,"display","none");var g=Tp(b,"height"),l=nY(b);d.fold(function(){t.remove(b,"display")},function(a){t.set(b,"display",a)});!0===a?t.set(c,"height","auto"):(a="auto"===g?e:g,void 0!==a&&t.set(c,"height",a));W.each(l,function(a,b){a.each(function(a){t.set(c,b,a)})})},oY=f.curry(dl,!1),pY=f.curry(dl,!0),qY=function(a){dl(!1,a,a)},rY=function(a){dl(!0,a,a)},Az=function(a){return a.replace(/\./g,
"-")},jb={create:function(a){var b=Az(a);return{resolve:function(a){a=a.split(" ");return k.map(a,function(a){return b+"-"+a}).join(" ")}}},cssNamespace:Az,cssClass:function(a,b){return a+"-"+b}},Bz=jb.create("ephox-elder"),el={resolve:Bz.resolve,scrollable:f.curry(Bz.resolve,"scrollable")},Up=function(a,b){var c=m.get(a,b);return void 0===c||""===c?[]:c.split(" ")},Sd={read:Up,add:function(a,b,c){c=Up(a,b).concat([c]);m.set(a,b,c.join(" "))},remove:function(a,b,c){var d=k.filter(Up(a,b),function(a){return a!==
c});0<d.length?m.set(a,b,d.join(" ")):m.remove(a,b)}},Cz=function(a){return Sd.read(a,"class")},Dz=function(a,b){return Sd.add(a,"class",b)},Ez=function(a,b){return Sd.remove(a,"class",b)},rc={get:Cz,add:Dz,remove:Ez,toggle:function(a,b){k.contains(Cz(a),b)?Ez(a,b):Dz(a,b)},supports:function(a){return void 0!==a.dom().classList}},Fz=function(a,b){return rc.supports(a)&&a.dom().classList.contains(b)},n={add:function(a,b){rc.supports(a)?a.dom().classList.add(b):rc.add(a,b)},remove:function(a,b){rc.supports(a)?
a.dom().classList.remove(b):rc.remove(a,b);0===(rc.supports(a)?a.dom().classList:rc.get(a)).length&&m.remove(a,"class")},toggle:function(a,b){return rc.supports(a)?a.dom().classList.toggle(b):rc.toggle(a,b)},toggler:function(a,b){var c=rc.supports(a),d=a.dom().classList;return Qn(function(){c?d.remove(b):rc.remove(a,b)},function(){c?d.add(b):rc.add(a,b)},Fz(a,b))},has:Fz},ea={add:function(a,b){k.each(b,function(b){n.add(a,b)})},remove:function(a,b){k.each(b,function(b){n.remove(a,b)})},toggle:function(a,
b){k.each(b,function(b){n.toggle(a,b)})},hasAll:function(a,b){return k.forall(b,function(b){return n.has(a,b)})},hasAny:function(a,b){return k.exists(b,function(b){return n.has(a,b)})},get:function(a){if(rc.supports(a)){a=a.dom().classList;for(var b=Array(a.length),c=0;c<a.length;c++)b[c]=a.item(c);a=b}else a=rc.get(a);return a}},le={addClass:function(a){return function(b){n.add(b,a)}},removeClass:function(a){return function(b){n.remove(b,a)}},removeClasses:function(a){return function(b){ea.remove(b,
a)}},hasClass:function(a){return function(b){return n.has(b,a)}}},fl=h.none(),Gz=el.resolve("modal-scroll-lock"),Hz=function(a,b){k.each(b,function(b){a(b)})},sY=f.curry(Hz,le.addClass(Gz)),tY=f.curry(Hz,le.removeClass(Gz)),oc={adaptable:function(a,b){var c=null,d=null;return{cancel:function(){null!==c&&(clearTimeout(c),d=c=null)},throttle:function(){d=arguments;null===c&&(c=setTimeout(function(){a.apply(null,d);d=c=null},b))}}},first:function(a,b){var c=null;return{cancel:function(){null!==c&&(clearTimeout(c),
c=null)},throttle:function(){var d=arguments;null===c&&(c=setTimeout(function(){a.apply(null,d);d=c=null},b))}}},last:function(a,b){var c=null;return{cancel:function(){null!==c&&(clearTimeout(c),c=null)},throttle:function(){var d=arguments;null!==c&&clearTimeout(c);c=setTimeout(function(){a.apply(null,d);d=c=null},b)}}}},D={create:function(a){var b=W.map(a,function(a){return{bind:a.bind,unbind:a.unbind}});a=W.map(a,function(a){return a.trigger});return{registry:b,trigger:a}}},cc={register:function(a){n.add(a,
el.scrollable())},deregister:function(a){n.remove(a,el.scrollable())},scrollable:el.scrollable,preserve:Ga.preserve,capture:Ga.capture,block:function(){if(fl.isNone()){var a=Ga.get(),b=E.bind(q.fromDom(window),"scroll",function(b){b=Ga.get();b.left()===a.left()&&b.top()===a.top()||window.scrollTo(a.left(),a.top())});fl=h.some(b)}},unblock:function(){fl.each(function(a){a.unbind();fl=h.none()})},lock:sY,unlock:tY,event:function(a){var b=!1,c=D.create({started:r([]),stopped:r([])}),d=oc.last(function(){!0===
b&&(b=!1,c.trigger.stopped())},250),e=E.bind(a,"scroll",function(){!1===b&&c.trigger.started();b=!0;d.throttle()});return{events:c.registry,destroy:function(){e.unbind()},isScrolling:function(){return b}}}},ke={isEmpty:function(a){return null===a||void 0===a||""===a||Q.isArray(a)&&0===a.length}},gl=vu(),Vp={preload:function(){gl.preload()},addStylesheet:function(a,b){return gl.addStylesheet(a,b)},addScript:function(a,b){return gl.addScript(a,b)},waitForLoad:function(){return gl.waitForLoad()}},Iz=
function(){return{zh_hk:"zh_tw",iw:"he",no:"nb",nn:"nb",en:"en",ar:"ar",ca:"ca",cs:"cs",da:"da",de:"de",el:"el",es:"es",fa:"fa",fi:"fi",fr:"fr",he:"he",hr:"hr",hu:"hu",it:"it",ja:"ja",kk:"kk",ko:"ko",nl:"nl",nb:"nb",pl:"pl",pt:"pt",pt_pt:"pt_pt",ro:"ro",ru:"ru",sl:"sl",sk:"sk",sv:"sv",th:"th",tr:"tr",uk:"uk",zh:"zh",zh_tw:"zh_tw"}},Jz=function(a){a=a.toLowerCase().replace("-","_");var b=a.indexOf(";");a=-1<b?a.substring(0,b):a;a=aa.trim(a);b=a.indexOf("_");b=-1<b?a.substring(0,b):a;return{full:a,
languageCode:b}},Kz=function(a,b){var c=a.split(","),c=k.map(c,function(a){a=Jz(a);return b[a.full]||b[a.languageCode]||""});return k.find(c,function(a){return""!==a})},Wp={extract:Jz,determine:function(a){var b=Iz();return Kz(a,b)},determineFrom:Kz,localeList:Iz},$a={cat:function(a){for(var b=[],c=function(a){b.push(a)},d=0;d<a.length;d++)a[d].each(c);return b},findMap:function(a,b){for(var c=0;c<a.length;c++){var d=b(a[c],c);if(d.isSome())return d}return h.none()},liftN:function(a,b){for(var c=
[],d=0;d<a.length;d++){var e=a[d];if(e.isSome())c.push(e.getOrDie());else return h.none()}return h.some(b.apply(null,c))}},Lz=function(){var a=xd.resolve("navigator")||{};return a.userLanguage||a.language||"en"}(),Mz=h.none(),ce={determine:function(a){var b=void 0!==a?[a,Lz]:[Lz];return $a.findMap(b,Wp.determine).fold(function(){console.warn("WARNING: locales not supported: "+b.join(", "));return"en"},f.identity)},get:function(){return Mz.getOrDie("locale used before it has been set")},set:function(a){Mz=
h.from(a)}},uY={font:{arial:"Arial",courier:"Courier New",comicsans:"Comic Sans MS",consolas:"Consolas",georgia:"Georgia",impact:"Impact",tahoma:"Tahoma",timesnr:"Times New Roman",trebuchet:"Trebuchet MS",verdana:"Verdana"},error:{duplicate:{code:"That snippet code is already taken.",uuid:"That snippet uuid is already taken."},unknown:{uuid:"The snippet uuid cannot be found"},code:{duplicate:"That snippet code is already taken."}},cog:{login:"Log in",logout:"Log out","not-logged-in":"Not logged in",
user:"User: {0}"},banner:{"logged-in":"Logged in as: {0}"}},Nz={},Oz="",Xp={},Pz=function(a){return xd.resolve(a,Xp)||xd.resolve(a,Nz)||xd.resolve(a,uY)},Ff={loadEnglish:function(a){Nz=a},load:function(a,b){Oz=a;Xp=b;ce.set(a)},isLoaded:function(a){return Oz===a&&0<W.keys(Xp).length},get:function(a){var b=Pz(a);if(Q.isString(b))return b;throw Error("key "+a+" does not exist");},has:function(a){if(!Q.isString(a))throw a.fold?console.error("object details were",a.fold(f.identity,f.identity,f.identity)):
console.error("object key was",a),"key was an object";return Q.isString(Pz(a))}},Yp=h.none(),Zp={set:function(a){Yp.fold(function(){Yp=h.some(a)},function(b){b!==a&&console.error('Only one base URL supported per page. Requested value "'+a+'", already using "'+b+'"')})},get:function(){return Yp.getOrDie("Must begin loading with a base URL")}},vY={execute:function(a){if("complete"===document.readyState||"interactive"===document.readyState)a();else var b=E.bind(q.fromDom(document),"DOMContentLoaded",
function(){a();b.unbind()})}},hl=Bu("width",function(a){return a.dom().offsetWidth}),ra={set:function(a,b){hl.set(a,b)},get:function(a){return hl.get(a)},getOuter:function(a){return hl.getOuter(a)},setMax:function(a,b){var c=hl.max(a,b,"margin-left border-left-width padding-left padding-right border-right-width margin-right".split(" "));t.set(a,"max-width",c+"px")}},Qz=function(){var a=q.fromTag("div");n.add(a,"ephox-textbox-font");var b=q.fromTag("span");n.add(b,"ephox-chameleon-icon");v.append(a,
b);v.append(ca.body(),a);var c=ra.get(b),b=t.get(b,"font-family");B.remove(a);return 0<c&&void 0!==b&&aa.contains(b,"Textbox Icons")},wY=function(a){var b=0,c=setInterval(function(){b+=250;Qz()?(clearInterval(c),a(!0)):2E3<b&&(clearInterval(c),a(!1))},250)},xY={wait:xb.cached(function(){return Xd.nu(function(a){vY.execute(function(){Qz()?a(!0):wY(a)})})})},yY=function(a){xY.wait().get(function(b){a(b?H.value(!0):H.error("Stylesheet loaded, but did not contain Textbox.io styles"))})},Rz=function(a,
b){var c=a+"/i18n/tbio_"+b+".js?"+Ge.resourceParam();return Vp.addScript(c,function(a){return a.bind(function(a){return Ge.strictMatch(a.version,"Language strings").fold(function(){return H.value(a.strings())},H.error)})})},Sz=function(a){var b="/textboxio.css?"+Ge.fullParam();Vp.addStylesheet(a+b,yY)},ei={load:function(a){Zp.set(a);a=Zp.get();Sz(a+"/css");Rz(a,"en").get(function(a){a.each(Ff.loadEnglish)});return a},devLoad:Sz,setLanguage:function(a){var b=ce.determine(a);Ff.isLoaded(b)||(a=Zp.get(),
Rz(a,b).get(function(a){a.each(function(a){Ff.load(b,a)})}))},waitForLoad:function(){return Vp.waitForLoad()},getFailures:function(a){return k.bind(a,function(a){return a.fold(function(a){return[a]},f.constant([]))})}},P={span:function(a){a=q.fromTag("span",a);m.set(a,"role","presentation");return a},div:function(a){a=q.fromTag("div",a);m.set(a,"role","presentation");return a},tag:function(a,b){var c=q.fromTag(a,b);m.set(c,"role","presentation");return c}},w={resolve:jb.create("ephox-polish").resolve},
db={any:function(a){return I.first(a).isSome()},ancestor:function(a,b,c){return I.ancestor(a,b,c).isSome()},sibling:function(a,b){return I.sibling(a,b).isSome()},child:function(a,b){return I.child(a,b).isSome()},descendant:function(a,b){return I.descendant(a,b).isSome()},closest:function(a,b,c){return I.closest(a,b,c).isSome()}},$p=w.resolve("highcontrast-mode"),zY=function(a){var b=q.fromTag("div");n.add(b,w.resolve("highcontrast-detect"));v.append(a,b);t.reflow(b);(!0===("none"===t.get(b,"background-image")?
!0:!1)?n.add:n.remove)(a,$p);B.remove(b)},AY=function(a){var b=q.fromDom(document.documentElement);(!0===(m.has(b,"hc")&&m.has(b,"hcx"))?n.add:n.remove)(a,$p)},BY=f.noop,vh={detect:function(a){var b=Y.detect();b.os.isWindows()&&(b.browser.isIE()||b.browser.isEdge()||b.browser.isFirefox()?zY:b.browser.isChrome()?AY:BY)(a)},isHighContrast:function(a){return db.ancestor(a.uiContainer(),"."+$p)}},Gu=C.immutableBag(["width","docWidth","height","docHeight"],[]),Tz=la.generate([{unchanged:["html"]},{changed:["html"]}]),
we={unchanged:Tz.unchanged,changed:Tz.changed,cata:function(a,b,c){return a.fold(b,c)}},Uz=function(){return{validate:function(a,b){return Q.isFunction(a)||"events"===b&&Q.isObject(a)},label:"Function (or events)"}}(),Vz="activateInline communication connect content deactivateInline element events filter focus getContent getMode insertHtmlAtCursor isDirty isPrettyPrinting keyboard macros operations setContent setDirty smartview state ui undo".split(" "),CY=Eb.ensureWith(Vz.concat([]),Uz),DY=Eb.ensureWith(Vz.concat("blur destroy fromTransfer fullscreen uploader toTransfer viewport".split(" ")),
Uz),uh={external:CY,internal:DY},EY={create:function(){var a=!1;return{isBlocked:function(){return a},block:function(){a=!0},unblock:function(){a=!1}}}},FY={create:function(a,b){return{control:a,instance:b}}},Lc={tap:function(a){var b=EY.create();return FY.create(b,function(){b.isBlocked()||a.apply(null,arguments)})}},Wz=0,Ma={generate:function(a){var b=(new Date).getTime(),c=Math.floor(1E9*Math.random());Wz++;return a+"_"+c+Wz+String(b)}},Xz={isFunctionOrEvents:function(a){var b=function(b){return!0===
k.forall(a,function(a){return void 0!==b[a]&&void 0!==b[a].bind&&Q.isFunction(b[a].bind)})?!0:!1};return{validate:function(a,d){return Q.isFunction(a)||"events"===d&&Q.isObject(a)&&b(a)},label:"Function (or events)"}}},Sn=Eb.ensureWith("events init ui check scanView situation hasDropdown hasAutocorrect handle assign lock destroy state lookup name".split(" "),Xz.isFunctionOrEvents(["analytics"])),kf={noSituation:function(){return{primary:f.constant([]),secondary:f.constant([]),submenus:f.constant({})}},
basic:function(){return{destroy:f.noop,ui:h.none,state:f.constant({}),events:Kc(["analytics"])}}},Yz=function(a,b){var c={};W.each(a,function(a,b){var d=b.split(".");if(1>=d.length)c[b]={finalvalue:a};else{var f=c;xd.namespace(b,c);for(var h=0;h<d.length-1;h++)f=f[d[h]];f[d[d.length-1]]={finalvalue:a}}});var d=function(a){var c={},l=W.keys(a);k.each(l,function(l){c[l]=void 0!==a[l].finalvalue?b(a[l].finalvalue):f.constant(d(a[l]))});return c};return d(c)},Za={ui:function(a,b){var c=Yz(a,void 0!==
b?b:f.constant);return f.constant(h.some(c))},actions:function(a){a=Yz(a,f.identity);return f.constant(a)}},Aa={basic:kf.basic,draganddrop:function(){return{events:Kc(["insertAssets","insertHtml"]),destroy:f.noop}},communication:function(){return{headers:f.constant({}),destroy:f.noop}},fullscreen:function(){return{ui:h.none,actions:Za.actions({maximize:f.noop,restore:f.noop}),select:f.noop,deselect:f.noop,destroy:f.noop,events:Kc(["analytics","maximize","restore"])}},dialog:function(){return{destroy:f.noop,
ui:h.none,events:Kc(["analytics"]),actions:Za.actions({show:f.noop})}},spelling:function(){return kO()},editorcontext:function(){return{events:Kc(["blockChanged","enterDown","enterUp"]),destroy:f.noop}},highlighter:function(){return{destroy:f.noop,run:f.noop}},linkvalidator:function(){return{destroy:f.noop,refresh:f.noop,ignore:f.noop,state:f.constant({ignore:[],cache:{}})}},macros:function(){return{events:Kc(["analytics"]),state:f.constant({}),customMacros:f.constant(Rn({})),destroy:f.noop}},table:function(){return{ui:h.none,
state:f.constant({}),events:Kc(["analytics"]),situation:kf.noSituation,handle:f.noop,assign:f.noop,destroy:f.noop,name:f.constant("table-disabled")}},image:function(){return{events:Kc(["changed","contextmenu"]),situation:kf.noSituation,handle:f.noop,assign:f.noop,destroy:f.noop,name:f.constant("image-disabled")}},imageEdit:function(){var a=function(a,b){return va.pure(k.map(b,f.compose(H.value,a)))},b=f.curry(a,f.identity),a=f.curry(a,function(a){return a.asset()});return{situation:kf.noSituation,
handle:f.noop,assign:f.noop,ui:h.none,destroy:f.noop,insertResample:f.constant({assets:b,correlated:a,destroy:f.noop}),name:f.constant("imageEdit-disabled")}},mobile:function(){return{ui:h.none,events:Kc(["fullscreen"]),destroy:f.noop}},noAnalytics:function(){return{log:f.noop,register:f.noop}},state:function(a){var b=Cu(a.laundry),c=Du(a.filters,f.noop,f.noop),d=Rn(a.macros.customs);return{filter:f.constant({customFilters:f.constant(c)}),macros:f.constant({customMacros:f.constant(d)}),laundry:b,
getState:function(e){return Z.merge(a,void 0===e?{}:e,{laundry:b.state(),filters:c.state(),macros:{customs:d.state()}})}}},uploader:function(){var a=D.create({reconstitute:r([]),uploadAssets:r(["assets"])});return{destroy:f.noop,events:a.registry,reconstitute:f.noop,uploadAssets:f.noop}},undo:function(){return{reset:f.noop,disable:f.apply,save:f.noop}}},Mc={activateInline:f.noop,deactivateInline:f.noop,communication:Aa.communication,events:function(){return D.create({loaded:r([]),focus:r([]),dirty:r([]),
change:r([]),internal:r(["command","data"]),paint:r([])}).registry},keyboard:f.die("the keyboard feature is not implemented in this mode"),operations:f.die("the operations feature is not implemented in this mode"),smartview:f.die("the smartview feature is not implemented in this mode"),ui:f.die("the ui feature is not implemented in this mode")},il=Bu("height",function(a){return ca.inBody(a)?a.dom().getBoundingClientRect().height:a.dom().offsetHeight}),ha={set:function(a,b){il.set(a,b)},get:function(a){return il.get(a)},
getOuter:function(a){return il.getOuter(a)},setMax:function(a,b){var c=il.max(a,b,"margin-top border-top-width padding-top padding-bottom border-bottom-width margin-bottom".split(" "));t.set(a,"max-height",c+"px")}},GY="undo insert style emphasis align listindent format tools".split(" "),Re=C.immutable("x","y","width","height"),HY={intersect:function(a,b){var c=Math.max(a.x(),b.x()),d=Math.max(a.y(),b.y()),e=Math.min(a.x()+a.width(),b.x()+b.width()),e=Math.max(0,e-c),g=Math.min(a.y()+a.height(),b.y()+
b.height()),g=Math.max(0,g-d);return Re(c,d,e,g)}},zd=la.generate([{unbundled:[]},{unsupported:["message"]},{item:["info","blueprint"]},{customMenu:["info","groups","blueprint"]},{textboxMenu:["info","blueprint"]},{palette:["info","children","blueprint"]}]),Zz={create:function(a){var b=function(a,b){return a.feature.fold(function(){return void 0!==a.unsupported?[zd.unsupported(a.unsupported)]:[zd.unbundled()]},function(c){if(void 0===c[a.command])return console.warn("unknown command: "+a.command),
[];c=c[a.command]();return[b(c)]})},c=function(a,c){return b(c,function(b){return k.contains(["widget","inline-widget","split-widget"],c.type)?zd.item({instance:b.widget},a[c.type]):zd.item(b[c.type](),a[c.type])})},d={dropdown:c,general:c,widget:c,"split-widget":c,"inline-widget":c,palette:function(a,c){return b(c,function(b){b=b.palette();var c=k.map(b.items,function(b){return k.contains(["widget","inline-widget","split-widget"],b.type)?zd.item({instance:b.build},a[b.type]):k.contains(["dropdown"],
b.type)?zd.item(b.build(),a[b.type]):zd.item(b.spec,a[b.type])});return zd.palette(b,c,a.palette)})},submenu:function(b,c){var d=k.map(c.commands,a);return[zd.customMenu(c,d,b.menu)]},menu:function(a,c){return b(c,function(b){return zd.textboxMenu(b[c.type](),a[c.type])})}};return{classify:function(a,b){var c=d[b.type];return void 0!==c?c(a,b):[]}}},cata:function(a,b,c,d,e,g,l){return a.fold(b,c,d,e,g,l)}},IY={fromConfig:function(a,b,c){var d=function(a,b){var c=f.curry(e.classify,a),c=k.bind(b.items,
c);return{category:b.category,books:c}};a=f.curry(d,a);b=f.curry(d,b);var e=Zz.create(b);return k.map(c,a)}},ia={resolve:jb.create("ephox-chameleon").resolve},wh={show:function(a){t.remove(a,"display")},hide:function(a){t.set(a,"display","none")},isShowing:function(a){return t.getRaw(a,"display").isNone()},isHiding:function(a){return t.getRaw(a,"display").is("none")}},Hu={group:Eb.ensure(["component","isVisible","refreshUi","destroy"])},$n={menu:function(a,b){var c=D.create({done:r([]),abort:r(["item"])}),
d=function(a){a.done.bind(function(){c.trigger.done()});a.abort.bind(function(a){c.trigger.abort(a.item())});return Z.merge(a,{done:c.registry.done,abort:c.registry.abort})},e=k.foldr(b,function(a,b){var c=Z.merge(b.structure(),a.structures),e=b.submenus().concat(a.submenus),f=Z.merge(b.handlers(),a.actions),h=[b.refreshMenu].concat(a.refreshMenu),k=[b.destroyer].concat(a.destroyers),m=d(b.events);return{structures:c,submenus:e,refreshMenu:h,actions:f,destroyers:k,events:m}},{structures:{},submenus:[],
actions:{},refreshMenu:[],destroyers:[],events:{}});return{structure:f.constant(e.structures),init:function(a){k.each(e.refreshMenu,f.apply)},name:f.constant(a),handlers:f.constant(e.actions),submenus:f.constant(e.submenus),events:e.events,destroy:function(){k.each(e.destroyers,f.apply)}}},toolbar:function(a){a=lO(a);var b=D.create({escaped:r([]),executed:r([])});return Hu.group({component:a.component,isVisible:a.isVisible,refreshUi:a.refreshUi,destroy:a.destroy,events:b.registry})}},$z=function(a,
b){n.add(a,ia.resolve("user-icon"));t.setAll(a,{"background-image":"url("+b+")"})},jl={setUrl:$z,findAndSetUrl:function(a,b){I.descendant(a,".ephox-pastry-icon-content").each(function(a){$z(a,b)})}},kl=function(a,b){m.set(a,"aria-pressed",b?"true":"false")},ga={expanded:function(a){m.set(a,"aria-expanded","true")},collapsed:function(a){m.set(a,"aria-expanded","false")},checked:function(a,b){m.set(a,"aria-checked",String(b))},setPressed:kl,press:function(a){kl(a,!0)},release:function(a){kl(a,!1)},
pressed:function(a){kl(a.element(),a.selected())},enable:function(a){m.set(a,"aria-disabled","false")},disable:function(a){m.set(a,"aria-disabled","true")},tabSelected:function(a,b){m.setAll(a,{"aria-selected":"true","aria-pressed":"true"});k.each(b,function(a){m.setAll(a,{"aria-selected":"false","aria-pressed":"false"})})},showPanel:function(a){m.set(a,"aria-selected","true");m.set(a,"aria-hidden","false")},hidePanel:function(a){m.set(a,"aria-selected","false");m.set(a,"aria-hidden","true")}},JY=
function(a){a.enable();ga.enable(a.element())},KY=function(a){a.disable();ga.disable(a.element())},Xn={control:function(a){return{enable:f.curry(JY,a),disable:f.curry(KY,a)}},ariaPressed:function(a){return{press:f.curry(ga.press,a.element()),release:f.curry(ga.release,a.element())}}},ll={css:function(a){var b=a.replace(/\./g,"-");return{resolve:function(a){return b+"-"+a}}}},oi={resolve:ll.css("ephox-echo").resolve},LY=oi.resolve("aria-help"),MY=oi.resolve("aria-help-visible"),ml=function(a){m.set(a,
"role","presentation")},aA=function(a,b){m.setAll(a,{role:"application","aria-label":b})},bA=function(a){m.set(a,"role","button")},aq=function(a,b){m.set(a,"aria-owns",b)},cA=function(a,b){m.set(a,"aria-controls",b)},dA=function(a,b){var c=Ma.generate("ephox-aria");m.set(b,"id",c);cA(a,c)},eA=function(a,b){m.set(a,"aria-describedby",b)},fA=function(a,b){m.set(a,"aria-labelledby",b)},nl=function(a,b){m.set(a,"aria-label",b)},O={document:function(a){m.set(a,"role","document")},presentation:ml,region:function(a){m.set(a,
"role","region")},controls:cA,owns:aq,disown:function(a){m.remove(a,"aria-owns")},editor:function(a,b,c,d,e){aA(a,c);d.each(function(c){var d=q.fromTag("span");ml(d);v.append(d,q.fromText(c));c=Ma.generate("ephox-aria");m.set(d,"id",c);eA(b,c);n.add(d,LY);!0===e&&n.add(d,MY);v.append(a,d)});return{destroy:function(){m.remove(b,"aria-describedby")}}},inline:function(a,b,c,d,e){aA(a,c);var g=[];m.has(b,"id")?aq(a,m.get(b,"id")):(c=Ma.generate("ephox-aria-content"),m.set(b,"id",c),aq(a,c),g.push(function(){m.remove(b,
"id")}));d.each(function(a){if(m.has(b,"aria-label")){var c=m.get(b,"aria-label");nl(b,a);g.push(function(){nl(b,c)})}else nl(b,a),g.push(function(){m.remove(b,"aria-label")})});return{destroy:function(){k.each(g,f.apply)}}},group:function(a){m.set(a,"role","group")},toolbar:function(a,b){m.setAll(a,{role:"group","aria-label":b})},toolbarGroup:function(a,b){m.set(a,"role","toolbar");null===b||void 0===b||""===b||Q.isArray(b)&&0===b.length||m.set(a,"aria-label",b)},toolbarButton:function(a,b,c,d){m.setAll(a,
{role:"button","aria-label":b,"aria-haspopup":""+c});d&&m.set(a,"aria-pressed","false");c&&m.set(a,"aria-expanded","false")},textButton:function(a,b){bA(a);ml(b)},menu:function(a,b){m.setAll(a,{"aria-label":b,role:"menu"})},menuItem:function(a,b,c){b=b.map(function(a){return{"aria-label":a}}).getOr({});m.setAll(a,Z.merge(b,{role:"menuitem","aria-haspopup":c.getOr(!1)}))},menuItemCheckbox:function(a){m.setAll(a,{role:"menuitemcheckbox","aria-checked":!1})},checkbox:function(a,b){m.setAll(a,{role:"checkbox",
"aria-label":b,"aria-checked":!1})},dialog:function(a,b){m.setAll(a,{role:"dialog","aria-label":b})},buttonRole:bA,button:function(a,b){m.setAll(a,{"aria-label":b,role:"button"})},labelledField:function(a,b,c){var d=q.fromTag("div");ml(d);b+=Ma.generate("");var e=Ma.generate("label");c=q.fromHtml("<label>"+c+"</label>");m.set(c,"for",b);m.set(c,"id",e);m.set(a,"id",b);fA(a,e);J.append(d,[c,a]);return{element:f.constant(d),field:f.constant(a)}},multiline:function(a){m.set(a,"aria-multiline","true")},
textarea:function(a){m.setAll(a,{"aria-multiline":"true",role:"textbox"})},label:nl,widget:function(a){m.set(a,"role","widget")},option:function(a){m.set(a,"role","option")},listBox:function(a){m.set(a,"role","listbox")},live:function(a,b,c){m.setAll(a,{"aria-live":c?c:"polite",id:b})},tabList:function(a){m.set(a,"role","tablist")},tabButton:function(a,b){m.setAll(a,{"aria-label":b,role:"tab"})},tabPanel:function(a){m.setAll(a,{role:"tabpanel"})},linkElements:dA,linkTabToPanel:function(a,b){dA(a,
b)},describedBy:eA,labelledBy:fA,required:function(a){m.set(a,"aria-required","true")},hidden:function(a,b){b?m.set(a,"aria-hidden",b):m.remove(a,"aria-hidden")},invalid:function(a,b){!0===b?m.set(a,"aria-invalid","true"):m.remove(a,"aria-invalid")}},mO={disable:function(a){m.set(a,"unselectable","on");t.setAll(a,{"-webkit-user-select":"none","user-select":"none","-ms-user-select":"none"});a.dom().style.setProperty("-moz-user-select","-moz-none");return E.bind(a,"onselectstart",function(){return!1})}},
Ta={resolve:jb.create("ephox-pastry").resolve},gA=function(a,b,c,d){O.toolbarButton(a.element(),b,c,d);b=Xn.control(a);c=Xn.ariaPressed(a);return{enable:b.enable,disable:b.disable,press:c.press,release:c.release,destroy:function(){a.destroy()}}},bq=function(a,b,c,d,e,g,l,f){l=h.from(l).fold(function(){return f(e)},function(a){return a(e,b)});g=h.from(g).getOr(!1);a=a(b);c=Nd([ia.resolve("icon"),ia.resolve(c)]);g=!0===g?[mc(f(e)).element()]:[];J.append(c.element(),g);a.content(c);a.events.click.bind(function(){d()});
m.set(a.element(),"title",l);a.initAria=gA;return a},hA=function(a,b){I.descendant(a,b).bind(function(a){O.hidden(a,"true")})},iA=function(a,b,c,d,e,g,l,f){a=bq(a,b,c,d,e,g,l,f);n.add(a.element(),ia.resolve("split-"+b));hA(a.element(),".ephox-pastry-dropbutton-arrow");hA(a.element(),".ephox-pastry-dropbutton-button");I.descendant(a.element(),".ephox-pastry-dropbutton-arrow .ephox-pastry-icon-content").bind(function(a){n.add(a,ia.resolve("icon"));n.add(a,ia.resolve("arrow-"+b))});return a},qf={aria:gA,
typical:function(a,b,c,d,e,g,l){return bq(Yb,a,b,c,d,e,g,l)},toggle:function(a,b,c,d,e,g,l){return bq(dd,a,b,c,d,e,g,l)},splitToggle:function(a,b,c,d,e,g,l){return iA(oO,a,b,c,d,e,g,l)},split:function(a,b,c,d,e,g,l){return iA(nO,a,b,c,d,e,g,l)}},md={resolve:jb.create("ephox-gopher").resolve},cq=Hj("item"),dq=md.resolve("disabled-item"),jA="data-"+md.resolve("item-value"),Rb={set:function(a,b){cq.set(a);m.set(a,jA,b)},get:function(a){return m.get(a,jA)},up:cq.up,all:cq.all,disable:function(a){n.add(a,
dq)},enable:function(a){n.remove(a,dq)},isEnabled:function(a){return!n.has(a,dq)}},pi=Hj("menu"),kA="data-"+md.resolve("menu-value"),ol=md.resolve("active-menu"),Nc={set:function(a,b){pi.set(a);m.set(a,kA,b)},active:function(a){return I.descendant(a,"."+ol)},inactive:function(a){a=pi.all(a);return k.filter(a,function(a){return!n.has(a,ol)})},activate:function(a,b){var c=pi.all(a);k.each(c,function(a){n.remove(a,ol)});n.add(b,ol)},up:pi.up,all:pi.all,submenu:function(a,b,c){c=Rb.get(c);return(b.hasOwnProperty(c)?
h.from(b[c]):h.none()).bind(function(b){return I.descendant(a,"["+kA+'="'+b+'"]')})}},NY=Hj("submenu"),OY=Hj("main-menu"),xe={main:f.constant(OY),submenu:f.constant(NY)},lA=function(a,b,c){Rb.set(c,b);m.set(c,"tabindex",-1);return c},nA=function(a,b,c){return mA(a,b,c,!1)},mA=function(a,b,c,d){var e=q.fromTag("li",a.dom()),g=P.span();n.add(g,md.resolve("item-text"));!0===d&&n.add(g,md.resolve("item-ellipsis"));v.append(g,q.fromText(c));v.append(e,g);lA(a,b,e);return e},oA=function(a){a=q.fromTag("li",
a.dom());n.add(a,md.resolve("separator"));return a},PY=function(a,b){return"-"!==b.value()?nA(a,b.value(),b.text()):oA(a)},pA=function(a,b,c){var d=q.fromTag("ol",a.dom());Nc.set(d,b);a=k.map(c,f.curry(PY,a));J.append(d,a);return d},qA=function(a,b){var c=q.fromTag("div",a.dom());Nc.set(c,b);return c},ab={item:nA,ellipsisItem:function(a,b,c){return mA(a,b,c,!0)},mainmenu:function(a,b,c){a=pA(a,b,c);xe.main().set(a);return a},submenu:function(a,b,c){a=pA(a,b,c);xe.submenu().set(a);return a},widget:qA,
widgetSubmenu:function(a,b){var c=qA(a,b);xe.submenu().set(c);return c},separator:oA,custom:lA,enableItem:Rb.enable,disableItem:Rb.disable},rA=function(a,b){if(void 0===a)throw Error("Cannot intersperse undefined");if(1>=a.length)return a;var c=[];c.push(a[0]);for(var d=1;d<a.length;d++)c.push(b()),c.push(a[d]);return c},sA={intersperse:function(a,b){return rA(a,function(){return b})},intersperseThunk:rA},QY={css:function(a){var b=/^[a-zA-Z]/.test(a)?"":"e";a=a.replace(/[^\w]/gi,"-");return b+a}},
RY={splits:function(a,b){if(0===b.length)return[a];var c=k.foldl(b,function(b,c){if(0===c)return b;var d=a.substring(b.prev,c);return{prev:c,values:b.values.concat([d])}},{prev:0,values:[]}),d=b[b.length-1];return d<a.length?c.values.concat(a.substring(d)):c.values}},pl={cssSanitise:function(a){return QY.css(a)},splits:function(a,b){return RY.splits(a,b)}},SY=function(a,b){var c=k.flatten(b);return $n.menu(a,c)},TY=function(a){return k.map(a,function(a){a=k.map(a,function(a){return a.items()});return k.flatten(a)})},
tA={create:function(a,b,c){var d=a.name,e=a.textkey,g=a.menuTextkey,l=a.tooltip,p=a.label,s=h.from(a.icon),z=f.constant(void 0!==a.contentFocus?a.contentFocus:!1),x=q.fromDom(document),m=Q.isString(e)?pl.cssSanitise(d):d,n=c(e),g=c(g),r=ab.mainmenu(x,m+"-menu",[]),t=qf.toggle(d,m,f.identity,e,p,l,c);s.filter(Q.isString).each(function(a){jl.findAndSetUrl(t.element(),a)});var u=t.initAria(t,n,!0,a.toggle);a=TY(b);var v=SY(m,b);b=sA.intersperseThunk(a,function(){return[ab.separator(x)]});O.menu(r,g);
J.append(r,k.flatten(b));return{button:f.constant(t),contentFocus:z,destroy:function(){t.destroy();v.destroy();u.destroy()},element:f.constant(r),events:v.events,handlers:v.handlers,icon:f.constant(s),init:v.init,label:f.constant(n),name:v.name,structure:v.structure,submenus:v.submenus,textkey:f.constant(e),menuTextkey:f.constant(g),updateMenu:f.noop,enable:u.enable,disable:u.disable}}},UY=function(a,b){return h.some(b(a))},VY=function(a,b){return h.some(b(a,[]))},uA=function(a,b){var c=f.curry(uA,
a);return Zz.cata(b,h.none,h.none,UY,function(b,e,g){e=k.map(e,function(a){return k.bind(a.books,c)});b=tA.create(b,e,a);return h.some(g(b,[]))},VY,function(a,b,g){b=k.bind(b,c);return h.some(g(a,b))}).toArray()},WY={build:function(a,b){return{items:k.bind(a.books,function(a){return uA(b,a)}),category:a.category}}},XY={build:function(a,b,c){var d=c.translations();a=IY.fromConfig(b.toolbar(),b.menu(),a);a=k.map(a,function(a){return WY.build(a,d)});return k.map(a,function(a){var b=$n.toolbar(a.items);
a=a.category;O.toolbarGroup(b.component(),d(a));return b})}},YY=C.immutable("toolbar","menu"),ZY=C.immutable("smartview","translations"),vA=function(a){return function(){return a.apply(null,arguments)}},wA={blueprints:vA(YY),env:vA(ZY)},xA=function(){return/(?:(?:[A-Za-z]{3,9}:(?:\/\/))(?:[-.~*+=!&;:'%@?^${}(),\w]+@)?[A-Za-z0-9-]+(?:\.[A-Za-z0-9-]+)*|(?:www\.|[-;:&=+$,.\w]+@)[A-Za-z0-9-]+(?:\.[A-Za-z0-9-]+)*)(?::[0-9]+)?(?:\/[-+~%.()\/\w]*)?(?:\?(?:[-.~*+=!&;:'%@?^${}(),\/\w]+))?(?:#(?:[-.~*+=!&;:'%@?^${}(),\/\w]+))?/g},
ql={tokens:function(a,b){return a.replace(/\{(\d+)\}/g,function(c,d,e,g){d=parseInt(d,10);if(void 0===b[d])throw"No value for token: "+c+" in translation: "+a;return b[d]})},link:xA,autolink:function(){var a=xA().source;return RegExp("("+a+")[-.~*+=!&;:'%@?#^${}(),]*","g")}},eq=la.generate([{raw:["text"]},{key:["key"]},{pkey:["key","params"]}]),fq=function(a){var b=Ff.get(a);if(1<arguments.length||/\{(\d+)\}/.test(b)){for(var c=Array(arguments.length-1),d=1;d<arguments.length;d++)c[d-1]=arguments[d];
return ql.tokens(b,c)}return b},u={get:function(a){if(Q.isString(a))throw"string passed to I18n.get:"+a;return a.fold(f.identity,fq,fq)},has:Ff.has,translate:fq,raw:eq.raw,key:function(a){Ff.get(a);return eq.key(a)},pkey:function(a,b){Ff.get(a);return eq.pkey(a,b)},cata:function(a,b,c,d){return a.fold(b,c,d)}},Ad={dropdown:Eb.exactly("enable disable select clear selectElement populate tick untick activate deactivate".split(" ")),menu:Eb.exactly(["enable","disable"]),general:Eb.exactly("enable disable select deselect selected element".split(" ")),
widget:Eb.exactly("enable disable select deselect press release".split(" ")),palette:Eb.exactly(["show","hide"])},Mj={generateItem:function(a,b,c,d){return c.fold(function(){return ab.item(a,b.value(),d(b.textkey()))},function(c){c=c(b);var d=q.fromTag("li",a.dom());v.append(d,c);return ab.custom(a,b.value(),d)})},generateSeparator:function(a,b,c){var d=ab.separator(a);v.append(d,q.fromText(c(b),a.dom()));return d}},$Y=function(a,b){var c=k.find(a,function(a){return a.value()===b});return h.from(c)},
yA=function(a){a=X.children(a,".ephox-pastry-toggle-list-item-selected");k.each(a,function(a){n.remove(a,"ephox-pastry-toggle-list-item-selected");ga.checked(a,!1)})},bg={updateDropdown:function(a,b,c,d,e){b.fold(a.clear,f.noop,function(b){e.fold(function(){(Q.isString(b)?$Y(d,b):h.some(b)).each(a.select)},function(c){c=c(b);var d=Ta.resolve("arrow-righticon");n.add(c,d);a.selectElement(c)})});c.fold(a.disable,f.noop,a.enable)},tick:function(a,b){yA(a);var c=X.descendants(a,".ephox-gopher-item");
k.find(c,function(a){return m.get(a,"data-ephox-gopher-item-value")===b}).each(function(a){n.add(a,"ephox-pastry-toggle-list-item-selected");ga.checked(a,!0)})},untick:yA,activate:function(a){n.add(a,"ephox-pastry-statebutton-selected")},deactivate:function(a){n.remove(a,"ephox-pastry-statebutton-selected")}},gq=Ta.resolve("toggle-list-item-selected"),aZ=function(a){ab.enableItem(a);ga.enable(a)},bZ=function(a){ab.disableItem(a);ga.disable(a)},cZ=function(a){n.remove(a,gq);ga.checked(a,!1)},dZ=function(a){n.add(a,
gq);ga.checked(a,!0)},$f={control:function(a){return{enable:f.curry(aZ,a),disable:f.curry(bZ,a)}},selected:function(a){return{deselect:f.curry(cZ,a),select:f.curry(dZ,a),selected:f.curry(n.has,a,gq)}}},zA=function(a){var b=P.span();O.hidden(b,!0);ea.add(b,["ephox-pastry-icon-content","ephox-chameleon-icon"].concat([a]));return[b]},eZ=function(a){var b=P.span();O.hidden(b,!0);ea.add(b,["ephox-pastry-icon-content","ephox-chameleon-"+a.value]);jl.setUrl(b,a.icon);return[b]},fZ=function(a){return zA(!0===
a.icon?"ephox-chameleon-"+a.value:a.icon)},yh={generate:zA,generateFrom:function(a){return void 0===a.icon?[]:(Q.isString(a.icon)?eZ:fZ)(a)}},gZ=Y.detect().browser.isFirefox(),hZ={position:"absolute",left:"-9999px"},AA=function(a,b){var c=q.fromTag("span",a.dom());O.presentation(c);var d=q.fromText(b,a.dom());v.append(c,d);return c},BA=function(a,b){var c=Ma.generate("ephox-echo-voice");m.set(b,"id",c);m.set(a,"aria-describedby",c)},CA=function(a,b,c){var d=y.owner(b),e=AA(d,c);gZ&&BA(b,e);m.setAll(e,
a(c));t.setAll(e,hZ);v.append(b,e);setTimeout(function(){m.remove(e,"aria-live");B.remove(e)},1E3)},iZ=f.curry(CA,function(a){return{"aria-live":"polite","aria-atomic":"true","aria-label":a}}),jZ=f.curry(CA,f.constant({"aria-live":"assertive","aria-atomic":"true",role:"alert"})),Oa={describe:function(a,b){var c=y.owner(a),c=AA(c,b);t.set(c,"display","none");O.hidden(c,!0);BA(a,c);return c},speak:iZ,shout:jZ,tokenSelector:function(){return'span[id^="ephox-echo-voice"]'}},qO=q.fromDom(document),Ju=
ia.resolve("label-default"),hq=q.fromDom(document),kZ="data-"+md.resolve("item-value"),lZ=function(a){a=ab.submenu(hq,a+"-menu",[]);n.remove(a,"ephox-gopher-main-menu");n.add(a,"ephox-gopher-submenu");return a},mZ=function(a,b){var c=m.get(b,"data-ephox-gopher-menu-value"),d={};d[a.name+"-menu-trigger"]=c;return d},nZ=function(a,b){var c=lZ(b.name);O.menu(c,a(b.textkey,!1));var d=mZ(b,c),e=pO(a,b),g=function(d){d=k.bind(d,function(c){var d=k.map(c.items(),function(c){c=Mj.generateItem(hq,c,b.render,
a);O.menuItemCheckbox(c);return c});return c.label().fold(f.constant(d),function(b){return[Mj.generateSeparator(hq,b,a)].concat(d)})});B.empty(c);J.append(c,d)},l=D.create({done:r([]),abort:r(["item"])}),p={};k.each(b.values,function(a){p[a.value()]=function(a){a=m.get(a,kZ);b.action(a);l.trigger.done()}});e.events.populate.bind(function(a){g(a.items())});return{items:f.constant([e.element()]),structure:f.constant(d),submenus:f.constant([c]),refreshMenu:function(){b.updateDropdown(Ad.dropdown({enable:e.enable,
disable:e.disable,select:e.select,clear:e.clear,selectElement:e.selectElement,populate:e.populate,tick:f.curry(bg.tick,c),untick:f.curry(bg.untick,c),activate:f.noop,deactivate:f.noop}))},destroyer:function(){e.destroy()},handlers:f.constant(p),events:l.registry}},oZ=q.fromDom(document),pZ=function(a,b){var c=a(b.textkey),d=(!0===b.hasDialog?ab.ellipsisItem:ab.item)(oZ,b.value,c),e=$f.control(d),g=!0===b.toggle?$f.selected(d):{select:f.noop,deselect:f.noop,selected:f.constant(!1)};!0===b.toggle?O.menuItemCheckbox(d):
O.menuItem(d,h.some(c),h.some(!1));var l=function(){b.updateGeneral(Ad.general({disable:e.disable,enable:e.enable,select:g.select,deselect:g.deselect,selected:g.selected,element:f.constant(d)}))},p=D.create({done:r([]),abort:r(["item"])}),c={};c[b.value]=function(){p.trigger.done();b.action();l()};var s=yh.generateFrom(b);J.prepend(d,s);return{items:f.constant([d]),structure:f.constant({}),submenus:f.constant([]),refreshMenu:l,handlers:f.constant(c),destroyer:f.identity,events:p.registry}},qZ=q.fromDom(document),
rZ=function(a){return{submenu:function(b){var c=b.textkey();b=b.element();O.menu(b,a(c));n.remove(b,"ephox-gopher-main-menu");n.add(b,"ephox-gopher-submenu");return b},item:function(b){var c=b.textkey(),c=a(c);b=ab.item(qZ,b.name()+"-menu-trigger",c);n.add(b,ia.resolve("menu-more"));O.menuItem(b,h.some(c),h.some(!0));return b}}},sZ=function(a,b,c){c=rZ(a);a=c.submenu(b);var d=m.get(a,"data-ephox-gopher-menu-value");c=c.item(b);var e={};e[b.name()+"-menu-trigger"]=d;var d=Z.merge(e,b.structure()),
g=yh.generate("ephox-chameleon-"+b.name());J.prepend(c,g);b.icon().each(function(a){0<g.length&&jl.setUrl(g[0],a)});var l=$f.control(c),e=void 0!==b.destroyer?b.destroyer:void 0!==b.destroy?b.destroy:f.noop;return{items:f.constant([c]),structure:f.constant(d),submenus:f.constant([a].concat(b.submenus())),refreshMenu:function(){b.updateMenu({enable:l.enable,disable:l.disable})},destroyer:e,handlers:b.handlers,events:b.events}},iq=q.fromDom(document),DA=ia.resolve("menu-widget"),tZ=function(a,b){var c=
ab.widgetSubmenu(iq,b);v.append(c,a.element());ea.add(a.element(),[DA,"ephox-gopher-item"]);return c},uZ=function(a,b,c){a=a(b.textkey());a=ab.item(iq,c,a);n.add(a,ia.resolve("menu-more"));c=yh.generate(ia.resolve(c));J.prepend(a,c);return a},EA=function(a,b){var c=b.instance(),d=c.name(),e=d+"-submenu",g=tZ(c,e),l=uZ(a,c,d);O.menu(g,a(c.menuTextkey()));O.menuItem(l,h.some(a(c.textkey())),h.some(!0));var p=$f.control(l),s={};s[d]=e;var k=D.create({done:K([],c.events.done),abort:r(["item"])});c.events.abort.bind(function(){k.trigger.abort(l)});
return{items:f.constant([l]),structure:f.constant(s),submenus:f.constant([g]),refreshMenu:function(){c.updateWidget(Ad.widget({enable:p.enable,disable:p.disable,select:f.noop,deselect:f.noop,press:f.noop,release:f.noop}))},destroyer:c.destroy,handlers:f.constant({}),events:k.registry}},Lj={widget:EA,inline:function(a,b){var c=b.instance(),d=c.name();n.add(c.element(),ia.resolve("menu-inline-widget"));var e=q.fromTag("li");v.append(e,c.element());var g=ab.custom(iq,d,e),l=$f.control(g);O.menuItem(g,
h.some(a(c.textkey())),h.some(!1));e={};e[d]=function(a){var b=T.active().filter(function(b){return Bc.ancestor(b,f.curry(L.eq,a))});c.element().dom().click();b.each(T.focus)};var p=D.create({done:K([],c.events.done),abort:r(["item"])});c.events.abort.bind(function(){p.trigger.abort(g)});return{items:f.constant([g]),structure:f.constant({}),submenus:f.constant([]),refreshMenu:function(){c.updateInlineWidget(Ad.widget({enable:l.enable,disable:l.disable,select:f.noop,deselect:f.noop,press:f.noop,release:f.noop}))},
destroyer:c.destroy,handlers:f.constant(e),events:p.registry}},split:EA,styles:f.constant(DA)},FA=ia.resolve("keyfocus"),GA=function(a,b){var c=P.span();t.set(c,"display","none");n.add(c,FA);v.append(a,c);return E.bind(c,"click",function(a){b();a.kill()})},ye={onButton:function(a){return GA(a.element(),a.click)},custom:GA,trigger:function(a){var b="."+FA;a=qa.is(a,b)?h.some(a):I.descendant(a,b);a.each(function(a){a.dom().click()});return a}},Bh={menu:C.immutableBag(["focusActive"],[])},yg=md.resolve("item-selected"),
jq=function(a,b){n.add(b,yg)},HA=function(a,b){n.remove(b,yg)},Oc={is:function(a){return n.has(a,yg)},none:function(a){var b=Rb.all(a);k.each(b,function(b){HA(a,b)})},selectAll:function(a,b){var c=Rb.all(a);k.each(c,function(a){n.remove(a,yg)});k.each(b,function(a){n.add(a,yg)})},select:jq,deselect:HA,selected:function(a){return I.descendant(a,"."+yg)},first:function(a){var b=Rb.all(a);return h.from(b[0]).map(function(b){jq(a,b);return b})},last:function(a){var b=Rb.all(a);return h.from(b[b.length-
1]).map(function(b){jq(a,b);return b})}},vZ=function(a,b){var c=Rb.all(a);return k.findIndex(c,function(a){return L.eq(b,a)}).map(function(a){return{index:f.constant(a),all:f.constant(c)}})},wZ=function(a,b){return 0===b?a.length-1:b-1},xZ=function(a,b){return b===a.length-1?0:b+1},IA=function(a,b,c){return vZ(a,b).map(function(d){var e=c(d.all(),d.index());d=d.all()[e];Oc.deselect(a,b);Oc.select(a,d);return d})},Vn={first:function(a){var b=Rb.all(a);return h.from(b[0]).map(function(b){Oc.select(a,
b);return b})},prev:function(a,b){return IA(a,b,wZ)},next:function(a,b){return IA(a,b,xZ)}},sb=function(a){return function(){return a}},N={BACKSPACE:sb([8]),TAB:sb([9]),ENTER:sb([13]),SHIFT:sb([16]),CTRL:sb([17]),ALT:sb([18]),CAPSLOCK:sb([20]),ESCAPE:sb([27]),SPACE:sb([32]),PAGEUP:sb([33]),PAGEDOWN:sb([34]),END:sb([35]),HOME:sb([36]),LEFT:sb([37]),UP:sb([38]),RIGHT:sb([39]),DOWN:sb([40]),INSERT:sb([45]),DEL:sb([46]),META:sb([91,93,224]),F10:sb([121])},Lu={isCommand:function(a,b){var c=[];k.each(b,
function(a){a="string"===typeof a?[a.toUpperCase().charCodeAt(0)]:a;c=c.concat(a)});var d=function(a){return 0<k.filter(c,function(b){return k.contains(N[a](),b)}).length};if(!!a.altKey!==d("ALT")||!!a.shiftKey!==d("SHIFT")||!!a.ctrlKey!==d("CTRL")||!!a.metaKey!==d("META"))return!1;var d=null!==a.charCode&&void 0!==a.charCode&&0!==a.charCode?String.fromCharCode(a.charCode).toUpperCase().charCodeAt(0):a.which,e=N.CTRL().concat(N.ALT()).concat(N.SHIFT()).concat(N.META()),g=k.filter(c,function(a){return!k.contains(e,
a)});return 1<g.length?!1:0===g.length&&void 0===a.which||g[0]===d}},Ku={stop:function(a){a.preventDefault();a.stopPropagation&&a.stopPropagation()}},yZ={BACKSPACE:N.BACKSPACE,TAB:N.TAB,ENTER:N.ENTER,CAPSLOCK:N.CAPSLOCK,ESCAPE:N.ESCAPE,SPACE:N.SPACE,PAGEUP:N.PAGEUP,PAGEDOWN:N.PAGEDOWN,END:N.END,HOME:N.HOME,LEFT:N.LEFT,UP:N.UP,DOWN:N.DOWN,RIGHT:N.RIGHT,INSERT:N.INSERT,DEL:N.DEL},nf={getSpecial:function(a){var b=null;W.each(yZ,function(c,d){k.contains(c(),a)&&(b=d)});return b},noModifiers:function(a){return!(a.metaKey||
a.altKey||a.ctrlKey)},isCharCode:function(a){return a.charCode===a.keyCode}},JA=function(a,b){return k.find(b,function(b){return Lu.isCommand(a,b)})},KA=function(a){return nf.isCharCode(a)?h.none():h.from(nf.getSpecial(a.keyCode))},tO={identify:function(a,b){return{fold:function(c,d,e){JA(a,b).fold(function(){KA(a).fold(function(){e(a.which&&String.fromCharCode(a.which))},function(a){d(N[a]())})},c)}}},shortcut:JA,special:KA},LA=function(a){return"rtl"===t.get(a,"direction")?"rtl":"ltr"},Od={onDirection:function(a,
b){return function(c){return"rtl"===LA(c)?b:a}},getDirection:LA},MA=function(a,b,c,d){var e=t.get(a,b);void 0===e&&(e="");c=e===c?d:c;e=f.curry(t.set,a,b,e);a=f.curry(t.set,a,b,c);return Qn(e,a,!1)},Sb={toggler:function(a){return MA(a,"visibility","hidden","visible")},displayToggler:function(a,b){return MA(a,"display","none",b)},isVisible:function(a){a=a.dom();return!(0>=a.offsetWidth&&0>=a.offsetHeight)}},rl=la.generate([{southeast:[]},{southwest:[]},{northeast:[]},{northwest:[]}]),Cc={southeast:rl.southeast,
southwest:rl.southwest,northeast:rl.northeast,northwest:rl.northwest,cata:function(a,b,c,d,e){return a.fold(b,c,d,e)}},NA=function(a,b){return a.view(b).fold(f.constant([]),function(b){var d=a.owner(b),d=NA(a,d);return[b].concat(d)})},zZ={pathTo:function(a,b){var c=b.owner(a),c=NA(b,c);return h.some(c)}},AZ={view:function(a){return(a.dom()===document?h.none():h.from(a.dom().defaultView.frameElement)).map(q.fromDom)},owner:function(a){return y.owner(a)}},qi={find:function(a){var b=q.fromDom(document),
c=Ga.get(b);return zZ.pathTo(a,AZ).fold(f.curry(Ja.absolute,a),function(b){var e=Ja.viewport(a);b=k.foldr(b,function(a,b){var c=Ja.viewport(b);return{left:a.left+c.left(),top:a.top+c.top()}},{left:0,top:0});return Ba(b.left+e.left()+c.left(),b.top+e.top()+c.top())})}},ne={absolute:function(a){var b=qi.find(a),c=ra.getOuter(a);a=ha.getOuter(a);return Re(b.left(),b.top(),c,a)},view:function(){return Re(0,0,window.innerWidth,window.innerHeight)}},OA=function(a,b,c){var d=Ba(b,c);b=function(){var a=Ga.get();
return d.translate(-a.left(),-a.top())};return a.fold(f.constant(d),b,b)},kq={toBox:function(a,b){var c=qi.find(b),c=OA(a,c.left(),c.top()),d=ra.getOuter(b),e=ha.getOuter(b);return Re(c.left(),c.top(),d,e)},viewport:function(a,b){return b.fold(function(){return a.fold(ne.view,ne.view,Re)},function(b){return a.fold(b,b,Re)})},translate:OA},BZ=C.immutableBag("x y width height maxHeight direction classes label candidateYforTest".split(" "),[]),CZ=C.immutable("position","left","top","right","bottom"),
Gf={decision:BZ,css:CZ},lq=la.generate([{none:[]},{relative:["x","y","width","height"]},{fixed:["x","y","width","height"]}]),PA=function(a,b,c,d,e,g){c=b.x()-c;d=b.y()-d;var l=b.width(),f=b.height();e-=c+l;g-=d+f;var s=h.some(c),k=h.some(d),x=h.some(e),m=h.some(g),n=h.none();return Cc.cata(b.direction(),function(){return Gf.css(a,s,k,n,n)},function(){return Gf.css(a,n,k,x,n)},function(){return Gf.css(a,s,n,n,m)},function(){return Gf.css(a,n,n,x,m)})},Bd={none:lq.none,relative:lq.relative,fixed:lq.fixed,
reposition:function(a,b){return a.fold(function(){return Gf.css("absolute",h.some(b.x()),h.some(b.y()),h.none(),h.none())},function(a,d,e,g){return PA("absolute",b,a,d,e,g)},function(a,d,e,g){return PA("fixed",b,a,d,e,g)})},viewport:function(a,b){return kq.viewport(a,b)},toBox:function(a,b){return kq.toBox(a,b)},translate:function(a,b,c){return kq.translate(a,b,c)},cata:function(a,b,c,d){return a.fold(b,c,d)}},QA=C.immutable("anchorBox","origin"),gg={box:function(a,b){return QA(a,b)},element:function(a,
b){var c=Bd.toBox(b,a);return QA(c,b)},relativeOrigin:function(a){a=a.dom().getBoundingClientRect();return Bd.relative(a.left,a.top,a.width,a.height)}},ri={resolve:jb.create("ephox-repartee").resolve},RA=ri.resolve("caret-top-align"),SA=ri.resolve("caret-bottom-align"),TA=ri.resolve("caret-right-align"),UA=ri.resolve("caret-left-align"),VA=ri.resolve("caret-middle-align"),tb={east:f.constant(UA),south:f.constant(RA),west:f.constant(TA),north:f.constant(SA),middle:f.constant(VA),all:f.constant([RA,
SA,UA,TA,VA])},Cd=C.immutable("x","y","bubble","direction","anchors","label"),WA=function(a,b){return a.x()+a.width()-b.width()/2},XA=function(a,b){return a.x()+a.width()-b.width()},mq=function(a,b){return a.y()-b.height()},nq=function(a){return a.y()+a.height()},oq=function(a,b,c){return Cd(a.x(),nq(a),c.southeast(),Cc.southeast(),[tb.south(),tb.east()],"layout-se")},pq=function(a,b,c){return Cd(XA(a,b),nq(a),c.southwest(),Cc.southwest(),[tb.south(),tb.west()],"layout-sw")},qq=function(a,b,c){return Cd(a.x(),
mq(a,b),c.northeast(),Cc.northeast(),[tb.north(),tb.east()],"layout-ne")},rq=function(a,b,c){return Cd(XA(a,b),mq(a,b),c.northwest(),Cc.northwest(),[tb.north(),tb.west()],"layout-nw")},sq=function(a,b,c){return Cd(WA(a,b),mq(a,b),c.northeast(),Cc.northeast(),[tb.north(),tb.middle()],"layout-nm")},tq=function(a,b,c){return Cd(WA(a,b),nq(a),c.southeast(),Cc.southeast(),[tb.south(),tb.middle()],"layout-sm")},mg={southeast:oq,northeast:qq,southwest:pq,northwest:rq,southmiddle:tq,northmiddle:sq,all:function(){return[oq,
pq,qq,rq,tq,sq]},allRtl:function(){return[pq,oq,rq,qq,tq,sq]}},YA=function(a){return a.x()+a.width()},ZA=function(a,b){return a.y()-b.height()+a.height()},uq=function(a,b,c){return Cd(YA(a),a.y(),c.southeast(),Cc.southeast(),[tb.south(),tb.east()],"link-layout-se")},vq=function(a,b,c){b=a.x()-b.width();return Cd(b,a.y(),c.southwest(),Cc.southwest(),[tb.south(),tb.west()],"link-layout-sw")},wq=function(a,b,c){return Cd(YA(a),ZA(a,b),c.northeast(),Cc.northeast(),[tb.north(),tb.east()],"link-layout-ne")},
xq=function(a,b,c){var d;d=a.x()-b.width();return Cd(d,ZA(a,b),c.northwest(),Cc.northwest(),[tb.north(),tb.west()],"link-layout-nw")},DZ={southeast:uq,northeast:wq,southwest:vq,northwest:xq,all:function(){return[uq,vq,wq,xq]},allRtl:function(){return[vq,uq,xq,wq]}},Pd={anchored:f.constant(function(a,b){ha.setMax(a,Math.floor(b));t.setAll(a,{"overflow-x":"hidden","overflow-y":"auto"})}),expandable:f.constant(function(a,b){ha.setMax(a,Math.floor(b))})},Hf=la.generate([{fit:["reposition"]},{nofit:["reposition",
"deltaW","deltaH"]}]),EZ=function(a,b,c,d){var e=a.x(),g=a.y(),l=a.bubble().left(),p=a.bubble().top(),h=d.x(),k=d.y(),x=d.width(),m=d.height(),l=e+l,e=g+p,n=l>=h,q=e>=k,g=n&&q,p=l+b<=h+x&&e+c<=k+m,h=n?Math.min(b,h+x-l):Math.abs(h-(l+b)),x=q?Math.min(c,k+m-e):Math.abs(k-(e+c));b=d.width()-b;d=Math.max(0,l);b=Math.min(d,b);c=q?e:e+(c-x);d=f.constant(c+x-k);k=f.constant(k+m-c);k=Cc.cata(a.direction(),k,k,d,d);a=Gf.decision({x:b,y:c,width:h,height:x,maxHeight:k,direction:a.direction(),classes:a.anchors(),
label:a.label(),candidateYforTest:e});return g&&p?Hf.fit(a):Hf.nofit(a,h,x)},FZ={attempts:function(a,b,c,d,e){var g=c.width(),l=c.height(),p=function(a,f,p,h){a=a(b,c,d);return EZ(a,g,l,e).fold(Hf.fit,function(a,b,c){return b>p||c>h?Hf.nofit(a,b,c):Hf.nofit(f,p,h)})};return k.foldl(a,function(a,b){var c=f.curry(p,b);return a.fold(Hf.fit,c)},Hf.nofit(Gf.decision({x:b.x(),y:b.y(),width:c.width(),height:c.height(),maxHeight:c.height(),direction:Cc.southeast(),classes:[],label:"none",candidateYforTest:b.y()}),
-1,-1)).fold(f.identity,f.identity)}},GZ={measure:function(a){var b=q.fromTag("div");t.setAll(b,{position:"fixed",opacity:"0",top:"0",left:"0",bottom:"0",right:"0"});v.prepend(a,b);a=Ja.viewport(b);var c=ra.get(b),d=ha.get(b);B.remove(b);return{top:a.top,left:a.left,width:f.constant(c),height:f.constant(d)}}},sl={layout:function(a,b,c,d){t.remove(b,"max-height");b={width:f.constant(ra.getOuter(b)),height:f.constant(ha.getOuter(b))};return FZ.attempts(d.preference(),a,b,c,d.bounds())},setClasses:function(a,
b){ea.remove(a,tb.all());ea.add(a,b.classes())},setHeight:function(a,b,c){c.maxHeightFunction()(a,b.maxHeight())},position:function(a,b,c){var d=function(a){return a+"px"};c=c.origin();var e=f.constant(c);c=c.fold(e,e,function(){var b=GZ.measure(a);return Bd.fixed(b.left(),b.top(),b.width(),b.height())});b=Bd.reposition(c,b,a);t.setOptions(a,{position:h.some(b.position()),left:b.left().map(d),top:b.top().map(d),right:b.right().map(d),bottom:b.bottom().map(d)})}},$A=C.immutableBag(["bounds","origin",
"preference","maxHeightFunction"],[]),si=function(a,b,c){return void 0===a[b]?c:a[b]},aB=function(a,b,c,d){a=sl.layout(a,b,c,d);sl.position(b,a,d);sl.setClasses(b,a);sl.setHeight(b,a,d)},vk={simple:function(a,b,c,d,e){var g=si(e,"maxHeightFunction",Pd.anchored());e=a.anchorBox();a=a.origin();d=$A({bounds:Bd.viewport(a,h.none()),origin:a,preference:d,maxHeightFunction:g});aB(e,b,c,d)},detailed:function(a,b,c,d){d=void 0!==d?d:{};d=$A({bounds:si(d,"bounds",ne.view()),origin:si(d,"origin",Bd.none()),
preference:si(d,"preference",mg.all()),maxHeightFunction:si(d,"maxHeightFunction",Pd.anchored())});aB(a,b,c,d)}},HZ=function(a,b,c,d,e,g,l){return function(a){var f,k,x=Bd.none();f=Bd.viewport(x,h.some(b));k=Bd.toBox(x,c());f={bounds:f,origin:x,preference:e.isRtl()?g.allRtl():g.all(),maxHeightFunction:l};a=a.panel();vk.detailed(k,a,d,f)}},IZ=function(a,b,c,d,e,g,l){return function(b){var f=e.isRtl()?g.allRtl():g.all(),h={maxHeightFunction:l},k=gg.element(c(),gg.relativeOrigin(a()));b=b.panel();vk.simple(k,
b,d,f,h)}},bB=Y.detect().deviceType.isiOS()?HZ:IZ,of={main:function(a,b,c,d,e,g){a=bB(a,b,c,d,e,mg,g);return{recalculate:a,isAnchored:f.always,place:a}},submenu:function(a,b,c,d,e){a=bB(a,b,c,ag(3,-2),d,DZ,e);return{recalculate:a,isAnchored:f.always,place:a}}},cB=function(a){return function(b){return b.key()===a}},JZ=C.immutable("key","value"),Jj={put:function(a,b,c,d,e){var g=void 0!==d?d:JZ,l=void 0!==e?e:cB(b);a=k.foldl(a,function(a,d){var e=l(d)?g(b,c):d;return{updated:l(d)||a.updated,acc:a.acc.concat([e])}},
{updated:!1,acc:[]});return a.updated?a.acc:a.acc.concat([g(b,c)])},get:function(a,b,c){b=void 0!==c?c:cB(b);return k.find(a,b)}},zO={triage:function(a){a=k.foldr(a,function(a,c){var d=ca.inBody(c.menu());return{keep:d?[c].concat(a.keep):a.keep,throwaway:!1===d?[c].concat(a.throwaway):a.throwaway}},{throwaway:[],keep:[]});k.each(a.throwaway,function(a){a.popup().destroy()});return a.keep}},dB=function(a,b){return Bc.ancestor(a,f.curry(L.eq,b))},wO={ancestor:dB,anyAncestor:function(a,b){return k.exists(b,
function(b){return dB(a,b)})},sibling:function(a,b){return Bc.sibling(a,f.curry(L.eq,b))},child:function(a,b){return Bc.child(a,f.curry(L.eq,b))},descendant:function(a,b){return Bc.descendant(a,f.curry(L.eq,b))}},yO={create:function(a,b){var c=D.create({open:r([]),close:r([]),uistale:r([])});if(void 0===a)throw"uicontainer not specified";var d=xO({layerClass:ia.resolve("layer-menus"),container:a()}),e=P.div();n.add(e,ia.resolve("popup-container"));d.content(e);var g=!1,l=function(){g&&(h.off(),d.hide(),
g=!1,k.control.block(),c.trigger.close())},p=[e],h=Mu(function(a){!1===!g&&(l(),I.ancestor(a,"."+b).fold(function(){T.focus(a)},f.noop))},function(){return p}),k=Lc.tap(function(){c.trigger.uistale()});k.control.block();return{element:function(){return e},panel:d.element,destroy:function(){d.hide();d.destroy();h.off()},open:function(){g||(k.control.unblock(),t.set(d.element(),"opacity","0"),d.show(),t.reflow(d.element()),h.on(),g=!0,c.trigger.open(),t.set(d.element(),"opacity","1"))},close:l,closed:function(){return!g},
mousedown:function(a){h.mousedown(a.original())},uiStale:function(){k.instance()},setContent:function(a){v.append(e,a)},setComponents:function(a){p=a.concat([e])},events:c.registry}}},Nu=C.immutable("menu","popup"),Kj=function(a){return function(b){return L.eq(b.menu(),a)}},DO=Y.detect().deviceType.isiOS,KZ=function(a,b,c,d,e){var g=BO(a,b,e.name,e.textkey,e.menuTextkey,e.render,e.layout,c,e.toggle,d);a=function(){e.updateDropdown(Ad.dropdown({enable:g.enable,disable:g.disable,select:g.select,clear:g.clear,
selectElement:g.selectElement,populate:g.populate,tick:g.tick,untick:g.untick,activate:g.activate,deactivate:g.deactivate}))};var l=ye.onButton(g);g.events.select.bind(function(a){e.action(a.value());g.close()});var f=D.create({select:K(["value","item"],g.events.select),itemHover:K(["item"],g.events.itemHover),escaped:K([],g.events.escaped),open:K(["menu","popup","anchor"],g.events.open),close:K([],g.events.close)});a();m.set(g.element(),"tabindex","-1");return{dropdown:function(){return{events:f.registry,
close:g.close,uiStale:g.uiStale,enable:g.enable,disable:g.disable,list:g.list,menu:g.menu,recalculate:g.recalculate}},component:g.element,refreshUi:a,destroy:function(){l.unbind();g.destroy()}}},LZ=function(a,b){var c=qf.typical(a.value,a.value,a.action,a.textkey,a.label,a.tooltip,b);a.setup&&a.setup(c,a);return c},MZ=function(a,b){var c=qf.toggle(a.value,a.value,a.action,a.textkey,a.label,a.tooltip,b);a.setup&&a.setup(c,a);a.selected&&c.select();return c},NZ=function(a,b){var c=!0===b.hasPopup,d=
(!0===b.toggle?MZ:LZ)(b,a);Q.isString(b.icon)&&jl.findAndSetUrl(d.element(),b.icon);var e=d.initAria(d,a(b.textkey),c,b.toggle);m.set(d.element(),"tabindex","-1");var g=function(){!0===b.toggle&&ga.pressed(d)},l=ye.onButton(d);d.events.click.bind(function(){g()});var p=!0===b.toggle?d.select:f.noop,h=!0===b.toggle?d.deselect:f.noop,k=!0===b.toggle?d.selected:f.constant(!1);g();var x=D.create({click:K([],d.events.click)});return{generals:function(){return{events:x.registry,enableButton:d.enable,disableButton:d.disable}},
component:d.element,refreshUi:function(){b.updateGeneral(Ad.general({disable:e.disable,enable:e.enable,select:p,deselect:h,selected:k,element:d.element}));g()},destroy:function(){l.unbind();d.destroy();e.destroy()}}},OZ=Y.detect().deviceType.isiOS,PZ=function(a,b,c,d,e,g){var l=e.button(),f=ye.onButton(l),h=Wn(a.uiContainer,e.name,Bh.menu({focusActive:!0}));m.set(l.element(),"tabindex","-1");var z=P.div();n.add(z,ia.resolve("menu-system-main"));var x=Ah(h.sandbox,a.bounds,b,[l.element()],d),M=x.initMenu(z);
c=Ij();var q=of.main(a.uiContainer,a.bounds,l.element,c,b.uiDirection(),Pd.anchored()),u=function(){q.recalculate(M)},w=function(){var a=y.children(h.sandbox());k.each(a,function(a){t.set(a,"display","none")})},A=function(a){h.update(a.structure());B.empty(z);v.append(z,a.element());a=x.registerMenus(a.submenus());a=k.map(a,function(a){return a.panel()});B.empty(h.sandbox());J.append(h.sandbox(),[M.panel()].concat(a));w()},C=function(a){e.init(a)},E=D.create({open:r(["menu","popup","anchor"]),close:K([],
h.events.close),itemAction:K(["value","item"],h.events.itemAction),itemHover:K(["item"],h.events.itemHover),reveal:r(["menu","trigger","popup","anchor"]),collapse:K(["menu","item"],h.events.collapse),escaped:K([],h.events.escaped)});l.events.click.bind(function(){return(l.selected()?M.open:M.close)()});e.events.done.bind(function(){h.close()});e.events.abort.bind(function(a){h.select(a.item());T.focus(a.item())});M.events.uistale.bind(function(){h.getActiveMenu().bind(function(a){C(a)})});M.events.close.bind(function(){h.close();
ga.collapsed(l.element())});M.events.open.bind(function(){var a=void 0!==g?g:[],a=[h.sandbox()].concat(a);A(e);C(e);t.set(M.panel(),"display","block");t.set(z,"display","block");h.open(a,z);ga.expanded(l.element())});h.events.open.bind(function(){E.trigger.open(e.element(),M,q);OZ()||h.setActiveMenu(e.element())});h.events.close.bind(function(){x.hideAll();l.deselect()});h.events.itemAction.bind(function(a){var b=e.handlers();if(void 0!==b[a.value()])(0,b[a.value()])(a.item())});h.events.reveal.bind(function(a){ga.expanded(a.trigger());
var b=x.expandMenu(a.menu(),a.trigger(),M);E.trigger.reveal(a.menu(),a.trigger(),b.popup,b.anchorage)});h.events.collapse.bind(function(a){x.hideMenu(a.menu());a.item().each(ga.collapsed)});return{menus:function(){return{events:E.registry,enable:e.enable,disable:e.disable,close:M.close,uiStale:M.uiStale,mousedown:M.mousedown,contentFocus:e.contentFocus,menu:M.element,refreshMenus:C,recalculate:u}},component:l.element,refreshUi:function(){e.updateMenu({enable:e.enable,disable:e.disable})},destroy:function(){f.unbind();
h.destroy();e.destroy();M.destroy()}}},QZ=function(a,b){var c=P.span();n.add(c,ia.resolve("palette-group"));var d=f.curry(Oa.speak,ca.body()),e=function(a){var b=wh.isShowing(c);wh.hide(c);b&&a.each(d);return b},g=Ad.palette({show:function(a){var b=wh.isHiding(c);wh.show(c);b&&a.each(d);return b},hide:e});e(h.none());J.append(c,k.map(b,function(a){return a.component()}));return{component:f.constant(c),destroy:function(){k.each(b,function(a){a.destroy()})},refreshUi:function(){k.each(b,function(a){a.refreshUi()});
a.updatePalette(g)}}},RZ=function(a,b,c,d,e){var g=e.instance();e=q.fromDom(document);var l=(g.toggle?qf.splitToggle:qf.split)(g.name(),g.name(),f.identity,g.textkey(),g.label(),g.tooltip,c),p=ye.custom(l.element(),function(){l.open();g.enter()});m.set(l.element(),"tabindex","-1");var h=l.initAria(l,c(g.textkey()),!0,g.toggle);d=Ah(a.uiContainer,a.bounds,b,[l.element()],d);var k=Ij(),x=ab.widget(e,g.name());e=Ma.generate("menu-control");m.set(x,"id",e);O.controls(l.element(),e);O.owns(l.element(),
e);O.menu(x,c(g.menuTextkey()));v.append(x,g.element());var n=d.initMenu(x),G=of.main(a.uiContainer,a.bounds,l.element,k,b.uiDirection(),Pd.expandable()),t=function(){G.recalculate(n)};n.events.open.bind(function(){ga.expanded(l.element());g.open();u.trigger.open(x,n,G)});n.events.close.bind(function(){ga.collapsed(l.element());g.close();l.close()});g.events.done.bind(function(){n.close();l.close()});g.events.abort.bind(function(){n.close();l.close();u.trigger.abort()});l.events.open.bind(function(){n.open();
G.recalculate(n)});l.events.close.bind(function(){g.close();n.close()});l.events.click.bind(function(){g.action()});var u=D.create({abort:r([]),close:K([],g.events.close),open:r(["menu","popup","anchor"])});return{widgets:function(){return{events:u.registry,open:l.open,isOpen:l.isOpen,close:l.close,recalculate:t}},component:l.element,refreshUi:function(){g.updateWidget(Ad.widget({select:l.select,deselect:l.deselect,enable:l.enable,disable:l.disable,press:h.press,release:h.release}))},destroy:function(){p.unbind();
h.destroy();n.destroy();g.destroy();l.destroy()}}},SZ=function(a,b,c,d,e){var g=e.instance(),l=qf.toggle(g.name(),g.name(),f.identity,g.textkey(),g.label(),g.tooltip,c),p=ye.onButton(l),h=l.initAria(l,c(g.textkey()),!0,!0);c=Ah(a.uiContainer,a.bounds,b,[l.element()],d);d=Ij();var k=c.initMenu(g.element()),x=of.main(a.uiContainer,a.bounds,l.element,d,b.uiDirection(),Pd.expandable());m.set(l.element(),"tabindex","-1");n.add(k.element(),ia.resolve("toolbar-widget"));var M=function(){x.recalculate(k)};
k.events.open.bind(function(){ga.expanded(l.element());g.open();q.trigger.open(g.element(),k,x)});k.events.close.bind(function(){ga.collapsed(l.element());g.close()});g.events.done.bind(function(){k.close();l.deselect()});g.events.abort.bind(function(){k.close();l.deselect();q.trigger.abort()});l.events.click.bind(function(){l.selected()?(k.open(),x.recalculate(k)):k.close();ga.pressed(l)});var q=D.create({abort:r([]),open:r(["menu","popup","anchor"])}),t=function(){l.deselect();k.close()};return{widgets:function(){return{events:q.registry,
close:t,recalculate:M}},component:l.element,refreshUi:function(){g.updateWidget(Ad.widget({select:f.noop,deselect:f.noop,enable:h.enable,disable:h.disable,press:f.noop,release:f.noop}))},destroy:function(){p.unbind();h.destroy();k.destroy();g.destroy();l.destroy()}}},TZ=function(a,b){var c=b.instance(),d=ye.custom(c.element(),function(){c.element().dom().click()});m.remove(c.element(),"tabindex");n.add(c.element(),ia.resolve("toolbar-inline-widget"));O.toolbarButton(c.element(),a(c.textkey()),!1);
var e=D.create({abort:r([]),open:r(["menu","popup","anchor"])});return{widgets:function(){return{events:e.registry,recalculate:f.noop,close:f.noop}},component:c.element,refreshUi:function(){c.updateInlineWidget(Ad.widget({select:f.noop,deselect:f.noop,enable:f.curry(ga.enable,c.element()),disable:f.curry(ga.disable,c.element()),press:f.noop,release:f.noop}))},destroy:function(){d.unbind();c.destroy()}}},Pu={menu:function(a){return{general:f.curry(pZ,a),menu:f.curry(sZ,a),dropdown:f.curry(nZ,a),widget:f.curry(Lj.widget,
a),"split-widget":f.curry(Lj.split,a),"inline-widget":f.curry(Lj.inline,a),palette:f.die("No palettes for menus yet")}},toolbar:function(a,b,c,d){var e=function(e){return f.curry(e,a,b,c,d)};return{menu:e(PZ),dropdown:e(KZ),widget:e(SZ),"split-widget":e(RZ),"inline-widget":f.curry(TZ,c),general:f.curry(NZ,c),palette:QZ}}},eB=la.generate([{toolbar:[]},{menu:[]}]),Yn={toolbar:eB.toolbar,menu:eB.menu,cata:function(a,b,c){return a.fold(b,c)}},UZ=function(a,b,c,d){a.events.escaped.bind(function(a){c.focused()&&
T.focus(d.component())});a.events.close.bind(function(a){b.focus()})},VZ=function(a,b,c,d){a.events.open.bind(function(a){cc.register(a.popup().panel())})},HO={init:function(a,b,c,d,e,g,l,f,h){var z=a.dropdown(h),x=z.dropdown();a=c.toolbar;(Y.detect().deviceType.isTouch()?VZ:UZ)(x,e,a,z);var m=!1;x.events.open.bind(function(a){e.toReading();l.show(a.popup(),a.anchor());m=!0});x.events.close.bind(function(){m=!1});x.events.escaped.bind(function(){T.focus(z.component())});e.events.mousedown.bind(function(){m&&
x.close()});e.events.uiStale.bind(x.uiStale);c.toolbar.events.transitionend.bind(function(a){k.contains(["top","height"],a.property())&&x.recalculate()});return{component:z.component,refreshUi:z.refreshUi,destroy:z.destroy}}},GO={init:function(a,b,c,d,e,g,l,f,h){a=a.general(h);b=a.generals();a.refreshUi();return{generals:b,component:a.component,refreshUi:a.refreshUi,destroy:a.destroy}}},fB=function(a){var b=h.none(),c=function(){b=h.none()};return{begin:function(){b=h.from(Ga.capture(a))},end:function(){b.each(function(a){a.restore()});
c()},destroy:c}},zk={fromSafe:function(a){return fB(a.doc())},fromUnsafe:function(a){a=a.doc().getOrDie();return fB(a)}},IO={init:function(a,b,c,d,e,g,l,p,k){var z=a.menu(k,[]),x=z.menus(),m=zk.fromUnsafe(e);x.events.open.bind(function(a){e.toReading();x.refreshMenus(a.menu());l.show(a.popup(),a.anchor())});x.events.close.bind(function(){e.focus();m.end()});x.events.escaped.bind(function(){T.focus(z.component())});x.events.reveal.bind(function(a){k.init(a.menu());l.show(a.popup(),a.anchor())});x.events.itemAction.bind(function(a){m.end()});
x.events.itemHover.bind(function(a){m.begin();if(null!==document.activeElement&&void 0!==document.activeElement){var b=q.fromDom(document.activeElement),c=y.owner(a.item());"input"!==A.name(b)&&cc.preserve(c,f.curry(T.focusInside,a.item()))}else e.backupSelection(),T.focus(a.item())});e.events.mousedown.bind(x.mousedown);e.events.uiStale.bind(x.uiStale);e.events.focus.bind(x.enable);var n=!e.isInline()&&k.contentFocus();n&&x.disable();return{component:z.component,refreshUi:function(){z.refreshUi();
var a=n?h.none():h.some(!0);e.getSelection().or(a).fold(x.disable,x.enable)},destroy:function(){m.destroy();e.events.mousedown.unbind(x.mousedown);e.events.uiStale.unbind(x.update);z.destroy()}}}},yq=function(a,b,c,d,e,g,l,f,h,k,x){var m=c[b]({instance:a(x.instance)});a=m.widgets();e=e.toolbar;a.events.open.bind(function(a){l.toReading();h.show(a.popup(),a.anchor())});a.events.abort.bind(function(){T.focus(m.component())});l.events.mousedown.bind(a.close);return(Y.detect().deviceType.isTouch()&&"split-widget"===
b?WZ:XZ)(a,l,e,m)},XZ=function(a,b,c,d){return d},WZ=function(a,b,c,d){var e=E.capture(d.component(),"click",function(b){b.kill();n.add(d.component(),Ta.resolve("statebutton-selected"));a.isOpen()?a.close():a.open()});a.events.close.bind(function(){n.remove(d.component(),Ta.resolve("statebutton-selected"))});return{widgets:d.widgets,component:d.component,refreshUi:d.refreshUi,destroy:function(){e.unbind();d.destroy()}}},Zn={widget:f.curry(yq,f.identity,"widget"),inlineWidget:f.curry(yq,function(a){return function(){return a(Yn.toolbar())}},
"inline-widget"),splitWidget:f.curry(yq,f.identity,"split-widget")},YZ=w.resolve("editor-container"),pf={editorContainer:f.constant(YZ)},tl=C.immutable("key","link"),gB=C.immutable("url","text"),hB=function(a,b,c){return function(d){var e=gB(b,u.translate(c));return tl(u.pkey(a,d),h.some(e))}},Fb=function(a){return function(b){return tl(u.pkey(a,b),h.none())}},zq=function(a){return function(b){var c=a(b);b=gB(b[0].websiteUrl,u.translate("cloud.dashboard"));return tl(c.key(),h.some(b))}},ZZ={"no.api.key":zq(Fb("cloud.error.apikey")),
"domain.not.supported":zq(function(a){return tl(u.pkey("cloud.error.domain",[a[0].details.domain]),h.none())}),"plan.exceeded":zq(Fb("cloud.error.plan")),"error.code.invalid.toolbar":Fb("errors.toolbar.invalid"),"error.code.spelling.not.found":Fb("errors.spelling.missing.service"),"error.code.images.not.found":Fb("errors.images.missing.service"),"safari.imagepaste":hB("errors.safari.image","https://support.ephox.com/entries/88543243-Safari-Direct-paste-of-images-does-not-work","errors.safari.url"),
"webview.imagepaste":Fb("errors.webview.image"),"flash.clipboard.no.rtf":function(a){return(Y.detect().browser.isSafari()?hB("errors.safari.browser-settings","https://support.ephox.com/entries/59328357-Safari-6-1-and-7-Flash-Sandboxing","errors.safari.rtf"):Fb("errors.images.missing.flash"))(a)},"fileupload.invalidimages":Fb("errors.images.upload.invalid"),"error.imageupload":Fb("errors.images.upload.failed"),"error.imageupload.generic":Fb("errors.images.upload.unknown"),"error.imageupload.cors":Fb("errors.images.upload.cors"),
"errors.paste.word.notready":Fb("errors.paste.notready"),"errors.paste.process.failure":Fb("errors.paste.generic"),"flash.crashed":Fb("errors.flash.crashed"),"errors.imageimport.failed":Fb("errors.images.import.failed"),"errors.imageimport.unsupported":Fb("errors.images.import.unsupported"),"errors.imageimport.invalid":Fb("errors.images.import.invalid"),"imageedit.needsproxy":Fb("errors.images.edit.needsproxy"),"imageedit.proxyerror":Fb("errors.images.edit.proxyerror"),"imageedit.generic":Fb("errors.images.edit.generic")},
$Z={"errors.local.images.disallowed":"Removing pasted images from content. Local image insert has been disabled.","errors.dragdrop.images.disallowed":"Blocking image drop operation. Local image insert has been disabled."},iB=function(a,b){var c=(0,ZZ[a])(b);return{description:f.constant(u.get(c.key())),link:f.constant(c.link().getOr(null))}},Yd={get:iB,getOrLog:function(a,b){return h.from($Z[a]).fold(function(){var c=iB(a,b);return h.some(c)},function(a){console.warn(a);return h.none()})}},a_=function(a,
b){var c=function(b){var c=Yd.get("error.code.invalid.toolbar",[b.small()]),c=xh(c);a.displayBanner(c);k.each(b.big(),function(a){console.error(a)})};return b.fold(function(a){c(a);return[]},f.identity)},jB={setup:function(a,b,c,d,e,g){g=a_(a,g);var l=function(a){a=Q.isString(a)?u.has(a)?u.key(a):u.raw(a):a;return u.get(a)};n.add(a.toolbar.element(),w.resolve("layer-above-editor"));b=wA.blueprints(FO(e.uiContainer,a,b,c,d,e,l),EO(l));e=wA.env(e.uiContainer,l);e=XY.build(g,b,e);k.each(e,a.toolbar.add);
a.position();k.each(e,function(a){c.events.uiStale.bind(function(){a.refreshUi()})})}},cg={preserve:function(a,b){var c=y.owner(b),d=T.active(c).bind(function(a){var c=function(b){return L.eq(a,b)};return c(b)?h.some(b):sa.descendant(b,c)}),e=a(b);d.each(function(a){T.active(c).filter(function(b){return L.eq(b,a)}).orThunk(function(){T.focus(a)})});return e}},Ru=C.immutable("component","index"),OO={item:f.constant('.ephox-chameleon-toolbar-group [tabindex="-1"]'),group:f.constant(".ephox-chameleon-toolbar-group"),
sector:f.constant(".ephox-chameleon-toolstrip > *")},kB=ia.resolve("toolbar-more-closed"),lB=ia.resolve("toolbar-more-open"),Vu=ia.resolve("toolbar-more-hide"),Uu=ia.resolve("toolbar-more-show"),bo=function(a,b){t.set(a,"height",b+"px");t.reflow(a)},ao=function(a){n.remove(a,lB);n.add(a,kB);bo(a,0)},Wu=function(a){n.remove(a,kB);n.add(a,lB);t.remove(a,"height")},Aq=C.immutable("within","extra","withinWidth"),mB=function(a,b,c){var d=Wc.generate(a,function(a,b){var d=c(a);return h.some({element:f.constant(a),
start:f.constant(b),finish:f.constant(b+d),width:f.constant(d)})});a=k.filter(d,function(a){return a.finish()<b});var e=k.foldr(a,function(a,b){return a+b.width()},0),d=d.slice(a.length);return{within:f.constant(a),extra:f.constant(d),withinWidth:f.constant(e)}},ul=function(a){return k.map(a,function(a){return a.element()})},b_=function(a,b,c){a=ul(a.concat(b));return Aq(a,[],c)},c_=function(a,b,c,d){a=ul(a).concat([c]);return Aq(a,ul(b),d)},d_=function(a,b,c){return Aq(ul(a),[],c)},e_=function(a,
b,c){a=mB(b,a,c);return 0===a.extra().length?h.some(a):h.none()},MO={partition:function(a,b,c,d){var e=e_(a,b,c).getOrThunk(function(){return mB(b,a-c(d),c)}),g=e.within(),l=e.extra(),e=e.withinWidth();return 1===l.length&&l[0].width()<=c(d)?b_(g,l,e):1<=l.length?c_(g,l,d,e):d_(g,l,e)}},pa={grid:C.immutableBag(["trigger"],["isValid","first"]),flow:C.immutableBag(["trigger"],["first","executeOnArrow"]),sectors:C.immutableBag(["trigger","first"],[]),radio:C.immutableBag(["one"],[]),input:C.immutableBag([],
["execute"]),button:C.immutableBag(["execute"],["process"]),dialog:C.immutableBag(["execute","ok","cancel"],["index"]),inlineDialog:C.immutableBag(["ok","cancel"],["index"]),page:C.immutableBag(["trigger"],["first"]),tabular:C.immutableBag(["trigger"],["first","isValid"]),dynamic:C.immutableBag([],["execute"])},nc=Eb.ensure(["enter","exit","destroy"]),nB=function(a){return function(b){return b.raw().which===a}},U={inSet:function(a){return function(b){return k.contains(a,b.raw().which)}},and:function(a){return function(b){return k.forall(a,
function(a){return a(b)})}},is:nB,isShift:function(a){return!0===a.raw().shiftKey},basic:function(a,b){return{matches:nB(a),run:b}},rule:function(a,b){return{matches:a,run:b}}},Bq=function(a){m.has(a,"tabIndex")||m.set(a,"tabIndex","-1")},Na={set:function(a){Bq(a);T.focus(a)},find:function(a){return T.search(a)},isFocused:T.hasFocus,mark:Bq,markSelectors:function(a,b){k.each(b,function(b){b=X.descendants(a,b);k.each(b,Bq)})}},Dd={adjust:function(a,b,c,d){a+=b;return a>d?c:a<c?d:a},findPrev:function(a,
b,c){var d=k.reverse(a.slice(0,b));a=k.reverse(a.slice(b+1));return k.find(d.concat(a),c)},findNext:function(a,b,c){var d=a.slice(0,b);a=a.slice(b+1);return k.find(a.concat(d),c)}},oB=function(a){return k.find(a,vl)},vl=function(a){return Sb.isVisible(a.element())&&a.isEnabled()&&"hidden"!==t.get(a.element(),"visibility")},ka={exit:function(a){k.each(a,function(a){a.clear();a.exit()})},clear:function(a){k.each(a,function(a){a.clear()})},refresh:function(a){k.each(a,function(a){a.refresh()})},first:oB,
enterFirst:function(a,b){b.index().bind(function(b){return h.from(a[b]).filter(vl)}).orThunk(function(){return oB(a)}).each(function(a){a.enter()})},isEnabled:function(a){return k.exists(a,function(a){return a.isEnabled()})},locate:function(a,b){return k.find(a,function(a){var d=b.target();a=a.element();return Bc.closest(d,f.curry(L.eq,a))}).getOr(void 0)},next:function(a,b){var c=k.indexOf(a,b).getOr(-1);return Dd.findNext(a,c,vl).getOr(b)},prev:function(a,b){var c=k.indexOf(a,b).getOr(-1);return Dd.findPrev(a,
c,vl).getOr(b)},prevNoCycle:function(a,b){var c=k.indexOf(a,b).getOr(-1);return 0<c?h.some(a[c-1]):h.none()},nextNoCycle:function(a,b){var c=k.indexOf(a,b).getOr(-1);return c+1<a.length?h.some(a[c+1]):h.none()},progress:function(a,b){a.exit();b.enter()},destroy:function(a){k.each(a,function(a){a.destroy()})}},f_=C.immutableBag(["index","focused","group","items"],[]),g_=C.immutableBag(["index","sectors","sector"],[]),h_=C.immutableBag(["index","candidates"],[]),If={ofFocus:function(a,b,c){return Na.find(a).bind(function(a){return I.closest(a,
b).bind(function(b){var g=X.descendants(b,c),l=k.filter(g,Sb.isVisible);return k.findIndex(l,f.curry(L.eq,a)).map(function(c){return f_({index:c,focused:a,group:b,items:l})})})})},ofSector:function(a,b,c){var d=X.descendants(a,b);return I.closest(c,b).bind(function(a){return k.findIndex(d,f.curry(L.eq,a)).map(function(b){return g_({index:b,sectors:d,sector:a})})})},within:function(a,b,c){var d=X.descendants(a,c);return k.findIndex(d,f.curry(L.eq,b)).map(function(a){return h_({index:a,candidates:d})})}},
pB={horizontal:function(a,b,c,d){return If.within(a,c,b).bind(function(a){var b=a.index();a=a.candidates();b=Dd.adjust(b,d,0,a.length-1);return h.from(a[b])})}},wl={delegate:function(a,b,c){return ze(a,[U.basic(N.LEFT()[0],b.west),U.basic(N.RIGHT()[0],b.east),U.basic(N.UP()[0],b.north),U.basic(N.DOWN()[0],b.south),U.rule(U.inSet(N.SPACE().concat(N.ENTER())),function(){return Na.find(a).bind(c.trigger()).map(f.always)})],h.none())},findRecent:function(a,b,c,d){return d.isValid().fold(f.constant(c),
function(a){return c.filter(a)}).orThunk(function(){return d.first().bind(function(a){return a()}).orThunk(function(){return I.descendant(a,b)})})}},i_=C.immutable("row","column"),$={set:function(a,b){if(void 0===b)throw Error("Value.set was undefined");a.dom().value=b},get:function(a){return a.dom().value}},j_={move:function(a,b,c){var d=C.immutable("row","col"),e=a.length-1,g=a[b.row()]-1,e=Dd.adjust(b.row(),c.dr(),0,e);a=a[e]-1;g=Math.max(g,a);b=Math.min(a,Dd.adjust(b.col(),c.dc(),0,g));return d(e,
b)}},qB={single:ze,multiple:Xu,multipleAll:function(a,b){var c=E.bind(a,"keydown",function(a){var c=ka.locate(b,a);if(U.is(N.ESCAPE()[0])(a))d(),a.kill();else if(void 0!==c&&null!==c)if(U.is(N.UP()[0])(a))ka.progress(c,ka.prev(b,c)),a.kill();else if(U.is(N.DOWN()[0])(a))ka.progress(c,ka.next(b,c)),a.kill();else if(U.is(N.TAB()[0])(a)){var e=(U.isShift(a)?ka.prev:ka.next)(b,c);ka.progress(c,e);a.kill()}}),d=function(){ka.exit(b);e.trigger.exit()},e=D.create({enter:r([]),exit:r([])});return nc({enter:function(){ka.first(b).each(function(a){a.enter()})},
exit:d,clear:f.curry(ka.clear,b),refresh:f.curry(ka.refresh,b),isEnabled:f.curry(ka.isEnabled,b),isFocused:f.curry(Na.isFocused,a),events:e.registry,destroy:function(){ka.destroy(b);c.unbind()}})},flow:function(a,b,c){var d=h.none();Na.markSelectors(a,[b.item()]);var e=function(c){return Na.find(a).bind(function(d){return pB.horizontal(a,b.item(),d,c)})},g=Ch(a,function(a){return e(a).bind(function(a){k(a);return c.executeOnArrow().fold(function(){return h.some(!0)},l)})}),l=function(){return Na.find(a).bind(c.trigger()).map(f.always)},
p=ze(a,[U.rule(U.inSet(N.LEFT().concat(N.UP())),g.west),U.rule(U.inSet(N.RIGHT().concat(N.DOWN())),g.east),U.rule(U.inSet(N.SPACE().concat(N.ENTER())),l)],h.none()),k=function(a){d=h.some(a);Na.set(a)};return nc({element:p.element,destroy:p.destroy,clickFocus:function(a){qa.is(a,b.item())&&k(a)},clear:function(){d=h.none()},isFocused:p.isFocused,isEnabled:f.constant(!0),refresh:f.noop,enter:function(){p.enter();d.orThunk(function(){return c.first().fold(function(){return I.descendant(a,b.item())},
f.apply)}).each(k)},exit:p.exit})},grid:function(a,b,c,d,e){var g=c,l=d;Na.markSelectors(a,[b.cell()]);var p=xa(h.none()),k=function(a){return y.findIndex(a).map(function(a){return i_(Math.floor(a/l),a%l)})},z=function(c,d){return Na.find(a).bind(function(e){return k(e).bind(function(e){var f=Dd.adjust(e.row(),d,0,g-1),p=Dd.adjust(e.column(),c,0,l-1);e=X.descendants(a,b.cell());var k=e.length-1,f=f*l,f=f+p>k?0<c?f:k:f+p;return 0<=f&&f<e.length?h.some(e[f]):h.none()})})};c=Ch(a,function(a,b){return z(a,
b).bind(function(a){Na.set(a);p.set(h.some(a));return h.some(!0)})});var x=wl.delegate(a,c,e);return nc({element:x.element,destroy:x.destroy,clear:function(){p.set(h.none())},isFocused:x.isFocused,isEnabled:f.always,refresh:f.noop,enter:function(){x.enter();p.set(wl.findRecent(a,b.cell(),p.get(),e));p.get().each(T.focus)},exit:x.exit,resize:function(a,b){g=a;l=b}})},sectors:function(a,b,c){Na.markSelectors(a,[b.sector(),b.group(),b.item()]);var d=function(a){return sa.descendant(a,function(a){return qa.is(a,
b.item())&&s(a)})},e=function(a){return sa.child(a,m)},g=function(a){a=lc.children(a,m);return 0<a.length?h.some(a[a.length-1]):h.none()},l=Ch(a,function(c){return If.ofFocus(a,b.group(),b.item()).bind(function(a){var b=a.items();a=Dd.adjust(a.index(),c,0,b.length-1);return h.from(b[a])})}),p=function(c){return If.ofFocus(a,b.group(),b.item()).bind(function(a){return c(a.group()).bind(d)})},s=function(a){return 0<ha.get(a)},z=function(c){return If.ofSector(a,b.sector(),c).map(function(a){return Dd.findPrev(a.sectors(),
a.index(),s).getOr(a.sector())})},x=function(c){return If.ofSector(a,b.sector(),c).map(function(a){return Dd.findNext(a.sectors(),a.index(),s).getOr(a.sector())})},m=function(a){var c;if(c=qa.is(a,b.group()))a=X.descendants(a,b.item()),c=k.exists(a,Sb.isVisible);return c},n=function(a){return function(){return a().map(function(a){Na.set(a);q.trigger.active(a);return a})}},q=D.create({enter:r([]),exit:r([]),active:r(["element"])}),t=ze(a,[U.rule(U.inSet(N.ESCAPE()),function(){t.exit();q.trigger.exit();
return h.some(!0)}),U.rule(U.inSet(N.RIGHT().concat(N.DOWN())),n(l.east)),U.rule(U.inSet(N.LEFT().concat(N.UP())),n(l.west)),U.rule(U.and([U.isShift,U.inSet(N.TAB())]),n(f.curry(p,function(a){return y.prevSibling(a).filter(m).orThunk(function(){return z(a).bind(g)})}))),U.rule(U.inSet(N.TAB()),n(f.curry(p,function(a){return y.nextSibling(a).filter(m).orThunk(function(){return x(a).bind(e)})}))),U.rule(U.inSet(N.SPACE().concat(N.ENTER())),function(){return Na.find(a).bind(c.trigger()).map(f.always)})],
h.none());return nc({element:t.element,clear:f.noop,isFocused:t.isFocused,enter:function(){t.enter();q.trigger.enter();c.first()().orThunk(function(){return d(a)}).each(function(a){Na.set(a);q.trigger.active(a)})},refresh:f.noop,isEnabled:f.always,exit:t.exit,destroy:t.destroy,events:q.registry})},radio:function(a,b,c){var d=function(c){return Na.find(a).bind(function(d){return pB.horizontal(a,b.item(),d,c)})},e=Ch(a,function(b){return d(b).bind(function(b){Na.set(b);c.one()(a,b);return h.some(!0)})}),
g=ze(a,[U.rule(U.inSet(N.LEFT().concat(N.UP())),e.west),U.rule(U.inSet(N.RIGHT().concat(N.DOWN())),e.east),U.rule(U.inSet(N.SPACE()),f.curry(h.some,!0))],h.none());return nc({element:g.element,destroy:g.destroy,clear:f.noop,refresh:function(){g.isFocused()&&I.descendant(a,b.selected()).each(Na.set)},isFocused:g.isFocused,isEnabled:f.always,enter:function(){g.enter();I.descendant(a,b.selected()).orThunk(function(){return I.descendant(a,b.item())}).each(function(d){qa.is(d,b.selected())||c.one()(a,
d);Na.set(d)})},exit:g.exit})},input:function(a,b){var c=ze(a,[U.basic(N.ENTER()[0],function(c){return b.execute().map(function(b){var g={isShift:f.constant(U.isShift(c))},l=$.get(a);b(l,g);return!0})})],h.none());return nc({element:c.element,destroy:c.destroy,clear:c.clear,isFocused:c.isFocused,isEnabled:function(){return!m.has(a,"disabled")},refresh:f.noop,enter:function(){c.enter();a.dom().setSelectionRange(0,$.get(a).length)},exit:c.exit})},dialog:function(a,b,c){var d=c.execute(),e=pa.button({execute:d}),
g=b.slice(0).concat([co(c.cancel(),e),co(c.ok(),e)]),l=E.bind(a,"keydown",function(a){var b=ka.locate(g,a);if(void 0!==b&&null!==b){var e=U.isShift(a);U.is(N.TAB()[0])(a)?(e=(e?ka.prev:ka.next)(g,b),ka.progress(b,e),a.kill()):U.is(N.ESCAPE()[0])(a)?(h(),a.kill(),d(c.cancel())):(b=b.element(),"button"===A.name(b)||e||!U.is(N.ENTER()[0])(a)?(b=[N.UP()[0],N.DOWN()[0]],e=["textarea","select","input"],U.inSet(b)(a)&&!1===k.contains(e,A.name(a.target()))&&a.kill()):(d(c.ok()),a.kill()))}}),h=function(){ka.exit(g);
s.trigger.exit()},s=D.create({enter:r([]),exit:r([])});return nc({enter:function(){ka.enterFirst(g,c)},exit:h,clear:f.curry(ka.clear,g),refresh:f.curry(ka.refresh,g),isEnabled:f.curry(ka.isEnabled,g),isFocused:f.curry(Na.isFocused,a),events:s.registry,destroy:function(){ka.destroy(g);l.unbind()}})},button:co,inlineDialog:function(a,b,c){var d=c.ok(),e=c.cancel(),g=E.bind(a,"keydown",function(a){var c=ka.locate(b,a);if(void 0!==c&&null!==c){var g=U.isShift(a);U.is(N.TAB()[0])(a)?(g=(g?ka.prev:ka.next)(b,
c),ka.progress(c,g),a.kill()):U.is(N.ESCAPE()[0])(a)?(l(),a.kill(),e(a.target())):!g&&U.is(N.ENTER()[0])(a)?(d(a.target()),a.kill()):(c=[N.UP()[0],N.DOWN()[0]],g=["textarea","select","input"],U.inSet(c)(a)&&!1===k.contains(g,A.name(a.target()))&&a.kill())}}),l=function(){ka.exit(b);h.trigger.exit()},h=D.create({enter:r([]),exit:r([])});return nc({enter:function(){ka.enterFirst(b,c)},exit:l,clear:f.curry(ka.clear,b),refresh:f.curry(ka.refresh,b),isEnabled:f.curry(ka.isEnabled,b),isFocused:f.curry(Na.isFocused,
a),events:h.registry,destroy:function(){ka.destroy(b);g.unbind()}})},tabular:function(a,b,c){var d=b.row(),e=b.cell();Na.markSelectors(a,[d,e]);var g=xa(h.none()),l=Ch(a,function(a,b){return q(a,b).bind(function(a){Na.set(a);g.set(h.some(a));return h.some(!0)})}),p=C.immutable("row","col"),s=C.immutable("dc","dr"),m=function(a){a=X.descendants(a,d);return k.map(a,function(a){return X.descendants(a,e).length})},x=function(b){return I.closest(b,d).bind(function(c){return If.within(a,c,d).bind(function(a){return If.within(c,
b,e).map(function(b){return p(a.index(),b.index())})})})},n=function(b){var c=X.descendants(a,d);return h.from(c[b.row()]).bind(function(a){a=X.descendants(a,e);return h.from(a[b.col()])})},q=function(b,c){return Na.find(a).bind(function(d){return x(d).bind(function(d){var e=m(a);d=j_.move(e,d,s(b,c));return n(d)})})},r=wl.delegate(a,l,c);return nc({element:r.element,destroy:r.destroy,clear:function(){g.set(h.none())},isFocused:r.isFocused,isEnabled:f.always,refresh:f.noop,enter:function(){r.enter();
g.set(wl.findRecent(a,b.cell(),g.get(),c));g.get().each(Na.set)},exit:r.exit})},page:function(a,b,c){var d=b.stops().join(","),e=function(){return c.first().bind(function(b){return I.descendant(a,b)}).getOr(a)},g=function(a){var b=e();return(T.hasFocus(b)?h.some:Na.find)(b).bind(function(b){var c;c=e();if(L.eq(c,b)&&0>a)c=h.none();else{var g=X.descendants(c,d);b=k.findIndex(g,f.curry(L.eq,b)).getOr(-1)+a;c=b>=g.length?h.none():0>b?h.some(c):0<=b&&b<g.length?h.some(g[b]):h.none()}return c})};b=function(a){return g(a).bind(function(a){Na.set(a);
return h.some(!0)})};var l=ze(a,[U.rule(U.and([U.isShift,U.inSet(N.TAB())]),f.curry(b,-1)),U.rule(U.inSet(N.TAB()),f.curry(b,1)),U.rule(U.inSet(N.SPACE().concat(N.ENTER())),function(){return Na.find(a).bind(c.trigger()).map(f.always)})],h.none());return nc({element:l.element,destroy:l.destroy,clear:f.noop,isFocused:l.isFocused,isEnabled:f.always,refresh:f.noop,enter:function(){l.enter();Na.set(e())},exit:l.exit})},dynamic:function(a){var b=xa([]),c=function(a,c){U.is(N.TAB()[0])(c)&&(U.isShift(c)?
ka.prevNoCycle:ka.nextNoCycle)(b.get(),a).each(function(b){ka.progress(a,b);c.kill()})},d=E.bind(a,"keydown",function(a){var d=ka.locate(b.get(),a);void 0!==d&&null!==d&&c(d,a)}),e=D.create({enter:r([]),exit:r([])}),g=function(a){return function(){return a(b.get())}};return nc({element:f.constant(a),enter:function(){ka.first(b.get()).each(function(a){a.enter()})},exit:function(){ka.exit(b.get());e.trigger.exit()},set:function(a){ka.destroy(b.get());b.set(a)},clear:g(ka.clear),refresh:g(ka.refresh),
isEnabled:g(ka.isEnabled),isFocused:f.curry(Na.isFocused,a),destroy:function(){ka.destroy(b.get());d.unbind()},events:e.registry})}},k_={grid:function(a,b,c,d,e){Na.markSelectors(a,[b.cell()])}},l_=function(a,b){var c=h.from(k_[b]).getOr(f.noop);return function(){c.apply(null,arguments);return{element:f.noop,clear:f.noop,isFocused:f.noop,isEnabled:f.noop,refresh:f.noop,enter:f.noop,exit:f.noop,events:D.create({enter:r([]),exit:r([]),active:r([])}).registry,destroy:f.noop,set:f.noop,clickFocus:f.noop,
resize:f.noop}}},ba=Y.detect().deviceType.isTouch()?W.map(qB,l_):qB,Qd={toolbar:function(a,b){return NO(a,b)},menu:function(a,b,c){return tA.create(a,b,c)},popup:function(a,b,c,d,e){return Ah(a,b,c,d,e)},menuSystem:function(a,b,c){return Wn(a,b,c)}},ed={styleSpan:f.constant("ephox-hare-style-span"),base:f.constant("ephox-candy-mountain"),active:f.constant("ephox-candy-mountain-active"),autoresize:f.constant("ephox-candy-mountain-autoresize")},rB=Y.detect(),xl=rB.deviceType.isTouch,yl=function(a,b){return window.screen.width>=
a&&window.screen.height>=b},sB=function(){return!yl(620,700)&&xl()},Lb={isTouch:xl,choice:function(a,b){return k.foldl(a,function(a,b){return a.orThunk(function(){return b.predicate()?h.some(b.value()):h.none()})},h.none()).getOr(b)},isLarge:function(){return yl(620,700)},isLargeTouch:function(){return yl(620,700)&&xl()},isSmallTouch:sB,isLargeDesktop:function(){return yl(620,700)&&!xl()},isSmallAndroid:function(){return sB()&&rB.deviceType.isAndroid()}},Jf=Y.detect(),m_={"ephox-platform-desktop":!Jf.deviceType.isTouch(),
"ephox-platform-touch":Jf.deviceType.isTouch(),"ephox-platform-small-touch":Lb.isSmallTouch(),"ephox-platform-android":Jf.deviceType.isAndroid(),"ephox-platform-ios":Jf.deviceType.isiOS(),"ephox-platform-ie":Jf.browser.isIE()||Jf.browser.isEdge(),"ephox-platform-firefox":Jf.browser.isFirefox()},tB=[];W.each(m_,function(a,b){!0===a&&tB.push(b)});var kp={addClasses:function(a){ea.add(a,tB)}},uB=function(a,b){var c=q.fromTag("div");n.add(c,w.resolve(b));v.append(c,a);return c},hv={build:function(a,b,
c){h.from(b).filter(gi.isPrototypeOf).map(q.fromDom).each(function(b){var c=q.fromTag("div");n.add(c,w.resolve("flex-row"));var g=q.fromTag("div");n.add(g,w.resolve("flex-column"));J.append(g,y.children(a));v.append(a,c);v.append(c,g);v.append(c,uB(b,"side-bar"))});h.from(c).filter(gi.isPrototypeOf).map(q.fromDom).each(function(b){v.append(a,uB(b,"bottom-bar"))})}},n_=Eb.exactly(["compare","extract","mutate","sink"]),o_=Eb.exactly(["element","start","stop","destroy"]),p_=Eb.exactly(["forceDrop","drop",
"move","delayDrop"]),fk={mode:n_,sink:o_,api:p_},$u={resolve:ll.css("ephox-dragster").resolve},q_=fk.mode({compare:function(a,b){return Ba(b.left()-a.left(),b.top()-a.top())},extract:function(a){return h.some(Ba(a.x(),a.y()))},sink:function(a,b){var c=QO(b),d=E.bind(c.element(),"mousedown",a.forceDrop),e=E.bind(c.element(),"mouseup",a.drop),g=E.bind(c.element(),"mousemove",a.move),f=E.bind(c.element(),"mouseout",a.delayDrop);return fk.sink({element:c.element,start:function(a){v.append(a,c.element())},
stop:function(){B.remove(c.element())},destroy:function(){c.destroy();e.unbind();g.unbind();f.unbind();d.unbind()}})},mutate:function(a,b){a.mutate(b.left(),b.top())}}),r_={setup:function(a,b,c){var d=!1,e=D.create({start:r([]),stop:r([])}),g=TO(),f=function(){m.stop();g.isOn()&&(g.off(),e.trigger.stop())},h=oc.last(f,200);g.events.move.bind(function(c){b.mutate(a,c.info())});var k=function(a){return function(){var b=Array.prototype.slice.call(arguments,0);if(d)return a.apply(null,b)}},m=b.sink(fk.api({forceDrop:f,
drop:k(f),move:k(function(a,c){h.cancel();g.onEvent(a,b)}),delayDrop:k(h.throttle)}),c);return{element:m.element,go:function(a){m.start(a);g.on();e.trigger.start()},on:function(){d=!0},off:function(){d=!1},destroy:function(){m.destroy()},events:e.registry}}},Dh={transform:function(a,b){var c=void 0!==b?b:{};return r_.setup(a,void 0!==c.mode?c.mode:q_,b)}},VO={both:function(a){var b=D.create({relocate:r(["x","y","deltaX","deltaY"])});return{mutate:function(c,d){var e=Ja.absolute(a),g=e.left()+c,e=
e.top()+d;b.trigger.relocate(g,e,c,d)},events:b.registry}}},vB=C.immutable("hx","hy","position","x","y"),s_=function(a,b,c,d,e,g){g=b.x();b=b.y()-c;return(b>=a.y()&&b<=a.y()+a.h()?[vB(g,b,"absolute",g,b)]:[]).concat([vB(e,a.y(),"fixed",e-d.left(),a.fy())])},t_={detect:function(a,b,c,d,e,g){a=s_(a,b,e,g,c,d);return k.find(a,function(a){return 10>Math.abs(d-a.hy())&&38>Math.abs(c-a.hx())})}},wB={box:function(a){var b=Ja.absolute(a),c=ra.getOuter(a);a=ha.getOuter(a);var d=b.left(),b=b.top();return{x:f.constant(d),
y:f.constant(b),width:f.constant(c),height:f.constant(a),right:f.constant(d+c),bottom:f.constant(b+a)}}},Cq={resolve:jb.create("ephox-ego").resolve},zl=function(a){var b="data-"+Cq.resolve(a+"-left"),c="data-"+Cq.resolve(a+"-top"),d="data-"+Cq.resolve(a+"-position");return{get:function(a){var g=parseInt(m.get(a,b),10),l=parseInt(m.get(a,c),10);a=m.get(a,d);return isNaN(g)||isNaN(l)?h.none():h.some({left:f.constant(g),top:f.constant(l),position:f.constant(a)})},set:function(a,g,f,h){m.set(a,d,g);m.set(a,
b,f+"px");m.set(a,c,h+"px")},clear:function(a){m.remove(a,d);m.remove(a,b);m.remove(a,c)}}}("pre-snap"),u_=function(a,b,c,d,e,g){return zl.get(b).fold(function(){return a.fromLocation(b,c,d)},function(c){return a.fromFixed(b,c.left()+e,c.top()+g)})},v_=function(a,b,c,d){var e=y.owner(b),e=Ga.get(e);b=wB.box(b);c=c.loc();return t_.detect(a,b,c.left(),c.top(),d,e)},Dq=function(a,b,c,d){return{attrs:{"data-ephox-snap":"absolute"===b?"true":"false"},styles:{position:b,left:a.left+c+"px",top:a.top+d+"px"}}},
ti={move:function(a,b,c,d,e,g){var f=a.graph(),h=a.lazyTheatre(),k=a.lazyHeight();c=u_(f,b,c,d,e,g);var m=c.loc(),x=c.fixed(),n={top:0,left:0};return v_(h,a.container(),c,k).fold(function(){var a=f.boundToFixed(h,b,m.left(),m.top(),x.left(),x.top(),k);zl.set(b,"fixed",a.left(),a.top());return Dq(n,"fixed",a.left(),a.top())},function(c){var d=f.boundToFixed(h,b,m.left(),m.top(),x.left(),x.top(),k);zl.set(b,"fixed",d.left(),d.top());d="absolute"===c.position()?f.locationToAbsolute(b,c.x(),c.y()):Ba(c.x(),
c.y());a.resetOffset();return Dq(n,c.position(),d.left(),d.top())})},getSnapAttrs:Dq,forget:function(a){zl.clear(a)}},ev={none:function(a,b){var c=D.create({dragend:r([]),moved:r([])});return{blocker:f.die("no blocker"),setState:f.noop,getState:f.constant({}),init:function(d,e){var g=ti.getSnapAttrs(a.getOffset(),"absolute",d,e);t.setAll(b,g.styles);m.setAll(b,g.attrs);c.trigger.moved()},update:f.noop,destroy:f.noop,events:c.registry}},except:function(a){return function(b,c){var d=UO(c,a.join(",")),
e=D.create({dragend:K([],d.events.dragend),moved:r([])});d.events.relocate.bind(function(a){var d=a.x(),e=a.y(),f=a.deltaX();a=a.deltaY();d=ti.move(b,c,d,e,f,a);t.setAll(c,d.styles);m.setAll(c,d.attrs)});d.events.dragend.bind(function(){e.trigger.moved()});return{blocker:d.blocker,setState:function(a){t.setAll(c,a.styles);m.setAll(c,a.attrs)},getState:function(){var a=Ja.viewport(c);return ti.getSnapAttrs(b.getOffset(),"absolute",a.left(),a.top())},init:function(a,d){var f=ti.getSnapAttrs(b.getOffset(),
"absolute",a,d);t.setAll(c,f.styles);m.setAll(c,f.attrs);e.trigger.moved()},update:function(){ti.forget(c)},destroy:function(){d.destroy()},events:e.registry}}}},av={isInside:function(a,b,c,d){return!(b>a.y()+a.h()||c-d<a.y())},isAllInside:function(a,b,c){return b>a.y()&&b<a.y()+a.h()&&c>a.y()&&c<a.y()+a.h()}},fv={register:function(a,b,c,d){var e=a.container(),g=c(a,b),f=d(a,b),p=WO();c=D.create({dragend:K([],g.events.dragend),appear:K(["element"],f.events.appear),disappear:K(["element"],f.events.disappear),
dock:K([],p.events.dock),undock:K([],p.events.undock)});g.events.moved.bind(function(){m();k=!0});f.events.scrolled.bind(function(){m()});f.events.appear.bind(function(){var c=a.lazyTheatre(),d=a.graph();p.update(d,c,b,a.lazyHeight,e,a.getOffset())});var k=!1,m=function(){g.update();f.update();var c=a.lazyTheatre(),d=Ja.absolute(b),c=Math.max(0,c.x()+c.w()-d.left());t.set(b,"max-width",c+"px")};return{blocker:g.blocker,setState:function(a){g.setState(a);m();k=!0},state:function(){return k?h.some(g.getState()):
h.none()},init:function(b,c,d){a.setOffset(d);g.init(b,c);m()},update:m,destroy:function(){f.destroy();g.destroy()},events:c.registry}}},dv={transitions:function(a,b){var c=a.container(),d=y.defaultView(b),e=D.create({appear:r(["element"]),disappear:r(["element"]),scrolled:r([])}),g=E.bind(d,"scroll",function(){e.trigger.scrolled()});return{update:function(){var d=a.lazyTheatre(),g=a.lazyHeight(),f=wB.box(c);av.isInside(d,f.y(),f.bottom(),g)?e.trigger.appear(b):e.trigger.disappear(b)},destroy:function(){g.unbind()},
events:e.registry}}},bv=C.immutable("fixed","loc"),YO=function(a,b,c,d){b=XO(b);var e={top:0,left:0},g=function(a){e.top=a.top;e.left=a.left};return{lazyTheatre:a,graph:f.constant(b),lazyHeight:c,container:f.constant(d),setOffset:g,resetOffset:function(){g({top:-1*c(),left:0})},getOffset:function(){return e}}},Eq=w.resolve("drag-show"),xB=w.resolve("fade-container"),uc={width:function(a,b){return t.getRaw(a,"max-width").fold(function(){return y.owner(b).dom().defaultView.innerWidth-Ja.absolute(b).left()},
function(a){return parseInt(a,10)})},updateWidth:function(a,b,c){b=0===c.extra().length?c.withinWidth():c.withinWidth()+ra.getOuter(b.group());0<b&&t.set(a,"width",b+"px")},clearWidth:function(a){t.remove(a,"width")},offsetFrom:function(a,b,c,d){b=void 0!==d.toolbar.offset?d.toolbar.offset:d.toolbar.sticky?{left:0,top:0}:{left:0,top:-1*c};c=Ja.absolute(a.element());a=a.isInline()?{left:c.left(),top:c.top()}:{left:0,top:0};return{left:a.left+b.left,top:a.top+b.top}},initFade:function(a){n.add(a,Eq)},
fadeIn:function(a,b){k.each(a,function(a){n.remove(a,xB)});n.add(b,Eq)},fadeOut:function(a,b){k.each(a,function(a){n.add(a,xB)});n.remove(b,Eq)}},bP={setup:function(a,b,c,d){return(!0===c.toolbar.draggable?ZO:!0===c.toolbar.sticky||void 0!==c.toolbar.offset||a.isInline()?$O:Zu)(a,b,c)}};Y.detect();var gv=function(a,b){a.updateUi(b);var c=[pf.editorContainer(),"ephox-textbox-font",w.resolve("layer-editor")];ea.add(b,c);m.set(b,"lang",ce.get());kp.addClasses(b)},w_=function(a){a=ne.absolute(a);var b=
ne.view();a=HY.intersect(a,b);return Re(a.x(),a.y(),a.width(),a.height())},lp={build:function(a,b,c,d,e,g,f,h){var k=aP(a,b,c,g,f,h),m=d.tabbed(k);m.init();return{element:k.element,socket:k.socket,viewport:k.viewport,uiContainerParent:k.uiContainerParent,init:function(b,d,f){d=m.config(a.isInline(),d,e,f);jB.setup(k,g,a,b,c,d);m.loaded()},connect:k.connect,destroy:function(){k.destroy();m.destroy()},displayBanner:k.displayBanner,hideBanner:k.hideBanner,position:k.position,refresh:k.refresh,tabstrip:k.toolbar,
state:k.state,dialogContainer:k.dialogContainer}},bounds:function(){var a=function(a){var c=function(){return h.from(a.bounds()).filter(gi.isPrototypeOf).map(q.fromDom).map(w_).getOrThunk(ne.view)};return Q.isFunction(a.bounds)?c:ne.view};return Y.detect().deviceType.isTouch()?f.constant(ne.view):a}()},$x={settings:function(a){return{onprem:!0,blocktag:{styles:[{rule:"p"},{rule:"h1"},{rule:"h2"},{rule:"h3"},{rule:"h4"},{rule:"div"},{rule:"pre"}],showDocumentStyles:!1,bundled:!0},image:{bundled:!0},
imageEdit:{bundled:!0},imageupload:{immediate:!1,bundled:!1},content:{imageExcludes:[],css:a+"/css",tabindex:null,stylesheets:[],documentStyles:"",prettyprint:!0,showDocumentStyles:!1,autoresize:!1},ui:{layout:lp,isFullScreen:!1,toolbar:{draggable:!1,sticky:!1},locale:{},editorName:H.value("debug"),bounds:null,showHelpHint:!1,autoresize:!1},shortcuts:{features:!0},spelling:{bundled:!0,autocorrect:!0,scanView:!0,multilingual:!0,menu:!0},specialchar:{bundled:!0},fileupload:{bundled:!0,allowLocalImages:!0},
horizontalrule:{bundled:!0},media:{bundled:!0},mentions:{bundled:!1},registration:{bundled:!1},help:{baseUrl:a+"/html",integration:{},bundled:!0},draganddrop:{bundled:!0},wordcount:{bundled:!0},formatting:{bundled:!0},alignindent:{bundled:!0},directionality:{bundled:!0},parlance:{bundled:!0,languages:"en_us en_gb es fr de pt zh".split(" ")},font:{faces:[],colors:{buttons:[]},bundled:!0},lists:{bundled:!0},link:{bundled:!0},linkvalidator:{bundled:!1},bookmark:{bundled:!0},removeformat:{bundled:!0},
fullscreen:{bundled:!0},editorcontext:{bundled:!0},macros:{allowed:h.none(),bundled:!0},highlighter:{external:[],bundled:!0},table:{colors:{buttons:[]},bundled:!0},contextmenu:{bundled:!0},project:{apiKey:null},smartclipboard:{bundled:!0,copy:{},paste:{forceText:!1,baseUrl:a+"/js",swf:a+"/flash/textboxpaste.swf",officeStyles:"prompt",htmlStyles:"merge",allowLocalImages:!0,enableFlashImport:!0}},resize:{bundled:!0},platform:{toolbar:{items:GY,contextual:["table-tools","image-tools"]},allowLocalImages:!0,
fillscreen:!1},codeview:{bundled:!0,showButton:!0,mode:"pencil",css:a+"/css",js:a+"/js"},findreplace:{bundled:!0},accessibility:{bundled:!0},plaincodeview:{bundled:!0},embed:{inlineStyles:!0,bundled:!1}}},state:function(){return{spelling:{words:{},language:h.none()},undo:{initial:{raw:"",marked:""},undo:[],redo:[]},profile:{spelling:!1,nativeSpelling:!0,autocorrect:!0,capitalisation:!1,linkpreviews:!1},content:{raw:"",marked:""},ui:{toolbar:{drag:h.none()}},macros:{customs:{}},filters:{customs:[]},
laundry:{dirty:!1},linkvalidator:{ignore:[],cache:{}},embed:{cache:{}}}}},Fq=C.immutable("item","mode"),Gq=function(a,b,c,d){var e=void 0!==d?d:ui;return a.property().parent(b).map(function(a){return Fq(a,e)})},ui=function(a,b,c,d){var e=void 0!==d?d:zg;return c.sibling(a,b).map(function(a){return Fq(a,e)})},zg=function(a,b,c,d){var e=void 0!==d?d:zg;a=a.property().children(b);return c.first(a).map(function(a){return Fq(a,e)})},x_=[{current:Gq,next:ui,fallback:h.none()},{current:ui,next:zg,fallback:h.some(Gq)},
{current:zg,next:zg,fallback:h.some(ui)}],yB=function(a,b,c,d,e){e=void 0!==e?e:x_;return k.find(e,function(a){return a.current===c}).bind(function(c){return c.current(a,b,d,c.next).orThunk(function(){return c.fallback.bind(function(c){return yB(a,b,c,d)})})})},Kf={backtrack:Gq,sidestep:ui,advance:zg,go:yB},Al={left:function(){return{sibling:function(a,b){return a.query().prevSibling(b)},first:function(a){return 0<a.length?h.some(a[a.length-1]):h.none()}}},right:function(){return{sibling:function(a,
b){return a.query().nextSibling(b)},first:function(a){return 0<a.length?h.some(a[0]):h.none()}}}},Hq=function(a,b,c,d,e,g){return Kf.go(a,b,d,e).bind(function(b){return g(b.item())?h.none():c(b.item())?h.some(b.item()):Hq(a,b.item(),c,b.mode(),e,g)})},Bl={left:function(a,b,c,d){return Hq(a,b,c,Kf.sidestep,Al.left(),d)},right:function(a,b,c,d){return Hq(a,b,c,Kf.sidestep,Al.right(),d)}},zB=function(a,b){return 0===a.property().children(b).length},AB=function(a,b,c,d){return Bl.left(a,b,c,d)},BB=function(a,
b,c,d){return Bl.right(a,b,c,d)},ma={before:function(a,b,c){return AB(a,b,f.curry(zB,a),c)},after:function(a,b,c){return BB(a,b,f.curry(zB,a),c)},seekLeft:AB,seekRight:BB,walkers:function(){return{left:Al.left,right:Al.right}},walk:function(a,b,c,d,e){return Kf.go(a,b,c,d,e)},backtrack:Kf.backtrack,sidestep:Kf.sidestep,advance:Kf.advance},Ag=Sa(),Kb={gather:function(a,b,c){return ma.gather(Ag,a,b,c)},before:function(a,b){return ma.before(Ag,a,b)},after:function(a,b){return ma.after(Ag,a,b)},seekLeft:function(a,
b,c){return ma.seekLeft(Ag,a,b,c)},seekRight:function(a,b,c){return ma.seekRight(Ag,a,b,c)},walkers:function(){return ma.walkers()},walk:function(a,b,c,d){return ma.walk(Ag,a,b,c,d)}},CB=function(a){return q.fromDom(a.dom().cloneNode(!0))},Iq=function(a,b){var c=q.fromTag(b),d=m.clone(a);m.setAll(c,d);return c},ac={shallow:function(a){return q.fromDom(a.dom().cloneNode(!1))},shallowAs:Iq,deep:CB,copy:function(a,b){var c=Iq(a,b),d=y.children(CB(a));J.append(c,d);return c},mutate:function(a,b){var c=
Iq(a,b);v.before(a,c);var d=y.children(a);J.append(c,d);B.remove(a);return c}},kv={convertToHeading:function(a,b){var c=y.owner(a),c=q.fromTag(b,c.dom()),d=y.children(a),d=k.map(d,ac.deep);J.append(c,d);d=X.descendants(c,"b,strong");k.each(d,B.unwrap);v.before(a,c);B.remove(a);return H.value(c)},joinLinks:function(a,b){return Kb.seekLeft(b,function(a){return"a"===A.name(a)},a).fold(function(){return H.value(b)},function(a){var d=y.children(b);J.append(a,d);B.remove(b);return H.value(a)})}},DB=C.immutable("row",
"y"),EB=C.immutable("col","x"),FB=function(a){return Ja.absolute(a).left()+ra.getOuter(a)},GB=function(a){return Ja.absolute(a).left()},HB=function(a,b){return EB(a,GB(b))},IB=function(a,b){return EB(a,FB(b))},Jq=function(a){return Ja.absolute(a).top()},Kq=function(a,b,c){if(0===c.length)return[];var d=k.map(c.slice(1),function(b,c){return b.map(function(b){return a(c,b)})}),e=c[c.length-1].map(function(a){return b(c.length-1,a)});return d.concat([e])},y_={delta:f.identity,positions:f.curry(Kq,function(a,
b){return DB(a,Jq(b))},function(a,b){return DB(a,Jq(b)+ha.getOuter(b))}),edge:Jq},z_={delta:f.identity,edge:GB,positions:f.curry(Kq,HB,IB)},A_={delta:function(a,b){return-a},edge:FB,positions:f.curry(Kq,IB,HB)},ai={height:y_,rtl:A_,ltr:z_},Nj={ltr:ai.ltr,rtl:ai.rtl},JB=function(a){return"img"===A.name(a)?1:Fa.getOption(a).fold(function(){return y.children(a).length},function(a){return a.length})},B_=function(a){return Fa.getOption(a).filter(function(a){return 0!==a.trim().length||-1<a.indexOf("\u00a0")}).isSome()},
C_=["img","br"],ja={getEnd:JB,isEnd:function(a,b){return JB(a)===b},isStart:function(a,b){return 0===b},isCursorPosition:function(a){return B_(a)||k.contains(C_,A.name(a))}},D_=function(a,b){var c=function(a){a=y.children(a);for(var e=a.length-1;0<=e;e--){var g=a[e];if(b(g))return h.some(g);g=c(g);if(g.isSome())return g}return h.none()};return c(a)},Ab={first:function(a){return sa.descendant(a,ja.isCursorPosition)},last:function(a){return D_(a,ja.isCursorPosition)}},Lq=function(){var a=q.fromTag("td");
v.append(a,q.fromTag("br"));return a},E_=function(a,b,c){var d=ac.copy(a,b);W.each(c,function(a,b){null===a?m.remove(d,b):m.set(d,b,a)});return d},F_=function(a){return a},KB=function(a){return function(){return q.fromTag("tr",a.dom())}},G_=function(a,b,c){return Ab.first(a).map(function(d){var e=c.join(",");d=X.ancestors(d,e,function(b){return L.eq(b,a)});return k.foldr(d,function(a,b){var c=ac.shallow(b);v.append(a,c);return c},b)}).getOr(b)},LB={cellOperations:function(a,b,c){return{row:KB(b),
cell:function(b){var e=y.owner(b.element()),e=q.fromTag(A.name(b.element()),e.dom()),g=c.getOr("strong em b i span font h1 h2 h3 h4 h5 h6 p div".split(" ")),g=0<g.length?G_(b.element(),e,g):e;v.append(g,q.fromTag("br"));t.copy(b.element(),e);t.remove(e,"height");1!==b.colspan()&&t.remove(b.element(),"width");a(b.element(),e);return e},replace:E_,gap:Lq}},paste:function(a){return{row:KB(a),cell:Lq,replace:F_,gap:Lq}}},Mb={erase:function(a,b,c,d){a=q.fromText("");v.after(b,a);B.remove(b);return h.some(Zb(a,
0,a,0))},execute:function(a,b,c,d){return function(e,g,l){var p=d(),k=e.doc().getOrDie();e=jv(a.directionAt);var m=h.some([]),k=LB.cellOperations(c,k,m);return b(p,g,l,k,e,f.noop,f.noop).bind(function(a){return a.cursor().map(function(a){return Zb(a,0,a,0)})})}}},ip={only:function(a){var b=h.from(a.dom().documentElement).map(q.fromDom).getOr(a);return{parent:f.constant(b),view:f.constant(a),origin:f.constant(Ba(0,0))}},detached:function(a,b){var c=f.curry(Ja.absolute,b);return{parent:f.constant(b),
view:f.constant(a),origin:c}},body:function(a,b){return{parent:f.constant(b),view:f.constant(a),origin:f.constant(Ba(0,0))}}},MB=function(a,b,c){return a.isInline()?ip.detached(a.element(),b.uiContainer()):ip.only(c)},cp={get:MB,fromEngine:function(a){var b=a.content(),c=a.smartview();return b.doc().map(function(a){return MB(b,c,a)})}},H_=C.immutable("width","height"),I_=C.immutable("rows","columns"),J_=C.immutable("row","column"),K_=C.immutable("x","y"),L_=C.immutable("element","rowspan","colspan"),
M_=C.immutable("element","rowspan","colspan","isNew"),N_=C.immutable("element","rowspan","colspan","row","column"),O_=C.immutable("element","cells","section"),P_=C.immutable("element","isNew"),Q_=C.immutable("element","cells","section","isNew"),R_=C.immutable("cells","section"),S_=C.immutable("details","section"),T_=C.immutable("startRow","startCol","finishRow","finishCol"),ya={dimensions:H_,grid:I_,address:J_,coords:K_,extended:N_,detail:L_,detailnew:M_,rowdata:O_,elementnew:P_,rowdatanew:Q_,rowcells:R_,
rowdetails:S_,bounds:T_},Mq=function(a,b,c){return k.bind(y.children(a),function(a){return qa.is(a,b)?c(a)?[a]:[]:Mq(a,b,c)})},vi={firstLayer:function(a,b){return Mq(a,b,f.constant(!0))},filterFirstLayer:Mq},Nq=function(a,b,c){var d=void 0!==c?c:f.constant(!1);return d(b)?h.none():k.contains(a,A.name(b))?h.some(b):I.ancestor(b,a.join(","),function(a){return qa.is(a,"table")||d(a)})},NB=function(a,b){return y.parent(b).map(function(b){return X.children(b,a)})},U_=f.curry(NB,"th,td"),V_=f.curry(NB,
"tr"),Oq=function(a,b){return parseInt(m.get(a,b),10)},Xa={cell:function(a,b){return Nq(["td","th"],a,b)},firstCell:function(a){return I.descendant(a,"th,td")},cells:function(a){return vi.firstLayer(a,"th,td")},neighbourCells:U_,table:function(a,b){return I.closest(a,"table",b)},row:function(a,b){return Nq(["tr"],a,b)},rows:function(a){return vi.firstLayer(a,"tr")},notCell:function(a,b){return Nq(["caption","tr","tbody","tfoot","thead"],a,b)},neighbourRows:V_,attr:Oq,grid:function(a,b,c){b=Oq(a,b);
a=Oq(a,c);return ya.grid(b,a)}},Se={fromTable:function(a){a=Xa.rows(a);return k.map(a,function(a){var c=y.parent(a).bind(function(a){a=A.name(a);return"tfoot"===a||"thead"===a||"tbody"===a?a:"tbody"}),d=k.map(Xa.cells(a),function(a){var b=m.has(a,"rowspan")?parseInt(m.get(a,"rowspan"),10):1,c=m.has(a,"colspan")?parseInt(m.get(a,"colspan"),10):1;return ya.detail(a,b,c)});return ya.rowdata(a,d,c)})},fromPastedRows:function(a,b){return k.map(a,function(a){var d=k.map(Xa.cells(a),function(a){var b=m.has(a,
"rowspan")?parseInt(m.get(a,"rowspan"),10):1,c=m.has(a,"colspan")?parseInt(m.get(a,"colspan"),10):1;return ya.detail(a,b,c)});return ya.rowdata(a,d,b.section())})}},OB=function(a,b){var c=k.bind(a.all(),function(a){return a.cells()});return k.filter(c,b)},fb={generate:function(a){var b={},c=[],d=a.length,e=0;k.each(a,function(a,d){var f=[];k.each(a.cells(),function(a,c){for(var g=0;void 0!==b[d+","+g];)g++;for(var h=ya.extended(a.element(),a.rowspan(),a.colspan(),d,g),k=0;k<a.colspan();k++)for(var m=
0;m<a.rowspan();m++){var n=g+k;b[d+m+","+n]=h;e=Math.max(e,n+1)}f.push(h)});c.push(ya.rowdata(a.element(),f,a.section()))});a=ya.grid(d,e);return{grid:f.constant(a),access:f.constant(b),all:f.constant(c)}},getAt:function(a,b,c){a=a.access()[b+","+c];return void 0!==a?h.some(a):h.none()},findItem:function(a,b,c){a=OB(a,function(a){return c(b,a.element())});return 0<a.length?h.some(a[0]):h.none()},filterItems:OB,justCells:function(a){a=k.map(a.all(),function(a){return a.cells()});return k.flatten(a)}},
kd={repeat:function(a,b){for(var c=[],d=0;d<a;d++)c.push(b(d));return c},range:function(a,b){for(var c=[],d=a;d<b;d++)c.push(d);return c},unique:function(a,b){var c=[];k.each(a,function(d,e){e<a.length-1&&!b(d,a[e+1])?c.push(d):e===a.length-1&&c.push(d)});return c},deduce:function(a,b){if(0>b||b>=a.length-1)return h.none();var c=a[b].fold(function(){var c=k.reverse(a.slice(0,b));return $a.findMap(c,function(a,b){return a.map(function(a){return{value:a,delta:b+1}})})},function(a){return h.some({value:a,
delta:0})}),d=a[b+1].fold(function(){var c=a.slice(b+1);return $a.findMap(c,function(a,b){return a.map(function(a){return{value:a,delta:b+1}})})},function(a){return h.some({value:a,delta:1})});return c.bind(function(a){return d.map(function(b){var c=b.delta+a.delta;return Math.abs(b.value-a.value)/c})})}},PB=function(a,b,c){var d=a();return k.find(d,b).orThunk(function(){return h.from(d[0]).orThunk(c)}).map(function(a){return a.element()})},Cl={columns:function(a){var b=a.grid(),c=kd.range(0,b.columns()),
d=kd.range(0,b.rows());return k.map(c,function(b){return PB(function(){return k.bind(d,function(c){return fb.getAt(a,c,b).filter(function(a){return a.column()===b}).fold(f.constant([]),function(a){return[a]})})},function(a){return 1===a.colspan()},function(){return fb.getAt(a,0,b)})})},rows:function(a){var b=a.grid(),c=kd.range(0,b.rows()),d=kd.range(0,b.columns());return k.map(c,function(b){return PB(function(){return k.bind(d,function(c){return fb.getAt(a,b,c).filter(function(a){return a.row()===
b}).fold(f.constant([]),function(a){return[a]})})},function(a){return 1===a.rowspan()},function(){return fb.getAt(a,b,0)})})}},QB=Y.detect(),Bg=function(a,b,c){a=t.get(a,b);a=parseFloat(a);return isNaN(a)?c:a},W_={getWidth:function(a){return Bg(a,"width",ra.get(a))},getHeight:function(a){var b;if(QB.browser.isIE()||QB.browser.isEdge()){b=Bg(a,"padding-top",0);var c=Bg(a,"padding-bottom",0),d=Bg(a,"border-top-width",0),e=Bg(a,"border-bottom-width",0),g=a.dom().getBoundingClientRect().height;a=t.get(a,
"box-sizing");b="border-box"===a?g:g-b-c-(d+e)}else b=Bg(a,"height",ha.get(a));return b}},RB=/(\d+(\.\d+)?)(\w|%)*/,wi=/(\d+(\.\d+)?)%/,Pq=/(\d+(\.\d+)?)px|em/,SB=function(a,b){t.set(a,"height",b+"px")},X_=function(a){return t.getRaw(a,"height").getOrThunk(function(){return W_.getHeight(a)+"px"})},Y_=function(a,b,c,d){var e=Xa.table(a).map(function(a){a=c(a);return Math.floor(b/100*a)}).getOr(b);d(a,e);return e},Dl=function(a){return t.getRaw(a,"width").fold(function(){return h.from(m.get(a,"width"))},
function(a){return h.some(a)})},Gb={percentageBasedSizeRegex:f.constant(wi),pixelBasedSizeRegex:f.constant(Pq),setPixelWidth:function(a,b){t.set(a,"width",b+"px")},setPercentageWidth:function(a,b){t.set(a,"width",b+"%")},setHeight:SB,getPixelWidth:function(a,b){return Dl(a).fold(function(){var b=ra.get(a);return parseInt(b,10)},function(c){Pq.test(c)?(c=Pq.exec(c),c=parseInt(c[1],10)):wi.test(c)?(c=wi.exec(c),c=parseFloat(c[1])/100*b.pixelWidth()):(c=ra.get(a),c=parseInt(c,10));return c})},getPercentageWidth:function(a,
b){return Dl(a).fold(function(){var c=ra.get(a);return parseInt(c,10)/b.pixelWidth()*100},function(c){wi.test(c)?(c=wi.exec(c),c=parseFloat(c[1])):(c=ra.get(a),c=parseInt(c,10)/b.pixelWidth()*100);return c})},getGenericWidth:function(a){return Dl(a).bind(function(a){return RB.test(a)?(a=RB.exec(a),h.some({width:f.constant(a[1]),unit:f.constant(a[3])})):h.none()})},setGenericWidth:function(a,b,c){t.set(a,"width",b+c)},getHeight:function(a){var b;if(b=X_(a)){var c=ha.get,d=parseInt(b,10);b=aa.endsWith(b,
"%")&&"table"!==A.name(a)?Y_(a,d,c,SB):d}else b=ha.get(a);a=m.has(a,"rowspan")?parseInt(m.get(a,"rowspan"),10):1;return b/a},getRawWidth:Dl},TB=function(a,b){return m.has(a,b)&&1<parseInt(m.get(a,b),10)},Uc={hasColspan:function(a){return TB(a,"colspan")},hasRowspan:function(a){return TB(a,"rowspan")},minWidth:f.constant(10),minHeight:f.constant(10),getInt:function(a,b){return parseInt(t.get(a,b),10)}},UB=function(a,b,c){return t.getRaw(a,b).fold(function(){return c(a)+"px"},function(a){return a})},
Z_=function(a){return UB(a,"width",Gb.getPixelWidth)},$_=function(a){return UB(a,"height",Gb.getHeight)},Qq=function(a,b,c,d,e){a=Cl.columns(a);var g=k.map(a,function(a){return a.map(b.edge)});return k.map(a,function(a,b){return a.filter(f.not(Uc.hasColspan)).fold(function(){var a=kd.deduce(g,b);return d(a)},function(a){return c(a,e)})})},VB=function(a){return a.map(function(a){return a+"px"}).getOr("")},WB=function(a,b,c,d){a=Cl.rows(a);var e=k.map(a,function(a){return a.map(b.edge)});return k.map(a,
function(a,b){return a.filter(f.not(Uc.hasRowspan)).fold(function(){var a=kd.deduce(e,b);return d(a)},function(a){return c(a)})})},xi={getRawWidths:function(a,b){return Qq(a,b,Z_,VB)},getPixelWidths:function(a,b,c){return Qq(a,b,Gb.getPixelWidth,function(a){return a.getOrThunk(c.minCellWidth)},c)},getPercentageWidths:function(a,b,c){return Qq(a,b,Gb.getPercentageWidth,function(a){return a.fold(function(){return c.minCellWidth()},function(a){return a/c.pixelWidth()*100})},c)},getPixelHeights:function(a,
b){return WB(a,b,Gb.getHeight,function(a){return a.getOrThunk(Uc.minHeight)})},getRawHeights:function(a,b){return WB(a,b,$_,VB)}},El=la.generate([{invalid:["raw"]},{pixels:["value"]},{percent:["value"]}]),XB=function(a,b,c){a=c.substring(0,c.length-a.length);var d=parseFloat(a);return a===d.toString()?b(d):El.invalid(c)},Lf=function(a){return aa.endsWith(a,"%")?XB("%",El.percent,a):aa.endsWith(a,"px")?XB("px",El.pixels,a):El.invalid(a)},a0=function(a,b){return k.map(a,function(a){return Lf(a).fold(function(){return a},
function(a){return a/b*100+"%"},function(a){return a+"%"})})},b0=function(a,b,c){var d=c/b;return k.map(a,function(a){return Lf(a).fold(function(){return a},function(a){return a*d+"px"},function(a){return a/100*c+"px"})})},c0=function(a,b){var c=a.fold(function(){return f.constant("")},function(a){return f.constant(a/b+"px")},function(a){return f.constant(a/b+"px")});return kd.repeat(b,c)},d0=function(a,b,c){return a.fold(function(){return b},function(a){return b0(b,c,a)},function(a){return a0(b,
c)})},YB=function(a,b){var c=Math.floor(a);return{value:c+b,remainder:a-c}},e0=function(a,b){return Lf(a).fold(f.constant(a),function(a){return a+b+"px"},function(a){return a+b+"%"})},ZB=function(a){if(0===a.length)return a;a=k.foldr(a,function(a,b){var e=Lf(b).fold(function(){return{value:b,remainder:0}},function(a){return YB(a,"px")},function(a){return YB(a,"%")});return{output:[e.value].concat(a.output),remainder:a.remainder+e.remainder}},{output:[],remainder:0});var b=a.output;return b.slice(0,
b.length-1).concat([e0(b[b.length-1],Math.round(a.remainder))])},yi={validate:Lf,redistribute:function(a,b,c){c=Lf(c);a=k.forall(a,function(a){return"0px"===a})?c0(c,a.length):d0(c,a,b);return ZB(a)},sum:function(a,b){return 0===a.length?b:k.foldr(a,function(a,b){return Lf(b).fold(f.constant(0),f.identity,f.identity)+a},0)},toIntegers:ZB},f0=function(a,b,c){k.each(b,function(b){var e=a.slice(b.column(),b.colspan()+b.column()),e=yi.sum(e,Uc.minWidth());t.set(b.element(),"width",e+c)})},g0=function(a,
b,c,d){k.each(c,function(b){var c=a.slice(b.row(),b.rowspan()+b.row()),c=yi.sum(c,Uc.minHeight());t.set(b.element(),"height",c+d)});k.each(b,function(b,c){t.set(b.element(),"height",a[c])})},$B=function(a){return yi.validate(a).fold(f.constant("px"),f.constant("px"),f.constant("%"))},h0={redistribute:function(a,b,c,d){var e=Se.fromTable(a),g=fb.generate(e),f=g.all(),h=fb.justCells(g);b.each(function(b){var c=$B(b),e=ra.get(a),f=xi.getRawWidths(g,d),e=yi.redistribute(f,e,b);f0(e,h,c);t.set(a,"width",
b)});c.each(function(b){var c=$B(b),d=ha.get(a),e=xi.getRawHeights(g,ai.height),d=yi.redistribute(e,d,b);g0(d,f,h,c);t.set(a,"height",b)})}},i0=function(a){var b=m.has(a,"colspan")?parseInt(m.get(a,"colspan"),10):1,c=m.has(a,"rowspan")?parseInt(m.get(a,"rowspan"),10):1;return{element:f.constant(a),colspan:f.constant(b),rowspan:f.constant(c)}},Rq=Eb.exactly(["cell","row","replace","gap"]),ub={modification:function(a,b){Rq(a);var c=xa(h.none()),d=void 0!==b?b:i0,e=function(b){var e;e=d(b);e=a.cell(e);
c.get().isNone()&&c.set(h.some(e));g=h.some({item:b,replacement:e});return e},g=h.none();return{getOrInit:function(a,b){return g.fold(function(){return e(a)},function(c){return b(a,c.item)?c.replacement:e(a)})},cursor:c.get}},transform:function(a,b){return function(c){var d=xa(h.none());Rq(c);var e=[],g=function(a,b){return k.find(e,function(c){return b(c.item,a)})},f=function(g){var f=c.replace(g,b,{scope:a});e.push({item:g,sub:f});d.get().isNone()&&d.set(h.some(f));return f};return{replaceOrInit:function(a,
b){return g(a,b).fold(function(){return f(a)},function(c){return b(a,c.item)?c.sub:f(a)})},cursor:d.get}}},merging:function(a){Rq(a);var b=xa(h.none());return{combine:function(c){b.get().isNone()&&b.set(h.some(c));return function(){var b=a.cell({element:f.constant(c),colspan:f.constant(1),rowspan:f.constant(1)});t.remove(b,"width");t.remove(c,"width");return b}},cursor:b.get}}},j0="body p div article aside figcaption figure footer header nav section ol ul table thead tfoot tbody caption tr td th h1 h2 h3 h4 h5 h6 blockquote pre address".split(" "),
aC=function(a,b){var c=a.property().name(b);return k.contains(j0,c)},bC=function(a,b){return k.contains(["br","img","hr","input"],a.property().name(b))},Xb={isBlock:aC,isList:function(a,b){var c=a.property().name(b);return k.contains(["ol","ul"],c)},isFormatting:function(a,b){var c=a.property().name(b);return k.contains("address pre p h1 h2 h3 h4 h5 h6".split(" "),c)},isHeading:function(a,b){var c=a.property().name(b);return k.contains("h1 h2 h3 h4 h5 h6".split(" "),c)},isContainer:function(a,b){return k.contains("div li td th blockquote body caption".split(" "),
a.property().name(b))},isEmptyTag:bC,isFrame:function(a,b){return"iframe"===a.property().name(b)},isInline:function(a,b){return!(aC(a,b)||bC(a,b))&&"li"!==a.property().name(b)}},Te=Sa(),fa={isBlock:function(a){return Xb.isBlock(Te,a)},isList:function(a){return Xb.isList(Te,a)},isFormatting:function(a){return Xb.isFormatting(Te,a)},isHeading:function(a){return Xb.isHeading(Te,a)},isContainer:function(a){return Xb.isContainer(Te,a)},isEmptyTag:function(a){return Xb.isEmptyTag(Te,a)},isFrame:function(a){return Xb.isFrame(Te,
a)},isInline:function(a){return Xb.isInline(Te,a)}},k0={merge:function(a){var b=function(a){return k.forall(a,function(a){return"br"===A.name(a)||A.isText(a)&&0===Fa.get(a).trim().length})},c=function(a){return y.nextSibling(a).map(function(a){if(fa.isBlock(a))return!0;if(fa.isEmptyTag(a))return"img"===A.name(a)?!1:!0}).getOr(!1)},d=function(a){return Ab.last(a).bind(function(b){var d=c(b);return y.parent(b).map(function(c){var e;(e=!0===d)||(e="li"===A.name(c)||sa.ancestor(c,fa.isList).isSome()||
"br"===A.name(b)||fa.isBlock(c)&&!L.eq(a,c));return e?[]:[q.fromTag("br")]})}).getOr([])},e=function(){var c=k.bind(a,function(a){var c=y.children(a);return b(c)?[]:c.concat(d(a))});return 0===c.length?[q.fromTag("br")]:c}();B.empty(a[0]);J.append(a[0],e)}},cC=function(a,b){return ya.rowcells(b,a.section())},dC=function(a,b){return a.cells()[b]},ta={addCell:function(a,b,c){var d=a.cells(),e=d.slice(0,b);b=d.slice(b);c=e.concat([c]).concat(b);return cC(a,c)},setCells:cC,mutateCell:function(a,b,c){a.cells()[b]=
c},getCell:dC,getCellElement:function(a,b){return dC(a,b).element()},mapCells:function(a,b){var c=a.cells(),c=k.map(c,b);return ya.rowcells(c,a.section())},cellLength:function(a){return a.cells().length}},l0=function(a,b){return k.map(a,function(a){return ta.getCell(a,b)})},eC=function(a,b){if(0===a.length)return 0;var c=a[0];return k.findIndex(a,function(a){return!b(c.element(),a.element())}).fold(function(){return a.length},function(a){return a})},m0={subgrid:function(a,b,c,d){var e=a[b].cells().slice(c),
e=eC(e,d);a=l0(a,c).slice(b);d=eC(a,d);return{colspan:f.constant(e),rowspan:f.constant(d)}}},Fl={toDetails:function(a,b){var c=k.map(a,function(a,b){return k.map(a.cells(),function(a,b){return!1})});return k.map(a,function(d,e){var g=k.bind(d.cells(),function(d,g){if(!1===c[e][g]){for(var f=m0.subgrid(a,e,g,b),h=f.rowspan(),k=f.colspan(),m=e;m<e+h;m++)for(var n=g;n<g+k;n++)c[m][n]=!0;return[ya.detailnew(d.element(),f.rowspan(),f.colspan(),d.isNew())]}return[]});return ya.rowdetails(g,d.section())})},
toGrid:function(a,b,c){for(var d=[],e=0;e<a.grid().rows();e++){for(var g=[],f=0;f<a.grid().columns();f++){var h=fb.getAt(a,e,f).map(function(a){return ya.elementnew(a.element(),c)}).getOrThunk(function(){return ya.elementnew(b.gap(),!0)});g.push(h)}g=ya.rowcells(g,a.all()[e].section());d.push(g)}return d}},Gl=function(a,b,c,d){c===d?m.remove(a,b):m.set(a,b,c)},n0={render:function(a,b){var c=[],d=[],e=function(b,e){var g=I.child(a,e).getOrThunk(function(){var b=q.fromTag(e,y.owner(a).dom());v.append(a,
b);return b});B.empty(g);var f=k.map(b,function(a){a.isNew()&&c.push(a.element());var b=a.element();B.empty(b);k.each(a.cells(),function(a){a.isNew()&&d.push(a.element());Gl(a.element(),"colspan",a.colspan(),1);Gl(a.element(),"rowspan",a.rowspan(),1);v.append(b,a.element())});return b});J.append(g,f)},g=function(b,c){0<b.length?e(b,c):I.child(a,c).bind(B.remove)},l=[],h=[],s=[];k.each(b,function(a){switch(a.section()){case "thead":l.push(a);break;case "tbody":h.push(a);break;case "tfoot":s.push(a)}});
g(l,"thead");g(h,"tbody");g(s,"tfoot");return{newRows:f.constant(c),newCells:f.constant(d)}},copy:function(a){return k.map(a,function(a){var c=ac.shallow(a.element());k.each(a.cells(),function(a){var b=ac.deep(a.element());Gl(b,"colspan",a.colspan(),1);Gl(b,"rowspan",a.rowspan(),1);v.append(c,b)});return c})}},fC={col:function(a,b,c,d,e){var g=q.fromTag("div");t.setAll(g,{position:"absolute",left:b-d/2+"px",top:c+"px",height:e+"px",width:d+"px"});m.setAll(g,{"data-column":a,role:"presentation"});
return g},row:function(a,b,c,d,e){var g=q.fromTag("div");t.setAll(g,{position:"absolute",left:b+"px",top:c-e/2+"px",height:e+"px",width:d+"px"});m.setAll(g,{"data-row":a,role:"presentation"});return g}},Ac={resolve:ll.css("ephox-snooker").resolve},Sq=Ac.resolve("resizer-bar"),gC=Ac.resolve("resizer-rows"),hC=Ac.resolve("resizer-cols"),iC=function(a){a=X.descendants(a.parent(),"."+Sq);k.each(a,B.remove)},jC=function(a,b,c){var d=a.origin();k.each(b,function(b,g){b.each(function(b){b=c(d,b);n.add(b,
Sq);v.append(a.parent(),b)})})},o0=function(a,b,c,d){jC(a,b,function(a,b){var f=fC.col(b.col(),b.x()-a.left(),c.top()-a.top(),7,d);n.add(f,hC);return f})},p0=function(a,b,c,d){jC(a,b,function(a,b){var f=fC.row(b.row(),c.left()-a.left(),b.y()-a.top(),d,7);n.add(f,gC);return f})},kC=function(a,b){var c=X.descendants(a.parent(),"."+Sq);k.each(c,b)},wd={refresh:function(a,b,c,d){iC(a);var e=Se.fromTable(b),e=fb.generate(e),g=Cl.rows(e),f=Cl.columns(e),e=Ja.absolute(b);c=0<g.length?c.positions(g,b):[];
p0(a,c,e,ra.getOuter(b));d=0<f.length?d.positions(f,b):[];o0(a,d,e,ha.getOuter(b))},hide:function(a){kC(a,function(a){t.set(a,"display","none")})},show:function(a){kC(a,function(a){t.set(a,"display","block")})},destroy:iC,isRowBar:function(a){return n.has(a,gC)},isColBar:function(a){return n.has(a,hC)}},q0=function(a,b){var c=function(a){return $a.findMap(a,function(a){return y.parent(a.element()).map(function(a){var b=y.parent(a).isNone();return ya.elementnew(a,b)})}).getOrThunk(function(){return ya.elementnew(b.row(),
!0)})};return k.map(a,function(a){var b=c(a.details());return ya.rowdatanew(b.element(),a.details(),a.section(),b.isNew())})},lC=function(a,b){var c=Fl.toDetails(a,L.eq);return q0(c,b)},Hl=function(a,b){var c=k.flatten(k.map(a.all(),function(a){return a.cells()}));return k.find(c,function(a){return L.eq(b,a.element())})},za={run:function(a,b,c,d,e){return function(g,l,p,k,m){var x=Se.fromTable(l),n=fb.generate(x);return b(n,p).map(function(b){var c=Fl.toGrid(n,k,!1);b=a(c,b,L.eq,e(k));c=lC(b.grid(),
k);return{grid:f.constant(c),cursor:b.cursor}}).fold(function(){return h.none()},function(a){var b=n0.render(l,a.grid());c(l,a.grid(),m);d(l);wd.refresh(g,l,ai.height,m);return h.some({cursor:a.cursor,newRows:b.newRows,newCells:b.newCells})})}},toDetailList:lC,onCell:function(a,b){return Xa.cell(b.element()).bind(function(b){return Hl(a,b)})},onCells:function(a,b){var c=k.map(b.selection(),function(b){return Xa.cell(b).bind(function(b){return Hl(a,b)})}),c=$a.cat(c);return 0<c.length?h.some(c):h.none()},
onPaste:function(a,b){return Xa.cell(b.element()).bind(function(c){return Hl(a,c).map(function(a){return Z.merge(a,{generators:b.generators,clipboard:b.clipboard})})})},onPasteRows:function(a,b){var c=k.map(b.selection(),function(b){return Xa.cell(b).bind(function(b){return Hl(a,b)})}),c=$a.cat(c);return 0<c.length?h.some(Z.merge({cells:c},{generators:b.generators,clipboard:b.clipboard})):h.none()},onMergable:function(a,b){return b.mergable()},onUnmergable:function(a,b){return b.unmergable()}},mC=
function(a,b){return k.map(a,function(){return ya.elementnew(b.cell(),!0)})},r0=function(a,b,c){return a.concat(kd.repeat(b,function(b){return ta.setCells(a[a.length-1],mC(a[a.length-1].cells(),c))}))},s0=function(a,b,c){return k.map(a,function(a){return ta.setCells(a,a.cells().concat(mC(kd.range(0,b),c)))})},Cg={measure:function(a,b,c){if(a.row()>=b.length||a.column()>ta.cellLength(b[0]))return H.error("invalid start address out of table bounds, row: "+a.row()+", column: "+a.column());b=b.slice(a.row());
a=b[0].cells().slice(a.column());var d=ta.cellLength(c[0]);return H.value({rowDelta:f.constant(b.length-c.length),colDelta:f.constant(a.length-d)})},measureWidth:function(a,b){var c=ta.cellLength(a[0]),d=ta.cellLength(b[0]);return{rowDelta:f.constant(0),colDelta:f.constant(c-d)}},tailor:function(a,b,c){var d=0>b.colDelta()?s0:f.identity,e=0>b.rowDelta()?r0:f.identity;a=d(a,Math.abs(b.colDelta()),c);return e(a,Math.abs(b.rowDelta()),c)}},t0=function(a,b){return k.foldl(a,function(a,d){return k.exists(a,
function(a){return b(a.element(),d.element())})?a:a.concat([d])},[])},Il={merge:function(a,b,c,d){if(0===a.length)return a;for(c=b.startRow();c<=b.finishRow();c++)for(var e=b.startCol();e<=b.finishCol();e++)ta.mutateCell(a[c],e,ya.elementnew(d(),!1));return a},unmerge:function(a,b,c,d){for(var e=!0,g=0;g<a.length;g++)for(var f=0;f<ta.cellLength(a[0]);f++){var h=ta.getCellElement(a[g],f),h=c(h,b);!0===h&&!1===e?ta.mutateCell(a[g],f,ya.elementnew(d(),!0)):!0===h&&(e=!1)}return a},splitRows:function(a,
b,c,d){if(0<b&&b<a.length){var e=a[b-1].cells(),e=t0(e,c);k.each(e,function(e){for(var f=h.none(),p=b;p<a.length;p++)for(var k=0;k<ta.cellLength(a[0]);k++){var m=a[p].cells()[k];c(m.element(),e.element())&&(f.isNone()&&(f=h.some(d())),f.each(function(b){ta.mutateCell(a[p],k,ya.elementnew(b,!0))}))}})}return a}},Tq={merge:function(a,b,c,d,e){return Cg.measure(a,b,c).map(function(g){g=Cg.tailor(b,g,d);for(var l=a.row(),h=a.column(),k=c.length,m=ta.cellLength(c[0]),k=l+k,m=h+m,x=l;x<k;x++)for(var n=
h;n<m;n++){var q=g,r=x,t=n,u=e,v=ta.getCell(q[r],t),u=f.curry(u,v.element()),v=q[r];1<q.length&&1<ta.cellLength(v)&&(0<t&&u(ta.getCellElement(v,t-1))||t<v.length-1&&u(ta.getCellElement(v,t+1))||0<r&&u(ta.getCellElement(q[r-1],t))||r<q.length-1&&u(ta.getCellElement(q[r+1],t)))&&Il.unmerge(g,ta.getCellElement(g[x],n),e,d.cell);q=ta.getCellElement(c[x-l],n-h);q=d.replace(q);ta.mutateCell(g[x],n,ya.elementnew(q,!0))}return g})},insert:function(a,b,c,d,e){Il.splitRows(b,a,e,d.cell);e=Cg.measureWidth(c,
b);c=Cg.tailor(c,e,d);e=Cg.measureWidth(b,c);b=Cg.tailor(b,e,d);return b.slice(0,a).concat(c).concat(b.slice(a,b.length))}},Xc={insertRowAt:function(a,b,c,d,e){var g=a.slice(0,b),f=a.slice(b);c=ta.mapCells(a[c],function(c,g){return 0<b&&b<a.length&&d(ta.getCellElement(a[b-1],g),ta.getCellElement(a[b],g))?ta.getCell(a[b],g):ya.elementnew(e(c.element(),d),!0)});return g.concat([c]).concat(f)},insertColumnAt:function(a,b,c,d,e){return k.map(a,function(a){var f=0<b&&b<ta.cellLength(a)&&d(ta.getCellElement(a,
b-1),ta.getCellElement(a,b))?ta.getCell(a,b):ya.elementnew(e(ta.getCellElement(a,c),d),!0);return ta.addCell(a,b,f)})},splitCellIntoColumns:function(a,b,c,d,e){var g=c+1;return k.map(a,function(a,f){var h=f===b?ya.elementnew(e(ta.getCellElement(a,c),d),!0):ta.getCell(a,c);return ta.addCell(a,g,h)})},splitCellIntoRows:function(a,b,c,d,e){var g=b+1,f=a.slice(0,g),g=a.slice(g);a=ta.mapCells(a[b],function(a,b){return b===c?ya.elementnew(e(a.element(),d),!0):a});return f.concat([a]).concat(g)},deleteRowsAt:function(a,
b,c){return a.slice(0,b).concat(a.slice(c+1))},deleteColumnsAt:function(a,b,c){a=k.map(a,function(a){var e=a.cells().slice(0,b).concat(a.cells().slice(c+1));return ya.rowcells(e,a.section())});return k.filter(a,function(a){return 0<a.cells().length})}},nC=function(a,b,c,d){var e=function(a){return k.exists(b,function(b){return c(a.element(),b.element())})};return k.map(a,function(a){return ta.mapCells(a,function(a){return e(a)?ya.elementnew(d(a.element(),c),!0):a})})},oC=function(a,b,c,d){return void 0!==
ta.getCellElement(a[b],c)&&0<b&&d(ta.getCellElement(a[b-1],c),ta.getCellElement(a[b],c))},pC=function(a,b,c){return 0<b&&c(ta.getCellElement(a,b-1),ta.getCellElement(a,b))},Jl={replaceColumn:function(a,b,c,d){var e=k.bind(a,function(d,e){return oC(a,e,b,c)||pC(d,b,c)?[]:[ta.getCell(d,b)]});return nC(a,e,c,d)},replaceRow:function(a,b,c,d){var e=a[b],g=k.bind(e.cells(),function(d,g){return oC(a,b,g,c)||pC(e,g,c)?[]:[d]});return nC(a,g,c,d)}},zi=function(a){return{fold:a}},Dg={none:function(){return zi(function(a,
b,c,d,e){return a()})},only:function(a){return zi(function(b,c,d,e,g){return c(a)})},left:function(a,b){return zi(function(c,d,e,g,f){return e(a,b)})},middle:function(a,b,c){return zi(function(d,e,g,f,h){return f(a,b,c)})},right:function(a,b){return zi(function(c,d,e,g,f){return f(a,b)})}},u0=function(a,b){return 0===a.length?Dg.none():1===a.length?Dg.only(0):0===b?Dg.left(0,1):b===a.length-1?Dg.right(b-1,b):0<b&&b<a.length-1?Dg.middle(b-1,b,b+1):Dg.none()},v0={determine:function(a,b,c,d){var e=a.slice(0);
a=u0(a,b);var g=function(a){return k.map(a,f.constant(0))};b=f.constant(g(e));var l=function(a,b){if(0<=c){var f=Math.max(d.minCellWidth(),e[b]-c);return g(e.slice(0,a)).concat([c,f-e[b]]).concat(g(e.slice(b+1)))}var f=Math.max(d.minCellWidth(),e[a]+c),l=e[a]-f;return g(e.slice(0,a)).concat([f-e[a],l]).concat(g(e.slice(b+1)))};return a.fold(b,function(a){return d.singleColumnWidth(e[a],c)},l,function(a,b,c){return l(b,c)},function(a,b){if(0<=c)return g(e.slice(0,b)).concat([c]);var f=Math.max(d.minCellWidth(),
e[b]+c);return g(e.slice(0,b)).concat([f-e[b]])})}},qC=function(a,b,c){for(var d=0;a<b;a++)d+=void 0!==c[a]?c[a]:0;return d},Kl={recalculateWidth:function(a,b){var c=fb.justCells(a);return k.map(c,function(a){var c=qC(a.column(),a.column()+a.colspan(),b);return{element:a.element,width:f.constant(c),colspan:a.colspan}})},recalculateHeight:function(a,b){var c=fb.justCells(a);return k.map(c,function(a){var c=qC(a.row(),a.row()+a.rowspan(),b);return{element:a.element,height:f.constant(c),rowspan:a.rowspan}})},
matchRowHeight:function(a,b){return k.map(a.all(),function(a,d){return{element:a.element,height:f.constant(b[d])}})}},w0=function(a,b){var c=parseFloat(a),d=ra.get(b);return{width:f.constant(c),pixelWidth:f.constant(d),getWidths:xi.getPercentageWidths,getCellDelta:function(a){return a/d*100},singleColumnWidth:function(a,b){return[100-a]},minCellWidth:function(){return Uc.minWidth()/d*100},setElementWidth:Gb.setPercentageWidth,setTableWidth:function(a,b,d){Gb.setPercentageWidth(a,c+d)}}},Uq=function(a){a=
parseInt(a,10);var b=f.identity;return{width:f.constant(a),pixelWidth:f.constant(a),getWidths:xi.getPixelWidths,getCellDelta:b,singleColumnWidth:function(a,b){return[Math.max(Uc.minWidth(),a+b)-a]},minCellWidth:Uc.minWidth,setElementWidth:Gb.setPixelWidth,setTableWidth:function(a,b,e){b=k.foldr(b,function(a,b){return a+b},0);Gb.setPixelWidth(a,b)}}},rC={getTableSize:function(a){return Gb.getRawWidth(a).fold(function(){var b=ra.get(a);return Uq(b)},function(b){Gb.percentageBasedSizeRegex().test(b)?
(b=Gb.percentageBasedSizeRegex().exec(b),b=w0(b[1],a)):Gb.pixelBasedSizeRegex().test(b)?(b=Gb.pixelBasedSizeRegex().exec(b),b=Uq(b[1])):(b=ra.get(a),b=Uq(b));return b})}},x0=function(a){return k.foldr(a,function(a,c){return a+c},0)},sC=function(a){a=Se.fromTable(a);return fb.generate(a)},hp={adjustWidth:function(a,b,c,d){var e=rC.getTableSize(a);b=e.getCellDelta(b);var g=sC(a),f=e.getWidths(g,d,e);d=v0.determine(f,c,b,e);d=k.map(d,function(a,b){return a+f[b]});var h=Kl.recalculateWidth(g,d);k.each(h,
function(a){e.setElementWidth(a.element(),a.width())});c===g.grid().columns()-1&&e.setTableWidth(a,d,b)},adjustHeight:function(a,b,c,d){var e=sC(a);d=xi.getPixelHeights(e,d);d=k.map(d,function(a,d){return c===d?Math.max(b+a,Uc.minHeight()):a});var g=Kl.recalculateHeight(e,d),e=Kl.matchRowHeight(e,d);k.each(e,function(a){Gb.setHeight(a.element(),a.height())});k.each(g,function(a){Gb.setHeight(a.element(),a.height())});e=x0(d);Gb.setHeight(a,e)},adjustWidthTo:function(a,b,c){var d=rC.getTableSize(a);
b=fb.generate(b);c=d.getWidths(b,c,d);b=Kl.recalculateWidth(b,c);k.each(b,function(a){d.setElementWidth(a.element(),a.width())});c=k.foldr(c,function(a,b){return b+a},0);0<b.length&&d.setElementWidth(a,c)}},tC=function(a){0===Xa.cells(a).length&&B.remove(a)},oe=C.immutable("grid","cursor"),Ai=function(a,b,c){return Vq(a,b,c).orThunk(function(){return Vq(a,0,0)})},Vq=function(a,b,c){return h.from(a[b]).bind(function(a){return h.from(a.cells()[c]).bind(function(a){return h.from(a.element())})})},sc=
function(a,b,c){return oe(a,Vq(a,b,c))},Wq=function(a){return k.foldl(a,function(a,c){return k.exists(a,function(a){return a.row()===c.row()})?a:a.concat([c])},[]).sort(function(a,c){return a.row()-c.row()})},Xq=function(a){return k.foldl(a,function(a,c){return k.exists(a,function(a){return a.column()===c.column()})?a:a.concat([c])},[]).sort(function(a,c){return a.column()-c.column()})},uC=function(a,b,c){a=Se.fromPastedRows(a,c);a=fb.generate(a);return Fl.toGrid(a,b,!0)},Ue=hp.adjustWidthTo,Db={insertRowBefore:za.run(function(a,
b,c,d){var e=b.row(),g=b.row();a=Xc.insertRowAt(a,g,e,c,d.getOrInit);return sc(a,g,b.column())},za.onCell,f.noop,f.noop,ub.modification),insertRowsBefore:za.run(function(a,b,c,d){var e=b[0].row(),g=b[0].row(),f=Wq(b);a=k.foldl(f,function(a,b){return Xc.insertRowAt(a,g,e,c,d.getOrInit)},a);return sc(a,g,b[0].column())},za.onCells,f.noop,f.noop,ub.modification),insertRowAfter:za.run(function(a,b,c,d){var e=b.row(),g=b.row()+b.rowspan();a=Xc.insertRowAt(a,g,e,c,d.getOrInit);return sc(a,g,b.column())},
za.onCell,f.noop,f.noop,ub.modification),insertRowsAfter:za.run(function(a,b,c,d){var e=Wq(b),g=e[e.length-1].row(),f=e[e.length-1].row()+e[e.length-1].rowspan();a=k.foldl(e,function(a,b){return Xc.insertRowAt(a,f,g,c,d.getOrInit)},a);return sc(a,f,b[0].column())},za.onCells,f.noop,f.noop,ub.modification),insertColumnBefore:za.run(function(a,b,c,d){var e=b.column(),g=b.column();a=Xc.insertColumnAt(a,g,e,c,d.getOrInit);return sc(a,b.row(),g)},za.onCell,Ue,f.noop,ub.modification),insertColumnsBefore:za.run(function(a,
b,c,d){var e=Xq(b),g=e[0].column(),f=e[0].column();a=k.foldl(e,function(a,b){return Xc.insertColumnAt(a,f,g,c,d.getOrInit)},a);return sc(a,b[0].row(),f)},za.onCells,Ue,f.noop,ub.modification),insertColumnAfter:za.run(function(a,b,c,d){var e=b.column(),g=b.column()+b.colspan();a=Xc.insertColumnAt(a,g,e,c,d.getOrInit);return sc(a,b.row(),g)},za.onCell,Ue,f.noop,ub.modification),insertColumnsAfter:za.run(function(a,b,c,d){var e=b[b.length-1].column(),g=b[b.length-1].column()+b[b.length-1].colspan(),
f=Xq(b);a=k.foldl(f,function(a,b){return Xc.insertColumnAt(a,g,e,c,d.getOrInit)},a);return sc(a,b[0].row(),g)},za.onCells,Ue,f.noop,ub.modification),splitCellIntoColumns:za.run(function(a,b,c,d){a=Xc.splitCellIntoColumns(a,b.row(),b.column(),c,d.getOrInit);return sc(a,b.row(),b.column())},za.onCell,Ue,f.noop,ub.modification),splitCellIntoRows:za.run(function(a,b,c,d){a=Xc.splitCellIntoRows(a,b.row(),b.column(),c,d.getOrInit);return sc(a,b.row(),b.column())},za.onCell,f.noop,f.noop,ub.modification),
eraseColumns:za.run(function(a,b,c,d){c=Xq(b);a=Xc.deleteColumnsAt(a,c[0].column(),c[c.length-1].column());b=Ai(a,b[0].row(),b[0].column());return oe(a,b)},za.onCells,Ue,tC,ub.modification),eraseRows:za.run(function(a,b,c,d){c=Wq(b);a=Xc.deleteRowsAt(a,c[0].row(),c[c.length-1].row());b=Ai(a,b[0].row(),b[0].column());return oe(a,b)},za.onCells,f.noop,tC,ub.modification),makeColumnHeader:za.run(function(a,b,c,d){a=Jl.replaceColumn(a,b.column(),c,d.replaceOrInit);return sc(a,b.row(),b.column())},za.onCell,
f.noop,f.noop,ub.transform("row","th")),unmakeColumnHeader:za.run(function(a,b,c,d){a=Jl.replaceColumn(a,b.column(),c,d.replaceOrInit);return sc(a,b.row(),b.column())},za.onCell,f.noop,f.noop,ub.transform(null,"td")),makeRowHeader:za.run(function(a,b,c,d){a=Jl.replaceRow(a,b.row(),c,d.replaceOrInit);return sc(a,b.row(),b.column())},za.onCell,f.noop,f.noop,ub.transform("col","th")),unmakeRowHeader:za.run(function(a,b,c,d){a=Jl.replaceRow(a,b.row(),c,d.replaceOrInit);return sc(a,b.row(),b.column())},
za.onCell,f.noop,f.noop,ub.transform(null,"td")),mergeCells:za.run(function(a,b,c,d){d=b.cells();k0.merge(d);a=Il.merge(a,b.bounds(),c,f.constant(d[0]));return oe(a,h.from(d[0]))},za.onMergable,f.noop,f.noop,ub.merging),unmergeCells:za.run(function(a,b,c,d){a=k.foldr(b,function(a,b){return Il.unmerge(a,b,c,d.combine(b))},a);return oe(a,h.from(b[0]))},za.onUnmergable,Ue,f.noop,ub.merging),pasteCells:za.run(function(a,b,c,d){d=function(a,b){var c=Se.fromTable(a),c=fb.generate(c);return Fl.toGrid(c,
b,!0)}(b.clipboard(),b.generators());var e=ya.address(b.row(),b.column());return Tq.merge(e,a,d,b.generators(),c).fold(function(){return oe(a,h.some(b.element()))},function(a){var c=Ai(a,b.row(),b.column());return oe(a,c)})},za.onPaste,Ue,f.noop,ub.modification),pasteRowsBefore:za.run(function(a,b,c,d){var e=a[b.cells[0].row()];d=b.cells[0].row();e=uC(b.clipboard(),b.generators(),e);a=Tq.insert(d,a,e,b.generators(),c);b=Ai(a,b.cells[0].row(),b.cells[0].column());return oe(a,b)},za.onPasteRows,f.noop,
f.noop,ub.modification),pasteRowsAfter:za.run(function(a,b,c,d){var e=a[b.cells[0].row()];d=b.cells[b.cells.length-1].row()+b.cells[b.cells.length-1].rowspan();e=uC(b.clipboard(),b.generators(),e);a=Tq.insert(d,a,e,b.generators(),c);b=Ai(a,b.cells[0].row(),b.cells[0].column());return oe(a,b)},za.onPasteRows,f.noop,f.noop,ub.modification)},Yq=function(a){return function(b,c){return k.foldl(a,function(a,e){return a.bind(function(a){return y0(c,function(a){return z0(e,b,c,a)})})},H.value(c))}},A0=Yq([Db.makeRowHeader,
Db.makeColumnHeader]),B0=Yq([Db.makeRowHeader]),C0=Yq([Db.makeColumnHeader]),z0=function(a,b,c,d){return cp.fromEngine(b).bind(function(e){e=f.constant(e);var g=f.noop;return Mb.execute(b.region(),a,g,e)(b.content(),c,{element:f.constant(d)})})},y0=function(a,b){return I.descendant(a,"td,th").bind(function(a){return b(a)}).fold(function(){return H.error("Could not run the operation on table")},function(b){return H.value(a)})},Ae={setCaption:function(a,b){var c=I.child(a,"caption").fold(function(){return q.fromTag("caption")},
function(a){B.empty(a);return a});ua.set(c,b);v.prepend(a,c)},setSummary:function(a,b){m.set(a,"summary",b)},setDimensions:function(a,b){h0.redistribute(a,b.width(),b.height(),"rtl"===m.get(a,"dir")?Nj.rtl:Nj.ltr)},addBothHeaders:A0,addRowHeader:B0,addColumnHeader:C0},Zq=la.generate([{field:["name","textkey","f"]},{select:["name","textkey","values"]},{toggles:["name","textkey","options"]}]),D0=C.immutable("value","text"),E0=C.immutable("value","icon","textkey"),zb={field:Zq.field,select:Zq.select,
toggles:Zq.toggles,pair:D0,toggle:E0,cata:function(a,b,c,d){return a.fold(b,c,d)}},F0=function(a,b){k.each(a,function(a){b.get(a.severity()).fold(function(){console.warn("unknown severity for accessibility rule: ",a.id(),a.severity())},function(d){ea.add(a.element(),[b.violation(),d.style()]);Sd.add(a.element(),d.attribute(),a.id())})});h.from(a[0]).each(function(a){var d=a.element(),e=b.currentAttr();a=a.severity();m.set(d,e,a)})},G0=function(a,b,c,d){a=X.descendants(a,"["+b+"]");k.each(a,function(a){m.remove(a,
b)});m.set(c,b,d)},H0=function(a,b){var c=X.descendants(a,"."+b.violation());k.each(c,function(a){n.remove(a,b.violation());m.remove(a,b.currentAttr());k.each(b.all(),function(b){n.remove(a,b.style());m.remove(a,b.attribute())})})},vC=function(a,b,c){var d=function(b){return 0===Sd.read(a,b.attribute()).length};b.get(c).each(function(b){d(b)&&n.remove(a,b.style())});k.forall(b.all(),d)&&n.remove(a,b.violation())},I0=function(a,b,c,d){b.get(d).each(function(d){Sd.remove(a,d.attribute(),c);Sd.add(a,
b.ignoreAttr(),c);d=b.currentAttr();m.remove(a,d)})},J0=function(a,b,c,d){b.get(d).each(function(d){Sd.remove(a,d.attribute(),c);d=b.currentAttr();m.remove(a,d)})},K0={manager:function(a){var b=a.content();return{start:function(b){F0(b,a)},moveTo:function(c,d){b.body().each(function(b){G0(b,a.currentAttr(),c,d)})},stop:function(){b.body().each(function(b){H0(b,a)})},ignore:function(b,d,e){I0(b,a,d,e);vC(b,a,e)},solve:function(b,d,e){J0(b,a,d,e);vC(b,a,e)}}}},Eg=function(a){return function(b){k.each(b,
a)}},L0=Eg(B.remove),M0=Eg(function(a){m.set(a,"class","")}),N0=Eg(function(a){var b=y.children(a);J.before(a,b);B.remove(a)}),O0=Ua.zeroWidth(),P0=function(a){return A.isText(a)?(a=nb.get(a),""===a||a===O0):!1},Q0=Eg(function(a){var b;A.isElement(a)?(b=y.childNodesCount(a),b=0===b||1===b&&y.child(a,0).exists(P0)):b=!1;b&&m.hasNone(a)&&B.remove(a)}),Ca={remove:L0,clearClasses:M0,removeClass:function(a){return Eg(function(b){n.remove(b,a)})},removeAttr:function(a){return Eg(function(b){m.remove(b,
a)})},unwrap:N0,removeIfEmpty:Q0},Bi=function(a){return"data-"+w.resolve(a)},wC=Bi("a11y-current-violation"),xC=w.resolve("a11y-violation"),yC=w.resolve("a11y-severity-info"),zC=w.resolve("a11y-severity-warn"),AC=w.resolve("a11y-severity-error"),Ll=Bi("a11y-ignore"),BC=Bi("a11y-error"),CC=Bi("a11y-warning"),DC=Bi("a11y-info"),$q=C.immutableBag(["style","attribute"],[]),EC=$q({style:AC,attribute:BC}),FC=$q({style:zC,attribute:CC}),GC=$q({style:yC,attribute:DC}),R0=function(a){return"error"===a?h.some(EC):
"warning"===a?h.some(FC):"info"===a?h.some(GC):h.none()},eo={configure:function(a){a.addSelector(a.output(),"["+Ll+"]",Ca.removeAttr(Ll));k.each([a.output(),a.input(),a.history(),a.internal()],function(b){k.each([xC,yC,zC,AC],function(c){a.add(b,c,Ca.removeClass(c))});k.each([wC,BC,CC,DC],function(c){a.addSelector(b,"["+c+"]",Ca.removeAttr(c))})})},ignoreAttr:f.constant(Ll),manager:function(a){return K0.manager({content:f.constant(a),violation:f.constant(xC),currentAttr:f.constant(wC),ignoreAttr:f.constant(Ll),
get:R0,all:f.constant([EC,FC,GC])})}},HC=w.resolve("highlight-common"),ar=w.resolve("highlight-placeholder"),de={configure:function(a){a.add(a.output(),HC,Ca.unwrap);a.add(a.history(),ar,Ca.unwrap);a.add(a.output(),ar,Ca.unwrap);a.add(a.output(),"ephox-custom-highlight",Ca.unwrap);a.add(a.history(),"ephox-custom-highlight",Ca.unwrap)},highlightClass:f.constant(HC),customHighlightClass:f.constant("ephox-custom-highlight"),placeholderClass:f.constant(ar)},IC=function(){return br(function(a,b,c){return a()},
"off")},JC=function(){return br(function(a,b,c){return b()},"unchanged")},KC=function(a){return br(function(b,c,d){return d(a)},"on")},br=function(a,b){return{fold:a,map:function(b){return a(IC,JC,function(a){return KC(b(a))})},label:f.constant(b)}},oa={off:IC,unchanged:JC,on:KC},LC=C.immutable("content"),nd={hasSelection:function(a){return a.getSelection().fold(function(){return LC(oa.off())},function(){return LC(oa.on(!0))})},isAnnotation:function(a){return n.has(a,"ephox-cram-annotation-wrap")||
n.has(a,de.customHighlightClass())},isEmptyText:function(a){return A.isText(a)&&0===Fa.get(a).length},isTextArea:function(a){return"textarea"===A.name(a)}},jx={descend:function(a,b){var c=y.children(a);if(0===c.length||nd.isTextArea(a))return S.point(a,b);if(b<c.length&&!nd.isTextArea(c[b]))return S.point(c[b],0);c=c[c.length-1];if(nd.isTextArea(c))return S.point(a,b);var d=A.isText(c)?Fa.get(c).length:"img"===A.name(c)?1:y.children(c).length;return S.point(c,d)}},cr=la.generate([{before:["element"]},
{on:["element","offset"]},{after:["element"]}]),da={before:cr.before,on:cr.on,after:cr.after,cata:function(a,b,c,d){return a.fold(b,c,d)},getStart:function(a){return a.fold(f.identity,f.identity,f.identity)}},Ml=la.generate([{domRange:["rng"]},{relative:["startSitu","finishSitu"]},{exact:["start","soffset","finish","foffset"]}]),S0=C.immutable("start","soffset","finish","foffset"),T0=function(a){return a.match({domRange:function(a){return q.fromDom(a.startContainer)},relative:function(a,c){return da.getStart(a)},
exact:function(a,c,d,e){return a}})},Vb={domRange:Ml.domRange,relative:Ml.relative,exact:Ml.exact,exactFromRange:function(a){return Ml.exact(a.start(),a.soffset(),a.finish(),a.foffset())},range:S0,getWin:function(a){a=T0(a);return y.defaultView(a)}},MC=function(a,b,c,d){var e=y.owner(a).dom().createRange();e.setStart(a.dom(),b);e.setEnd(c.dom(),d);return e},wc={after:function(a,b,c,d){var e=MC(a,b,c,d);a=L.eq(a,c)&&b===d;return e.collapsed&&!a},commonAncestorContainer:function(a,b,c,d){a=MC(a,b,c,
d);return q.fromDom(a.commonAncestorContainer)}},U0={fromElements:function(a,b){var c=(b||document).createDocumentFragment();k.each(a,function(a){c.appendChild(a.dom())});return q.fromDom(c)}},NC=function(a,b){a.selectNodeContents(b.dom())},V0=function(a,b){b.fold(function(b){a.setStartBefore(b.dom())},function(b,d){a.setStart(b.dom(),d)},function(b){a.setStartAfter(b.dom())})},W0=function(a,b){b.fold(function(b){a.setEndBefore(b.dom())},function(b,d){a.setEnd(b.dom(),d)},function(b){a.setEndAfter(b.dom())})},
OC=function(a){a.deleteContents()},PC=function(a){return{left:f.constant(a.left),top:f.constant(a.top),right:f.constant(a.right),bottom:f.constant(a.bottom),width:f.constant(a.width),height:f.constant(a.height)}},Nb={create:function(a){return a.document.createRange()},replaceWith:function(a,b){OC(a);a.insertNode(b.dom())},selectNodeContents:function(a,b){var c=a.document.createRange();NC(c,b);return c},selectNodeContentsUsing:NC,relativeToNative:function(a,b,c){a=a.document.createRange();V0(a,b);
W0(a,c);return a},exactToNative:function(a,b,c,d,e){a=a.document.createRange();a.setStart(b.dom(),c);a.setEnd(d.dom(),e);return a},deleteContents:OC,cloneFragment:function(a){a=a.cloneContents();return q.fromDom(a)},getFirstRect:function(a){var b=a.getClientRects();a=0<b.length?b[0]:a.getBoundingClientRect();return 0<a.width||0<a.height?h.some(a).map(PC):h.none()},getBounds:function(a){a=a.getBoundingClientRect();return 0<a.width||0<a.height?h.some(a).map(PC):h.none()},isWithin:function(a,b){return 1>
b.compareBoundaryPoints(a.END_TO_START,a)&&-1<b.compareBoundaryPoints(a.START_TO_END,a)},toString:function(a){return a.toString()}},Ci=la.generate([{ltr:["start","soffset","finish","foffset"]},{rtl:["start","soffset","finish","foffset"]}]),QC=function(a,b,c){return b(q.fromDom(c.startContainer),c.startOffset,q.fromDom(c.endContainer),c.endOffset)},X0=function(a,b){return b.match({domRange:function(a){return{ltr:f.constant(a),rtl:h.none}},relative:function(b,d){return{ltr:xb.cached(function(){return Nb.relativeToNative(a,
b,d)}),rtl:xb.cached(function(){return h.some(Nb.relativeToNative(a,d,b))})}},exact:function(b,d,e,g){return{ltr:xb.cached(function(){return Nb.exactToNative(a,b,d,e,g)}),rtl:xb.cached(function(){return h.some(Nb.exactToNative(a,e,g,b,d))})}}})},Y0=function(a,b){var c=b.ltr();return c.collapsed?b.rtl().filter(function(a){return!1===a.collapsed}).map(function(a){return Ci.rtl(q.fromDom(a.endContainer),a.endOffset,q.fromDom(a.startContainer),a.startOffset)}).getOrThunk(function(){return QC(a,Ci.ltr,
c)}):QC(a,Ci.ltr,c)},RC=function(a,b){var c=X0(a,b);return Y0(a,c)},Ed={ltr:Ci.ltr,rtl:Ci.rtl,diagnose:RC,asLtrRange:function(a,b){return RC(a,b).match({ltr:function(b,d,e,g){var f=a.document.createRange();f.setStart(b.dom(),d);f.setEnd(e.dom(),g);return f},rtl:function(b,d,e,g){var f=a.document.createRange();f.setStart(e.dom(),g);f.setEnd(b.dom(),d);return f}})}},dr={inRect:function(a,b,c){return b>=a.left&&b<=a.right&&c>=a.top&&c<=a.bottom},searchForPoint:function(a,b,c,d,e){if(0===e)return 0;if(b===
d)return e-1;for(var g=1;g<e;g++){var f=a(g),h=Math.abs(b-f.left);if(!(c>f.bottom)){if(c<f.top||h>d)return g-1;d=h}}return 0}},Z0=function(a,b,c,d,e){var g=function(c){var d=a.dom().createRange();d.setStart(b.dom(),c);d.collapse(!0);return d},f=Fa.get(b).length;c=dr.searchForPoint(function(a){return g(a).getBoundingClientRect()},c,d,e.right,f);return g(c)},SC=function(a,b,c,d){var e=a.dom().createRange();e.selectNode(b.dom());e=e.getClientRects();return $a.findMap(e,function(a){return dr.inRect(a,
c,d)?h.some(a):h.none()}).map(function(e){return Z0(a,b,c,d,e)})},TC=function(a,b,c,d){var e=a.dom().createRange();b=y.children(b);return $a.findMap(b,function(b){e.selectNode(b.dom());return dr.inRect(e.getBoundingClientRect(),c,d)?(A.isText(b)?SC:TC)(a,b,c,d):h.none()})},$0={locate:function(a,b,c,d){var e=a.dom().createRange();e.selectNode(b.dom());e=e.getBoundingClientRect();c=Math.max(e.left,Math.min(e.right,c));d=Math.max(e.top,Math.min(e.bottom,d));return(A.isText(b)?SC:TC)(a,b,c,d)}},UC=function(a,
b,c){a=a.dom().createRange();a.selectNode(b.dom());a.collapse(c);return a},a1=function(a,b,c){var d=a.dom().createRange();d.selectNode(b.dom());var d=d.getBoundingClientRect(),e=c-d.left<d.right-c?!0:!1;return(!0===e?Ab.first:Ab.last)(b).map(function(b){return UC(a,b,e)})},b1=function(a,b,c){var d=b.dom().getBoundingClientRect();return h.some(UC(a,b,c-d.left<d.right-c?!0:!1))},c1={search:function(a,b,c){return(0===y.children(b).length?b1:a1)(a,b,c)}},d1=function(a,b,c){return h.from(a.dom().caretPositionFromPoint(b,
c)).bind(function(b){if(null===b.offsetNode)return h.none();var c=a.dom().createRange();c.setStart(b.offsetNode,b.offset);c.collapse();return h.some(c)})},e1=function(a,b,c){return h.from(a.dom().caretRangeFromPoint(b,c))},f1=function(a,b,c,d){var e=a.dom().createRange();e.selectNode(b.dom());e=e.getBoundingClientRect();c=Math.max(e.left,Math.min(e.right,c));d=Math.max(e.top,Math.min(e.bottom,d));return $0.locate(a,b,c,d)},g1=function(a,b,c){return q.fromPoint(a,b,c).bind(function(d){var e=function(){return c1.search(a,
d,b)};return 0===y.children(d).length?e():f1(a,d,b,c).orThunk(e)})},h1=document.caretPositionFromPoint?d1:document.caretRangeFromPoint?e1:g1,i1={fromPoint:function(a,b,c){a=q.fromDom(a.document);return h1(a,b,c).map(function(a){return Vb.range(q.fromDom(a.startContainer),a.startOffset,q.fromDom(a.endContainer),a.endOffset)})}},j1=function(a,b,c,d){var e=Nb.create(a);a=(qa.is(b,d)?[b]:[]).concat(X.descendants(b,d));return k.filter(a,function(a){Nb.selectNodeContentsUsing(e,a);return Nb.isWithin(c,
e)})},k1={find:function(a,b,c){b=Ed.asLtrRange(a,b);var d=q.fromDom(b.commonAncestorContainer);return A.isElement(d)?j1(a,d,b,c):[]}},Di=function(a,b){var c=A.name(a);return"input"===c?da.after(a):k.contains(["br","img"],c)?0===b?da.before(a):da.after(a):da.on(a,b)},VC=function(a,b){var c=a.fold(da.before,Di,da.after),d=b.fold(da.before,Di,da.after);return Vb.relative(c,d)},er=function(a,b,c,d){a=Di(a,b);c=Di(c,d);return Vb.relative(a,c)},fr={beforeSpecial:Di,preprocess:function(a){return a.match({domRange:function(a){var c=
q.fromDom(a.startContainer),d=q.fromDom(a.endContainer);return er(c,a.startOffset,d,a.endOffset)},relative:VC,exact:er})},preprocessRelative:VC,preprocessExact:er},gr=function(a,b){h.from(a.getSelection()).each(function(a){a.removeAllRanges();a.addRange(b)})},WC=function(a,b){return Ed.diagnose(a,b).match({ltr:function(b,d,e,g){b=Nb.exactToNative(a,b,d,e,g);gr(a,b)},rtl:function(b,d,e,g){var f=a.getSelection();f.setBaseAndExtent?f.setBaseAndExtent(b.dom(),d,e.dom(),g):f.extend?(f.collapse(b.dom(),
d),f.extend(e.dom(),g)):(b=Nb.exactToNative(a,e,g,b,d),gr(a,b))}})},l1=function(a){var b=q.fromDom(a.anchorNode),c=q.fromDom(a.focusNode);wc.after(b,a.anchorOffset,c,a.focusOffset)?a=h.some(Vb.range(q.fromDom(a.anchorNode),a.anchorOffset,q.fromDom(a.focusNode),a.focusOffset)):0<a.rangeCount?(b=a.getRangeAt(0),a=a.getRangeAt(a.rangeCount-1),a=h.some(Vb.range(q.fromDom(b.startContainer),b.startOffset,q.fromDom(a.endContainer),a.endOffset))):a=h.none();return a},XC=function(a){return h.from(a.getSelection()).filter(function(a){return 0<
a.rangeCount}).bind(l1)},Ea={setExact:function(a,b,c,d,e){b=fr.preprocessExact(b,c,d,e);WC(a,b)},getExact:XC,get:function(a){return XC(a).map(function(a){return Vb.exact(a.start(),a.soffset(),a.finish(),a.foffset())})},setRelative:function(a,b,c){b=fr.preprocessRelative(b,c);WC(a,b)},toNative:function(a){var b=Vb.getWin(a).dom(),c=function(a,c,g,f){return Nb.exactToNative(b,a,c,g,f)};a=fr.preprocess(a);return Ed.diagnose(b,a).match({ltr:c,rtl:c})},setToElement:function(a,b){var c=Nb.selectNodeContents(a,
b);gr(a,c)},clear:function(a){a.getSelection().removeAllRanges()},clone:function(a,b){var c=Ed.asLtrRange(a,b);return Nb.cloneFragment(c)},replace:function(a,b,c){b=Ed.asLtrRange(a,b);a=U0.fromElements(c,a.document);Nb.replaceWith(b,a)},deleteAt:function(a,b){var c=Ed.asLtrRange(a,b);Nb.deleteContents(c)},forElement:function(a,b){var c=Nb.selectNodeContents(a,b);return Vb.range(q.fromDom(c.startContainer),c.startOffset,q.fromDom(c.endContainer),c.endOffset)},getFirstRect:function(a,b){var c=Ed.asLtrRange(a,
b);return Nb.getFirstRect(c)},getBounds:function(a,b){var c=Ed.asLtrRange(a,b);return Nb.getBounds(c)},getAtPoint:function(a,b,c){return i1.fromPoint(a,b,c)},findWithin:function(a,b,c){return k1.find(a,b,c)},getAsString:function(a,b){var c=Ed.asLtrRange(a,b);return Nb.toString(c)},isCollapsed:function(a,b,c,d){return L.eq(a,c)&&b===d}},YC=function(a,b){return ca.inBody(a)?h.some(Math.max(0,Math.min(b,ja.getEnd(a)))):h.none()},hr={findDescendants:function(a,b,c,d,e){var g=y.defaultView(a);return YC(a,
b).bind(function(b){return YC(c,d).map(function(d){d=Vb.exact(a,b,c,d);return Ea.findWithin(g.dom(),d,e)})}).getOr([])},findAncestors:function(a,b,c){return I.ancestor(a,c).fold(function(){return I.ancestor(b,c).toArray()},function(a){return I.ancestor(b,c).fold(f.constant([a]),function(b){return L.eq(a,b)?[a]:[a,b]})})}},m1=Y.detect().browser.isFirefox(),Ei=function(a){return a.filter(function(a){return"img"===A.name(a)})},n1=function(a){var b=Ei(y.child(a.startContainer(),a.startOffset()));return Ei(y.nextSibling(a.startContainer())).orThunk(function(){return b}).bind(function(c){return Ei(y.prevSibling(a.endContainer())).bind(function(d){d=
L.eq(c,d);var e=a.startContainer().dom().length===a.startOffset(),g=0===a.endOffset();return d&&(e||b.isSome())&&g?h.some(c):h.none()})})},o1=function(a){if(!L.eq(a.startContainer(),a.endContainer()))return h.none();var b=Math.min(a.startOffset(),a.endOffset()),c=Math.max(a.startOffset(),a.endOffset()),d=Ei(y.child(a.startContainer(),b));return c===b+1?d.orThunk(function(){return Ei(h.some(a.startContainer()))}):m1&&c===b+2?d.filter(function(a){return y.nextSibling(a).filter(nd.isEmptyText).isSome()}):
h.none()},ZC=C.immutable("image"),$C=function(a){return a.filter(function(a){return!a.collapsed()}).bind(function(a){return o1(a).orThunk(function(){return n1(a)})})},aD=function(a,b){return!k.exists(b,function(b){return qa.is(a,b)})},Jb={allowedForEditing:aD,detect:function(a){return $C(a).map(ZC)},detectForEditing:function(a,b){return $C(a).filter(function(a){return aD(a,b)}).map(ZC)}},bD=Y.detect().browser.isFirefox(),p1=function(a,b){return Jb.detect(h.some(a)).filter(function(a){return L.eq(a.image(),
b)}).isSome()},cD=function(a,b){var c=function(){a.setRelativeSelection(da.before(b),da.after(b))},d=bD?function(){a.getSelection().fold(c,function(c){q1(a,c,b)})}:c;a.focus();d()},q1=function(a,b,c){2===Math.abs(b.startOffset()-b.endOffset())&&p1(b,c)||(b=y.nextSibling(c).filter(nd.isEmptyText).getOrThunk(function(){var a=q.fromText("");v.after(c,a);return a}),a.setRelativeSelection(da.before(c),da.after(b)))},ee={selectionContains:function(a){a=hr.findDescendants(a.startContainer(),a.startOffset(),
a.endContainer(),a.endOffset(),"img");return 1===a.length?h.some(a[0]):h.none()},remove:function(a,b){a.setRelativeSelection(da.before(b),da.before(b));B.remove(b)},select:cD,reselect:bD?cD:f.noop},ir=function(a,b){var c=Ja.absolute(a),d=ha.get(a);return{element:f.constant(a),bottom:f.constant(c.top()+d),pos:f.constant(c),cleanup:b}},r1=function(a,b){var c=jx.descend(a,b),d=q.fromText(Ua.zeroWidth()),e=q.fromTag("span");v.append(e,d);v.before(c.element(),e);return ir(e,function(){B.remove(e)})},eD=
function(a,b){a.getSelection().each(function(c){dD(a,function(d,e){s1(a,b,c)},c)})},s1=function(a,b,c){a.body().each(function(d){a.doc().each(function(a){t.reflow(d);var g=Ga.get(a).top(),f=r1(c.startContainer(),c.startOffset());b(a,g,f);f.cleanup()})})},fD=function(a,b,c){a.doc().each(function(a){var e=Ga.get(a).top();c(a,e,b)})},gD=function(a,b,c){var d=a.dom().defaultView.innerHeight,e=c.pos();c.bottom()>d+b?(b=e.top()-d+1.5*ha.get(c.element()),Ga.to(e.left(),b,a)):e.top()<b&&Ga.to(e.left(),e.top(),
a)},hD=function(a,b,c,d){a.body().each(function(e){var g=ha.get(a.element()),f,h=e.dom();f=Math.max(h.offsetHeight,h.scrollHeight);h=d.pos();d.bottom()>f?t.set(e,"min-height",d.bottom()+"px"):t.remove(e,"min-height");h.top()<c?Ga.to(h.left(),h.top(),b):h.top()>g+c&&(e=h.top()-g+(d.bottom()-h.top()),Ga.to(h.left(),e,b));e=qi.find(d.element());g=Ga.get().top();h=window.innerHeight+g;e.top()<g?Ga.intoView(d.element(),!0):e.top()>h&&Ga.intoView(d.element(),!1)})},t1=function(a){eD(a,gD)},u1=function(a,
b){fD(a,ir(b,f.noop),gD)},v1=function(a){eD(a,f.curry(hD,a))},w1=function(a,b){fD(a,ir(b,f.noop),f.curry(hD,a))},dD=function(a,b,c){var d=c.startContainer(),e=c.startOffset(),g=c.endContainer();c=c.endOffset();b(d,g);a.setSelection(d,e,g,c);Jb.detect(a.getSelection()).each(function(b){ee.select(a,b.image())})},rf={cursorIntoView:function(a){(a.isInline()?t1:v1)(a)},elementIntoView:function(a,b){(a.isInline()?u1:w1)(a,b)},preserve:function(a,b){a.getSelection().each(function(c){dD(a,b,c)})}},x1=Y.detect(),
jr=function(a,b,c){a=q.fromTag(a);c=u.translate(c);return iD(a,b,c)},iD=function(a,b,c){c=O.labelledField(a,b,c);n.add(c.element(),w.resolve("form-group"));n.add(c.element(),w.resolve(b));"select"===A.name(a)&&(a=P.div(),n.add(a,w.resolve("select-wrap")),v.append(a,c.field()),v.append(c.element(),a));return c},dc={input:function(a,b){var c=jr("input",a,b);x1.browser.isSafari()&&m.setAll(c.field(),{autocomplete:"off",autocorrect:"off",autocapitalize:"off",spellcheck:"false"});m.setAll(c.field(),{type:"text"});
return{element:c.element,input:c.field}},textarea:function(a,b){var c=jr("textarea",a,b);O.multiline(c.field());return{element:c.element,textarea:c.field}},common:jr,commonWith:iD,comboBox:function(a,b,c){var d=q.fromTag("input"),e=u.translate(b);b=P.div();var g=a+Ma.generate(""),e=q.fromHtml("<label>"+e+"</label>");m.set(e,"for",g);m.set(d,"id",g);n.add(b,w.resolve("form-group"));n.add(b,w.resolve(a));a=P.span();O.hidden(a,!0);g=P.span();O.hidden(g,!0);ea.add(g,["ephox-textbox-font",w.resolve("icon"),
w.resolve("combo-drop-arrow-icon")]);n.add(a,w.resolve("combo-drop-arrow"));v.append(a,g);var l=P.div();n.add(l,w.resolve("label-wrap"));c.each(function(a){v.append(l,a)});v.append(l,e);c=P.div();n.add(c,w.resolve("combo-wrap"));J.append(c,[d,a]);m.set(d,"type","text");J.append(b,[l,c]);return{element:f.constant(b),input:f.constant(d),dropArrow:f.constant(a)}}},jD=function(a){n.add(a,w.resolve("dialog-button-default"))},kD=function(a){n.add(a,w.resolve("dialog-button"))},kr=function(a,b,c){var d=
Yb(a+b);n.add(d.element(),w.resolve("dialog-"+b));a=mc(u.translate(c));d.content(a);m.set(d.element(),"tabindex","-1");O.textButton(d.element(),a.element());return{enable:function(){d.enable();ga.enable(d.element())},disable:function(){d.disable();ga.disable(d.element())},element:d.element,name:d.name,destroy:d.destroy,content:d.content,disabled:d.disabled,click:d.click,events:d.events}},y1=function(a){a=kr(a,"ok","button.ok");jD(a.element());return a},z1=function(a){a=kr(a,"cancel","button.cancel");
kD(a.element());return a},Rc={button:kr,okCancel:function(a){var b=void 0!==a?a+"-":"";a=P.div();n.add(a,w.resolve(b+"dialog-controls"));var c=z1(b),d=y1(b);J.append(a,[c.element(),d.element()]);b=D.create({ok:K([],d.events.click),cancel:K([],c.events.click)});return{element:f.constant(a),ok:f.constant(d),cancel:f.constant(c),destroy:function(){d.destroy();c.destroy()},events:b.registry}},makeNormal:kD,makeDefault:jD},lr=function(a,b){var c=a(),d=c.element();O.button(d,b);m.set(d,"tabindex","-1");
c.events.click.bind(function(){T.focus(d)});return c},lD=function(a,b){var c=lr(Yb,b);c.content(Nd([a,w.resolve("icon")]));m.set(c.element(),"title",b);return c},rP={setDefaultAction:function(a){Rc.makeDefault(a)},setNormalButton:function(a){Rc.makeNormal(a)},makeTextButton:function(a,b,c){b=lr(Yb,b);ea.add(b.element(),a);b.content(mc(c));return b},makeIconToggle:function(a,b,c){var d=lr(dd,c);d.content(Nd([b,w.resolve("icon")]));n.add(d.element(),w.resolve("choice-button"));m.set(d.element(),"data-value",
a);m.set(d.element(),"title",c);return d},makeField:function(a,b,c){return dc.commonWith(a,b,c)},makeIconButton:lD,makeIconStepperButton:function(a,b){var c=lD(a,b);n.add(c.element(),w.resolve("stepper-button"));return c}},mr={"a11y.widget.ok.label":"button.ok","a11y.widget.ok.text":"button.ok","a11y.widget.ignore.label":"a11y.widget.ignore","a11y.widget.ignore.text":"a11y.widget.ignore","a11y.widget.repair.label":"a11y.widget.repair","a11y.widget.repair.text":"a11y.widget.repair","a11y.widget.repair.available":"a11y.widget.available",
"a11y.i1.description":"a11y.image.alttext.empty","a11y.i1.repair.info":"a11y.image.alttext.set","a11y.i1.repair.errors.empty":"a11y.image.alttext.validation.empty","a11y.i1.repair.errors.duplicate":"a11y.image.alttext.validation.filenameduplicate","a11y.i2.description":"a11y.image.alttext.filenameduplicate","a11y.i2.repair.info":"a11y.image.alttext.set","a11y.i2.repair.errors.empty":"a11y.image.alttext.validation.empty","a11y.i2.repair.errors.duplicate":"a11y.image.alttext.validation.filenameduplicate",
"a11y.t1.description":"a11y.table.caption.empty","a11y.t1.repair.info":"a11y.table.caption.set","a11y.t1.repair.errors.empty":"a11y.table.caption.validation.empty","a11y.t1.repair.errors.duplicate":"a11y.table.caption.validation.summaryduplicate","a11y.t2.description":"a11y.table.summary.empty","a11y.t2.repair.info":"a11y.table.summary.set","a11y.t2.repair.errors.empty":"a11y.table.summary.validation.empty","a11y.t2.repair.errors.duplicate":"a11y.table.summary.validation.captionduplicate","a11y.t3.description":"a11y.table.caption.summaryduplicate",
"a11y.t3.repair.info":"a11y.table.caption.set","a11y.t3.repair.errors.empty":"a11y.table.caption.validation.empty","a11y.t3.repair.errors.duplicate":"a11y.table.caption.validation.summaryduplicate","a11y.t4a.description":"a11y.table.rowscells.none","a11y.t4b.description":"a11y.table.headers.none","a11y.t4b.repair.info":"a11y.table.headers.set","a11y.t4b.repair.row":"table.row-header","a11y.t4b.repair.column":"table.column-header","a11y.t4b.repair.errors.none":"a11y.table.headers.validation.none",
"a11y.t4c.description":"a11y.table.headerscope.none","a11y.t4c.repair.info":"a11y.table.headerscope.set","a11y.t4c.repair.scope.row":"a11y.table.headerscope.scope.row","a11y.t4c.repair.scope.col":"a11y.table.headerscope.scope.col","a11y.t4c.repair.scope.rowgroup":"a11y.table.headerscope.scope.rowgroup","a11y.t4c.repair.scope.colgroup":"a11y.table.headerscope.scope.colgroup","a11y.d1.description":"a11y.heading.paragraphmisuse","a11y.d1.repair.info":"a11y.heading.set","a11y.d1.repair.block.h1":"block.h1",
"a11y.d1.repair.block.h2":"block.h2","a11y.d1.repair.block.h3":"block.h3","a11y.d1.repair.block.h4":"block.h4","a11y.d1.repair.block.h5":"block.h5","a11y.d1.repair.block.h6":"block.h6","a11y.d2.description":"a11y.heading.nonsequential","a11y.d3.description":"a11y.link.adjacent","a11y.d4.description":"a11y.list.paragraphmisuse","a11y.d5a.description":"a11y.contrast.largetext","a11y.d5b.description":"a11y.contrast.smalltext"},lv={get:function(a){return h.from(mr[a])},translate:function(a){var b=Array.prototype.slice.call(arguments,
1);return u.translate.apply(void 0,[void 0!==mr[a]?mr[a]:a].concat(b))}},tP=C.immutableBag(["rules"],[]),mD=C.immutableBag(["rule","element"],[]),A1=function(a,b){return k.bind(b,function(b){return b.check()(a)?[mD({rule:b,element:a})]:[]})},B1=function(a,b){return k.bind(b,function(b){return k.map(b.check()(a),function(a){return mD({rule:b,element:a})})})},hP={audit:function(a,b){for(var c=[],d=k.partition(b,function(a){return a.walkable()}),e=d.pass,d=d.fail,g=document.createTreeWalker(a,Ub.getOrDie("NodeFilter").SHOW_ELEMENT,
null,!1);g.nextNode();)c=c.concat(A1(g.currentNode,e));e=B1(a,d);c=c.concat(e);c.sort(function(a,b){var c=a.element(),d=b.element();return c===d?0:bk.documentPositionPreceding(c,d)?1:-1});return c}},fc=C.immutableBag("id wcag severity desckey url walkable check".split(" "),[]),gc={error:f.constant("error"),warning:f.constant("warning"),info:f.constant("info")},Mf={match:function(a,b){return a.matches?a.matches(b):a.webkitMatchesSelector?a.webkitMatchesSelector(b):a.mozMatchesSelector?a.mozMatchesSelector(b):
a.msMatchesSelector?a.msMatchesSelector(b):!1}},C1=function(a){return k.forall(a.childNodes,function(a){return/^(b|strong)$/i.test(a.nodeName)})},D1=fc({id:"D1",wcag:"1.3.1",severity:gc.warning(),desckey:"a11y.d1.description",url:"http://www.w3.org/TR/UNDERSTANDING-WCAG20/content-structure-separation-programmatic.html",walkable:!0,check:function(a){return Mf.match(a,"p")?C1(a):!1}}),E1=fc({id:"D2",wcag:"1.3.1",severity:gc.error(),desckey:"a11y.d2.description",url:"http://www.w3.org/TR/UNDERSTANDING-WCAG20/content-structure-separation-programmatic.html",
walkable:!1,check:function(a){a=a.querySelectorAll("h1, h2, h3, h4, h5, h6");var b,c=[];k.each(a,function(a){var e=parseInt(a.tagName.slice(1),10);b&&1<e-b&&c.push(a);b=e});return c}}),F1=fc({id:"D3",wcag:"2.4.4",severity:gc.error(),desckey:"a11y.d3.description",url:"http://www.w3.org/TR/UNDERSTANDING-WCAG20/navigation-mechanisms-refs.html",walkable:!1,check:function(a){return k.filter(a.querySelectorAll("a + a"),function(a){return a.href===a.previousSibling.href})}}),nD=function(a){var b=a.nodeName;
for(a=a.nextSibling;null!==a&&("#text"===a.nodeName||"BR"===a.nodeName);)a=a.nextSibling;return null!==a&&a.nodeName===b?a:!1},oD={check:function(a,b){for(var c=a.querySelectorAll("p,h1,h2,h3,h4,h5,h6"),d=[],e=0;e<c.length;){var g,f=c[e];g=b;for(var h=nD(f),f=g(f)?[f]:[];!1!==h&&g(h);)f.push(h),h=nD(h);g=f;if(1<g.length){d.push(g[0]);g=g[g.length-1];h=-1;for(f=0;f<c.length;f++)if(c[f]===g){h=f;break}g=h;e=-1===g?e+1:g}else e++}return d}},G1=function(a){return a.textContent.match(/^\s{0,}([a-z1-9]|i+)\s{0,}[.)-]/gmi)},
H1=fc({id:"D4o",wcag:"1.3.1",severity:gc.error(),desckey:"a11y.d4.description",url:"http://www.w3.org/TR/UNDERSTANDING-WCAG20/content-structure-separation-programmatic.html",walkable:!1,check:function(a){return oD.check(a,G1)}}),I1=function(a){return a.textContent.match(/^\s{0,}(\*|-)\s{0,}/gmi)},J1=fc({id:"D4u",wcag:"1.3.1",severity:gc.error(),desckey:"a11y.d4.description",url:"http://www.w3.org/TR/UNDERSTANDING-WCAG20/content-structure-separation-programmatic.html",walkable:!1,check:function(a){return oD.check(a,
I1)}}),pD=C.immutable("red","green","blue","alpha"),Fi={rgbaColour:pD,white:function(){return pD(255,255,255,1)}},Fg={calculateContrastRatio:function(a,b){var c=Math.max(a,b)+0.05,d=Math.min(a,b)+0.05;return c/d},calculateLuminance:function(a){var b=function(a){return 0.03928>=a?a/12.92:Math.pow((a+0.055)/1.055,2.4)},c=a.red()/255,d=a.green()/255;a=a.blue()/255;c=b(c);d=b(d);b=b(a);return 0.2126*c+0.7152*d+0.0722*b},composeColour:function(a,b){var c=a.alpha()+b.alpha()*(1-a.alpha()),d=(a.red()*a.alpha()+
b.red()*b.alpha()*(1-a.alpha()))/c,e=(a.green()*a.alpha()+b.green()*b.alpha()*(1-a.alpha()))/c,g=(a.blue()*a.alpha()+b.blue()*b.alpha()*(1-a.alpha()))/c;return Fi.rgbaColour(Math.ceil(d),Math.ceil(e),Math.ceil(g),c)}},qD={parseColour:function(a){var b=function(a,b,c,f){a=parseInt(a,10);b=parseInt(b,10);c=parseInt(c,10);f=parseFloat(f);return h.some(Fi.rgbaColour(a,b,c,f))};if("transparent"===a)return b(0,0,0,0);var c=a.match(/^rgb\((\d+),\s*(\d+),\s*(\d+)\)/);if(null!==c)return b(c[1],c[2],c[3],1);
a=a.match(/^rgba\((\d+),\s*(\d+),\s*(\d+),\s*(\d?(?:\.\d+)?)\)/);return null!==a?b(a[1],a[2],a[3],a[4]):h.none()}},rD=function(a,b){var c=t.get(a,"opacity");return 1>c?Fi.rgbaColour(b.red(),b.green(),b.blue(),b.alpha()*c):b},sD={getBackgroundColor:function(a){var b=y.owner(a),c=ca.getBody(b);a=[a].concat(y.parents(a,function(a){return L.eq(a,c)}));a=k.foldl(a,function(a,b){if(1===a.alpha())return a;var c=t.get(b,"background-color");return qD.parseColour(c).bind(function(c){c=rD(b,c);return 0<c.alpha()?
h.some(Fg.composeColour(a,c)):h.none()}).getOr(a)},Fi.rgbaColour(0,0,0,0));return 1>a.alpha()?Fg.composeColour(a,Fi.white()):a},getForegroundColor:function(a,b){var c=t.get(a,"color");return qD.parseColour(c).bind(function(c){c=rD(a,c);c=1>c.alpha()?Fg.composeColour(c,b):c;return h.some(c)})}},tD=function(a){var b=sD.getBackgroundColor(a);return sD.getForegroundColor(a,b).map(function(a){var d=Fg.calculateLuminance(b);a=Fg.calculateLuminance(a);return Fg.calculateContrastRatio(a,d)})},uD={check:function(a,
b){return tD(a).filter(function(a){return a<b}).isSome()},getRatio:tD},K1=function(a){a=t.get(a,"font-weight");return"bold"===a||"bolder"===a?!0:/^[0-9]*$/.test(a)?700<=parseInt(a,10):!1},vD=function(a){var b=t.get(a,"font-size");a=/.*px/.test(b);b=b.match(/(\d*\.?\d*)(.*)/);return a&&null!==b?h.some(Number(b[1])):h.none()},wD={isLargeFont:function(a){var b=K1(a),c=y.owner(a),c=ca.getBody(c),d=vD(c);return vD(a).fold(f.never,function(a){return d.fold(function(){return 24<=a||b&&19<=a},function(c){return a>=
1.5*c||b&&a>=1.2*c})})}},xD={hasNonEmptyTextChild:function(a){a=y.children(a);return 0<k.filter(a,function(a){return A.isText(a)&&0<A.value(a).trim().length}).length}},L1=fc({id:"D5a",wcag:"1.4.3",severity:gc.error(),desckey:"a11y.d5a.description",url:"https://www.w3.org/TR/UNDERSTANDING-WCAG20/visual-audio-contrast-contrast.html",walkable:!0,check:function(a){a=q.fromDom(a);return xD.hasNonEmptyTextChild(a)&&wD.isLargeFont(a)&&uD.check(a,3)}}),M1=fc({id:"D5b",wcag:"1.4.3",severity:gc.error(),desckey:"a11y.d5b.description",
url:"https://www.w3.org/TR/UNDERSTANDING-WCAG20/visual-audio-contrast-contrast.html",walkable:!0,check:function(a){a=q.fromDom(a);return xD.hasNonEmptyTextChild(a)&&!wD.isLargeFont(a)&&uD.check(a,4.5)}}),N1=fc({id:"I1",wcag:"1.1.1",severity:gc.error(),desckey:"a11y.i1.description",url:"http://www.w3.org/TR/UNDERSTANDING-WCAG20/text-equiv-all.html",walkable:!0,check:function(a){return Mf.match(a,"img")&&(!1===a.hasAttribute("alt")||""===a.getAttribute("alt").trim())}}),O1=fc({id:"I2",wcag:"1.1.1",
severity:gc.error(),desckey:"a11y.i2.description",url:"http://www.w3.org/TR/UNDERSTANDING-WCAG20/text-equiv-all.html",walkable:!0,check:function(a){return Mf.match(a,"img[alt][src]")&&a.src.split("/").pop()===a.alt.split("/").pop()}}),P1=fc({id:"T1",wcag:"1.3.1",severity:gc.error(),desckey:"a11y.t1.description",url:"http://www.w3.org/TR/UNDERSTANDING-WCAG20/content-structure-separation-programmatic.html",walkable:!0,check:function(a){return Mf.match(a,"table")?(a=a.querySelector("caption"))?Mf.match(a,
":empty"):!0:!1}}),Q1=fc({id:"T2",wcag:"1.3.1",severity:gc.warning(),desckey:"a11y.t2.description",url:"http://www.w3.org/TR/UNDERSTANDING-WCAG20/content-structure-separation-programmatic.html",walkable:!0,check:function(a){return Mf.match(a,"table")&&(a.querySelector("[rowspan]")||a.querySelector("[colspan]"))&&!a.hasAttribute("summary")}}),R1=fc({id:"T3",wcag:"1.3.1",severity:gc.error(),desckey:"a11y.t3.description",url:"http://www.w3.org/TR/UNDERSTANDING-WCAG20/content-structure-separation-programmatic.html",
walkable:!0,check:function(a){return Mf.match(a,"table")&&a.hasAttribute("summary")&&0<a.querySelectorAll("caption").length&&a.getAttribute("summary")===a.querySelector("caption").innerHTML}}),S1=fc({id:"T4b",wcag:"1.3.1",severity:gc.error(),desckey:"a11y.t4b.description",url:"http://www.w3.org/TR/UNDERSTANDING-WCAG20/content-structure-separation-programmatic.html",walkable:!0,check:function(a){return"table"===a.nodeName.toLowerCase()&&0===a.querySelectorAll("th").length}}),T1=fc({id:"T4c",wcag:"1.3.1",
severity:gc.error(),desckey:"a11y.t4c.description",url:"http://www.w3.org/TR/UNDERSTANDING-WCAG20/content-structure-separation-programmatic.html",walkable:!0,check:function(a){var b;"th"===a.nodeName.toLowerCase()?(b=!1===a.hasAttribute("scope"),a=!1===/row|col|rowgroup|colgroup/i.test(a.getAttribute("scope")),b=b||a):b=!1;return b}}),U1=fc({id:"T4a",wcag:"1.3.1",severity:gc.error(),desckey:"a11y.t4a.description",url:"http://www.w3.org/TR/UNDERSTANDING-WCAG20/content-structure-separation-programmatic.html",
walkable:!0,check:function(a){return"table"===a.nodeName.toLowerCase()?0===a.querySelectorAll("tr").length||0===a.querySelectorAll("td").length:!1}}),yD=[D1,E1,F1,H1,J1,L1,M1,N1,O1,P1,Q1,R1,T1,U1,S1],zD={get:function(a){return k.find(yD,function(b){return b.name()===a})},all:f.constant(yD)},sP={get:function(a){return zD.get(a)},all:function(){return zD.all().slice()}},V1={resolve:jb.create("ephox-wheel").resolve},Ha={resolve:function(a,b){return V1.resolve(a.prefix()+"-"+b)},translate:function(a,
b){var c=[(aa.startsWith(b,a.tnames())?"":a.tnames()+".")+b].concat(Array.prototype.slice.call(arguments,2));return a.translate.apply(null,c)}},nr=function(a,b,c,d,e){c=Ha.translate(e,c);d=Ha.translate(e,d);return a.makeTextButton(b,c,d)},Rd={defaultActionButton:function(a,b,c,d,e){b=nr(a,b,c,d,e);a.setDefaultAction(b.element());return b},normalButton:function(a,b,c,d,e){b=nr(a,b,c,d,e);a.setNormalButton(b.element());return b},button:nr,toggleButton:function(a,b,c,d,e){d=Ha.translate(e,d);return a.makeIconToggle(b,
c,d)},field:function(a,b,c,d,e){d=Ha.translate(e,d);return a.makeField(b,c,d)},icon:function(a,b,c,d){c=Ha.translate(d,c);return a.makeIconStepperButton(b,c)}},W1=function(a,b,c,d,e,g){var l=q.fromTag("input");a=Rd.field(a,l,c,d,g);n.add(l,Ha.resolve(g,"input"));b=[ba.input(l,pa.input({execute:b}))];return{element:a.element,get:function(){var a={};a[c]=$.get(l);return a},update:function(a){a=e(a);$.set(l,a)},keylayouts:f.constant(b),destroy:f.noop}},X1=function(a,b,c,d,e){var g=q.fromTag("select");
a=Rd.field(a,g,b,c,e);d=k.map(d,function(a){var b=q.fromTag("option");$.set(b,a.value());ua.set(b,Ha.translate(e,a.text()));return b});J.append(g,d);d=[ba.single(g,[],h.none())];return{element:a.element,get:function(){var a={};a[b]=$.get(g);return a},update:f.noop,keylayouts:f.constant(d),destroy:f.noop}},Y1=function(a,b,c,d,e){var g=P.div();n.add(g,Ha.resolve(e,"flow"));var l=k.map(d,function(b){return Rd.toggleButton(a,b.value(),b.icon(),b.textkey(),e)});d=k.map(l,function(a){return a.element()});
J.append(g,d);d=[ba.flow(g,{item:f.constant(".ephox-pastry-statebutton")},pa.flow({trigger:function(a){return I.descendant(a,".ephox-pastry-button").map(function(a){a.dom().click();return a})}}))];return{element:Rd.field(a,g,b,c,e).element,get:function(){return k.foldr(l,function(a,b){var c={};c[m.get(b.element(),"data-value")]=b.selected();return Z.deepMerge(a,c)},{})},update:f.noop,keylayouts:f.constant(d),destroy:function(){k.each(l,function(a){a.destroy()})}}},kP={generate:function(a,b,c,d){b=
b.getOr([]);var e=k.bind(b,function(a){return a.fold(function(a,b,c){return[a]},function(a,b,c){return[a]},function(a,b,c){return k.map(c,function(a){return a.value()})})}),g=0<e.length?C.immutableBag(e,[]):f.constant({}),l=D.create({execute:r([])}),h=function(){l.trigger.execute()},s=k.map(b,function(b){return b.fold(function(b,c,e){return W1(a,h,b,c,e,d)},function(b,c,e){return X1(a,b,c,e,d)},function(b,c,e){return Y1(a,b,c,e,d)})});k.each(s,function(a){a.update(c)});b=k.map(s,function(a){return a.element()});
var m=k.bind(s,function(a){return a.keylayouts()});return{elements:f.constant(b),get:function(){var a=k.foldr(s,function(a,b){return Z.deepMerge(a,b.get())},{});return g(a)},keylayouts:f.constant(m),destroy:function(){k.each(s,function(a){a.destroy()});k.each(m,function(a){a.destroy()})},events:l.registry}}},$b={title:f.constant("widget.title"),running:f.constant("widget.running"),previous:f.constant("widget.previous"),next:f.constant("widget.next"),issueCounter:f.constant("widget.issue.counter"),
issueHelp:f.constant("widget.issue.help"),noIssue:f.constant("widget.issue.none"),severity:function(a){return"severity."+a},repairLabel:f.constant("widget.repair.label"),repairText:f.constant("widget.repair.text"),repairAvailable:f.constant("widget.repair.available"),ignoreLabel:f.constant("widget.ignore.label"),ignoreText:f.constant("widget.ignore.text"),okLabel:f.constant("widget.ok.label"),okText:f.constant("widget.ok.text")},Oj=function(a,b,c){var d=P.div();n.add(d,Ha.resolve(c,a));b.each(function(a){v.append(d,
q.fromText(Ha.translate(c,a)))});return d},AD=function(a){var b=xa(h.none());return{clear:function(){b.get().each(a);b.set(h.none())},isSet:function(){return b.get().isSome()},set:function(c){b.get().each(a);b.set(h.some(c))}}},pc={destroyable:function(){return AD(function(a){a.destroy()})},unbindable:function(){return AD(function(a){a.unbind()})},api:function(){var a=xa(h.none()),b=function(){a.get().each(function(a){a.destroy()})};return{clear:function(){b();a.set(h.none())},isSet:function(){return a.get().isSome()},
set:function(c){b();a.set(h.some(c))},run:function(b){a.get().each(b)}}},value:function(){var a=xa(h.none());return{clear:function(){a.set(h.none())},set:function(b){a.set(h.some(b))},isSet:function(){return a.get().isSome()},on:function(b){a.get().each(b)}}}},BD=Y.detect(),Nl=BD.os.isOSX(),hc=Nl?"\u2318":"Ctrl",Ol=Nl?"\u21e7":"Shift",CD={blockquote:[hc,Ol,"9"],bold:[hc,"B"],italic:[hc,"I"],underline:[hc,"U"],link:[hc,"K"],help:[hc,"?"],fullscreen:[hc,Ol,"F"],indent:[hc,"]"],outdent:[hc,"["],undo:[hc,
"Z"],redo:Nl?[hc,Ol,"Z"]:[hc,"Y"],search:[hc,"F"]},Z1="fr nl sv ru de es it".split(" "),$1=Z.merge(CD,{indent:[hc,"M"],outdent:[hc,Ol,"M"]}),DD=function(a){var b=ce.get();return k.contains(Z1,b)?$1[a]:CD[a]},a2=function(a){a=DD(a);return void 0===a?"":" "+a.join("")},b2=function(a){a=DD(a);return void 0===a?"":" ("+a.join(" ")+")"},c2=Nl?a2:b2,Va={get:function(a,b){return BD.os.isiOS()?u.get(a):u.get(a)+c2(b)}},fo="a11y-check",wP=w.resolve("inverted-dialog-widget"),ED=function(a,b,c){var d=t.get(b,
a);c=parseInt(d,10)+40*c;(0<c?t.set:t.remove)(b,a,c+"px")},d2={change:f.curry(ED,"margin-right")},nv={ltr:{change:f.curry(ED,"margin-left")},rtl:d2},Tc={runTransaction:function(a,b,c,d){d=void 0!==d?d:f.noop;b.save();a.focus();c=c();setTimeout(function(){a.domChanged();a.uiChanged()},0);d();b.save();return c}},or=C.immutable("startContainer","startOffset","endContainer","endOffset"),pr=function(a,b){if(a.property().isText(b))return S.point(b,a.property().getText(b).length);var c=a.property().children(b);
return 0<c.length?pr(a,c[c.length-1]):S.point(b,c.length)},FD=function(a,b,c){var d=a.property().children(b);return 0<d.length&&c<d.length?FD(a,d[c],0):0<d.length&&a.property().isElement(b)&&d.length===c?pr(a,d[d.length-1]):S.point(b,c)},qr=function(a,b,c){return a.property().isText(b)&&0===a.property().getText(b).trim().length||a.property().isComment(b)?c(b).bind(function(b){return qr(a,b,c).orThunk(function(){return h.some(b)})}):h.none()},GD=function(a,b){var c=qr(a,b,a.query().nextSibling).getOr(b);
if(a.property().isText(c))return S.point(c,0);var d=a.property().children(c);return 0<d.length?GD(a,d[0]):S.point(c,0)},HD=function(a,b){return a.property().isText(b)?a.property().getText(b).length:a.property().children(b).length},ID=function(a,b){var c=qr(a,b,a.query().prevSibling).getOr(b);if(a.property().isText(c))return S.point(c,HD(a,c));var d=a.property().children(c);return 0<d.length?ID(a,d[d.length-1]):S.point(c,HD(a,c))},Ve={toLast:pr,toLeaf:FD,toLower:function(a,b){var c=a.property().isText(b)?
a.property().getText(b).length:a.property().children(b).length;return S.point(b,c)},freefallLtr:GD,freefallRtl:ID},ic={toLeaf:function(a,b,c){return Ve.toLeaf(a,b,c)},freefallLtr:function(a,b){return Ve.freefallLtr(a,b)},freefallRtl:function(a,b){return Ve.freefallRtl(a,b)}},rr=Sa(),Ka={toLeaf:function(a,b){return ic.toLeaf(rr,a,b)},freefallLtr:function(a){return ic.freefallLtr(rr,a)},freefallRtl:function(a){return ic.freefallRtl(rr,a)}},JD=function(a,b){return ca.inBody(a)&&0<=b&&b<y.children(a).length},
Pl={multiple:function(a,b,c){return function(d,e){var g=a.getSelection(),f=g.map(function(a){return{left:y.parent(a.startContainer()).getOrDie(),right:y.parent(a.endContainer()).getOrDie()}}),h=Tc.runTransaction(a,b,function(){return k.bind(e,function(a){return a.getSelection().bind(function(a){return c(a.startContainer(),a.startOffset(),a.endContainer(),a.endOffset()).map(function(a){return a.all()})}).getOr([])})},a.toEditing),g=g.filter(function(a){return JD(a.startContainer(),a.startOffset())&&
JD(a.endContainer(),a.endOffset())}).getOrThunk(function(){var a=Ka.freefallLtr(0<h.length?h[0]:f.getOrDie().left),b=Ka.freefallRtl(0<h.length?h[h.length-1]:f.getOrDie().right);return or(a.element(),a.offset(),b.element(),b.offset())});a.setSelection(g.startContainer(),g.startOffset(),g.endContainer(),g.endOffset());return h}},single:function(a,b,c,d,e){return function(g,f){var h=d(a,g.startContainer(),g.startOffset()),k=d(a,g.endContainer(),g.endOffset()),m=Tc.runTransaction(a,b,function(){return c(h.element(),
h.offset(),k.element(),k.offset())},a.toEditing);return e(a,m,h,k,g)}}},Ql={multiple:function(a,b,c){return function(d,e){return Tc.runTransaction(a,b,function(){return k.bind(e,function(a){return a.getSelection().bind(function(a){return c(a.startContainer(),a.startOffset(),a.endContainer(),a.endOffset()).map(function(a){return a.all()})}).getOr([])})},a.toEditing)}},single:function(a,b,c,d,e){return function(g,f){var h=d(a,g.startContainer(),g.startOffset()),k=d(a,g.endContainer(),g.endOffset()),
m=Tc.runTransaction(a,b,function(){return c(h.element(),h.offset(),k.element(),k.offset())},a.toEditing);return e(a,m,h,k,g)}}},Gi=function(a,b,c,d,e){return b.map(function(b){a.setSelection(b.start(),b.soffset(),b.finish(),b.foffset());return b.all()}).getOr([])},Hi=function(a,b,c){return S.point(b,c)},sr=la.generate([{none:[]},{multiple:["elements","environments"]},{single:["selection","environment"]}]),qb={cata:function(a,b,c,d){return a.fold(b,c,d)},none:sr.none,multiple:sr.multiple,single:sr.single,
toSelection:function(a){return a.fold(h.none,function(a,c){return h.from(c[0]).bind(function(a){return a.getSelection()})},h.some)}},KD=C.immutable("left","right"),LD=function(a,b,c){var d=a.property().children(b);return k.findIndex(d,f.curry(a.eq,c)).map(function(a){return{before:f.constant(d.slice(0,a)),after:f.constant(d.slice(a+1))}})},Ii={breakToLeft:function(a,b,c){return LD(a,b,c).map(function(d){var e=a.create().clone(b);a.insert().appendAll(e,d.before().concat([c]));a.insert().appendAll(b,
d.after());a.insert().before(b,e);return KD(e,b)})},breakToRight:function(a,b,c){return LD(a,b,c).map(function(c){var e=a.create().clone(b);a.insert().appendAll(e,c.after());a.insert().after(b,e);return KD(b,e)})},breakPath:function(a,b,c,d){var e=C.immutable("first","second","splits"),g=function(b,f,k){var m=e(b,h.none(),k);return c(b)?e(b,f,k):a.property().parent(b).bind(function(e){return d(a,e,b).map(function(a){var b=[{first:a.left,second:a.right}],d=c(e)?e:a.left();return g(d,h.some(a.right()),
k.concat(b))}).getOr(m)})};return g(b,h.none(),[])}},f2=function(a,b,c,d){c=b(a,c);return k.foldr(d,function(c,d){var f=b(a,d);return e2(a,c,f)},c)},e2=function(a,b,c){return b.bind(function(b){return c.filter(f.curry(a.eq,b))})},g2={oneAll:function(a,b,c){if(0<c.length){var d=c[0];c=c.slice(1);a=f2(a,b,d,c)}else a=h.none();return a}},h2=function(a,b,c,d){var e=a.property().children(b);if(a.eq(b,c[0]))return h.some([c[0]]);if(a.eq(b,d[0]))return h.some([d[0]]);var g=function(c){c=k.reverse(c);var d=
k.findIndex(c,f.curry(a.eq,b)).getOr(-1);return k.findIndex(e,f.curry(a.eq,d<c.length-1?c[d+1]:c[d]))};c=g(c);var l=g(d);return c.bind(function(a){return l.map(function(b){var c=Math.min(a,b);b=Math.max(a,b);return e.slice(c,b+1)})})},MD=function(a,b,c,d){var e=void 0!==d?d:f.constant(!1);b=[b].concat(a.up().all(b));c=[c].concat(a.up().all(c));d=function(a){return k.findIndex(a,e).fold(function(){return a},function(b){return a.slice(0,b+1)})};b=d(b);var g=d(c);c=k.find(b,function(b){return k.exists(g,
f.curry(a.eq,b))});return{firstpath:f.constant(b),secondpath:f.constant(g),shared:f.constant(c)}},tr={subset:function(a,b,c){var d=MD(a,b,c);return d.shared().bind(function(b){return h2(a,b,d.firstpath(),d.secondpath())})},ancestors:MD},Dc={sharedOne:function(a,b,c){return g2.oneAll(a,b,c)},subset:function(a,b,c){return tr.subset(a,b,c)},ancestors:function(a,b,c,d){return tr.ancestors(a,b,c,d)},breakToLeft:function(a,b,c){return Ii.breakToLeft(a,b,c)},breakToRight:function(a,b,c){return Ii.breakToRight(a,
b,c)},breakPath:function(a,b,c,d){return Ii.breakPath(a,b,c,d)}},Gg=Sa(),Zd={sharedOne:function(a,b){return Dc.sharedOne(Gg,function(b,d){return a(d)},b)},subset:function(a,b){return Dc.subset(Gg,a,b)},ancestors:function(a,b,c){return Dc.ancestors(Gg,a,b,c)},breakToLeft:function(a,b){return Dc.breakToLeft(Gg,a,b)},breakToRight:function(a,b){return Dc.breakToRight(Gg,a,b)},breakPath:function(a,b,c){return Dc.breakPath(Gg,a,b,function(a,b,g){return c(b,g)})}},Rl=function(a,b,c,d,e){return d(a).fold(function(){return!0},
function(a){return L.eq(b,a)&&e(b,c)})},tf={isLeft:function(a,b){return Rl(a,b.startContainer(),b.startOffset(),Ab.first,ja.isStart)},isAtLeftEdge:function(a,b,c){return Rl(a,b,c,Ab.first,ja.isStart)},isRight:function(a,b){return Rl(a,b.startContainer(),b.startOffset(),Ab.last,ja.isEnd)},isAtRightEdge:function(a,b,c){return Rl(a,b,c,Ab.last,ja.isEnd)}},i2=function(a){a=A.name(a);return"td"===a||"th"===a},ur=function(a){return"li"===A.name(a)||fa.isBlock(a)},ND=function(a){return"a"===A.name(a)},OD=
function(a,b,c){return sa.closest(a,b,c).filter(f.not(c)).filter(f.not(i2))},vb={stopAt:function(a){return f.curry(L.eq,a)},isList:function(a){a=A.name(a);return"ol"===a||"ul"===a},isAnchor:ND,isHeading:function(a,b){var c=Q.isArray(b)?b:[],c="h1 h2 h3 h4 h5 h6".split(" ").concat(c),d=A.name(a);return k.contains(c,d)},isCollapsed:function(a){return L.eq(a.startContainer(),a.endContainer())&&a.startOffset()===a.endOffset()},isRightEdge:function(a,b,c){var d=C.immutable("startContainer","startOffset");
return tf.isRight(a,d(b,c))},isBlockOrList:ur,exitList:function(a){return 0===lc.descendants(a,function(a){return A.isText(a)&&0<Fa.get(a).length&&0<aa.trim(Fa.get(a)).length||A.isElement(a)&&k.contains("hr img input video iframe picture audio embed map object".split(" "),A.name(a))}).length},findBlock:function(a,b){return sa.closest(a,ur,b)},findValidHardBreak:function(a,b){return OD(a,ur,b)},findAnchorBreak:function(a,b){return OD(a,ND,b)}},vr={forceAddBr:function(a,b){if("br"!==A.name(a)){var c=
q.fromTag("br");if(A.isText(a))v.after(a,c),L.eq(b,a)||B.remove(a);else if(vb.isBlockOrList(a))v.append(a,c);else{var d=q.fromText(Ua.zeroWidth());v.prepend(a,d);v.after(a,c)}}},rootBr:function(a,b){v.before(a,q.fromTag("br"))}},PD=function(a,b,c){var d=[];k.each(y.children(a),function(a){b(a)&&(d=d.concat([a]));d=c(a)?d:d.concat(PD(a,b,c))});return d},QD=function(a,b){var c=y.children(a);return 0<c.length?(c=c[0],b(c)||"textarea"===A.name(c)?a:QD(c,b)):a},Sl={descendants:PD,plunge:QD},Tl=function(a){if(!A.isText(a))return!1;
a=Fa.get(a).trim();return 0===a.length||0===a.replace(Ua.zeroWidth(),"").length},Ul=function(a){if(A.isText(a))return Tl(a);var b=ua.get(a);a=y.children(a);return""===aa.trim(b)||k.forall(a,Tl)},Hg={vacant:function(a){a=X.descendants(a,"span,a");return k.filter(a,function(a){if("span"===A.name(a)){var c=m.has(a,"class")&&0<m.get(a,"class").length,d=m.has(a,"id");a=!c&&!d&&!m.has(a,"style")&&Ul(a)}else a=Ul(a);return a})},isEmpty:Ul,hasCursor:function(a,b){var c=void 0!==b?b:"hr br img input textarea iframe".split(" ");
return A.isText(a)?!1===Tl(a):k.contains(c,A.name(a))},isVacantText:Tl,hasNoContent:Ul},RD=function(a){var b="li"===A.name(a)?vb.isList:f.constant(!1);return 0<Sl.descendants(a,Hg.hasCursor,b).length?h.none():h.some(Sl.plunge(a,b))},SD=function(a){a=Hg.vacant(a);k.each(a,B.remove)},TD=function(a,b){var c=X.descendants(b,a),c=k.filter(c,Hg.isEmpty);k.each(c,B.remove);Hg.isEmpty(b)&&B.remove(b)},pe={vacate:SD,emptyStyles:function(a){!0===m.has(a,"style")&&0===m.get(a,"style").length&&m.remove(a,"style")},
needsCursor:RD,postprocess:function(a,b,c){SD(a);RD(a).each(function(a){vr.forceAddBr(a,b)})},lists:f.curry(TD,"ul,ol"),blockquotes:f.curry(TD,"blockquote")},j2=function(a,b){var c=Zd.breakToRight(a,b);c.each(function(a){a=a.right();k.each(["id"],f.curry(m.remove,a));pe.emptyStyles(a)});return c},Vl={breakPath:function(a,b){return Zd.breakPath(a,b,j2)}},k2={breakQuote:function(a,b){var c=Vl.breakPath(b,vb.stopAt(a));return c.second().map(function(a){var e=c.first();v.before(a,b);k.each([e,a],pe.blockquotes);
return{start:f.constant(da.on(b,0)),finish:f.constant(da.on(b,0))}})}},UD=function(a){return A.isElement(a)?a:y.parent(a).getOr(a)},VD={bothMatch:function(a,b,c){a=UD(a);b=UD(b);return c(a)&&c(b)}},Wl={isRootOrCell:function(a){return function(b){return a(b)||qa.is(b,"td,th")}},isRootOrContainer:function(a){return function(b){return a(b)||fa.isContainer(b)}}},WD=function(a,b){return 0===a.length?!0:0===b.length?!1:a[0]<b[0]?!0:b[0]<a[0]?!1:WD(a.slice(1),b.slice(1))},We={head:function(a){return 0<a.length?
h.some(a[0]):h.none()},tail:function(a){return 0<a.length?h.some(a.slice(1)):h.none()},toLast:function(a){return 0<a.length?h.some(a[a.length-1]):h.none()},box:function(a){return[a]},isBefore:WD},Xl=la.generate([{quasi:["elements"]},{block:["element"]},{container:["element","children"]},{fixture:["element"]}]),XD=function(a){return a.fold(function(a){return"@q["+k.map(a,function(a){return a.dom().outerHTML||'"'+a.dom().nodeValue+'"'}).join(",")+"]"},function(a){return"@"+a.dom().nodeName.toLowerCase()+
"("+a.dom().innerHTML+")"},function(a,c){return"#"+a.dom().nodeName.toLowerCase()+"("+k.map(c,XD).join(",")+")"},function(a){return a.dom().nodeName.toLowerCase()})},YD=function(a){var b=function(a){return[a]};return a.fold(f.identity,b,b,b)},Yl=f.constant(!0),Xe=f.constant(!1),Ob={cata:function(a,b,c,d,e){return a.fold(b,c,d,e)},quasi:Xl.quasi,block:Xl.block,container:Xl.container,fixture:Xl.fixture,isQuasi:function(a){return a.fold(Yl,Xe,Xe,Xe)},isFixture:function(a){return a.fold(Xe,Xe,Xe,Yl)},
isQuasiOrFixture:function(a){return a.fold(Yl,Xe,Xe,Yl)},toTarget:YD,toString:XD,toLastTarget:function(a){return We.toLast(YD(a))}},Ji=function(a,b){return{fold:a,label:f.constant(b)}},Ye={before:function(a){return Ji(function(b,c,d,e,g){return b(a)},"before")},after:function(a){return Ji(function(b,c,d,e,g){return c(a)},"after")},rest:function(a){return Ji(function(b,c,d,e,g){return d(a)},"rest")},last:function(a){return Ji(function(b,c,d,e,g){return e(a)},"last")},invalid:function(a,b){return Ji(function(c,
d,e,g,f){return f(a,b)},"invalid")}},ZD={subdivide:function(a,b,c){var d=a.property().getText(b);c=k.filter(pl.splits(d,c),function(a){return 0<a.length});if(1>=c.length)return[S.range(b,0,d.length)];a.property().setText(b,c[0]);var d=Wc.generate(c.slice(1),function(b,c){var d=a.create().text(b),d=S.range(d,c,c+b.length);return h.some(d)},c[0].length),e=k.map(d,function(a){return a.element()});a.insert().afterAll(b,e);return[S.range(b,0,c[0].length)].concat(d)}},Zl=function(a,b){return{fold:a,label:f.constant(b)}},
$l={none:function(){return Zl(function(a,b,c,d){return a()},"none")},start:function(a){return Zl(function(b,c,d,e){return c(a)},"start")},middle:function(a,b){return Zl(function(c,d,e,g){return e(a,b)},"middle")},end:function(a){return Zl(function(b,c,d,e){return e(a)},"end")}},l2={determine:function(a){return a.before().fold(function(){return a.after().fold(function(){return $l.none()},function(a){return $l.start(a)})},function(b){return a.after().fold(function(){return $l.end(b)},function(a){return $l.middle(b,
a)})})}},m2={group:function(a,b,c){b=k.bind(b,function(b){return Qe.from(a,b,c)});b=hz.splitbyAdv(b,function(a){return Vk.cata(a,function(){return vg.excludeWithout(a)},function(){return vg.excludeWith(a)},function(){return vg.include(a)})});return k.filter(b,function(a){return 0<a.length})}},n2={common:function(a,b,c){b=[b].concat(a.up().all(b));var d=[c].concat(a.up().all(c));return k.find(b,function(b){return k.exists(d,function(c){return a.eq(c,b)})})}},yP="table tbody thead tfoot tr ul ol".split(" "),
o2={range:function(a,b,c,d,e){return a.eq(b,d)?[b]:n2.common(a,b,d).fold(function(){return[]},function(g){var l=[g].concat(Qe.all(a,g,f.constant(!1)));g=k.findIndex(l,f.curry(a.eq,b));var h=k.findIndex(l,f.curry(a.eq,d));g=g.bind(function(a){return h.map(function(b){return a<b?l.slice(a+c,b+e):l.slice(b+e,a+c)})}).getOr([]);var s=xP(a);return k.filter(g,s.validateText)})}},$D={range:function(a,b,c,d,e){return o2.range(a,b,c,d,e)},group:function(a,b,c){return m2.group(a,b,c)}},wr=C.immutable("before",
"after"),aE=function(a,b,c){a=a.property().getText(b);return pl.splits(a,c)},bE=function(a,b,c,d){if(!a.property().isText(b)||c===d)return b;if(c>d)return bE(a,b,d,c);var e=a.property().getText(b).length;if(0===c&&d===e)return b;d=aE(a,b,[c,d]);a.property().setText(b,d[0]);d=k.map(d.slice(1),function(b){return a.create().text(b)});e=d[0];a.insert().afterAll(b,d);return 0===c?b:e},Ki={split:function(a,b,c){if(!a.property().isText(b)||0>=c)return wr(h.none(),h.some(b));if(c>=a.property().getText(b).length)return wr(h.some(b),
h.none());c=aE(a,b,[c]);a.property().setText(b,c[0]);c=a.create().text(c[1]);a.insert().after(b,c);return wr(h.some(b),h.some(c))},splitByPair:bE},p2=function(a,b,c,d,e){c=Ki.split(a,b,c).after().fold(function(){return S.delta(b,1)},function(a){return S.delta(a,0)});e=Ki.split(a,d,e).before().fold(function(){return S.delta(d,0)},function(a){return S.delta(a,1)});return $D.range(a,c.element(),c.deltaOffset(),e.element(),e.deltaOffset())},q2=function(a,b,c,d,e){return[Ki.splitByPair(a,b,c,e)]},r2={nodes:function(a,
b,c,d,e){return(a.eq(b,d)?q2:p2)(a,b,c,d,e)}},Yc={split:function(a,b,c){return Ki.split(a,b,c)},splitByPair:function(a,b,c,d){return Ki.splitByPair(a,b,c,d)},range:function(a,b,c,d,e){return r2.nodes(a,b,c,d,e)},subdivide:function(a,b,c){return ZD.subdivide(a,b,c)},position:function(a,b){return l2.determine(b)}},s2=function(a,b,c){var d=Yc.split(a,b,c);return Yc.position(a,d).fold(function(){return Ye.invalid(b,c)},Ye.before,Ye.after,Ye.after)},t2=function(a,b,c){var d=a.property().children(b);return a.property().isEmptyTag(b)?
Ye.before(b):c===d.length?Ye.last(b):c<d.length?Ye.rest(d[c]):Ye.invalid(b,c)},u2={atStartOf:function(a,b,c,d){var e=function(b){a.insert().before(b,d)};(a.property().isText(b)?s2:t2)(a,b,c).fold(e,function(b){a.insert().after(b,d)},e,function(b){a.insert().append(b,d)},f.noop)}},xr={atStartOf:function(a,b,c,d){u2.atStartOf(a,b,c,d)}},v2=la.generate([{none:[]},{root:["target","block"]},{created:["target","block"]},{actual:["target","block"]}]),Ze=Z.merge(v2,{toString:function(a){return a.fold(function(){return["block.none"]},
function(a,c){return["block.root",a,c]},function(a,c){return["block.created",a,c]},function(a,c){return["block.actual",a,c]})},cata:function(a,b,c,d,e){return a.fold(b,c,d,e)},extract:function(a){var b=f.constant([]),c=function(a,b){return[b]};return a.fold(b,b,c,c)},extractEvenRoot:function(a){var b=f.constant([]),c=function(a,b){return[b]};return a.fold(b,c,c,c)}}),cE=function(a,b){return function(c){return a.eq(c,b)||a.property().parent(c).map(function(c){return a.eq(c,b)}).getOr(!1)}},w2=function(a,
b,c){return a.eq(b,c)?h.none():a.property().isBoundary(c)?a.query().nextSibling(c):a.property().isEmptyTag(c)?(b=cE(a,b),b(c)?a.query().nextSibling(c):Dc.breakPath(a,c,b,Dc.breakToRight).second()):h.none()},x2=function(a,b,c){if(a.eq(b,c))return h.none();if(a.property().isBoundary(c))return a.query().prevSibling(c);if(a.property().isEmptyTag(c)){var d=cE(a,b);return d(c)?a.query().prevSibling(c):a.query().prevSibling(c).map(function(b){return Dc.breakPath(a,b,d,Dc.breakToRight).first()})}return h.none()},
dE=function(a,b,c,d){return c(a,b,d).bind(function(c){var d=a.property().children(b);return k.findIndex(d,function(b){return a.eq(b,c)})})},yr=function(a,b){return a.property().isEmptyTag(b)||a.property().isBoundary(b)},zr={create:function(a,b,c){if(yr(a,c)||yr(a,ic.toLeaf(a,c,0).element()))return[c];var d=f.curry(yr,a),e=f.curry(a.eq,b),g=ma.seekLeft(a,c,d,e).bind(function(c){return dE(a,b,w2,c)}).getOr(0),l=a.property().children(b);c=ma.seekRight(a,c,d,e).bind(function(c){return dE(a,b,x2,c)}).getOr(l.length-
1);return a.property().children(b).slice(g,c+1)}},y2=function(a,b,c,d){return c(b)||d(b)?h.some(b):a.up().predicate(b,c,d)},eE=function(a,b,c){c=c();a.insert().wrap(b,c);return Ze.created(b,c)},z2=function(a,b,c,d){var e=d();a.insert().before(c[0],e);k.each(c,function(b){a.insert().append(e,b)});return Ze.created(b,e)},A2=function(a,b,c,d,e,g,f){if(g(c)){var h=a.property().children(b);if(d<h.length&&f(h[d]))return Ze.actual(c,h[d])}return e(b).fold(function(){return Ze.root(c,b)},function(e){if(g(c)){var f=
e(),l=a.property().children(b),h=l[d];void 0!==h&&(e=zr.create(a,b,h,e),a.insert().appendAll(f,0<e.length?e:[h]));xr.atStartOf(a,b,Math.min(l.count,d),f);return Ze.created(b,f)}a.property().isEmptyTag(c)?e=eE(a,c,e):(f=zr.create(a,b,c),e=0<f.length?z2(a,c,f,e):eE(a,c,e));return e})},B2={single:function(a,b,c,d,e,g){return y2(a,c,b,g).fold(Ze.none,function(f){return g(f)?A2(a,f,c,d,e,g,b):Ze.actual(c,f)})}},fE={resolve:jb.create("ephox-soldier").resolve},Ig=fE.resolve("quasi-block"),gE=function(a){a=
y.children(a);return 1===a.length&&"br"===A.name(a[0])},hE=function(a){return n.has(a,Ig)&&!gE(a)},am={condense:function(a){a=k.filter(a,function(a,c){if(!A.isElement(a))return!0;var d;n.has(a,Ig)&&gE(a)&&(y.prevSibling(a).exists(hE)||y.nextSibling(a).exists(hE))?(B.remove(a),d=!1):d=!0;return d});return k.map(a,function(a){var c=A.isElement(a)?[a].concat(X.descendants(a,"."+Ig)):[];k.each(c,function(a){n.remove(a,Ig)});return a})},register:function(a){return function(b){return a(b).map(function(a){return function(){var b=
a();n.add(b,Ig);return b}})}},style:f.constant(Ig)},C2=Sa(),Lh={single:function(a,b,c,d,e){return B2.single(C2,a,b,c,am.register(d),e)},isBlock:function(a){return k.contains("ol p div ul table caption td th h1 h2 h3 h4 h5 h6 body blockquote pre".split(" "),A.name(a))}},Li={tag:function(){return"p"},nu:function(a){return f.curry(a.create().nu,"p")}},Ar=function(a){return 0<a.length?h.some(a[0]):h.none()},Mi=la.generate([{descend:["index"]},{leftOf:["rindex"]},{bounded:["lindex","rindex"]},{rightOf:["lindex"]},
{all:[]}]),iE={derive:function(a,b){return a.bind(Ar).fold(function(){return b.bind(Ar).fold(function(){return Mi.all()},function(a){return Mi.leftOf(a)})},function(a){return b.bind(Ar).fold(function(){return Mi.rightOf(a)},function(b){return a===b?Mi.descend(a):Mi.bounded(a,b)})})},cata:function(a,b,c,d,e,g){return a.fold(b,c,d,e,g)}},jE=function(a,b,c){return h.from(a.property().children(b)[c])},D2=function(a,b,c){var d=a.property().children(c),e=jE(a,c,0).bind(function(e){return jE(a,c,d.length-
1).map(function(d){return Br(a,b,c,e,d)})}).getOr([]);return Ob.container(c,e)},Br=function(a,b,c,d,e){var g=kE(a,c,b,d);return Ob.toLastTarget(g).filter(function(b){return!a.eq(e,b)}).bind(function(d){return ma.walk(a,d,ma.sidestep,ma.walkers().right()).bind(function(d){if(a.eq(c,d.item()))return h.none();d=Br(a,b,c,d.item(),e);return h.some([g].concat(d))})}).getOrThunk(function(){return[g]})},kE=function(a,b,c,d){if(Xb.isFormatting(a,d))return Ob.block(d);if(Xb.isEmptyTag(a,d))return Ob.fixture(d);
if(Xb.isBlock(a,d)||Xb.isContainer(a,d))return D2(a,c,d);a=zr.create(a,b,d);return Ob.quasi(0<a.length?a:[d])},lE=function(a,b,c){return kE(a,c,b,c)},Cr=function(a,b,c,d,e,g,f,p){c=c.map(function(c){return Ni(a,b,c,f.bind(We.tail),h.none())}).getOr([]);e=e.map(function(c){return Ni(a,b,c,h.none(),p.bind(We.tail))}).getOr([]);d=0===d.length?[]:Br(a,b,g,d[0],d[d.length-1]);return[Ob.container(g,c.concat(d).concat(e))]},Ni=function(a,b,c,d,e){var g=a.property().children(c);d.bind(We.head).getOr(0);e.bind(We.head).getOr(g.length-
1);var f=iE.derive(d,e);return iE.cata(f,function(c){return Ni(a,b,g[c],d.bind(We.tail),e.bind(We.tail))},function(f){return Cr(a,b,h.none(),g.slice(0,f),h.from(g[f]),c,d,e)},function(f,l){return Cr(a,b,h.from(g[f]),g.slice(f+1,l),h.from(g[l]),c,d,e)},function(f){return Cr(a,b,h.from(g[f]),g.slice(f+1),h.none(),c,d,e)},function(){return[lE(a,b,c)]})},mE={categorise:lE,within:function(a,b,c,d,e){return!0===We.isBefore(d,e)?Ni(a,b,c,h.some(d),h.some(e)):Ni(a,b,c,h.some(e),h.some(d))}},Dr=function(a,
b){if("li"!==A.name(a))return!1;var c=k.foldl(b,function(a,b){return 1<a.quasi||0<a.nonlist?a:Ob.cata(b,function(){return{quasi:1+a.quasi,nonlist:a.nonlist}},function(){return{quasi:a.quasi,nonlist:1+a.nonlist}},function(b){return{quasi:a.quasi,nonlist:(k.contains(["ul","ol"],A.name(b))?0:1)+a.nonlist}},function(){return{quasi:1+a.quasi,nonlist:a.nonlist}})},{quasi:0,nonlist:0});return 1>=c.quasi&&0===c.nonlist},Er=function(a,b,c){return 0>=c.length?!0:k.contains(a,A.name(b))?2<c.length?!1:1===c.length?
Ob.isQuasiOrFixture(c[0]):Ob.isQuasiOrFixture(c[0])&&Ob.isQuasiOrFixture(c[1])&&!k.forall(c,Ob.isFixture):!1},Zc={wrap:function(a){if(0===a.length||1===a.length&&A.isText(a[0])&&0===Fa.get(a[0]).trim().length)return[];var b=q.fromTag(Li.tag());n.add(b,am.style());v.before(a[0],b);J.append(b,a);return[b]},handleContainer:function(a,b,c,d){if(Er(a,b,c))return[b];var e=Dr(b,c)?[b]:[];return e.concat(k.bind(c,function(a){return d(a,0<e.length)}))},hasSimpleContent:Er,isNestedList:Dr,handleRoot:function(a,
b){var c=mE.categorise(Sa(),f.curry(L.eq,b),b,b,b),d=function(){return h.some(Li.nu(Sa()))},e=h.none;return Ob.cata(c,d,e,function(b,c){return Er(a,b,c)||Dr(b,c)?e():d()},d)}},bm=["li","td","th","caption"],nE=function(a,b){return Ob.cata(a,function(a){return!0===b?[]:Zc.wrap(a)},function(a){return[a]},function(a,b){return Zc.handleContainer(bm,a,b,nE)},function(a){return!0===b?[]:Zc.wrap([a])})},E2={isRootContainer:Wl.isRootOrContainer,extract:function(a){return nE(a,!1)},isCapable:function(a){return Lh.isBlock(a)||
k.contains(bm,A.name(a))},canUse:function(a){return fa.isFormatting(a)||k.contains(bm,A.name(a))},quasi:f.curry(Zc.handleRoot,bm),ascend:f.identity},oE=C.immutableBag(["start","soffset","finish","foffset","all"],[]),pE=C.immutableBag(["start","soffset","finish","foffset"],[]),Jg={block:oE,inline:pE,blockFrom:function(a){return 0<a.length?h.some(oE({start:a[0],soffset:0,finish:a[a.length-1],foffset:ja.getEnd(a[a.length-1]),all:a})):h.none()},inlineFrom:function(a){return a.map(function(a){return pE({start:a.start(),
soffset:a.soffset(),finish:a.finish(),foffset:a.foffset()})})}},cm=function(a){return qa.is(a,"td,th")},qE=function(a){return L.eq(a.startContainer(),a.endContainer())&&a.startOffset()===a.endOffset()},rE=function(a,b){return a(b.startContainer())?h.some(Ka.freefallLtr(b.startContainer())):h.none()},sE=function(a,b){return(a(b.endContainer())?h.some(Ka.freefallRtl(b.endContainer())):h.none()).map(function(a){return qa.is(a.element(),"br")&&!1===qE(b)?S.point(a.element(),1):a})},$c={is:cm,isCollapsed:qE,
isWholeCell:function(a){return cm(a.startContainer())&&L.eq(a.startContainer(),a.endContainer())&&0===a.startOffset()&&a.endOffset()===ja.getEnd(a.endContainer())},left:f.curry(rE,cm),leftWith:rE,right:f.curry(sE,cm),rightWith:sE},Fr=C.immutable("startContainer","startOffset","endContainer","endOffset"),Gr=C.immutable("start","soffset","finish","foffset"),mb={hare:Fr,fussy:Gr,fromHare:function(a){return Gr(a.startContainer(),a.startOffset(),a.endContainer(),a.endOffset())},fromFussy:function(a){return Fr(a.start(),
a.soffset(),a.finish(),a.foffset())},fussyFromElements:function(a){if(0===a.length)return h.none();var b=a[0];a=a[a.length-1];b=y.firstChild(b).getOr(b);a=y.lastChild(a).getOr(a);return h.some(Gr(b,0,a,ja.getEnd(a)))},hareFromElement:function(a){return Fr(a,0,a,ja.getEnd(a))}},tE=function(a,b){return b(a)?h.some([]):y.parent(a).bind(function(c){return y.findIndex(a).bind(function(a){return tE(c,b).map(function(b){return b.concat([a])})})})},uE=function(a,b){return 0===b.length?h.some(a):y.child(a,
b[0]).bind(function(a){return uE(a,b.slice(1))})},Kg={path:function(a,b){var c=f.curry(L.eq,a);return L.eq(a,b)?h.some([]):tE(b,c)},follow:uE},vE=C.immutable("ancestor","startPath","finishPath"),F2=function(a,b,c){return Zd.ancestors(b,c,a).shared().bind(function(a){return Kg.path(a,b).bind(function(b){return Kg.path(a,c).map(function(c){return vE(a,b,c)})})})},wE=function(a,b,c,d){var e=b.isRootContainer(a);c=Lh.single(b.isCapable,c,d,b.quasi,e);c=Ze.extractEvenRoot(c);return 1===c.length?h.some(c[0]).map(function(c){return b.ascend(c,
a)}):h.none()},xE=function(a,b,c,d){if(!1===b(c))return S.point(c,d);d<ja.getEnd(c)||a.isCapable(c)&&a.canUse(c)?c=Ka.toLeaf(c,d):(a=q.fromTag("br"),v.append(c,a),c=S.point(a,0));return c},G2={branch:function(a,b,c,d,e,g){var l=b.isRootContainer(a),p=mb.hare(c,d,e,g),k=f.constant(!0===$c.isWholeCell(p)),m=$c.left(p).filter(k).getOrThunk(function(){return xE(b,l,c,d)}),x=$c.right(p).filter(k).getOrThunk(function(){return xE(b,l,e,g)});return wE(a,b,m.element(),m.offset()).bind(function(c){return(L.eq(m.element(),
x.element())&&m.offset()===x.offset()?h.some(c):wE(a,b,x.element(),x.offset())).bind(function(b){return L.eq(c,b)?h.some(vE(c,[],[])):F2(a,c,b)})})}},yE=function(a,b,c,d,e,g,f){a=b.isRootContainer(a)(c);b=!a&&ca.inBody(c)?S.point(c,d):a||!b.isCapable(c)||ca.inBody(c)?ca.inBody(e.element())&&k.contains(["td","th"],A.name(c))?e:!ca.inBody(c)&&ca.inBody(g.element())&&"br"==A.name(g.element())?g:Ka.toLeaf(f,0):S.point(f,d);ja.getEnd(b.element());return b.offset()<=ja.getEnd(b.element())?h.some(b):h.none()},
Lg={applyOn:function(a,b,c,d,e,g,f){var p=wc.after(c,d,e,g),s=b.isRootContainer(a)(c)?Ka.toLeaf(c,d):S.point(c,d),m=b.isRootContainer(a)(e)?Ka.toLeaf(e,g):S.point(e,g),x=Ka.toLeaf(c,d),n=Ka.toLeaf(e,g),r=G2.branch(a,b,c,d,e,g).map(function(b){return mE.within(Sa(),a,b.ancestor(),b.startPath(),b.finishPath())}).getOr([]),r=k.bind(r,b.extract);k.each(r,function(a){0===y.children(a).length&&fa.isFormatting(a)&&v.append(a,q.fromTag("br"))});var r=am.condense(r),t=f(r);return 0===t.length?h.none():yE(a,
b,c,d,s,x,t[p?t.length-1:0]).bind(function(c){return yE(a,b,e,g,m,n,t[p?0:t.length-1]).map(function(a){return Jg.block({start:c.element(),soffset:c.offset(),finish:a.element(),foffset:a.offset(),all:t})})})}},Hr=function(a){return function(b){return a}},zE={start:Od.onDirection("left","right"),end:Od.onDirection("right","left"),justify:Hr("justify"),center:Hr("center"),"match-parent":Hr("match-parent")},H2={hasAlignment:function(a,b,c){A.isText(a)?a=!1:(b=t.get(a,b),a=(void 0!==zE[b]?zE[b](a):b)===
c);return a}},I2=function(a,b,c){return H2.hasAlignment(c,a,b)},dm=function(a,b,c){var d=zP(b,c);return{run:function(a,b,c,f,h){return Lg.applyOn(a,E2,b,c,f,h,function(a){var b=k.forall(a,d.is)?d.remove:d.set;k.each(a,b);return a})},query:function(a,d){var l=f.curry(I2,b,c);return VD.bothMatch(a,d,l)},name:f.constant(a)}},J2=dm("JustifyLeft","text-align","left"),K2=dm("JustifyCenter","text-align","center"),L2=dm("JustifyRight","text-align","right"),M2=dm("JustifyFull","text-align","justify"),ld={justifyleft:f.constant(J2),
justifycentre:f.constant(K2),justifyright:f.constant(L2),justifyfull:f.constant(M2)},AE=function(a){a=a.dom();if(Md.isSupported(a)){var b=a.style.marginLeft;return"auto"===a.style.marginRight&&"auto"===b}return!1},Ir={isCentered:AE,divine:function(a){if(AE(a))return h.some("center");var b=t.getRaw(a,"float").getOrThunk(function(){return t.get(a,"float")});return void 0!==b&&null!==b&&0<b.length?h.some(b):h.none()},getRaw:function(a){return t.getRaw(a,"float").getOr(null)},setCentered:function(a){t.setAll(a,
{"margin-left":"auto","margin-right":"auto"})}},N2={left:{"float":"left",margin:""},right:{"float":"right",margin:""},none:{"float":"none",margin:""},center:{"float":"",margin:"0 auto"}},BE={none:{display:""},left:{display:""},right:{display:""},center:{display:"block"}},CE=function(a,b){return Ir.divine(a).is(b)},DE=function(a,b){var c="img"===A.name(a)&&void 0!==BE[b]?BE[b]:{};h.from(N2[b]).each(function(b){t.setAll(a,b);t.setAll(a,c)})},em=function(a,b){return{run:function(a){DE(a,b);return h.none()},
query:function(a){return CE(a,b)},name:f.constant(a)}},O2=em("JustifyLeft","left"),P2=em("JustifyCenter","center"),Q2=em("JustifyRight","right"),R2=em("FloatNone","none"),Nf={floatnone:f.constant(R2),floatleft:f.constant(O2),floatcentre:f.constant(P2),floatright:f.constant(Q2),queryIsFloat:CE,runFloat:DE},EE=function(a){return Ob.cata(a,function(a){return Zc.wrap(a)},function(a){return[a]},function(a,c){return k.bind(c,EE)},function(a){return Zc.wrap([a])})},FE={isRootContainer:Wl.isRootOrContainer,
extract:EE,isCapable:function(a){return Lh.isBlock(a)||"li"===A.name(a)},canUse:function(a){return fa.isFormatting(a)},quasi:function(a){return h.some(Li.nu(Sa()))},ascend:f.identity},Jr=C.immutable("level","content","cruft","list","item"),fm={level:function(a,b){return Jr(a.level()+b,a.content(),a.cruft(),a.list(),a.item())},list:function(a,b){return Jr(a.level(),a.content(),a.cruft(),b,a.item())}},GE=C.immutable("elements","elementsTransformed"),S2=C.immutable("original","replaced"),Of=C.immutable("result",
"items"),gm={answer:GE,write:function(a,b){var c=[],d=function(b){var c=a.create().nu("p");a.insert().appendAll(c,b);return c},e=function(a){if(0===a.length)throw"Cannot get tail of an empty array";return a.slice(1)},g=function(b,c){for(var d=a.create().clone(c[0].list()),h=[],p=c[0];0<c.length&&c[0].level()>=b&&a.property().name(p.list())===a.property().name(c[0].list());){var m;if(c[0].level()===b){m=b;var n=c,q=n[0],r;r=q;var t=r.item(),u=t,u=a.property().children(u);k.each(u,a.remove().remove);
a.insert().appendAll(t,r.content());r=t;q=q.cruft();for(n=e(n);0<n.length&&n[0].level()>m;)n=g(m+1,n),t=[n.result()].filter(f.curry(l,["li"])),n=n.items(),a.insert().appendAll(r,t);a.insert().appendAll(r,q);m=Of(r,n);n=[m.result()].filter(f.curry(l,["li"]));m=Of(n,m.items())}else m=g(b+1,c),n=[m.result()].filter(f.curry(l,["ul","ol"])),q=a.create().nu("li"),a.styles().set(q,"list-style-type","none"),a.attrs().remove(d,"id"),a.insert().appendAll(q,n),m=Of([q],m.items());c=m.items();h=h.concat(m.result())}a.insert().appendAll(d,
h);return Of(d,c)},l=function(b,c){return!(k.contains(b,a.property().name(c))&&0===a.property().children(c).length)},h=function(b){for(var h=[];0<b.length;){var k=b[0];if(0===k.level()){var p=b[0],m=p.content(),m=1===m.length&&Xb.isBlock(a,m[0])?m[0]:d(m);c.push(S2(p.item(),m));b=Of(m,e(b));p=[b.result()].filter(f.curry(l,["p"]));0===p.length&&c.pop();b=b.items();h=h.concat(p);m=b;for(b=[];0<m.length&&0<m[0].level();)m=g(1,m),p=[m.result()].filter(f.curry(l,["ul","ol"])),m=m.items(),b=b.concat(p);
p=Of(b,m);b=p.items();h=h.concat(p.result());0<k.cruft().length&&(h=h.concat([d(k.cruft())]))}else b=g(1,b),k=[b.result()].filter(f.curry(l,["ul","ol"])),b=b.items(),h=h.concat(k)}return Of(h,b)}(b);if(0!==h.items().length)throw"Error - there should not be any remaining items to parse";return GE(h.result(),c)}},HE=function(a){return k.foldl(a,function(a,c){var d=a.elements().concat(c.elements()),e=a.elementsTransformed().concat(c.elementsTransformed());return gm.answer(d,e)},gm.answer([],[]))},T2=
{combine:HE,write:function(a,b){var c=k.groupBy(b,function(b){return a.property().name(b.list())+"-"+a.styles().getRaw(b.list(),"list-style-type").getOr("default")}),c=k.map(c,function(b){return gm.write(a,b)});return HE(c)}},IE=Sa(),JE=function(a){return T2.write(IE,a)},U2=function(a){return gm.write(IE,a)},KE=function(a,b,c){return I.closest(a,"li",c).bind(function(a){return b(a,c).map(function(b){return{item:f.constant(a),outerlist:f.constant(b)}})})},LE=function(a,b){return k.findIndex(a,function(a){return L.eq(a,
b)})},V2=function(a,b,c){return LE(a,b).bind(function(b){return LE(a,c).map(function(c){var g=Math.min(b,c);c=Math.max(b,c);return a.slice(g,c+1)})})},Mg={context:function(a,b,c,d,e){return KE(a,c,e).bind(function(g){return KE(b,c,e).bind(function(c){if(L.eq(g.outerlist(),c.outerlist())){var e;if(L.eq(a,b))e=[g.item()];else{var k=g.outerlist();e=g.item();var m=c.item(),k=X.descendants(k,"li");e=V2(k,e,m).getOr([])}c=h.some({outerlist:g.outerlist,startItem:g.item,finishItem:c.item,writer:f.constant(d),
selected:f.constant(e)})}else c=h.none();return c})})},immediate:function(a,b){return I.closest(a,"ul,ol",b)},topmost:function(a,b){var c=lc.ancestors(a,function(a){return fa.isList(a)||fa.isContainer(a)},b);return k.findIndex(c,function(a){return!k.contains(["li","ol","ul"],A.name(a))}).map(function(a){return 0<a&&a-1<c.length?h.some(c[a-1]):0<c.length?h.some(c[c.length-1]):h.none()}).getOrThunk(function(){return 0<c.length?h.some(c[c.length-1]):h.none()})}},Kr={context:function(a,b,c){return Mg.context(a,
b,Mg.topmost,U2,c)},indent:function(a){return fm.level(a,1)},outdent:function(a){return fm.level(a,-1)}},W2=function(a,b){return k.exists(a,function(a){return L.eq(b,a)})},X2={operate:function(a,b,c){return k.map(b,function(b){return W2(c,b.item())?a(b):b})}},ME=C.immutable("before","on","after"),Y2=function(a,b){var c=h.from(k.map(b,function(b){return a[b]})),d=a.slice(0,b[0]),e=a.slice(b[b.length-1]+1);return ME(d,c,e)},Z2={refine:function(a,b){var c=k.map(a,function(a,c){return b(a)?h.some(c):
h.none()}),c=$a.cat(c),d=ME(a,h.none(),[]);return 0===c.length?d:Y2(a,c)}},Lr=function(a,b){var c=X.children(a,"li,ol,ul");return k.bind(c,function(c){return"li"===A.name(c)?$2(a,c,b):Lr(c,b+1)})},$2=function(a,b,c){var d=a3(b),e=[Jr(c,d.before(),d.after(),a,b)];return d.on().fold(function(){return e},function(a){a=k.bind(a,function(a){return Lr(a,c+1)});return e.concat(a)})},b3=function(a){return qa.is(a,"ol,ul")},a3=function(a){a=y.children(a);return Z2.refine(a,b3)},c3={read:function(a){return Lr(a,
1)}},d3=function(a){a=a.elementsTransformed();k.each(a,function(a){t.transfer(a.original(),a.replaced(),["text-align"]);m.transfer(a.original(),a.replaced(),["dir"])})},NE=function(a,b){return k.find(b,function(b){return L.eq(b.original(),a)}).map(function(a){return a.replaced()}).getOr(a)},OE=function(a,b,c,d,e,g){if(0===a.selected().length)return h.none();var f=a.writer(),k=a.outerlist();a=a.selected();var s=c3.read(k);g=g(a);g=X2.operate(g,s,a);f=f(g);d3(f);J.before(k,f.elements());B.remove(k);
k=f.elementsTransformed();b=NE(b,k);d=NE(d,k);return h.some(Jg.block({start:b,soffset:c,finish:d,foffset:e,all:f.elements()}))},PE={execute:function(a,b,c,d,e,g){return OE(a,b,c,d,e,f.constant(g))},executeUsing:OE};Sa();var e3=function(a,b,c,d,e,g,f){return Lg.applyOn(a,FE,b,c,d,e,function(a){k.each(a,function(a){f.change(a,g)});return a})},QE=function(a,b){return function(c,d,e,g,f,h){var k=Wl.isRootOrCell(c);return Kr.context(d,g,c).fold(function(){return e3(k,d,e,g,f,a,h)},function(a){return PE.execute(a,
d,e,g,f,b)})}},lo={indent:function(a,b,c,d,e,g){return QE(1,Kr.indent)(a,b,c,d,e,g)},outdent:function(a,b,c,d,e,g){return QE(-1,Kr.outdent)(a,b,c,d,e,g)}},f3={isRootContainer:function(a){return function(b){return a(b)||k.contains(["td","th","caption"],A.name(b))}},extract:function(a){return Ob.cata(a,function(a){return[a]},function(a){return[a]},function(a,c){return k.contains(["ol","ul"],A.name(a))?[a]:k.bind(c,Ob.toTarget)},function(a){return[a]})},isCapable:function(a){return fa.isBlock(a)},canUse:f.constant(!1),
quasi:function(a){return h.some(Li.nu(Sa()))},ascend:f.identity},Mr=function(a){return $c.is(a)?I.descendant(a,"blockquote"):I.closest(a,"blockquote")},RE=function(a){return Zd.sharedOne(Mr,a)},g3=function(a,b,c,d,e){return Lg.applyOn(a,f3,b,c,d,e,function(a){var b=q.fromTag("blockquote");0<a.length&&(v.before(a[0],b),J.append(b,a),b=X.descendants(b,"blockquote"),k.map(b,B.unwrap));return a})},Nr={toggle:function(a,b,c,d,e){return(L.eq(b,d)?Mr(b):RE([b,d])).fold(function(){return g3(a,b,c,d,e)},function(a){B.unwrap(a);
return h.some(Jg.block({start:b,soffset:c,finish:d,foffset:e,all:[]}))})},queryPoint:Mr,queryAll:RE},SE=function(a,b,c,d){var e=a.content(),g=a.undo();qb.cata(a.selections().get(),f.noop,Pl.multiple(e,a.undo(),d),Pl.single(e,g,d,b,c))},TE=function(a){return function(b){var c=0<a?lo.indent:lo.outdent,d=go(b.region()),e=b.content();SE(b,Hi,Gi,function(a,b,f,h){return c(e.isRoot,a,b,f,h,d)})}},hm=function(a){return function(b){var c=b.content(),d=function(b,d,f,h){return a.run(c.isRoot,b,d,f,h)};qb.cata(b.selections().get(),
f.noop,Ql.multiple(c,b.undo(),d),Ql.single(c,b.undo(),d,Hi,Gi))}},im=function(a){return function(b){Jb.detect(b.content().getSelection()).each(function(c){Tc.runTransaction(b.content(),b.undo(),function(){(a.query(c.image())?Nf.floatnone():a).run(c.image())},b.content().toEditing)})}},fd={indent:TE(1),outdent:TE(-1),blockquote:function(a){var b=a.content();SE(a,Hi,Gi,function(a,d,e,g){return Nr.toggle(b.isRoot,a,d,e,g)})},justifyLeft:hm(ld.justifyleft()),justifyCentre:hm(ld.justifycentre()),justifyRight:hm(ld.justifyright()),
justifyFull:hm(ld.justifyfull()),imageNone:im(Nf.floatnone()),imageLeft:im(Nf.floatleft()),imageCentre:im(Nf.floatcentre()),imageRight:im(Nf.floatright()),breakQuote:function(a,b,c){k2.breakQuote(b,c).each(function(b){a.content().setRelativeSelection(b.start(),b.finish());a.content().uiChanged()})}},h3=function(a,b){return k.find(a,function(a){return a.value()===b})},Qj={updateMenu:function(a,b,c,d,e){b.fold(a.clear,f.noop,function(b){(Q.isString(b)?h3(d,b):h.some(b)).each(a.select);e.each(function(c){c=
c(b);a.selectElement(c)})});c.fold(a.disable,f.noop,a.enable);b.fold(a.untick,f.noop,function(b){b=Q.isString(b)?b:b.value();a.tick(b)})}},Or=la.generate([{table:["selection"]},{list:["selection"]}]),i3=function(a,b){return a.isRoot(b)||k.contains(["table","ul","ol"],A.name(b))},Pj={context:function(a){return a.getSelection().bind(function(b){if(b.collapsed())return I.closest(b.startContainer(),"td,th,li",f.curry(i3,a)).map(function(a){return"li"===A.name(a)?Or.list(b):Or.table(b)});var c=wc.commonAncestorContainer(b.startContainer(),
b.startOffset(),b.endContainer(),b.endOffset());return I.closest(c,"ol,ul",a.isRoot).map(function(a){return Or.list(b)})})},cata:function(a,b,c){return a.fold(b,c)}},Ng={attr:function(a,b,c){var d=f.curry(m.set,a,b,c);a=f.curry(m.remove,a,b);0<c.length?d():a()},css:function(a,b,c){var d=f.curry(t.set,a,b,c);a=f.curry(t.remove,a,b);0<c.length?d():a()}},Pr={resolve:jb.create("ephox-salmon").resolve},j3=Pr.resolve("upload-image-in-progress"),k3="data-"+Pr.resolve("image-blob"),l3="data-"+Pr.resolve("image-upload"),
Ib={uploadInProgress:f.constant(j3),blobId:f.constant(k3),trackedImage:f.constant(l3)},UE=C.immutableBag("url alt width height isLocal align".split(" "),["computedWidth","computedHeight"]),VE=function(a,b){var c=m.get(a,b);return void 0!==c?c:""},qk={divine:function(a){var b=t.getRaw(a,"width").getOr(""),c=t.getRaw(a,"height").getOr(""),d=t.getRaw(a,"width").getOrThunk(function(){return ra.get(a)+"px"}),e=t.getRaw(a,"height").getOrThunk(function(){return ha.get(a)+"px"}),g=Ir.divine(a);return UE({url:VE(a,
"src"),alt:VE(a,"alt"),width:b,height:c,computedWidth:d,computedHeight:e,isLocal:m.has(a,Ib.blobId()),align:g})},properties:UE,apply:function(a,b){m.get(a,"src")===b.url()||b.isLocal()||m.set(a,"src",b.url());Ng.attr(a,"alt",b.alt());Ng.css(a,"width",b.width());Ng.css(a,"height",b.height());b.align().each(function(b){Nf.runFloat(a,b)})}},m3={hasNoContent:function(a){var b=y.children(a);return A.isElement(a)&&(0===b.length||1===b.length&&"br"===A.name(b[0]))}},n3=C.immutable("alignment","quoted"),
WE=function(a){return a.getSelection().fold(function(){return!1},function(a){var c=a.startContainer();a=a.endContainer();return L.eq(c,a)?Nr.queryPoint(c).isSome():Nr.queryAll([c,a]).isSome()})},o3=[ld.justifyleft(),ld.justifycentre(),ld.justifyright(),ld.justifyfull()],XE=function(a){return Jb.detect(a.getSelection()).fold(function(){return a.getSelection().bind(function(a){return k.find(o3,function(c){return c.query(a.startContainer(),a.endContainer())}).map(function(a){return a.name()})}).fold(oa.off,
oa.on)},function(a){return qk.divine(a.image()).align().fold(oa.off,function(a){return"center"===a?oa.on(ld.justifycentre().name()):"right"===a?oa.on(ld.justifyright().name()):oa.on(ld.justifyleft().name())})})},ho={read:function(a){var b=XE(a);a=WE(a)?oa.on({}):oa.off();return n3(b,a)},alignment:XE,inQuote:WE,atQuoteBreak:function(a){return a.getSelection().bind(function(a){var c=a.startContainer();return a.collapsed()?I.closest(c,"blockquote").bind(function(a){return m3.hasNoContent(c)?h.some({quote:f.constant(a),
element:f.constant(c)}):h.none()}):h.none()})}},Tj={multiple:function(a,b,c){return function(d,e){Tc.runTransaction(a,b,function(){k.each(e,c)},a.toEditing)}},single:function(a,b,c){return function(d,e){Tc.runTransaction(a,b,function(){c(e).each(function(b){a.setSelection(b.start(),b.soffset(),b.finish(),b.foffset())});a.backupSelection()},a.toEditing)}}},p3=Sa(),Rj={atStartOf:function(a,b,c){xr.atStartOf(p3,a,b,c)}},q3=fE.resolve("style-marker"),hb={styleSpan:f.constant(q3),overrideSpan:f.constant("data-ephox-override"),
quasiBlock:am.style},Oi=la.generate([{none:[]},{tempIn:["selection"]},{tempOut:["selection"]},{rangedIn:["selection"]},{rangedOut:["selection"]}]),jo={detect:function(a,b){return a.getSelection().fold(function(){return Oi.none()},function(a){var d=b(a);return Ea.isCollapsed(a.startContainer(),a.startOffset(),a.endContainer(),a.endOffset())?d?Oi.tempIn(a):Oi.tempOut(a):d?Oi.rangedIn(a):Oi.rangedOut(a)})}},YE=function(a,b){return q.fromTag(a,b.dom())},ZE=function(a,b,c){c=q.fromTag("span",c.dom());
t.set(c,a,b);return c},io={nu:function(a,b,c,d){return"span"===c?ZE(a,b,d):YE(c,d)},nuTag:YE,nuAttr:function(a,b,c){c=q.fromTag("span",c.dom());m.set(c,a,b);return c},nuStyle:ZE},$E={"font-weight":{700:"bold",400:"normal"}},aF=function(a,b){if(a===b&&""!==b&&void 0!==b)return!0;var c=a.toLowerCase(),d=b.toLowerCase().split(" ");return k.contains(d,c)},bF=function(a,b){if(void 0!==$E[a]){var c=$E[a][b];return void 0!==c?c:b}return b},cF=function(a,b){var c=r3(a,b);return bF(b,c)},r3=function(a,b){return(A.isText(a)?
y.parent(a):h.some(a)).map(function(a){return t.get(a,b)}).getOr(void 0)},Eh={state:function(a,b,c){a=cF(a,b);return"text-decoration"===b?aF(c,a):c===a&&""!==a&&void 0!==a},rawState:function(a,b,c){a=bF(b,t.getRaw(a,b).getOr(void 0));return"text-decoration"===b?aF(c,a):c===a&&""!==a&&void 0!==a},value:cF},dF={"text-decoration":function(a,b,c,d){var e=function(d){return sa.closest(d,function(d){return A.isElement(d)&&(k.contains(c,A.name(d))||t.getRaw(d,a).exists(function(a){return-1!==a.indexOf(b)}))}).toArray()};
d=e(d.startContainer()).concat(e(d.endContainer()));return k.exists(d,function(d){return k.contains(c,A.name(d))?!0:t.getRaw(d,a).exists(function(a){return b===a})})}},s3={handle:function(a,b,c){return void 0!==dF[a]?h.some(dF[a]):h.none()}},eF=function(a,b){return b.getSelection().map(function(b){return a(b)}).getOr(!1)},Qr=function(a,b,c,d){var e=$c.leftWith(fa.isBlock,d).getOrThunk(function(){return S.point(d.startContainer(),d.startOffset())}),g=$c.rightWith(fa.isBlock,d).getOrThunk(function(){return S.point(d.endContainer(),
d.endOffset())});return s3.handle(a,b).fold(function(){var c=Eh.state(e.element(),a,b),d=Eh.state(g.element(),a,b);return c||d},function(d){return d(a,b,c,mb.hare(e.element(),e.offset(),g.element(),g.offset()))})},t3=function(a,b,c,d){return eF(f.curry(Qr,a,b,c),d)},fF=function(a,b){return u3(a,b)},v3=function(a,b){return eF(f.curry(fF,a),b)},u3=function(a,b){var c=$c.leftWith(fa.isBlock,b).fold(b.startContainer,function(a){return a.element()}),d=$c.rightWith(fa.isBlock,b).fold(b.endContainer,function(a){return a.element()}),
c=db.closest(c,a),d=db.closest(d,a);return c||d},gF=function(a,b){return k.contains(a,A.name(b))},w3=function(a,b){var c="["+a+"]";return I.closest(b.startContainer(),c).bind(function(d){return I.closest(b.endContainer(),c).bind(function(b){var c=m.get(d,a);b=m.get(b,a);c=c.toLowerCase();b=b.toLowerCase();return c===b?h.some(c):h.none()})})},sf={queriesStyle:function(a,b,c){return{queryOn:f.curry(Qr,a,b,c),query:f.curry(t3,a,b,c)}},queryStyleOn:Qr,queriesTag:function(a){return{queryOn:f.curry(fF,
a),query:f.curry(v3,a)}},relatedStyle:function(a,b,c,d){(c=gF(c,d))||(c="span"===A.name(d)&&Eh.state(d,a,b));return c},relatedTags:gF,queryAttrSame:function(a,b){return b.getSelection().bind(function(b){return w3(a,b)})},queryAttrIs:function(a,b,c){var d=b.toLowerCase(),e=function(b){return m.get(b,a).toLowerCase()===d};return I.closest(c.startContainer(),"["+a+"]").filter(e).orThunk(function(){return I.closest(c.endContainer(),"["+a+"]").filter(e)}).isSome()}},jm=la.generate([{none:["last","mode"]},
{running:["next","mode"]},{split:["boundary","last","mode"]},{finished:["element","mode"]}]),Rr=C.immutable("start","soffset","finish","foffset"),hF=function(a,b,c){c=ic.toLeaf(a,c,0);return Sr(a,c.element())?Tr(a,b,c.element()).map(function(a){return S.point(a,0)}).getOr(c):c},Pi=function(a,b){return Xb.isFrame(a,b)||Xb.isBlock(a,b)||k.contains(["li"],a.property().name(b))},Tr=function(a,b,c){return ma.seekRight(a,c,function(b){return!Sr(a,b)&&!Pi(a,b)},b)},Sr=function(a,b){return a.property().isText(b)?
a.property().parent(b).exists(function(b){return k.contains("table tbody thead tfoot tr ul ol".split(" "),a.property().name(b))}):!1},x3=function(a,b,c,d,e){return ma.walk(a,d,c,ma.walkers().right()).fold(function(){return jm.none(d,ma.sidestep)},function(b){return a.eq(b.item(),e)?jm.finished(e,b.mode()):Pi(a,b.item())?jm.split(b.item(),d,b.mode()):jm.running(b.item(),b.mode())})},jF=function(a,b,c,d){return Tr(a,b,c).fold(function(){return h.none()},function(e){return a.eq(e,d)?h.some(d):iF(a,c,
e)?jF(a,b,e,d):Pi(a,e)?(e=hF(a,b,e),h.some(e.element())):h.some(e)})},iF=function(a,b,c){return a.property().parent(b).exists(function(b){return a.eq(b,c)})},Ur=function(a,b,c,d,e,g){return x3(a,b,c,e,g).fold(function(a,b){return[{start:d,finish:a}]},function(c,e){return Ur(a,b,e,d,c,g)},function(c,f,k){var m={start:d,finish:f};return(iF(a,e,c)?jF(a,b,c,g):function(){var d=hF(a,b,c);return a.eq(d.element(),c)?ma.walk(a,c,ma.advance,ma.walkers().right()).map(function(a){return a.item()}):h.some(d.element())}()).fold(function(){return[m]},
function(c){return a.eq(c,g)?[m].concat({start:g,finish:g}):[m].concat(Ur(a,b,ma.advance,c,c,g))})},function(a,b){return[{start:d,finish:a}]})},Vr=function(a,b,c){if(Pi(a,b)){var d=a.property().children(b);return 0<=c&&c<d.length?Vr(a,d[c],0):c===d.length?Vr(a,d[d.length-1],0):b}return b},kF=function(a,b,c,d){c=Vr(a,c,d);return Sr(a,c)?Tr(a,b,c).getOr(c):c},y3=function(a,b,c,d,e,g){var f=kF(a,b,c,d),h=kF(a,b,e,g);b=Ur(a,b,ma.sidestep,f,f,h);return k.map(b,function(b,f){var l=a.eq(b.start,c)?d:0,h;
a.eq(b.finish,e)?h=g:(h=b.finish,h=a.property().isText(h)?a.property().getText(h).length:a.property().children(h).length);return Rr(b.start,l,b.finish,h)})},lF=function(a,b,c,d,e,g){a.eq(c,e)?Pi(a,c)?(d=ic.toLeaf(a,c,d),g=ic.toLeaf(a,c,g),a=a.eq(d.element(),c)&&a.eq(g.element(),c)?[Rr(d.element(),d.offset(),g.element(),g.offset())]:lF(a,b,d.element(),d.offset(),g.element(),g.offset())):a=[Rr(c,d,c,g)]:a=y3(a,b,c,d,e,g);return a},z3={collect:lF},qe=la.generate([{leftEdge:["element"]},{between:["before",
"after"]},{rightEdge:["element"]}]),A3=function(a,b,c){c=Yc.split(a,b,c);var d=function(){return qe.rightEdge(b)};return Yc.position(a,c).fold(d,function(){return qe.leftEdge(b)},qe.between,d)},mF=function(a,b,c,d){if(a.property().isText(b))return A3(a,b,c);if(a.property().isEmptyTag(b))return d(b);a=a.property().children(b);b=0===c?qe.leftEdge(b):c===a.length?qe.rightEdge(b):0<c&&c<a.length?qe.between(a[c-1],a[c]):qe.rightEdge(b);return b},nF={toLeft:function(a,b,c,d){return mF(a,c,d,qe.leftEdge).fold(function(a){return a},
function(a,b){return b},function(c){return ma.after(a,c,b).getOr(c)})},toRight:function(a,b,c,d){return mF(a,c,d,qe.rightEdge).fold(function(c){return ma.before(a,c,b).getOr(c)},function(a,b){return a},function(a){return a})}},B3=function(a,b,c,d){var e=a.property().children(b);b=function(b){return k.findIndex(e,f.curry(a.eq,b))};c=c.bind(b).getOr(0);d=d.bind(b).getOr(e.length-1);return-1<c&&-1<d?h.some(e.slice(c,d+1)):h.none()},oF=function(a,b,c,d){return Dc.breakPath(a,b,function(b){return a.property().parent(b).fold(f.constant(!0),
f.curry(a.eq,c))},d)},pF=function(a,b,c,d){a.eq(b,d)?d=h.none():(d=oF(a,d,b,Ii.breakToRight),d=h.some(d.first()));if(a.eq(b,c))c=h.none();else{var e=oF(a,c,b,Ii.breakToLeft);0<e.splits().length&&a.insert().prepend(e.splits()[0].second(),c);c=h.some(e.second().getOr(c))}return B3(a,b,c,d)},C3=function(a,b,c,d,e){return tr.ancestors(a,c,d,b).shared().orThunk(function(){return Dc.sharedOne(a,function(c,d){return b(d)?h.some(d):a.up().predicate(d,b)},[c,d])}).map(e)},D3=function(a,b,c,d,e){return C3(a,
b,c,d,e).bind(function(b){return pF(a,b,c,d)})},qF={fracture:function(a,b,c,d,e){e=void 0!==e?e:f.identity;a.eq(c,d)?(b=e(c),a=a.eq(b,c)?h.some([c]):pF(a,b,c,c)):a=D3(a,b,c,d,e);return a}},rF=function(a,b,c,d,e,g,f){a.property().isText(c)&&a.eq(c,e)?(c=Yc.splitByPair(a,c,d,g),a=qF.fracture(a,b,c,c,f)):(e=nF.toRight(a,b,e,g),c=nF.toLeft(a,b,c,d),a=qF.fracture(a,b,c,e,f));return a},sF={fractures:function(a,b,c,d,e,g,f){c=z3.collect(a,b,c,d,e,g);return k.bind(c,function(c,d){return rF(a,b,c.start(),
c.soffset(),c.finish(),c.foffset(),f).toArray()})},fracture:rF},tF=Sa(),E3={fractures:function(a,b,c,d,e,g){return sF.fractures(tF,a,b,c,d,e,g)},fracture:function(a,b,c,d,e,g){return sF.fracture(tF,a,b,c,d,e,g)}},Pf={makeTo:function(a,b,c){var d=y.owner(a).dom().createRange();d.setStart(a.dom(),b);d.setEndBefore(c.dom());return d},makeFrom:function(a,b,c){var d=y.owner(b).dom().createRange();d.setStartAfter(a.dom());d.setEnd(b.dom(),c);return d},leftEdge:function(a,b,c,d){return wc.after(a,b,c,d)?
S.point(c,d):S.point(a,b)},rightEdge:function(a,b,c,d){return wc.after(a,b,c,d)?S.point(a,b):S.point(c,d)}},F3=function(a,b){var c=W.keys(b).join(",");return(qa.is(a,c)?[a]:[]).concat(X.descendants(a,c))},uF={cleanse:function(a,b){var c=F3(a,b);k.each(c,function(a){var c=A.name(a);(void 0!==b[c]?b[c]:f.noop)(a)})}},G3={onlyEphox:function(a){var b=ea.get(a),b=k.filter(b,function(a,b,e){return!aa.startsWith(a,"ephox-")});k.each(b,function(b){n.remove(a,b)})}},Qi=function(a){B.unwrap(a)},vF=function(a,
b){t.remove(a,b);m.hasNone(a)&&Qi(a)},wF=function(a){var b={};k.each(a,function(a){b[a]=Qf(Qi)});return b},Qf=function(a){return function(b){m.has(b,"data-ignore")||a.apply(null,arguments)}},Tb={cssAndTag:function(a,b,c){a=wF(a);c=function(a){vF(a,b)};return Z.merge(a,{span:Qf(c),font:Qf(c)})},tagList:wF,removeStyle:Qf(vF),removeAttribute:Qf(function(a,b){m.remove(a,b);m.hasNone(a)&&Qi(a)}),unwrap:Qf(Qi),unstyle:Qf(function(a){G3.onlyEphox(a);m.remove(a,"style");m.hasNone(a)&&Qi(a)}),normal:function(a){m.remove(a,
"data-ignore")},ignore:function(a){m.set(a,"data-ignore","true")}},km=function(a,b){var c=y.children(a);k.each(c,function(a){km(a,b)});b(a)},xF=function(a){return A.isElement(a)&&!fa.isEmptyTag(a)&&!fa.isFrame(a)&&0===ua.get(a).replace(Ua.zeroWidth(),"").length},Og={wipeout:km,onEmpty:function(a){km(a,function(a){!A.isElement(a)||fa.isFrame(a)||fa.isEmptyTag(a)||0!==ua.get(a).length?xF(a)&&B.unwrap(a):B.remove(a)})},onQuasiEmpty:function(a){km(a,function(a){xF(a)&&B.remove(a)})}},yF=function(a){return y.parent(a).fold(f.constant([]),
function(a){return fa.isBlock(a)?[a]:[a].concat(yF(a))})},H3=function(a,b){var c=[b].concat(yF(b)),d=k.reverse(c);return k.findIndex(d,a).map(function(a){return 0===a?d[0]:d[a-1]}).getOr(b)},I3=function(a,b){k.each(b,function(b){uF.cleanse(b,a);Og.onQuasiEmpty(b)})},ko={run:function(a,b,c,d){var e=$c.left(c).getOrThunk(function(){return Pf.leftEdge(c.startContainer(),c.startOffset(),c.endContainer(),c.endOffset())}),g=$c.right(c).getOrThunk(function(){return Pf.rightEdge(c.startContainer(),c.startOffset(),
c.endContainer(),c.endOffset())}),l=f.curry(H3,d.matches);b=E3.fractures(b,e.element(),e.offset(),g.element(),g.offset(),l);b=k.bind(b,function(b){var c;if(0<b.length){c=d.purifiers();var e=(0,d.nu)(a);Tb.ignore(e);h.from(b[0]).bind(y.prevSibling).each(Og.onQuasiEmpty);h.from(b[b.length-1]).bind(y.nextSibling).each(Og.onQuasiEmpty);k.each(b,Og.onQuasiEmpty);b=k.filter(b,ca.inBody);0<b.length?(v.before(b[0],e),J.append(e,b),I3(c,b),c=[e]):c=[]}else c=[];return c});k.each(b,Tb.normal);return mb.fussyFromElements(b)}},
Wr=function(a,b){return L.eq(a,b)?[]:y.parent(a).fold(function(){return[]},function(c){c=Wr(c,b);var d=y.findIndex(a).toArray();return c.concat(d)})},J3=function(a,b){return a.slice(b+1)},K3=function(a,b){return a.slice(0,b)},Xr=function(a,b,c,d){if(0===d.length)b(c);else{var e=d[0],g=d.slice(1);y.child(c,e).each(function(c){Xr(a,b,c,g)});c=y.children(c);e=a(c,e);k.each(e,b)}},zF={one:function(a,b){a(b)},across:function(a,b,c,d){c=Wr(c,b);d=Wr(d,b);b=y.children(b);var e=b.slice(0<c.length?c[0]+1:
0,0<d.length?d[0]:b.length-1);k.each(e,a);0<c.length&&Xr(J3,a,b[c[0]],c.slice(1));0<d.length&&Xr(K3,a,b[d[0]],d.slice(1))}},Ri=Sa(),Pg={split:function(a,b){return Yc.split(Ri,a,b)},splitByPair:function(a,b,c){return Yc.splitByPair(Ri,a,b,c)},range:function(a,b,c,d){return Yc.range(Ri,a,b,c,d)},subdivide:function(a,b){return Yc.subdivide(Ri,a,b)},position:function(a){return Yc.position(Ri,a)}},AF=function(a,b,c){var d=y.children(b),e=0===c,g=c===d.length,f=0<d.length;return void 0!==a.empty&&k.contains(["br",
"hr","img"],A.name(b))?a.empty:void 0!==a.hasPrevious&&f&&0<c&&c<d.length?a.hasPrevious:void 0!==a.hasNext&&f&&c<d.length-1?a.hasNext:void 0!==a.rightEdge&&f&&g?a.rightEdge:void 0!==a.first&&e?a.first:a.otherwise},L3=function(a,b,c){return AF(a.before.element,b,c)(b,c)},M3=function(a,b,c){return AF(a.after.element,b,c)(b,c)},BF=function(a,b,c){c=Pg.split(b,c);var d=function(a){return function(){var c=Array.prototype.slice.call(arguments,0),c=[b].concat(c);return a.apply(null,c)}};return Pg.position(c).fold(d(a.none),
d(a.start),d(a.middle),d(a.end))},N3=function(a,b,c){return BF(a.before.text,b,c)},O3=function(a,b,c){return BF(a.after.text,b,c)},lm={prefix:function(a,b,c){return(A.isText(b)?N3:L3)(a,b,c)},postfix:function(a,b,c,d,e){b=Pf.rightEdge(b,c,d,e);return(A.isText(b.element())?O3:M3)(a,b.element(),b.offset())}},Yr=function(a,b){return a.bind(function(a){return b.map(function(b){return{left:f.constant(a),right:f.constant(b)}})})},P3=function(a,b,c,d){b=Pg.splitByPair(b,c,d);return Yr(a.general.insertBefore(b),
a.general.insertAfter(b))},Q3=function(a,b,c,d){c=y.child(b,c);var e=d<y.children(b).length?y.child(b,d):y.lastChild(b);return c.bind(function(b){return e.bind(function(c){return Yr(a.general.insertBefore(b),a.general.insertAfter(c))})})},qx={both:function(a,b,c,d,e){if(L.eq(b,d)){var g=A.isText(b)?P3:Q3;return c>e?g(a,b,e,c):g(a,b,c,e)}g=Pf.leftEdge(b,c,d,e);b=lm.postfix(a,b,c,d,e);a=lm.prefix(a,g.element(),g.offset());return Yr(a,b)}},mm=C.immutable("inside","outside"),CF=function(a,b){return y.parent(b).fold(f.constant(!0),
function(b){return a(b)})},DF=function(a,b){var c=Sa(),d=[a].concat(c.up().all(a)),e=[b].concat(c.up().all(b));return k.find(d,function(a){return k.exists(e,f.curry(L.eq,a))})},EF=function(a){return mm(a.second(),h.some(a.first()))},FF=function(a){return mm(h.some(a.first()),a.second())},GF=function(a){return mm(h.some(a),h.none())},Zr=function(a,b,c){c=f.curry(CF,c);c=c(a)?a:sa.ancestor(a,c).getOr(a);return L.eq(a,c)?GF(a):HF(a,b,c)},HF=function(a,b,c){a=Vl.breakPath(a,f.curry(L.eq,c));return b(a)},
R3={bridge:function(a,b,c){var d=Zr(a,EF,c),e=Zr(b,FF,c);return d.inside().bind(function(a){return e.inside().bind(function(b){return DF(a,b).map(function(c){return{common:f.constant(c),left:f.constant(a),right:f.constant(b),wipeout:function(){d.outside().each(Og.onEmpty);e.outside().each(Og.onEmpty)}}})})})},edge:mm,isSplit:CF,getCommon:DF,onLeft:EF,onRight:FF,onInside:GF,splitFrom:Zr,breaker:HF},S3=C.immutable("start","soffset","finish","foffset"),nm=f.constant(!1),$r=function(a,b){return fa.isBlock(b)||
fa.isContainer(b)||a(b)},IF=function(a,b){return y.parents(b,f.curry($r,a))},JF=function(a,b,c){return A.isElement(c)&&!b(c)?(a=IF(a,c),!k.exists(a,b)):!1},KF=function(a,b){return function(c){return $r(a,c)||JF(a,b,c)}},T3=function(a,b,c,d,e,g){var f=Ea.isCollapsed(b,c,d,e);b=Ka.toLeaf(b,c);d=Ka.toLeaf(d,e);var h=sg.extractTo(b.element(),b.offset(),g,nm),k=sg.extractTo(d.element(),d.offset(),g,nm),m=function(b){return f||b.offset()!==ja.getEnd(b.element())?b:Kb.after(b.element(),a).map(function(a){return S.point(a,
0)}).getOr(b)},x=function(b){return f||0!==b.offset()?b:Kb.before(b.element(),a).map(function(a){return S.point(a,ja.getEnd(a))}).getOr(b)};return function(){return sg.find(h.element(),h.offset(),nm).map(m).bind(function(a){return sg.find(k.element(),k.offset(),nm).map(x).map(function(b){return S3(a.element(),a.offset(),b.element(),b.offset())})})}},U3={applyTo:function(a,b,c,d,e,g,f){var h=KF(a,f),k=T3(a,c,d,e,g,h);a=BP(Ua.zeroWidth(),Ua.zeroWidth());return qx.both(a,c,d,e,g).bind(function(a){return R3.bridge(a.left().element(),
a.right().element(),h).bind(function(c){b(c.common(),c.left(),c.right());a.left().cleanup();a.right().cleanup();c.wipeout();return k()})})},blockRoot:$r,pathToTop:IF,isEnclosingInline:JF,isStopper:KF},LF=function(a,b,c,d){var e=function(a){uF.cleanse(a,b)};return U3.applyTo(a,function(a,b,c,d){if(L.eq(b,c))zF.one(e,b);else zF.across(e,a,b,c)},c.startContainer(),c.startOffset(),c.endContainer(),c.endOffset(),d)},gd={doRemoveAll:function(a,b,c){return LF(a,b,c,f.always)},doRemoveUpto:LF,allRules:{b:Tb.unwrap,
strong:Tb.unwrap,i:Tb.unwrap,em:Tb.unwrap,u:Tb.unwrap,strike:Tb.unwrap,del:Tb.unwrap,s:Tb.unwrap,sup:Tb.unwrap,sub:Tb.unwrap,small:f.noop,span:Tb.unstyle,font:Tb.unstyle}},V3=function(a,b,c){return{groups:0<a.current.length?a.groups.concat({parent:a.parent,children:a.current}):a.groups,current:[c],parent:b}},W3=function(a,b,c){return{groups:a.groups,current:a.current.concat([c]),parent:b}},X3=function(a,b,c){return h.from(b.current[b.current.length-1]).bind(a.query().nextSibling).bind(function(b){return a.eq(b,
c)?h.some(W3):h.none()}).getOr(V3)},Y3={textnodes:function(a,b){var c=k.foldl(b,function(b,c){return a.property().parent(c).fold(function(){return b},function(g){return X3(a,b,c)(b,g,c)})},{groups:[],current:[],parent:null});return 0<c.current.length?c.groups.concat({parent:c.parent,children:c.current}):c.groups}},NF=function(a,b,c,d,e,g){b=Yc.range(a,b,c,d,e);return MF(a,b,g)},MF=function(a,b,c){if(0===b.length)return b;b=k.filter(b,function(b){return a.property().isText(b)&&0<a.property().getText(b).length});
return k.map(b,function(b){var e=c();a.insert().before(b,e.element());e.wrap(b);return e.element()})},Z3=function(a,b){return h.from(b[0]).map(function(c){var d=Ve.toLower(a,b[b.length-1]);return S.points(S.point(c,0),S.point(d.element(),d.offset()))})},Si={wrapWith:NF,wrapper:MF,leaves:function(a,b,c,d,e,g){b=Ve.toLeaf(a,b,c);d=Ve.toLeaf(a,d,e);g=NF(a,b.element(),b.offset(),d.element(),d.offset(),g);return Z3(a,g)},reuse:function(a,b,c,d,e,g,f){b=Ve.toLeaf(a,b,c);d=Ve.toLeaf(a,d,e);d=Yc.range(a,
b.element(),b.offset(),d.element(),d.offset());d=Y3.textnodes(a,d);var h=function(a){return a.parent},s=function(b){var c=f();a.insert().before(b.children[0],c.element());k.each(b.children,c.wrap);return c.element()};return k.map(d,function(b){return(a.property().children(b.parent).length===b.children.length&&g(b.parent)?h:s)(b)})}},a4=function(a,b,c,d,e,g){a=$3(a,b,c,d,e,g);b=a.cursor();b=S.points(S.point(b.element(),b.offset()),S.point(b.element(),b.offset()));return h.some({range:f.constant(b),
temporary:a.temporary,wrappers:a.wrappers})},b4=function(a,b,c,d,e){d=b.dom().ownerDocument;var g=a.create().nu("span",d);d=a.create().text(Ua.zeroWidth(),d);a.insert().append(g,d);(a.property().isEmptyTag(b)?a.property().parent(b):h.some(b)).each(function(b){xr.atStartOf(a,b,c,g)});return{cursor:f.constant(S.point(d,1)),wrappers:f.constant([g]),temporary:f.constant(!0)}},$3=function(a,b,c,d,e,g){return a.property().parent(b).bind(function(d){var e=S.point(b,c),k;if(k=OF(a,g,d))if(k=1===a.property().children(d).length)k=
a.property().isText(b)&&a.property().getText(b)===Ua.zeroWidth();return k?h.some({cursor:f.constant(e),temporary:f.constant(!1),wrappers:f.constant([d])}):h.none()}).getOrThunk(function(){return b4(a,b,c,d,e)})},OF=function(a,b,c){return"span"===a.property().name(c)&&!1===b(c)},c4=function(a,b,c,d,e,g){var l=b.dom().ownerDocument,k=Si.reuse(a,b,c,d,e,f.curry(OF,a,g),function(){return pv(a,a.create().nu("span",l))});return h.from(k[k.length-1]).map(function(b){var c=a.property().children(b).length;
b=S.points(S.point(k[0],0),S.point(b,c));return{wrappers:f.constant(k),temporary:f.constant(!1),range:f.constant(b)}})},d4={spans:function(a,b,c,d,e,g){g=void 0!==g?g:f.constant(!1);return(a.eq(b,d)&&c===e?a4:c4)(a,b,c,d,e,g)}},Qg={nu:function(a,b){return pv(a,b)},wrapWith:function(a,b,c,d,e,g){return Si.wrapWith(a,b,c,d,e,g)},wrapper:function(a,b,c){return Si.wrapper(a,b,c)},leaves:function(a,b,c,d,e,g){return Si.leaves(a,b,c,d,e,g)},reuse:function(a,b,c,d,e,g,f){return Si.reuse(a,b,c,d,e,g,f)},
spans:function(a,b,c,d,e,g){return d4.spans(a,b,c,d,e,g)}},Rg=Sa(),Sg={nu:function(a){return Qg.nu(Rg,a)},wrapWith:function(a,b,c,d,e){return Qg.wrapWith(Rg,a,b,c,d,e)},wrapper:function(a,b){return Qg.wrapper(Rg,a,b)},leaves:function(a,b,c,d,e){return Qg.leaves(Rg,a,b,c,d,e)},reuse:function(a,b,c,d,e,g){return Qg.reuse(Rg,a,b,c,d,e,g)},spans:function(a,b,c,d,e){return Qg.spans(Rg,a,b,c,d,e)}},e4=function(a,b,c){a.getSelection().each(function(d){var e=$c.left(d).getOrThunk(function(){return S.point(d.startContainer(),
d.startOffset())}),g=$c.right(d).getOrThunk(function(){return S.point(d.endContainer(),d.endOffset())});Sg.spans(e.element(),e.offset(),g.element(),g.offset(),c).each(function(c){var d=c.temporary()?[hb.styleSpan()]:[],e=c.range();k.each(c.wrappers(),function(a){ea.add(a,d);b(a)});c=e.begin();e=e.end();a.setSelection(c.element(),c.offset(),e.element(),e.offset())})})},PF=function(a,b,c,d){b(a);e4(a,d,c)},Td={style:function(a,b,c,d){return PF(a,c,d,function(a){t.setAll(a,b)})},generic:PF},QF=Sj("bold",
"strong",["strong","b"],"font-weight","bold","normal"),RF=Sj("italic","em",["em","i"],"font-style","italic","normal"),SF=Sj("underline","span",["u"],"text-decoration","underline","none"),TF=Sj("strikethrough","span",["s","strike","del"],"text-decoration","line-through","none"),UF=function(a,b){var c=function(a,c){return io.nuAttr(b,a,c)},d=function(a){return"span"===A.name(a)&&m.has(a,b)},e={span:function(a){Tb.removeAttribute(a,b)}},g=function(a,c){return sf.queryAttrIs(b,a,c)},l=function(a,c){Td.generic(c,
f.noop,void 0,function(c){n.add(c,hb.styleSpan());m.set(c,b,a)});return h.none()};return{run:function(a,k,m){return jo.detect(k,f.curry(g,m)).fold(function(){return h.none()},function(a){var c=["[",b,'="',m,'"]'].join("");I.closest(a.startContainer(),c).each(B.unwrap);return h.none()},function(a){return l(m,k)},function(b){return gd.doRemoveAll(a,e,b)},function(b){return ko.run(k.doc(),a,b,{nu:f.curry(c,m),matches:d,purifiers:f.constant(e)})})},queryValue:function(a){return sf.queryAttrSame(b,a)},
name:f.constant(a)}}("language","lang"),VF=ov("superscript","sup",["sup","sub"],{"font-size":"smaller","vertical-align":"super"}),WF=ov("subscript","sub",["sub","sup"],{"font-size":"smaller","vertical-align":"sub"}),XF={bold:QF,italic:RF,underline:SF,strikethrough:TF,language:UF,superscript:VF,subscript:WF},jc={bold:f.constant(QF),italic:f.constant(RF),underline:f.constant(SF),strikethrough:f.constant(TF),language:f.constant(UF),superscript:f.constant(VF),subscript:f.constant(WF),search:function(a){return void 0!==
XF[a]?h.some(XF[a]):h.none()}},Tg=function(a,b){return a.query(b)},zf={bold:f.curry(Tg,jc.bold()),italic:f.curry(Tg,jc.italic()),underline:f.curry(Tg,jc.underline()),strikethrough:f.curry(Tg,jc.strikethrough()),superscript:f.curry(Tg,jc.superscript()),subscript:f.curry(Tg,jc.subscript()),language:f.curry(function(a,b){return a.queryValue(b)},jc.language())},f4=C.immutable("bold","italic","underline","strikethrough","superscript","subscript"),Ug=function(a,b){return a.on(function(a){return b(a)?oa.on(!0):
oa.off()}).getOrThunk(oa.off)},DP={read:function(a){return f4(Ug(a,zf.bold),Ug(a,zf.italic),Ug(a,zf.underline),Ug(a,zf.strikethrough),Ug(a,zf.superscript),Ug(a,zf.subscript))}},om=C.immutable("startContainer","startOffset","endContainer","endOffset"),pm=C.immutable("item","start","finish","text"),qm=C.immutable("items","abort"),YF=function(a,b){var c=a.property().getText(b);return pm(b,0,c.length,c)},as=function(a,b,c){return qm([],!0)},g4=function(a,b,c){return qm([],!1)},h4=function(a,b,c){var d=
a.property().getText(b);return c(d).fold(function(){return qm([pm(b,0,d.length,d)],!1)},function(a){a=a[0]===a[1]?[]:[pm(b,a[0],a[1],d.substring(a[0],a[1]))];return qm(a,!0)})},re={detail:YF,fromItem:function(a,b){return a.property().isText(b)?YF(a,b):pm(b,0,0,"")},decide:function(a,b,c,d){return(a.property().isBoundary(b)?as:a.property().isEmptyTag(b)?as:d(a,b)?as:a.property().isText(b)?h4:g4)(a,b,c)}},ZF={all:function(a,b){for(var c=b.term(),d=[],e=c.exec(a);e;){var g=e.index+b.prefix(e),e=e[0].length-
b.prefix(e)-b.suffix(e);d.push({start:f.constant(g),finish:f.constant(g+e)});c.lastIndex=g+e;e=c.exec(a)}return d}},i4=function(a){a=Array.prototype.slice.call(a,0);a.sort(function(a,c){return a.start()<c.start()?-1:c.start()<a.start()?1:0});return a},j4={search:function(a,b){var c=k.bind(b,function(b){var c=ZF.all(a,b.pattern());return k.map(c,function(a){return Z.merge(b,{start:a.start,finish:a.finish})})});return i4(c)}},rm={findall:function(a,b){return ZF.all(a,b)},findmany:function(a,b){return j4.search(a,
b)}},k4=RegExp(cb.wordbreak()+"+","g"),$F=f.constant(0),aG=function(a){a=rm.findall(a,cb.custom(cb.wordbreak(),$F,$F,h.none()));return h.from(a[a.length-1]).map(function(a){return a.start()})},bs=function(a){a=a.search(k4);return-1<a?h.some(a):h.none()},Ti={firstWord:function(a){return bs(a).map(function(b){return a.substring(0,b+1)})},lastWord:function(a){return aG(a).map(function(b){return a.substring(b)})},leftBreak:aG,rightBreak:bs,hasBreak:function(a){return bs(a).isSome()}},bG=ma.walkers(),
cG=bG.left(),dG=bG.right(),l4={sibling:cG.sibling,first:cG.first,slicer:function(a){return Ti.leftBreak(a).map(function(b){return[b+1,a.length]})}},m4={sibling:dG.sibling,first:dG.first,slicer:function(a){return Ti.rightBreak(a).map(function(a){return[0,a]})}},cs=function(a,b,c,d,e){b=ma.walk(a,b,c,d).map(function(b){var c=re.decide(a,b.item(),d.slicer,e);b=c.abort()?[]:cs(a,b.item(),b.mode(),d,e);return c.items().concat(b)}).getOr([]);return k.filter(b,function(a){return 0<a.text().trim().length})},
Ui={creepLeft:function(a,b,c){return cs(a,b,ma.sidestep,l4,c)},creepRight:function(a,b,c){return cs(a,b,ma.sidestep,m4,c)},flatten:function(a,b){return a.property().isText(b)?[re.detail(a,b)]:k.map(a.down().predicate(b,a.property().isText),function(b){return re.detail(a,b)})},isEmpty:function(a,b){return a.property().isText(b)?!1:0===a.down().predicate(b,a.property().isText).length}},ds=function(a,b){return a.up().closest(b,"[lang]",f.constant(!1)).map(function(b){return a.attrs().get(b,"lang")})},
Vg={nu:function(a){var b=[],c=[],d=[],e=a,g=function(a){a.each(function(a){b.push(a)})},l=function(a){a.each(function(a){b=b.slice(0,b.length-1)})},k=function(){0<d.length&&c.push({lang:f.constant(e),details:f.constant(d)})},s=function(a){k();d=[];e=a},m=function(c){return c.or(h.from(b[b.length-1])).getOr(a)};return{openInline:function(a,b){var c=m(a);c!==e&&s(c);g(a)},closeInline:function(a,b){l(a)},addDetail:function(a){var b=m(h.none());b!==e&&s(b);d.push(a)},addEmpty:function(a){a=m(h.none());
s(a)},openBoundary:function(a,b){g(a);var c=m(a);s(c)},closeBoundary:function(a,b){l(a);var c=m(a);s(c)},done:function(){k();return c.slice(0)}}},calculate:ds,softBounder:function(a){return function(b,c){var d=ds(b,c);return!a.equals(d)}},strictBounder:function(a,b){return function(c,d){var e=ds(c,d).getOr(a);return b!==e}}},eG=function(a,b,c,d){var e=Ui.creepLeft(a,b,d);d=Ui.creepRight(a,c,d);b=0<e.length?e[e.length-1]:re.fromItem(a,b);a=0<d.length?d[d.length-1]:re.fromItem(a,c);e=0===e.length&&
0===d.length;return{left:f.constant(b),right:f.constant(a),isEmpty:f.constant(e)}},Vi={byBoundary:function(a,b){var c=f.constant(!1),c=eG(a,b,b,c),d=c.isEmpty()&&Ui.isEmpty(a,b);return{left:c.left,right:c.right,isEmpty:f.constant(d)}},getEdges:eG,byLanguage:function(a,b){var c=Vg.calculate(a,b),d=Vg.softBounder(c),e=Ui.creepLeft(a,b,d),d=Ui.creepRight(a,b,d),g=a.property().isText(b)?[re.detail(a,b)]:[],l=k.reverse(e).concat(g).concat(d);return{all:f.constant(l),left:f.constant(e),middle:f.constant(g),
right:f.constant(d),lang:f.constant(c)}}},es=function(a,b,c,d){d=a.property().getText(b);var e=k.filter(d.substring(0,c),function(a){return a!==Ua.zeroWidth()}).length,g=k.filter(d.substring(c,d.length),function(a){return a===Ua.zeroWidth()}).length;a=Vi.byLanguage(a,b);b=0===e&&0===a.left().length;c=c+g===d.length&&0===a.right().length;return{all:a.all,leftEdge:f.constant(b),rightEdge:f.constant(c),text:f.constant(d)}},sm={before:function(a,b,c,d,e){a=es(a,b,c,e);a.rightEdge()?b=h.none():(a=a.all(),
0===a.length?b=h.none():(a=a[a.length-1],b=h.some(om(b,d,a.item(),a.finish()))));return b},after:function(a,b,c,d,e){a=es(a,b,c,e);a.leftEdge()?b=h.none():(a=a.all(),0===a.length?b=h.none():(a=a[0],b=h.some(om(a.item(),a.start(),b,d))));return b},both:function(a,b,c,d,e,g){return d===e?h.none():h.some(om(b,d,b,e))},neither:function(a,b,c,d){a=es(a,b,c,d);a.leftEdge()||a.rightEdge()?a=h.none():(b=a.all(),0===b.length?a=h.none():(a=b[0],b=b[b.length-1],a=h.some(om(a.item(),a.start(),b.item(),b.finish()))));
return a}},fG=C.immutable("before","after"),n4={around:function(a,b){var c=a.substring(0,b),d=Ti.leftBreak(c).map(function(a){return a+1}),c=a.substring(b),c=Ti.rightBreak(c).map(function(a){return b+a}),e=fG(d,c),g=fG(h.some(b),h.some(b));return c.bind(function(a){return b===a?h.some(g):h.none()}).getOrThunk(function(){return d.bind(function(a){return b===a?h.some(g):h.none()}).getOr(e)})}},o4={word:function(a,b,c,d){if(!a.property().isText(b))return h.none();var e=a.property().getText(b),g=n4.around(e,
c);return g.before().fold(function(){return g.after().fold(function(){return sm.neither(a,b,c,d)},function(e){return sm.after(a,b,c,e,d)})},function(e){return g.after().fold(function(){return sm.before(a,b,c,e,d)},function(g){return sm.both(a,b,c,e,g,d)})})}},p4={word:function(a,b,c,d){return o4.word(a,b,c,d)}},q4=Sa(),r4={word:function(a,b,c){return p4.word(q4,a,b,c)}},gG=function(a,b,c){r4.word(b,c,f.constant(!1)).each(function(b){a.setSelection(b.startContainer(),b.startOffset(),b.endContainer(),
b.endOffset())})},Ec={expand:function(a){a.getSelection().each(function(b){Ea.isCollapsed(b.startContainer(),b.startOffset(),b.endContainer(),b.endOffset())&&gG(a,b.startContainer(),b.startOffset())})},expandWord:gG},iG=function(a,b){var c=mb.fussy(b,0,b,y.children(b).length-1);hG(a,b,c)},fs=function(a){a=y.children(a);return 1===a.length&&A.isText(a[0])&&Fa.get(a[0])===Ua.zeroWidth()},jG=function(a,b){return I.closest(a,"."+hb.styleSpan()).bind(function(a){return I.closest(b,"."+hb.styleSpan()).filter(function(b){return L.eq(a,
b)})})},hG=function(a,b,c){n.remove(b,hb.styleSpan());return m.has(b,hb.overrideSpan())?kG(a,b,c):h.some(c)},kG=function(a,b,c){return s4(b).bind(function(d){if(d.isStyled(b)){d=d.nu;var e=y.owner(b),e=d(e);v.before(b,e);J.append(e,y.children(b));B.remove(b);d=L.eq(b,c.start())?e:c.start();e=L.eq(b,c.finish())?e:c.finish();d=h.some(mb.fussy(d,c.soffset(),e,c.foffset()))}else d=t4(a,b,d.purifiers(),c,d.matches);return d})},s4=function(a){a=m.get(a,hb.overrideSpan());return jc.search(a).map(function(a){return a.deferred()})},
t4=function(a,b,c,d,e){b=y.owner(b);var g=mb.fromFussy(d);gd.doRemoveUpto(a,c,g,e);a="["+hb.overrideSpan()+"]";return qa.one(a,b).bind(function(a){B.unwrap(a);return ca.inBody(d.start())&&ca.inBody(d.finish())?h.some(d):h.none()})},$e={clean:function(a,b){fs(b)?B.unwrap(b):iG(a,b)},cleanNonEmpty:iG,isTransient:fs,withinTransient:jG,handleOverride:kG,apply:function(a,b,c,d,e){var g=mb.fussy(b,c,d,e);return jG(b,d).bind(function(b){if(fs(b)){var c=y.children(b),c=L.eq(b,g.start())?mb.fussy(c[0],0,c[0],
ja.getEnd(c[0])):g;B.unwrap(b);b=h.some(c)}else b=hG(a,b,g);return b})}},tm=function(a,b){return a.action().run(a.isRoot(),a.environment())},af=function(a,b){var c=a.temp();$e.handleOverride(a.isRoot(),c,mb.fussy(c,0,c,ja.getEnd(c)));return h.some(b)},u4=function(a,b){v.after(a.temp(),a.cursor());return h.some(b)},lG=function(a,b){v.before(a.temp(),a.cursor());return h.some(b)},gs=function(a,b){var c=a.original();Rj.atStartOf(c.startContainer(),c.startOffset(),a.cursor());return h.some(b)},mG=function(a,
b){var c=a.action().deferred().isStyled(a.temp()),d=a.cursor(),e=h.some(mb.fussy(d,1,d,1));c?c=e:(a.environment().setSelection(d,0,d,0),c=tm(a,b));return c},v4=function(a,b){var c=a.cursor(),d=a.action().deferred();gd.doRemoveUpto(a.isRoot(),d.purifiers(),mb.hare(c,0,c,1),d.matches);return h.some(mb.fussy(c,1,c,1))},hs=function(a,b){var c=a.cursor();a.environment().setSelection(c,0,c,1);tm(a,b);return h.some(mb.fussy(c,1,c,1))},nG=function(a,b){var c=a.environment(),d=a.original();c.setSelection(d.startContainer(),
d.startOffset(),d.endContainer(),d.endOffset());Ec.expand(c);return c.getSelection().map(mb.fromHare)},w4=function(a,b){var c=a.action().deferred();return gd.doRemoveUpto(a.isRoot(),c.purifiers(),mb.fromFussy(b),c.matches)},x4=function(a,b){var c;a.action().deferred().isStyled(a.temp())?c=h.some(b):(a.environment().setSelection(b.start(),b.soffset(),b.finish(),b.foffset()),c=tm(a,b));return c},y4=function(a,b){var c=a.temp(),d=y.children(c);B.unwrap(c);return 0===d.length?h.none():h.some(mb.fussy(d[0],
0,d[d.length-1],ja.getEnd(d[d.length-1])))},z4=C.immutable("environment","isRoot","cursor","temp","action","original"),A4=function(a,b){return Ab.last(a).fold(f.constant(!0),function(a){return L.eq(a,b.startContainer())&&ja.getEnd(a)===b.startOffset()})},B4=function(a,b){return Ab.first(a).fold(f.constant(!0),function(a){return L.eq(a,b.startContainer())&&0===b.startOffset()})},C4=function(a,b,c,d,e){var g=m.get(d,hb.overrideSpan()),f=e.collapsed(),p=q.fromText(Ua.zeroWidth()),s=A4(d,e),n=B4(d,e),
g=a.name()===g,x=z4(c,b,p,d,a,e);a=g&&$e.isTransient(d)?[y4]:f&&g&&s?[u4,af,mG]:f&&g&&n?[lG,af,mG]:f&&g?[gs,af,v4]:f&&s?[gs,af,hs]:f&&n?[lG,af,hs]:f?[gs,af,hs]:g?[af,nG,w4,x4]:[af,nG,tm];return k.foldl(a,function(a,b){return a.bind(function(a){return b(x,a)})},h.some(mb.fromHare(e)))},Wg=function(a,b,c){Ec.expand(c);var d=c.getSelection().bind(function(d){return $e.withinTransient(d.startContainer(),d.endContainer()).filter(function(a){return m.has(a,hb.overrideSpan())}).fold(function(){return a.run(b,
c)},function(g){return C4(a,b,c,g,d)})});return Jg.inlineFrom(d)},vc={bold:f.curry(Wg,jc.bold()),italic:f.curry(Wg,jc.italic()),underline:f.curry(Wg,jc.underline()),strikethrough:f.curry(Wg,jc.strikethrough()),superscript:f.curry(Wg,jc.superscript()),subscript:f.curry(Wg,jc.subscript()),removeformat:function(a,b){Ec.expand(b);var c=b.getSelection().bind(function(b){return gd.doRemoveAll(a,gd.allRules,b)});return Jg.inlineFrom(c)},language:f.curry(function(a,b,c,d){c.getSelection().each(function(a){$e.apply(b,
a.startContainer(),a.startOffset(),a.endContainer(),a.endOffset()).each(function(a){c.setSelection(a.start(),a.soffset(),a.finish(),a.foffset())})});Ec.expand(c);a=a.run(b,c,d);return Jg.inlineFrom(a)},jc.language()),cleanup:$e.clean,cleanupNonEmpty:$e.cleanNonEmpty,isTransient:$e.isTransient,withinTransient:$e.withinTransient},um={multiple:function(a,b,c,d){return function(e,g){Tc.runTransaction(a,b,function(){k.each(g,c)},d)}},single:function(a,b,c,d){return function(e,g){Tc.runTransaction(a,b,
function(){c(g)},d)}}},oG=function(a,b,c){c=a.create().nu(c);var d=a.property().children(b);a.insert().append(b,c);a.insert().appendAll(c,d);return c},pG=function(a,b,c){c=a.create().nu(c);var d=a.property().children(b);a.attrs().copyTo(b,c);a.insert().before(b,c);a.insert().appendAll(c,d);a.remove().remove(b);return c},tv={blockTransform:function(a,b,c){return(Xb.isFormatting(a,b)?pG:oG)(a,b,c)},nest:oG,replace:pG},EP={tags:f.constant("address article aside audio blockquote canvas dd div dl fieldset figcaption figure footer form h1 h2 h3 h4 h5 h6 header hgroup hr li noscript ol output p pre section table tbody td tfoot th thead tr ul video".split(" "))},
D4=Sa(),E4=qv(D4),F4={div:!0},qG={query:function(a,b,c){return E4.query(a,b,c)},apply:function(a,b,c,d,e,g){return Lg.applyOn(a,FE,b,c,d,e,function(b){return k.map(b,function(b){if(!F4[g]){var c=mb.hareFromElement(b);gd.doRemoveAll(a,gd.allRules,c)}return tv.blockTransform(Sa(),b,g)})})}},Xg={background:function(a,b,c){Td.style(a,{"background-color":b},Ec.expand,c)},addClass:function(a,b,c){Td.generic(a,Ec.expand,c,function(a){n.add(a,b)})},setClass:function(a,b,c){Td.generic(a,Ec.expand,c,function(a){m.set(a,
"class",b)})},foreground:function(a,b,c){Td.style(a,{color:b},Ec.expand,c)},addAttribute:function(a){return function(b,c,d){Td.generic(b,Ec.expand,d,function(b){m.set(b,a,c)})}},face:function(a,b,c){Td.style(a,{"font-family":b},Ec.expand,c)},size:function(a,b,c){Td.style(a,{"font-size":b},Ec.expand,c)}},rG=function(a,b,c,d,e){b=function(b,d,e,g){return a(c.isRoot,b,d,e,g)};var g=Pl.multiple(c,d,b),f=Pl.single(c,d,b,Hi,Gi);return qb.cata(e.get(),h.none,function(a,b){return h.some(g(a,b))},function(a,
b){return h.some(f(a,b))})},dg={transform:function(a,b,c,d,e){return rG(function(a,b,c,d,f){return qG.apply(a,b,c,d,f,e)},a,b,c,d)},setClass:function(a,b,c,d,e,g){var l=function(a){I.closest(a,e).each(function(a){Tc.runTransaction(b,c,function(){m.set(a,"class",g)},b.toEditing)})};qb.cata(d.get(),f.noop,function(a,b){k.each(a,l)},function(a,b){l(a.startContainer())})},inline:function(a,b,c,d,e){a=function(a){Xg.setClass(a,e,nd.isAnnotation)};qb.cata(d.get(),f.noop,um.multiple(b,c,a,b.toEditing),um.single(b,
c,a,b.toEditing))},list:function(a,b,c,d,e){return rG(a,b,c,d,e)}},sG=C.immutable("label","items"),Yg=function(a,b){return 0<b.length?[sG(h.some(u.key(a)),b)]:[]},vv={groups:function(a,b,c){var d=a.divisions(),e=k.map(d.blocks().concat(d.classblocks()),a.toCandidate),g=k.map(d.inlines(),a.toCandidate);a=k.map(d.objects(),a.toCandidate);a=k.foldr(a,function(a,d){var e;db.closest(b,d.base(),c)?(e=d.base(),e=k.contains(["a"],e)?Z.merge(a,{link:a.link.concat([d])}):k.contains(["embed","img","object"],
e)?Z.merge(a,{media:a.media.concat([d])}):k.contains(["hr"],e)?Z.merge(a,{line:a.line.concat([d])}):k.contains(["li","ol","ul"],e)?Z.merge(a,{list:a.list.concat([d])}):k.contains(["table","tr","td","th"],e)?Z.merge(a,{table:a.table.concat([d])}):a):e=a;return e},{link:[],media:[],line:[],list:[],table:[]});return k.flatten([[sG(h.none(),e)],Yg("block.label.inline",g),Yg("block.label.link",a.link),Yg("block.label.media",a.media),Yg("block.label.line",a.line),Yg("block.label.list",a.list),Yg("block.label.table",
a.table)])}},vm=function(a,b){return{fold:b}},Be={inline:function(a,b,c){return vm("inline",function(d,e,g,f){return d(a,b,c)})},object:function(a,b,c,d){return vm("object",function(e,g,f,h){return g(a,b,c,d)})},block:function(a,b,c){return vm("block",function(d,e,g,f){return g(a,b,c)})},classblock:function(a,b,c,d){return vm("classed block",function(e,g,f,h){return h(a,b,c,d)})},cata:function(a,b,c,d,e){return a.fold(b,c,d,e)}},tG="h1 h2 h3 h4 h5 h6 div p pre".split(" "),G4="a embed hr img li object ol table td tr ul th".split(" "),
H4=function(a){var b=a.match(/[\[\]* !#%=+>:~,\^\$]/),c=a.indexOf(".");-1<c&&null===b?(b=a.substring(0,c),a=a.substring(c+1),a=-1===a.indexOf(".")?h.some({tag:f.constant(b),clazz:f.constant(a)}):h.none()):a=h.none();return a},J4=function(a,b){var c=a.tag(),d=a.clazz(),e=k.contains(tG,c),g=k.contains(G4,c);return(e?H.value(Be.classblock):g?H.value(Be.object):H.error("Rule must have object tag or block tag.")).map(function(e){var g=I4(b,a);return e(c,d,g,b.style)})},K4=function(a){return a.text.getOrThunk(function(){return u.key("block."+
a.name)})},L4=function(a,b){return a.text.getOrThunk(function(){return u.pkey("tag.inline.class",[b])})},I4=function(a,b){return a.text.getOrThunk(function(){var a="block."+b.tag(),d="tag."+b.tag(),a=(u.has(a)?u.translate(a):u.has(d)?u.translate(d):b.tag())+" ("+b.clazz()+")";return u.raw(a)})},GP={decipher:function(a){return H4(a.name).fold(function(){return k.contains(tG,a.name)?H.value(Be.block(a.name,K4(a),a.style)):H.error("Invalid style name: "+a.name)},function(b){return 0<b.tag().length?J4(b,
a):H.value(Be.inline(b.clazz(),L4(a,b.clazz()),a.style))})}},FP=function(a,b){return k.bind(b,function(b){if(k.exists(k.from(b.cssRules),function(a){return/ephox-candy-mountain/i.test(a.selectorText)}))return[];var d={};k.each(k.from(b.cssRules),function(b){if(b.type===CSSRule.STYLE_RULE){var c=b.selectorText,f=c.match(/(.*)\[ephox-data\](.*)/i);null===f?(d.hasOwnProperty(c)||(d[c]={}),d[c].rule=c,d[c].visibility=a):(c=f[1]+f[2],d.hasOwnProperty(c)||(d[c]={}),f=b.style.visibility,"hidden"===f?d[c].visibility=
!1:"visible"===f&&(d[c].visibility=!0),b=b.style.content,ke.isEmpty(b)||(d[c].text=b.replace(/["']/g,"")))}});return k.filter(W.values(d),function(a){return a.hasOwnProperty("rule")&&!1!==a.visibility})})},M4={text:function(a){var b=u.get(a.textkey()),c=u.cata(a.textkey(),f.constant(!0),f.constant(!1),f.constant(!1));a=c&&void 0===b?a.value():b;return{text:f.constant(a),unknown:f.constant(c)}}},uv={format:function(a){var b=q.fromText(u.get(a.textkey())),c=P.div();n.add(c,w.resolve("format-element-"+
a.tag()));t.setAll(c,a.styles());a=P.div();n.add(a,w.resolve("format-element-container"));v.append(c,b);v.append(a,c);return a},face:function(a){var b=M4.text(a),c=b.text(),c=mc(c).element();t.setAll(c,{"font-family":a.value()});a=b.unknown()?[w.resolve("font-face-unknown")]:[];ea.add(c,a);return c}},JP=function(a,b){var c=q.fromTag(a);O.hidden(c,!0);t.set(c,"list-style-type",b);for(var d=w.resolve("list-style-content"),e=0;3>e;e++){var g=q.fromTag("li"),f=P.span();n.add(f,d);v.append(g,f);v.append(c,
g)}return c},IP=function(a,b){var c=u.translate(b),d=q.fromText(c),e=P.span();n.add(e,w.resolve("list-style-default"));m.set(a,"data-"+w.resolve("list-style"),"default");m.set(a,"title",c);v.append(e,d);return e},Uj="data-"+w.resolve("list-style"),N4=la.generate([{mine:["element"]},{other:["element"]},{paragraphs:["elements"]}]),Fh=Z.merge(N4,{cata:function(a,b,c,d){return a.fold(b,c,d)}}),O4=function(a,b,c){var d=A.name(a);return t.getRaw(a,"list-style-type").fold(function(){return d===b&&c.isNone()},
function(a){return c.exists(function(c){return d===b&&a===c})})},MP={categorise:function(a,b,c){a=k.groupBy(a,function(a){return fa.isList(a)?!0:y.parent(a).map(function(a){return a.dom()}).getOr(!1)});return k.bind(a,function(a){return k.forall(a,fa.isList)?k.map(a,function(a){return O4(a,b,c)?Fh.mine(a):Fh.other(a)}):[Fh.paragraphs(a)]})}},uG=function(a){return Ob.cata(a,function(a){return Zc.wrap(a)},function(a){return[a]},function(a,c){return fa.isList(a)?[a]:k.bind(c,uG)},function(a){return Zc.wrap([a])})},
P4={isRootContainer:function(a){return function(b){return a(b)||fa.isContainer(b)&&"li"!==A.name(b)}},extract:uG,isCapable:fa.isBlock,canUse:f.constant(!1),quasi:function(){return h.some(Li.nu(Sa()))},ascend:function(a,b){return I.closest(a,"ol,ul",b).getOr(a)}},Q4=function(a,b,c){var d=q.fromTag(b);c.each(function(a){t.set(d,"list-style-type",a)});return fm.list(a,d)},Rf={hasSameType:function(a,b){return A.name(a)===b},hasSameStyle:function(a,b){var c=t.getRaw(a,"list-style-type");return b.fold(function(){return c.isNone()},
function(a){return c.is(a)})},convertOr:function(a,b,c,d,e){return function(g){return d(g.list(),a)&&e(g.list(),b)?c(g):Q4(g,a,b)}},topContext:function(a,b,c){return Mg.context(a,b,Mg.topmost,JE,c)},context:function(a,b,c){return Mg.context(a,b,Mg.immediate,JE,c)},unapply:function(a){return fm.level(a,-1*a.level())}},Wi=Sa(),R4=qv(Wi),S4=function(a){a=k.map(a,function(a){return I.ancestor(a,"ul,ol")});var b=k.map(a,function(a){return a.fold(function(){return"-"},function(a){return A.name(a)+"-"+t.get(a,
"list-style-type")})}),c=b[0];return k.forall(b.slice(1),function(a){return a===c})?a[0]:h.none()},vG=function(a,b,c){var d=LP(Wi,a,c),e=function(a,b,c,e,g,f){return Lg.applyOn(a,P4,b,c,e,g,function(b){return d.apply(a,f,b)})},g=function(b,d,e){b=b.selected();return 0<b.length&&S4(b).map(function(b){return d(b,a)&&e(b,c)}).getOr(!1)};return{query:function(c){return R4.queryAll(c.startContainer(),c.endContainer(),["ul","ol"],b).exists(function(b){return b===a})},queryStyle:function(a){var d=c.fold(function(){return":not([style])"},
function(a){return'[style*="list-style-type: '+a+';"]'});return Wi.up().closest(a.startContainer(),"ol, ul",b).exists(function(c){return Wi.up().closest(a.endContainer(),"ol, ul",b).exists(function(a){return c.dom()===a.dom()?Wi.is(c,d):!1})})},apply:function(b,d,h,k,m,n,q){var r=q?f.constant(!0):Rf.hasSameStyle,t=function(){return e(b,d,h,k,m,n)},u=function(b,e){return PE.executeUsing(b,d,h,k,m,function(){return Rf.convertOr(a,c,e,Rf.hasSameType,r)})},v=function(){return Rf.topContext(d,k,b).fold(t,
function(a){return u(a,Rf.unapply)})};return Rf.context(d,k,b).fold(t,function(a){return g(a,Rf.hasSameType,r)?v():u(a,f.identity)})}}},Vj={unordered:f.curry(vG,"ul"),ordered:f.curry(vG,"ol")},wG=function(a,b,c,d){return function(c){var g=d(c.content().isRoot,h.none());return{toggle:!0,value:a,textkey:u.key(b),icon:!0,tooltip:Va.get,updateGeneral:function(a){c.content().getSelection().each(function(b){(g.query(b)?oa.on(!0):oa.off()).fold(a.deselect,f.noop,a.select)})},action:function(){dg.list(function(a,
b,d,f,h){return g.apply(a,b,d,f,h,go(c.region()))},c.region(),c.content(),c.undo(),c.selections());c.content().focus()}}}},T4=wG("bullist","action.bullist","ul",Vj.unordered),wv={ol:wG("numlist","action.numlist","ol",Vj.ordered),ul:T4},U4=C.immutable("tag"),xG=function(a,b){return k.contains(["label","li","td","th","normal"],b)?oa.on(a.backup(b)):oa.off()},V4=function(a,b,c){return qG.query(a,b.selectors(),c).fold(function(){return a.collapsed()?xG(b,"normal"):oa.off()},function(a){return b.candidateByName(a).map(oa.on).getOrThunk(function(){return xG(b,
a)})})},PP={read:function(a,b){var c=a.getSelection().fold(function(){return oa.off()},function(c){return V4(c,b,a.isRoot)});return U4(c)}},OP=Y.detect(),yG={resolve:jb.create("ephox-arcade").resolve},is="data-"+yG.resolve("no-merge"),js="data-"+yG.resolve("atomic"),bf={doNotMerge:function(a){A.isElement(a)&&m.set(a,is,"true")},shouldMerge:function(a){return A.isElement(a)&&!1===m.has(a,is)},setAtomic:function(a){A.isElement(a)&&m.set(a,js,"true")},isAtomic:function(a){return A.isElement(a)&&"true"===
m.get(a,js)},clear:function(a){A.isElement(a)&&k.each([is,js],function(b){m.remove(a,b)})}},W4=function(a){var b=y.owner(a);a=X.descendants(a,"td,th");k.each(a,function(a){pe.needsCursor(a).each(function(d){v.append(a,q.fromTag("br",b.dom()))})})},X4=function(a){pe.vacate(a);pe.needsCursor(a).each(function(b){B.remove(a)})},Y4=function(a){("table"===A.name(a)?W4:X4)(a)},zG=function(a,b){var c=Z4(a),c=k.filter(c,b);k.each(c,Y4)},Z4=function(a){var b=function(a){return[a]},c=y.prevSibling(a).map(b).getOr([]),
b=y.nextSibling(a).map(b).getOr([]);return c.concat([a]).concat(b)},Zg={purge:function(a){zG(a,fa.isBlock)},purgeBy:zG},AG=function(a){Zg.purgeBy(a,function(a){var c=fa.isBlock(a)||"li"===A.name(a)||"ol"===A.name(a)||"ul"===A.name(a);if("li"===A.name(a)){var d;if(!(d=0===X.descendants(a,"ul,ol").length)){d=X.descendants(a,"ul,ol,li");var e=X.descendants(a,"*");a=lc.descendants(a,A.isText);d=d.length===e.length&&0===a.length}a=d}else a=!0;return c&&a})},ks=function(a){var b=X.descendants(a,"ol,ul,li");
k.each([a].concat(b),AG)},BG=function(a){a=("li"===A.name(a)?[a]:[]).concat(X.descendants(a,"li"));k.each(a,function(a){var c=y.children(a);k.exists(c,function(a){return A.isText(a)?0<Fa.get(a).length:!k.contains(["ol","ul"],A.name(a))})||t.set(a,"list-style-type","none")})},wm=function(a,b){var c=q.fromText(Ua.zeroWidth());a(b,c);return h.some({element:f.constant(c),cleanup:function(){B.remove(c)},splits:f.constant([])})},$g=function(a,b){return a.map(function(a){return{element:f.constant(a),cleanup:f.noop,
splits:f.constant(b)}})},CG=function(a,b){return wm(v.before,a)},DG=function(a,b){return wm(v.after,a)},ls=function(a,b){return wm(v.append,a)},ms=function(a,b){return wm(v.prepend,a)},EG=function(a,b){return function(c,d){return a(c,d).fold(function(){return b(c,d)},h.some)}},ns=function(a,b,c){return $g(h.some(b),void 0!==b&&void 0!==c?[{first:b.dom(),second:c.dom()}]:[])},FG={before:{text:{none:h.none,start:EG(function(a,b){return $g(y.prevSibling(a),[])},CG),middle:ns,end:ns},element:{hasPrevious:function(a,
b){return $g(y.child(a,b-1),[])},rightEdge:ls,first:ms,empty:CG,otherwise:ms}},after:{text:{none:h.none,start:ns,middle:function(a,b,c){return $g(h.some(c),void 0!==b&&void 0!==c?[{first:b.dom(),second:c.dom()}]:[])},end:EG(function(a,b){return $g(y.nextSibling(a),[])},DG)},element:{hasNext:function(a,b){return $g(y.child(a,b+1),[])},rightEdge:ls,first:ms,empty:DG,otherwise:ls}}},xm={prefix:f.curry(lm.prefix,FG),postfix:f.curry(lm.postfix,FG)},$4=function(a){return!Bc.descendant(a,function(a){return Hg.hasCursor(a,
["hr","img"])})},a5=function(a){var b=ac.shallowAs(a,"p");v.before(a,b);B.remove(a);return h.some(b)},b5=function(a){var b=a.second(),b=(vb.isHeading(b)&&$4(b)?a5(b):h.none()).getOr(a.second());return{first:a.first,second:f.constant(b),mark:a.mark,splits:a.splits}},c5=function(a){return A.isElement(a)&&fa.isInline(a)&&0===y.children(a).length},d5=function(a){var b=q.fromText(Ua.zeroWidth());v.append(a,b);return b},GG=function(a,b,c){return xm.prefix(b,c).bind(function(b){var c=Vl.breakPath(b.element(),
vb.stopAt(a));return c.second().map(function(g){return{first:f.constant(a),second:f.constant(g),mark:f.constant(b),splits:f.constant(c.splits().concat(b.splits()))}})})},Fd={soft:function(a,b,c){var d=function(c){var e;A.isText(c)?(e=Fa.get(c),e=-1===e.indexOf("\u00a0")&&0===e.trim().length):e=!1;return e?y.nextSibling(c).forall(d):!ja.isStart(a,b)&&fa.isBlock(c)},e=q.fromTag("br");Rj.atStartOf(a,b,e);y.nextSibling(e).fold(function(){return ja.getEnd(a)===b&&vb.findBlock(a,c).bind(Ab.last).fold(f.constant(!1),
function(b){var c="br"===A.name(b)?e:a;return L.eq(c,b)})},d)&&v.after(e,q.fromTag("br"));return h.some({start:f.constant(da.after(e)),finish:f.constant(da.after(e))})},hard:function(a,b,c,d,e){return GG(a,b,c).map(b5).map(function(a){k.each([d.getOr(a.first()),a.second()],function(b){pe.postprocess(b,a.mark().element(),e)});vb.findValidHardBreak(a.second(),e).orThunk(function(){vr.rootBr(a.second(),a.mark().element())});var b=Sl.plunge(a.second(),f.constant(!1)),b=c5(b)?d5(b):b;a.mark().cleanup();
return{start:f.constant(da.on(b,0)),finish:f.constant(da.on(b,0))}})},rupture:GG},HG=function(a){return h.some({start:f.constant(a),finish:f.constant(a)})},e5={doubleBr:function(a){v.after(a,q.fromTag("br"));var b=q.fromTag("br");v.after(a,b);return HG(da.after(b))},emptyParagraph:function(a){var b=q.fromTag("p"),c=q.fromTag("br");v.append(b,c);v.after(a,b);return HG(da.on(c,0))}},IG=function(a){return[a]},f5={processes:function(a){return{stopper:vb.stopAt(a),wrapper:IG,post:f.noop}}},h5=function(a,
b,c){h.from(c[c.length-1]).each(function(a){J.append(a,g5(y.children(b)));B.empty(b)})},g5=function(a){return k.filter(a,function(a){return!(A.isElement(a)&&vb.isList(a)&&0===y.children(a).length)})},i5={processes:function(a){return{stopper:vb.stopAt(a),wrapper:IG,post:h5}}},j5=function(a,b){B.remove(a);return b},k5=function(a,b){var c=q.fromTag("p");J.append(c,b);v.before(a,c);B.remove(a);pe.needsCursor(c).each(function(a){vr.forceAddBr(a,q.fromTag("span"))});return[c]},l5=function(a){var b=y.children(a),
b=(Bc.descendant(a,fa.isFormatting)?j5:k5)(a,b);k.each(b,function(b){A.isElement(b)&&(m.transfer(a,b,["dir"]),t.transfer(a,b,["text-align"]))});return b},m5={processes:function(a){return{stopper:vb.stopAt(a),wrapper:l5,post:f.noop}}},n5={exit:function(a,b){return I.ancestor(a,"ol,ul",b).bind(function(c){var d=I.ancestor(c,"li,ol,ul",b).fold(function(){return m5.processes(c)},function(a){return"li"===A.name(a)?i5.processes(a):f5.processes(c)}),e=Vl.breakPath(a,d.stopper);return e.second().map(function(b){var c=
e.first(),h=d.wrapper(a);J.before(b,h);d.post(c,b,h);k.each([c,b],pe.lists);b=Sl.plunge(h[0],f.constant(!1));b=f.constant(da.on(b,0));return{start:b,finish:b}})})}},o5=function(a,b,c,d){return I.closest(b,"li",d).fold(function(){return Fd.hard(a,b,c,h.none(),d)},function(a){a=vb.exitList(a)?n5.exit(a,d):Fd.hard(a,b,c,h.some(a),d);return a})},os={hard:function(a,b,c){return vb.findValidHardBreak(a,c).fold(function(){return vb.findAnchorBreak(a,c).fold(function(){return Fd.soft(a,b,c)},function(d){return!0===
vb.isRightEdge(d,a,b)?e5.doubleBr(d):Fd.hard(d,a,b,h.none(),c)})},function(d){return o5(d,a,b,c)})},soft:Fd.soft,rupture:Fd.rupture},ps=C.immutable("cursor","blocks"),ym=function(a,b,c,d){return xm.postfix(a,b,c,d).map(function(e){var g=Pf.leftEdge(a,b,c,d);Pf.makeTo(g.element(),g.offset(),e.element()).deleteContents();return{start:f.constant(da.before(e.element())),finish:f.constant(da.before(e.element())),mark:e.element}})},qs=function(a,b,c,d,e){return ym(a,b,c,d).bind(function(a){return Fd.soft(a.mark(),
0,e)})},p5=function(a,b,c,d,e){return ym(a,b,c,d).bind(function(a){return vb.findValidHardBreak(a.mark(),e).bind(function(b){return Fd.hard(b,a.mark(),0,h.none(),e)})})},q5=function(a,b){k.each(a,function(a){pe.postprocess(a,b)})},rs={soft:qs,hard:function(a,b,c,d,e){var g=vb.findValidHardBreak(a,e),l=vb.findValidHardBreak(c,e),h=g.fold(function(){var g=qs(a,b,c,d,e);return ps(g,[])},function(g){return l.fold(function(){var f=qs(a,b,c,d,e);return ps(f,[g])},function(f){var l=L.eq(g,f)?p5(a,b,c,d,
e):ym(a,b,c,d);return ps(l,[g,f])})});return h.cursor().map(function(a){var b=h.blocks(),c;c=a.start().fold(f.identity,f.identity,f.identity);q5(b,c);return a})},rupture:function(a,b,c,d,e){return ym(a,b,c,d).bind(function(a){return vb.findValidHardBreak(a.mark(),e).bind(function(b){return Fd.rupture(b,a.mark(),0)})})}},ss={point:function(a,b,c){return os.rupture(a,b,c)},range:function(a,b,c,d,e){return rs.rupture(a,b,c,d,e)},ruptureUntil:function(a,b,c,d,e,g){var f=xm.postfix(a,b,c,d);return function(a,
b){return vb.findValidHardBreak(a,e).map(g).bind(function(c){return Fd.rupture(c,a,b)})}(a,b).bind(function(a){return f.map(function(b){var c=document.createRange();c.setStartAfter(a.first().dom());c.setEndBefore(b.element().dom());c.deleteContents();b.cleanup();a.mark().cleanup();return a.first()})})}},Xi=function(a,b,c){if(0<a.length){var d=a[0],e=a.slice(1);Rj.atStartOf(b,c,d);J.after(d,e);return h.some(a[a.length-1])}return h.none()},Fc={split:function(a,b,c){var d=void 0===c?Zg.purge:c;return ss.point(a.block(),
a.element(),a.offset()).bind(function(a){var c=b.all();J.before(a.second(),c);a.mark().cleanup();d(a.first());d(a.second());k.each([a.first(),a.second()],BG);a=k.reverse(c);return k.find(a,function(a){return y.parent(a).isSome()})})},merge:function(a,b){var c=y.children(b.single());return Xi(c,a.element(),a.offset())},nest:function(a,b){return Xi(b.all(),a.element(),a.offset())},insertMany:Xi,insertChildren:function(a,b){var c=y.children(a);return Xi(c,b.element(),b.offset())},fallback:function(a,
b,c){return Xi(c,b.startContainer(),b.startOffset())}},JG={lists:function(a){return k.foldr(a,function(a,c){return a.bind(function(a){return I.closest(c,"ol,ul").map(function(b){return[b].concat(a)})})},h.some([])).map(function(a){return{all:f.constant(a)}})},from:function(a){return{all:f.constant(a)}}},KG=C.immutable("left","right"),r5=function(a){return fa.isFormatting(a)||fa.isContainer(a)},LG=function(a,b,c,d){return sa.closest(c,a,b)},MG=function(a){return function(b,c,d){return a(b,c.element(),
c.offset()).bind(function(c){return a(b,d.element(),d.offset()).map(function(a){return KG(c,a)})})}},NG=function(a){var b=MG(a);return function(a,d,e){return b(a,d,e).filter(function(a){return L.eq(a.left(),a.right())})}},Ia={inline:function(a,b,c){return sa.closest(b,r5,a).fold(function(){return h.some(b)},function(c){return a(c)?h.some(b):h.none()})},formatter:f.curry(LG,fa.isFormatting),container:function(a,b,c){return sa.closest(b,fa.isContainer,a).filter(f.not(a))},inListItem:function(a,b,c){return I.closest(b,
"li",a)},inList:function(a,b,c){return I.closest(b,"ol,ul",a)},inTableCell:function(a,b,c){return I.closest(b,"td,th",a)},setBlock:function(a,b){return Z.deepMerge(a,{block:f.constant(b)})},both:MG,shared:NG,sharedPredicate:function(a){a=f.curry(LG,a);return NG(a)},entireRoot:function(a,b,c){return sa.closest(b.element(),a).filter(function(c){var e=function(a){return L.eq(a,b.element())};return a(b.element())&&0===b.offset()||A.isText(b.element())&&0===b.offset()&&Ab.first(c).map(e).getOr(!1)}).filter(function(b){var e=
function(a){return L.eq(a,c.element())};return a(c.element())&&c.offset()>=y.children(b).length-1||A.isText(c.element())&&c.offset()>=Fa.get(c.element()).length&&Ab.last(b).map(e).getOr(!1)}).map(function(a){return KG(a,a)})}},OG=function(a){return function(b){return(1===b.length?h.some(b[0]):h.none()).filter(a).map(function(a){return{single:f.constant(a)}})}},PG=function(a){return function(b){return(k.exists(b,a)?h.some(b):h.none()).map(function(a){return{all:f.constant(a)}})}},wb={oneOf:OG,anyOf:PG,
noneOf:function(a){return function(b){return(k.exists(b,a)?h.none():h.some(b)).map(function(a){return{all:f.constant(a)}})}},allOf:function(a){return function(b){return k.forall(b,a)?h.some({all:f.constant(b)}):h.none()}},any:h.some,oneOfTag:function(a){return OG(function(b){return A.name(b)===a})},anyOfTag:function(a){return PG(function(b){return A.name(b)===a})},single:function(a){return h.some({single:f.constant(a)})},all:function(a){return h.some({all:f.constant(a)})}},zm=function(a){return 1===
a.length?I.closest(a[0],"ol,ul").map(function(a){return{single:f.constant(a)}}):h.none()},QG=function(a){return zm(a).bind(function(a){a=X.descendants(a.single(),"li");return 1===a.length?h.some({single:f.constant(a[0])}):h.none()})},RG=function(a){if(2!==a.length)return h.none();var b=a[0],c=a[1];return fa.isFormatting(b)||fa.isContainer(b)||k.contains(["ol","ul","li"],A.name(b))||!k.contains(["ol","ul"],A.name(c))?h.none():h.some({all:f.constant(a),list:f.constant(c),inline:f.constant(b)})},ah=
Ia.formatter,SG=Ia.inline,s5=Ia.container,TG=function(a){return fa.isFormatting(a)&&!1===bf.shouldMerge(a)},t5=[Qa(Ia.inListItem,zm,function(a,b){var c=X.children(b.single(),"li");return 1!==c.length||db.descendant(c[0],"ol,ul")?Fc.split(a,JG.from(c),AG):Fc.insertChildren(c[0],a)},"List"),Qa(Ia.inListItem,JG.lists,function(a,b){return I.ancestor(a.block(),"ol,ul",a.isRoot).bind(function(c){c=Ia.setBlock(a,c);return Fc.split(c,b,ks)})},"Many lists"),Qa(SG,wb.anyOf(TG),Fc.nest,"Copying formatting (NO MERGE) into root"),
Qa(SG,wb.oneOf(fa.isFormatting),Fc.merge,"Copying formatting into root"),Qa(ah,wb.anyOfTag("hr"),Fc.split,"insert hr into formatter"),Qa(ah,wb.anyOf(TG),Fc.split,"Copying one formatting block (NO MERGE) into formatting"),Qa(ah,wb.oneOf(fa.isFormatting),Fc.merge,"Copying one formatting block into formatting"),Qa(ah,wb.anyOf(fa.isFormatting),Fc.split,"Copying many formatting blocks into formatting"),Qa(ah,wb.anyOfTag("table"),function(a){return function(b,c){var d=c.all(),e=a(b,c);h.from(d[d.length-
1]).each(function(a){y.nextSibling(a).fold(function(){var b=q.fromTag("p");v.append(b,q.fromTag("br"));v.after(a,b)},f.noop)});return e}}(Fc.split),"Copying tables into formatting"),Qa(ah,wb.anyOf(fa.isContainer),Fc.split,"Copying container blocks into formatting"),Qa(s5,wb.all,Fc.nest,"Fallback pasting into container.")],u5={context:function(a,b,c){return b.context(a.isRoot,c.startContainer(),c.startOffset()).map(function(b){return{block:f.constant(b),element:c.startContainer,offset:c.startOffset,
isRoot:a.isRoot}})},rules:f.constant(t5),fallback:Fc.fallback},v5={force:function(a){var b=wc.after(a.startContainer(),a.startOffset(),a.endContainer(),a.endOffset()),c=b?S.point(a.endContainer(),a.endOffset()):S.point(a.startContainer(),a.startOffset());a=b?S.point(a.startContainer(),a.startOffset()):S.point(a.endContainer(),a.endOffset());return{left:f.constant(c),right:f.constant(a)}}},w5=function(a,b){var c=a.original(),d=xm.postfix(c.left().element(),c.left().offset(),c.right().element(),c.right().offset()),
e=b.all();return d.bind(function(b){Pf.makeTo(c.left().element(),c.left().offset(),b.element()).deleteContents();b.cleanup();J.append(a.left(),e);b=y.children(a.right());J.append(a.left(),b);B.remove(a.right());return h.from(e[e.length-1])})},UG=function(a,b){if(!L.eq(a.left(),a.right()))throw"replaceContents used in the wrong context";var c=a.left();B.empty(c);var d=b.all();J.append(c,d);return Ab.last(c).or(h.from(d[d.length-1]))},Gc={replace:function(a,b){if(L.eq(a.left(),a.right())){var c=b.all();
a.replaceSelection(c);return h.from(c[c.length-1])}return w5(a,b)},replaceContents:UG,replaceContentsWrapP:function(a,b){var c=q.fromTag("p");J.append(c,b.all());return UG(a,{all:f.constant([c])})},replaceWhole:function(a,b){var c=b.all();J.after(a.left(),c);B.remove(a.left());return h.from(c[c.length-1])},merge:function(a,b){var c=y.children(b.single());a.replaceSelection(c);return h.from(c[c.length-1])},split:function(a,b,c){var d=void 0===c?Zg.purge:c;c=a.original().left();var e=a.original().right();
return ss.range(c.element(),c.offset(),e.element(),e.offset(),a.isRoot).bind(function(a){var c=b.all();J.before(a.second(),c);a.mark().cleanup();k.each([a.first(),a.second()],d);return h.from(c[c.length-1])})},fallback:function(a,b,c){a.replaceSelection(c);h.from(c[0]).each(Zg.purge);h.from(c[c.length-1]).each(Zg.purge);return h.from(c[c.length-1])}},VG=function(a,b,c,d){d=void 0!==d?d:f.identity;var e=b.original(),g=e.left(),e=e.right();return ss.ruptureUntil(g.element(),g.offset(),e.element(),e.offset(),
b.isRoot,d).bind(function(b){var d=a(b,c);x5(b);return d},void 0!==d?d:f.identity)},x5=function(a){var b=X.ancestors(a,"ol,ul");0<b.length&&k.each([ks,BG],function(a){a(b[b.length-1])})},Am=function(a,b,c){return VG(a,b,c,f.identity)},Yi=Ia.formatter,y5=f.curry(Am,function(a,b){v.after(a,b.single());return h.some(b.single())}),WG=f.curry(function(a,b,c){return VG(a,b,c,function(a){return y.parent(a).getOr(a)})},function(a,b){var c=b.all();J.after(a,c);return h.from(c[c.length-1])}),z5=f.curry(Am,
function(a,b){var c=y.children(b.single());J.after(a,c);return h.some(c[c.length-1])}),A5=f.curry(Am,function(a,b){var c=q.fromTag("li");J.append(c,[b.inline(),b.list()]);v.after(a,c);return h.some(b.list())}),B5=f.curry(Am,function(a,b){var c=q.fromTag("li");J.append(c,[b.inline(),b.list()]);var d=I.ancestor(a,"ol,ul").fold(function(){var a=q.fromTag(A.name(b.list()));v.append(a,c);return a},function(){return c});v.after(a,d);return h.some(b.list())}),C5=[Qa(Ia.sharedPredicate(bf.isAtomic),wb.all,
Gc.replaceWhole,"selection: inside something atomic, so just replace the whole thing"),Qa(Ia.shared(Ia.inListItem),QG,function(a,b){return Gc.merge(a,b)},"selection: same item, paste: singleton"),Qa(Ia.shared(Ia.inListItem),zm,function(a,b){return Gc.split(a,{all:f.constant(y.children(b.single()))},ks)},"selection: same item, paste: single list"),Qa(Ia.shared(Ia.inListItem),RG,B5,"selection: same item, paste: partial"),Qa(Ia.shared(Ia.inListItem),wb.noneOf(fa.isBlock),Gc.replace,"selection: same item, paste: no blocks"),
Qa(Ia.shared(Ia.inListItem),wb.anyOf(fa.isHeading),function(a,b){var c=Gc.replace(a,b);k.each(b.all(),function(a){Zg.purgeBy(a,Hg.isVacantText)});return c},"selection: same item, paste: heading"),Qa(Ia.shared(Ia.inListItem),wb.all,WG,"selection: same item, paste: any"),Qa(Ia.both(Ia.inListItem),QG,y5,"selection: diff items, paste: singleton"),Qa(Ia.both(Ia.inListItem),zm,z5,"selection: diff items, paste: single list"),Qa(Ia.both(Ia.inListItem),RG,A5,"selection: diff items, paste: partial"),Qa(Ia.both(Ia.inListItem),
wb.all,WG,"selection: diff items, paste: any"),Qa(Ia.both(Yi),wb.anyOfTag("hr"),Gc.split,"selection: inside formatter, paste: split"),Qa(Ia.both(Yi),wb.noneOf(fa.isBlock),Gc.replace,"range no blocks"),Qa(Ia.both(Yi),wb.anyOf(function(a){return fa.isFormatting(a)&&!1===bf.shouldMerge(a)}),Gc.split,"range 1 formatting block"),Qa(Ia.both(Yi),wb.oneOf(fa.isFormatting),Gc.merge,"range 1 formatting block"),Qa(Ia.both(Yi),wb.all,Gc.split,"range anything > formatters"),Qa(Ia.entireRoot,wb.noneOf(fa.isBlock),
Gc.replaceContentsWrapP,"complete body, not inserting a block: wrap in P and replace the contents"),Qa(Ia.entireRoot,wb.all,Gc.replaceContents,"complete body: replace the contents")],D5={context:function(a,b,c){var d=v5.force(c);return b.context(a.isRoot,d.left(),d.right()).map(function(b){return{left:b.left,right:b.right,original:f.constant(d),isRoot:a.isRoot,replaceSelection:a.replaceSelection}})},rules:f.constant(C5),fallback:Gc.fallback},E5=function(a,b,c,d,e){return k.foldl(a,function(a,l){return a.orThunk(function(){return d(b,
l,c).bind(function(a){return l.profile(e).map(function(b){return{action:l.action,target:f.constant(b),ctx:f.constant(a)}})})})},h.none())},F5=function(a){var b=ja.getEnd(a);return S.point(a,b)},XG=function(a,b,c,d,e,g){var f={getSelection:a,replaceSelection:b,isRoot:c};return f.getSelection().bind(function(a){var b=a.collapsed()?u5:D5,c=a.collapsed()?e.concat(b.rules()):g.concat(b.rules()),c=E5(c,f,a,b.context,d).fold(function(){return b.fallback(f,a,d)},function(a){return a.action(a.ctx(),a.target())});
return c.isNone()&&0===d.length?h.some(S.point(a.startContainer(),a.startOffset())):c.map(F5)})},G5={insertAtCursor:function(a,b,c,d){return XG(a,b,c,d,[],[])},insertAtCursorWith:XG},H5=function(a){return A.isElement(a)&&"false"===m.get(a,"contenteditable")},I5=function(a){return a().map(function(a){a=k.map([a.startContainer(),a.endContainer()],function(a){return sa.closest(a,H5)});return $a.cat(a)}).getOr([])},YG=function(a,b,c){k.each(a,b);b=c();k.each(a,bf.clear);return b},J5=function(a,b){return YG(a,
bf.setAtomic,b)},ZG=function(a,b,c,d,e,g){var f=I5(a);return J5(f,function(){return G5.insertAtCursorWith(a,b,c,d,e,g)})},$G=function(a,b,c,d){b=ZG(a.getSelection,a.replaceSelection,a.isRoot,b,c,d);a.domChanged();a.undoChanged();return b},aH=function(a,b){return $G(a,b,[],[])},xc={insertAtCursorWith:$G,insertAtCursor:aH,insertAtCursorWithInstructions:function(a,b,c){return YG(c,a,function(){return aH(b,c)})},insertAt:function(a,b,c){c=ZG(function(){return h.some(b)},function(c){a.win().each(function(a){var g=
Vb.relative(da.on(b.startContainer(),b.startOffset()),da.on(b.endContainer(),b.endOffset()));Ea.replace(a,g,c)})},a.isRoot,c,[],[]);a.domChanged();a.undoChanged();return c}},Wj={generate:function(a){return a+"-"+Math.floor(99999*Math.random()).toString()}},K5=C.immutable("ch","offset"),bH=function(a,b){return K5(a.charAt(b),b)},Bm={previous:function(a,b){for(var c=b.getOr(a.length)-1;0<=c;c--)if(a.charAt(c)!==Ua.zeroWidth())return h.some(bH(a,c));return h.none()},next:function(a,b){for(var c=b.getOr(0)+
1;c<a.length;c++)if(a.charAt(c)!==Ua.zeroWidth())return h.some(bH(a,c));return h.none()},rfind:function(a,b){b.lastIndex=-1;var c=k.reverse(a).join(""),d=c.match(b);return void 0!==d&&null!==d&&0<=d.index?h.some(c.length-1-d.index):h.none()},lfind:function(a,b){b.lastIndex=-1;var c=a.match(b);return void 0!==c&&null!==c&&0<=c.index?h.some(c.index):h.none()}},L5=ma.walkers().left(),M5=ma.walkers().right(),N5=la.generate([{abort:[]},{kontinue:[]},{finish:["info"]}]),ts=la.generate([{aborted:[]},{edge:["element"]},
{success:["info"]}]),cH=function(a,b){return Xb.isEmptyTag(a,b)||a.property().isBoundary(b)},us=function(a,b,c,d,e,g,f){var k=function(){return f.fold(ts.aborted,ts.edge)},m=function(d){return ma.walk(a,b,c,g).fold(k,function(b){return us(a,b.item(),b.mode(),h.none(),e,g,d)})};if(cH(a,b))return k();if(a.property().isText(b)){var n=a.property().getText(b);return e(a,N5,b,n,d).fold(k,function(){return m(h.some(b))},ts.success)}return m(f)},O5=function(a,b,c,d){c=ic.toLeaf(a,b,c);return a.property().isText(b)?
h.none():Bl.left(a,c.element(),a.property().isText,d).map(function(b){return S.point(b,a.property().getText(b).length)})},P5=function(a,b,c,d){c=ic.toLeaf(a,b,c);return a.property().isText(b)?h.none():Bl.right(a,c.element(),a.property().isText,d).map(function(a){return S.point(a,0)})},dH=function(a,b,c){var d=f.curry(cH,a);return O5(a,b,c,d).orThunk(function(){return P5(a,b,c,d)}).getOr(S.point(b,c))},eH={repeatLeft:function(a,b,c,d){b=dH(a,b,c);return us(a,b.element(),ma.sidestep,h.some(b.offset()),
d,L5,h.none())},repeatRight:function(a,b,c,d){b=dH(a,b,c);return us(a,b.element(),ma.sidestep,h.some(b.offset()),d,M5,h.none())}},fH=Eb.exactly(["regex","attempt"]),gH=function(a,b,c,d){return eH.repeatLeft(a,b,c,d)},hH=function(a,b,c,d){return eH.repeatRight(a,b,c,d)},iH=function(a,b,c){var d=f.constant(!1);if(!a.property().isText(b))return h.none();var e=a.property().getText(b);return c<=e.length?h.some(S.point(b,c)):ma.seekRight(a,b,a.property().isText,d).bind(function(b){return iH(a,b,c-e.length)})},
Sf={previousChar:function(a,b){return Bm.previous(a,b)},nextChar:function(a,b){return Bm.next(a,b)},repeatLeft:gH,repeatRight:hH,expandLeft:function(a,b,c,d){var e=fH(d);return gH(a,b,c,function(a,b,c,d,f){a=f.getOr(d.length);return Bm.rfind(d.substring(0,a),e.regex()).fold(function(){return b.kontinue()},function(a){return e.attempt(b,c,d,a)})})},expandRight:function(a,b,c,d){var e=fH(d);return hH(a,b,c,function(a,b,c,d,f){var h=f.getOr(0);return Bm.lfind(d.substring(h),e.regex()).fold(function(){return b.kontinue()},
function(a){return e.attempt(b,c,d,h+a)})})},scanRight:iH},Zi=Sa(),Tf={previousChar:function(a,b){return Sf.previousChar(a,b)},nextChar:function(a,b){return Sf.nextChar(a,b)},repeatLeft:function(a,b,c){return Sf.repeatLeft(Zi,a,b,c)},repeatRight:function(a,b,c){return Sf.repeatRight(Zi,a,b,c)},expandLeft:function(a,b,c){return Sf.expandLeft(Zi,a,b,c)},expandRight:function(a,b,c){return Sf.expandRight(Zi,a,b,c)},scanRight:function(a,b){return Sf.scanRight(Zi,a,b)}},bh=C.immutable("before","after"),
xs=function(a,b,c,d,e){return Cm(c).fold(function(){var c=jH(a,b,d);return bh(c,e)},function(g){var f=ch(c,g);return f.length>a?bh(d,e):vs(b).fold(function(){var b=ws(a-f.length,g,e+f);return bh(d,b)},function(c){var h=ch(c,b);return h.length>a-f.length?bh(d,e+f):xs(a-f.length-h.length,c,g,h+d,e+f)})})},kH=function(a,b,c,d){return a.finish(S.point(b,d))},lH={regex:function(){return RegExp(cb.wordchar(),"i")},attempt:kH},mH={regex:function(){return RegExp(cb.wordbreak(),"i")},attempt:kH},nH=function(a,
b){return a.offset()===b.offset()&&L.eq(a.element(),b.element())},oH=function(a){return S.point(a,A.value(a).length)},pH=function(a){return S.point(a,0)},ys=function(a,b,c){var d=function(b){b=c(b);return nH(a,b)?h.none():h.some(b)};return b(a.element(),a.offset(),lH).fold(h.none,d,function(a){return b(a.element(),a.offset(),mH).fold(h.none,d,function(a){return h.some(a)})})},Cm=function(a){return ys(a,Tf.expandRight,oH)},vs=function(a){return ys(a,Tf.expandLeft,pH)},Dm=function(a,b,c,d,e,g){return a(c).fold(f.constant(d),
function(f){var h=e(c,f);return h.length+d.length>b||0===h.length?d:Dm(a,b,f,g(d,h),e,g)})},ws=function(a,b,c){return Dm(Cm,a,b,c,ch,function(a,b){return a+b})},jH=function(a,b,c){return Dm(vs,a,b,c,function(a,b){return ch(b,a)},function(a,b){return b+a})},ch=function(a,b){var c=y.defaultView(a.element()).dom(),d=Vb.exact(a.element(),a.offset(),b.element(),b.offset());return Ea.getAsString(c,d)},qH={beforeAfter:bh,anchorText:function(a,b){var c=Ka.freefallLtr(b);return Cm(c).map(function(b){var e=
ch(c,b);return e+ws(a-e.length,b,"")}).getOr("")},flankingText:function(a,b){if(0===a)return bh("","");var c=Ka.freefallLtr(b),d=Ka.freefallRtl(b);return xs(a,c,d,"","")},extendRightAndLeft:xs,extendWordsSearch:Dm,extendWordsRight:ws,extendWordsLeft:jH,wordSearch:ys,wordLeft:vs,wordRight:Cm,pointEq:nH,boundaryPointRight:oH,boundaryPointLeft:pH,textBetweenPoints:ch,wordSeeker:lH,wordBreakSeeker:mH},rH=function(a,b){try{return a()}catch(c){if(12===c.code)return b();throw c;}},zs=function(a){return I.closest(a,
"a[href]")},As=function(a,b){return zs(a).bind(function(a){return zs(b).filter(function(b){return L.eq(a,b)})})},Q5=C.immutable("element","innerText","before","after"),Bs=function(a,b,c,d){b=ke.isEmpty(b)&&ke.isEmpty(c)&&ke.isEmpty(d)?"#"+m.get(a,"id"):b;return Q5(a,b,c,d)},Cs=function(a){return qa.is(a,"a[href]")?[a]:qa.all("a[href]",a)},Pc={contentLink:function(a){var b=a.getSelection();return Jb.detect(b).fold(function(){return b.bind(function(a){return As(a.startContainer(),a.endContainer())})},
function(a){return h.some(a.image()).bind(zs)})},sharedLink:As,sharedLinkOrClosest:function(a,b){var c=Ka.toLeaf(a.startContainer(),a.startOffset()),d=Ka.toLeaf(a.endContainer(),a.endOffset());return As(c.element(),d.element()).orThunk(function(){return I.closest(c.element(),"a[href]",b)})},findLinkTargets:function(a){return qa.all("h1,h2,h3,h4,h5,h6,div[id],p[id],span[id],a[id],a[name]",a)},linkTargetText:function(a,b){var c=nb.get(b).length,d=ac.deep(b),c=qH.anchorText(c,d);if(fa.isBlock(b))return Bs(b,
c,"","");d=qH.flankingText(Math.max(0,a-c.length),b);return Bs(b,c,d.before(),d.after())},linkTargetFastText:function(a,b){var c=nb.get(b),c=c.length>a?c.substr(0,a):c;return Bs(b,c,"","")},all:Cs,many:function(a){return k.bind(a,Cs)},hrefUrl:function(a,b){return rH(function(){return qa.all('a[href="'+b+'"]',a)},function(){var c=Cs(a);return k.filter(c,function(a){return m.get(a,"href")===b})})},anchorTarget:function(a,b){return rH(function(){return qa.one("#"+b+',a[name="'+b+'"]',a)},function(){var c=
y.owner(a).dom();return h.from(c.getElementById(b)).map(q.fromDom).orThunk(function(){var c=qa.all("[name]",a);return k.find(c,function(a){return m.get(a,"id")===b||m.get(a,"name")===b})})})},getAnchorValue:function(a,b){var c=a.replace(/[^0-9a-zA-Z$_.+*(),-]/g,"");return 0<c.length?c:b}},Em=["li"],sH=function(a,b){return Ob.cata(a,function(a){return!0===b?[]:Zc.wrap(a)},function(a){return[a]},function(a,b){return"table"===A.name(a)?[a]:Zc.handleContainer(Em,a,b,sH)},function(a){return!0===b?[]:Zc.wrap([a])})},
R5={isRootContainer:Wl.isRootOrContainer,extract:function(a){return sH(a,!1)},isCapable:function(a){return Lh.isBlock(a)||k.contains(Em,A.name(a))},canUse:function(a){return fa.isFormatting(a)||k.contains(Em,A.name(a))},quasi:f.curry(Zc.handleRoot,Em),ascend:f.identity},S5=function(a,b){return I.closest(b,'[dir="rtl"],[dir="ltr"]').filter(a).isSome()},tH=function(a,b,c){var d=RP(b,c),e=function(a){d.set(a);t.reflow(a)},g=function(a){return Od.getDirection(a)===c};return{run:function(a,b,c,d,g){return Lg.applyOn(a,
R5,b,c,d,g,function(a){k.each(a,e);return a})},query:function(a,b){return VD.bothMatch(a,b,f.curry(S5,g))},name:f.constant(a)}},T5=tH("DirRtl","dir","rtl"),U5=tH("DirLtr","dir","ltr"),Fm={dirLtr:f.constant(U5),dirRtl:f.constant(T5)},uH=function(a){return function(b){var c=function(c,e,g,f){return a.run(b.content().isRoot,c,e,g,f)};qb.cata(b.selections().get(),f.noop,Ql.multiple(b.content(),b.undo(),c),Ql.single(b.content(),b.undo(),c,Hi,Gi));setTimeout(function(){b.content().uiChanged()},0)}},yv=
{dirRtl:uH(Fm.dirRtl()),dirLtr:uH(Fm.dirLtr())},V5=C.immutable("ltrdir","rtldir"),vH=function(a,b){return b.query(a.startContainer(),a.endContainer())?oa.on(!0):oa.off()},W5=function(a){return I.closest(a.startContainer(),"[dir]").isSome()||I.closest(a.endContainer(),"[dir]").isSome()},xv={readDir:function(a){return a.getSelection().filter(W5).map(function(a){return V5(vH(a,Fm.dirLtr()),vH(a,Fm.dirRtl()))})}},X5=la.generate([{blob:["id","imageresult","objurl"]},{url:["id","url","raw"]}]),kc=Z.merge(X5,
{cata:function(a,b,c){return a.fold(b,c)}}),bc={create:zv,clone:function(a){var b;b=zv(a.width,a.height);Bv(b).drawImage(a,0,0);return b},resize:Av,get2dContext:Bv,get3dContext:function(a){var b=null;try{b=a.getContext("webgl")||a.getContext("experimental-webgl")}catch(c){}b||(b=null);return b}},ig={getWidth:function(a){return a.naturalWidth||a.width},getHeight:function(a){return a.naturalHeight||a.height}},Y5=function(){function a(a,b){return function(){a.apply(b,arguments)}}function b(a){var b=
this;null===this._state?this._deferreds.push(a):k(function(){var c=b._state?a.onFulfilled:a.onRejected;if(null===c)(b._state?a.resolve:a.reject)(b._value);else{var d;try{d=c(b._value)}catch(e){a.reject(e);return}a.resolve(d)}})}function c(b){try{if(b===this)throw new TypeError("A promise cannot be resolved with itself.");if(b&&("object"===typeof b||"function"===typeof b)){var g=b.then;if("function"===typeof g){f(a(g,b),a(c,this),a(d,this));return}}this._state=!0;this._value=b;e.call(this)}catch(h){d.call(this,
h)}}function d(a){this._state=!1;this._value=a;e.call(this)}function e(){for(var a=0,c=this._deferreds.length;a<c;a++)b.call(this,this._deferreds[a]);this._deferreds=null}function g(a,b,c,d){this.onFulfilled="function"===typeof a?a:null;this.onRejected="function"===typeof b?b:null;this.resolve=c;this.reject=d}function f(a,b,c){var d=!1;try{a(function(a){d||(d=!0,b(a))},function(a){d||(d=!0,c(a))})}catch(e){d||(d=!0,c(e))}}var h=function(b){if("object"!==typeof this)throw new TypeError("Promises must be constructed via new");
if("function"!==typeof b)throw new TypeError("not a function");this._value=this._state=null;this._deferreds=[];f(b,a(c,this),a(d,this))},k=h.immediateFn||"function"===typeof setImmediate&&setImmediate||function(a){setTimeout(a,1)},m=Array.isArray||function(a){return"[object Array]"===Object.prototype.toString.call(a)};h.prototype["catch"]=function(a){return this.then(null,a)};h.prototype.then=function(a,c){var d=this;return new h(function(e,f){b.call(d,new g(a,c,e,f))})};h.all=function(){var a=Array.prototype.slice.call(1===
arguments.length&&m(arguments[0])?arguments[0]:arguments);return new h(function(b,c){function d(g,f){try{if(f&&("object"===typeof f||"function"===typeof f)){var l=f.then;if("function"===typeof l){l.call(f,function(a){d(g,a)},c);return}}a[g]=f;0===--e&&b(a)}catch(h){c(h)}}if(0===a.length)return b([]);for(var e=a.length,g=0;g<a.length;g++)d(g,a[g])})};h.resolve=function(a){return a&&"object"===typeof a&&a.constructor===h?a:new h(function(b){b(a)})};h.reject=function(a){return new h(function(b,c){c(a)})};
h.race=function(a){return new h(function(b,c){for(var d=0,e=a.length;d<e;d++)a[d].then(b,c)})};return h},Ud=window.Promise?window.Promise:Y5(),Xj={atob:function(a){return Ub.getOrDie("atob")(a)},requestAnimationFrame:function(a){Ub.getOrDie("requestAnimationFrame")(a)}},yc={blobToImage:Ev,imageToBlob:function(a){a=a.src;return 0===a.indexOf("data:")?no(a):Fv(a)},blobToArrayBuffer:function(a){return new Ud(function(b){var c=new mo;c.onloadend=function(){b(c.result)};c.readAsArrayBuffer(a)})},blobToDataUri:Hv,
blobToBase64:function(a){return Hv(a).then(function(a){return a.split(",")[1]})},dataUriToBlobSync:Gv,canvasToBlob:function(a,b,c){b=b||"image/png";return HTMLCanvasElement.prototype.toBlob?new Ud(function(d){a.toBlob(function(a){d(a)},b,c)}):no(a.toDataURL(b,c))},canvasToDataURL:function(a,b,c){b=b||"image/png";return a.then(function(a){return a.toDataURL(b,c)})},blobToCanvas:function(a){return Ev(a).then(function(a){URL.revokeObjectURL(a.src);var c;c=bc.create(ig.getWidth(a),ig.getHeight(a));bc.get2dContext(c).drawImage(a,
0,0);return c})},uriToBlob:function(a){return 0===a.indexOf("blob:")?Fv(a):0===a.indexOf("data:")?no(a):null}},Th={blobToImage:function(a){return yc.blobToImage(a)},imageToBlob:function(a){return yc.imageToBlob(a)},blobToDataUri:function(a){return yc.blobToDataUri(a)},blobToBase64:function(a){return yc.blobToBase64(a)},dataUriToBlobSync:function(a){return yc.dataUriToBlobSync(a)},uriToBlob:function(a){return h.from(yc.uriToBlob(a))}},rd={fromBlob:Iv,fromCanvas:function(a,b){return yc.canvasToBlob(a,
b).then(function(b){return oo(Ud.resolve(a),b,a.toDataURL())})},fromImage:function(a){return yc.imageToBlob(a).then(function(a){return Iv(a)})},fromBlobAndUrlSync:function(a,b){return oo(yc.blobToCanvas(a),a,b)}},wH=function(a){return a.toBlob()},qc={blobToImageResult:function(a){return rd.fromBlob(a)},fromBlobAndUrlSync:function(a,b){return rd.fromBlobAndUrlSync(a,b)},imageToImageResult:function(a){return rd.fromImage(a)},imageResultToBlob:function(a,b,c){return void 0===b&&void 0===c?wH(a):a.toAdjustedBlob(b,
c)},imageResultToOriginalBlob:wH,imageResultToDataURL:function(a){return a.toDataURL()}},Ne={createObjectURL:function(a){return Ub.getOrDie("URL").createObjectURL(a)},revokeObjectURL:function(a){Ub.getOrDie("URL").revokeObjectURL(a)}},$i=Y.detect(),yH=function(a){var b=Ne.createObjectURL(a);return xH(a,b)},xH=function(a,b){return va.nu(function(c){Th.blobToDataUri(a).then(function(d){d=qc.fromBlobAndUrlSync(a,d);var e=Ma.generate("image");d=kc.blob(e,d,b);c(d)})})},Z5=function(a){return 1===a.length&&
k.contains(a,"Files")},$5=function(a){return!k.contains(a,"text/_moz_htmlcontext")},a6=function(a){return k.contains(a,"Files")},b6=function(a){return!0},qd={multiple:function(a){return 0===a.length?va.pure([]):Ic.mapM(a,yH)},toFiles:function(a){return a.raw().target.files||a.raw().dataTransfer.files},isFiles:$i.browser.isChrome()||$i.browser.isSafari()||$i.browser.isOpera()?a6:$i.browser.isFirefox()?$5:$i.browser.isIE()?Z5:b6,fromImages:function(a){a=k.map(a,function(a){var c=Ma.generate("image");
return kc.url(c,m.get(a,"src"),a)});return va.pure(a)},single:yH,singleWithUrl:xH},Dw={register:function(a,b,c){var d=D.create({dragover:r(["original"]),dragleave:r(["original"]),drop:r(["original"]),dragndropimages:r(["original","files"]),dragndrophtml:r(["original"])});b.each(function(b){var c=function(c){return function(){c(a,b)}};d.registry.dragover.bind(c(n.add));d.registry.dragleave.bind(c(n.remove));d.registry.drop.bind(c(n.remove))});var e=E.bind(a,"dragover",function(a){!0===c?(a.prevent(),
d.trigger.dragover(a)):a.kill()}),g=E.bind(a,"dragleave",d.trigger.dragleave),f=E.bind(a,"drop",function(a){d.trigger.drop(a);a.kill();if(qd.isFiles(a.raw().dataTransfer.types)){var b=qd.toFiles(a);d.trigger.dragndropimages(a,b)}else k.contains(a.raw().dataTransfer.types,"text/html")&&d.trigger.dragndrophtml(a)});return{destroy:function(){e.unbind();g.unbind();f.unbind()},events:d.registry}}},UP={forImages:function(a,b,c){a=Dw.register(a,b,c);var d=D.create({dragover:r(["original"]),dragleave:r(["original"]),
drop:r(["original"]),dragndropimages:r(["assets","x","y"]),dragndrophtml:r(["html","x","y"])});b=function(a,b){a.bind(function(a){b(a.original())})};a.events.dragndropimages.bind(function(a){var b=a.original();qd.multiple(a.files()).get(function(a){d.trigger.dragndropimages(a,b.x(),b.y())})});a.events.dragndrophtml.bind(function(a){a=a.original();var b=a.raw().dataTransfer.getData("text/html");d.trigger.dragndrophtml(b,a.x(),a.y())});b(a.events.dragover,d.trigger.dragover);b(a.events.dragleave,d.trigger.dragleave);
b(a.events.drop,d.trigger.drop);return{destroy:a.destroy,events:d.registry}}},c6=f.compose(va.pure,H.value),d6=f.compose(va.pure,H.error),Vd={pure:c6,failed:d6,foldSync:function(a,b,c){return a.map(function(a){return a.fold(b,c)})},bindSync:function(a,b){return a.map(function(a){return a.bind(b)})},bindAsync:function(a,b){return a.bind(function(a){return a.bind(b)})},mapSync:function(a,b){return a.map(function(a){return a.map(b)})},handle:function(a,b,c){return a.get(function(a){return a.fold(b,c)})}},
Gh={now:function(){return(new Date).getTime()}},VP=36E5,zH=la.generate([{strict:[]},{defaultedThunk:["fallbackThunk"]},{asOption:[]},{asDefaultedOptionThunk:["fallbackThunk"]},{mergeWithThunk:["baseThunk"]}]),Gm=zH.strict,Hm=la.generate([{bothErrors:["error1","error2"]},{firstError:["error1","value2"]},{secondError:["value1","error2"]},{bothValues:["value1","value2"]}]),AH={partition:function(a){var b=[],c=[];k.each(a,function(a){a.fold(function(a){b.push(a)},function(a){c.push(a)})});return{errors:b,
values:c}},compare:function(a,b){return a.fold(function(a){return b.fold(function(b){return Hm.bothErrors(a,b)},function(b){return Hm.firstError(a,b)})},function(a){return b.fold(function(b){return Hm.secondError(a,b)},function(b){return Hm.bothValues(a,b)})})}},BH=function(a){return f.compose(H.error,k.flatten)(a)},CH={consolidateObj:function(a,b){var c=AH.partition(a);return 0<c.errors.length?BH(c.errors):H.value(Z.deepMerge.apply(void 0,[b].concat(c.values)))},consolidateArr:function(a){a=AH.partition(a);
return 0<a.errors.length?BH(a.errors):H.value(a.values)}},yT=function(a,b){var c={};k.each(a,function(a){c[a[b]]=a});return c},e6=function(a){return function(b){return b.hasOwnProperty(a)?h.from(b[a]):h.none()}},aj=function(a,b){return e6(b)(a)},bj=function(a,b){var c={};c[a]=b;return c},Ds=la.generate([{setOf:["validator","valueType"]},{arrOf:["valueType"]},{objOf:["fields"]},{itemOf:["validator"]},{choiceOf:["key","branches"]},{thunk:["description"]},{func:["args","outputSchema"]}]),DH=la.generate([{field:["name",
"presence","type"]},{state:["name"]}]),Vc={parse:function(a){return Ub.getOrDie("JSON").parse(a)},stringify:function(a,b,c){return Ub.getOrDie("JSON").stringify(a,b,c)}},EH=function(a){return Q.isObject(a)&&100<W.keys(a).length?" removed due to size":Vc.stringify(a,null,2)},f6=function(a){a=10<a.length?a.slice(0,10).concat([{path:[],getErrorInfo:function(){return"... (only showing first ten failures)"}}]):a;return k.map(a,function(a){return"Failed path: ("+a.path.join(" > ")+")\n"+a.getErrorInfo()})},
FH=function(a,b){return H.error([{path:a,getErrorInfo:b}])},g6=function(a,b,c){return FH(a,function(){return'Could not find valid *strict* value for "'+b+'" in '+EH(c)})},h6=function(a,b){return FH(a,function(){return b})},i6=la.generate([{field:["key","okey","presence","prop"]},{state:["okey","instantiator"]}]),j6=function(a,b,c){return aj(b,c).fold(function(){return g6(a,c,b)},H.value)},GH=function(a,b,c){b=aj(a,b).fold(function(){return c(a)},f.identity);return H.value(b)},k6=function(a,b,c){b=
aj(a,b).map(function(b){return!0===b?c(a):b});return H.value(b)},l6=function(a,b,c,d){return c.fold(function(c,g,l,k){var m=function(b){return k.extract(a.concat([c]),d,b).map(function(a){return bj(g,d(a))})},n=function(b){return b.fold(function(){var a=bj(g,d(h.none()));return H.value(a)},function(b){return k.extract(a.concat([c]),d,b).map(function(a){return bj(g,d(h.some(a)))})})};return function(){return l.fold(function(){return j6(a,b,c).bind(m)},function(a){return GH(b,c,a).bind(m)},function(){return H.value(aj(b,
c)).bind(n)},function(a){return k6(b,c,a).bind(n)},function(a){var d=a(b);return GH(b,c,f.constant({})).map(function(a){return Z.deepMerge(d,a)}).bind(m)})}()},function(a,c){var f=c(b);return H.value(bj(a,d(f)))})},m6=function(a,b,c,d){c=k.map(c,function(c){return l6(a,b,c,d)});return CH.consolidateObj(c,{})},Es=function(a){return{extract:function(b,c,d){return a(d,c).fold(function(a){return h6(b,a)},H.value)},toString:function(){return"val"},toDsl:function(){return Ds.itemOf(a)}}},cf=function(a){return{extract:function(b,
c,d){return m6(b,d,a,c)},toString:function(){return"obj{\n"+k.map(a,function(a){return a.fold(function(a,b,e,g){return a+" -> "+g.toString()},function(a,b){return"state("+a+")"})}).join("\n")+"}"},toDsl:function(){return Ds.objOf(k.map(a,function(a){return a.fold(function(a,b,e,g){return DH.field(a,e,g)},function(a,b){return DH.state(a)})}))}}},HH=f.constant(Es(H.value)),n6=f.compose(function(a){return{extract:function(b,c,d){d=k.map(d,function(d,g){return a.extract(b.concat(["["+g+"]"]),c,d)});return CH.consolidateArr(d)},
toString:function(){return"array("+a.toString()+")"},toDsl:function(){return Ds.arrOf(a)}}},cf),cj=i6.field,o6=Es(H.value),Fs=function(a,b,c,d){return b.extract([a],c,d).fold(function(a){return H.error({input:d,errors:a})},H.value)},IH=function(a,b,c){return Fs(a,b,f.constant,c)},JH=function(a){return a.fold(function(a){throw Error(Gs(a));},f.identity)},Gs=function(a){return"Errors: \n"+f6(a.errors)+"\n\nInput object: "+EH(a.input)};f.constant(o6);var Im=la.generate([{get:[]},{post:[]},{put:[]},{del:[]}]),
Jm={get:Im.get,post:Im.post,put:Im.put,del:Im.del},p6={generate:function(a,b,c,d){a=a.bind(function(a){return a.match({file:function(){return h.none()},form:function(){return h.some("application/x-www-form-urlencoded; charset=UTF-8")},json:function(){return h.some("application/json")},plain:function(){return h.some("text/plain")},html:function(){return h.some("text/html")}})});c=c.match({none:h.none,xhr:f.constant(h.some(!0))});var e=b.match({json:h.none,blob:f.constant(h.some("blob")),xml:f.constant(h.some("document")),
html:f.constant(h.some("document")),text:f.constant(h.some("text"))});b=b.match({json:f.constant("application/json, text/javascript"),blob:f.constant("application/octet-stream"),text:f.constant("text/plain"),html:f.constant("text/html"),xml:f.constant("application/xml, text/xml")})+", */*; q=0.01";return{contentType:f.constant(a),credentials:f.constant(c),responseType:f.constant(e),accept:f.constant(b),headers:f.constant(d)}}},q6={mutate:function(a,b){b.contentType().each(function(b){a.setRequestHeader("Content-Type",
b)});var c=b.accept();a.setRequestHeader("Accept",c);b.credentials().each(function(b){a.withCredentials=b});b.responseType().each(function(b){a.responseType=b});c=b.headers();W.each(c,function(b,c){Q.isString(c)||Q.isString(b)?a.setRequestHeader(c,b):console.error("Request header data was not a string: ",c," -> ",b)})}},KH={parse:function(a){try{var b=Vc.parse(a);return H.value(b)}catch(c){return H.error("Response was not JSON")}}},LH=C.immutableBag(["message","status","responseText"],[]),MH={handle:function(a,
b,c){var d=function(){return va.pure(c.response)};return b.match({json:function(){return KH.parse(c.response).fold(d,va.pure)},blob:function(){return h.from(c.response).map(WP).getOr(va.pure("no response content"))},text:d,html:d,xml:d}).map(function(b){return LH({message:0===c.status?"Unknown HTTP error (possible cross-domain request)":'Could not load url "'+a+'": '+c.statusText,status:c.status,responseText:b})})},nu:LH},r6=Object.assign||function(a){for(var b,c=1,d=arguments.length;c<d;c++){b=arguments[c];
for(var e in b)Object.prototype.hasOwnProperty.call(b,e)&&(a[e]=b[e])}return a},Gd=function(a){return r6({},a,{bindFuture:function(b){return Gd(a.bind(function(c){return c.fold(function(){return a},function(a){return b(a)})}))},bindResult:function(b){return Gd(a.map(function(a){return a.bind(b)}))},mapResult:function(b){return Gd(a.map(function(a){return a.map(b)}))},foldResult:function(b,c){return a.map(function(a){return a.fold(b,c)})},withTimeout:function(b,c){return Gd(va.nu(function(d){var e=
!1,g=window.setTimeout(function(){e=!0;d(H.error(c()))},b);a.get(function(a){e||(window.clearTimeout(g),d(a))})}))}})},NH=function(a){return Gd(va.nu(a))},OH=function(a){return Gd(va.pure(H.value(a)))},dj={nu:NH,wrap:Gd,pure:OH,value:OH,error:function(a){return Gd(va.pure(H.error(a)))},fromResult:function(a){return Gd(va.pure(a))},fromFuture:function(a){return Gd(a.map(H.value))},fromPromise:function(a){return NH(function(b){a.then(function(a){b(H.value(a))},function(a){b(H.error(a))})})}},s6={validate:function(a,
b){var c=function(){return dj.pure(b.response)};return a.match({json:function(){return KH.parse(b.response).fold(function(a){return dj.error(MH.nu({message:a,status:b.status,responseText:b.responseText}))},dj.pure)},blob:c,text:c,html:c,xml:function(a,b){return function(){return b().bindResult(function(b){return null===b?H.error(a):H.value(b)})}}("Invalid XML document",c)})}},Km=function(a,b,c,d,e,g){var l=void 0!==g?g:{};return dj.nu(function(g){var h=b.match({get:f.constant("get"),put:f.constant("put"),
post:f.constant("post"),del:f.constant("delete")}),k=new (Ub.getOrDie("XMLHttpRequest"));k.open(h,a,!0);h=p6.generate(c,d,e,l);q6.mutate(k,h);var m=function(){MH.handle(a,d,k).get(function(a){g(H.error(a))})};k.onload=function(){0!==k.status||aa.startsWith(a,"file:")?100>k.status||400<=k.status?m():s6.validate(d,k).get(g):m()};k.onerror=m;c.fold(function(){k.send()},function(a){a=a.match({file:f.identity,form:f.identity,json:Vc.stringify,plain:f.identity,html:f.identity});k.send(a)})}).toLazy()},
sd={get:function(a,b,c,d){var e=Jm.get();return Km(a,e,h.none(),b,c,d)},post:function(a,b,c,d,e){var g=Jm.post();return Km(a,g,h.some(b),c,d,e)},put:function(a,b,c,d,e){var g=Jm.put();return Km(a,g,h.some(b),c,d,e)},del:function(a,b,c,d){var e=Jm.del();return Km(a,e,h.none(),b,c,d)}},ej=la.generate([{file:["data"]},{form:["data"]},{json:["data"]},{plain:["data"]},{html:["data"]}]),Xx={file:ej.file,form:ej.form,json:ej.json,plain:ej.plain,html:ej.html},PH=la.generate([{none:[]},{xhr:[]}]),jd={none:PH.none,
xhr:PH.xhr},fj=la.generate([{json:[]},{blob:[]},{text:[]},{html:[]},{xml:[]}]),td={json:fj.json,blob:fj.blob,text:fj.text,html:fj.html,xml:fj.xml,cata:function(a,b,c,d,e,g){return a.match({json:b,blob:c,text:d,html:e,xml:g})}},QH=function(a,b){var c=-1===a.indexOf("?")?"?":"&";return b?a+c+"apiKey="+encodeURIComponent(b):a},RH=function(a){return a.hasOwnProperty("tiny-api-key")?a["tiny-api-key"]:a.hasOwnProperty("tinymce-api-key")?a["tinymce-api-key"]:a["textbox-api-key"]},SH=function(a){return a.fold(function(a){var c=
a.responseText();a=Q.isObject(c)?c:a.message();return H.error(a)},H.value)},Zj={get:function(a,b,c,d){var e=RH(d);return{execute:function(g){g=JH(Fs(a+".ajax.service.get",b,f.identity,g));g=W.map(g,function(a){return Q.isBoolean(a)?String(a):a});g=QH(aa.supplant(c,g),e);return sd.get(g,td.json(),jd.xhr(),d).map(SH)}}},post:function(a,b,c,d){var e=RH(d);return{execute:function(g){g=JH(Fs(a+".ajax.service.post",b,f.identity,g));return sd.post(QH(c,e),Xx.json(g),td.json(),jd.xhr(),d).map(SH)}}}},t6=
{partition:function(a,b,c,d,e){return!0===e?{known:{},unknown:c}:k.foldl(c,function(c,e){var f=d(e);return a(b,f).fold(function(){return{known:c.known,unknown:c.unknown.concat([e])}},function(a){a=bj(f,a);return{known:Z.merge(c.known,a),unknown:c.unknown}})},{known:{},unknown:[]})}},u6=function(a,b,c,d,e,g,f){a=a(d,f);return Vd.mapSync(a,function(a){a=e(a);W.each(a,function(a,c){b.set(c,a,g)});return Z.deepMerge(c,a)})},ak={single:function(a,b,c,d,e){return(!0===e?h.none():b.get(d,c)).fold(function(){return a(c,
e).map(function(a){return a.map(function(a){b.set(c,a,d);return a})})},function(a){return Vd.pure(a)})},multiple:function(a,b,c,d,e,g,f){c=t6.partition(b.get,g,c,e,f);return 0===c.unknown.length?Vd.pure(c.known):u6(a,b,c.known,c.unknown,d,g,f)}},se=function(a){return cj(a,a,Gm(),HH())},TH=function(a,b){return cj(a,a,zH.defaultedThunk(f.constant(b)),HH())},Lm=function(a){return"["+a.join(", ")+"]"},UH=["iframely","oembed","fallback"],Mm=function(a,b,c){return k.exists(b,function(b){return k.contains(a,
b)})?H.error("Embed response source: "+Lm(a)+" contains more than one of "+Lm(UH)):H.value(c)},v6={iframely:f.constant("iframely"),oembed:f.constant("oembed"),fallback:f.constant("fallback"),identify:function(a){return k.contains(a,"iframely")?Mm(a,["oembed","fallback","wikipedia"],"iframely"):k.contains(a,"oembed")?Mm(a,["iframely","fallback","wikipedia"],"oembed"):k.contains(a,"fallback")?Mm(a,["iframely","oembed","wikipedia"],"fallback"):k.contains(a,"wikipedia")?Mm(a,["iframely","oembed","fallback"],
"wikipedia"):H.error("Embed response source: "+Lm(a)+" did not contain any of: "+Lm(UH))}},w6=cf([se("url"),se("maxWidth"),TH("fresh",!1)]),x6=cf([se("status_code"),se("sub_code"),se("msg")]),y6=cf([se("html"),function(a,b){return cj(a,a,Gm(),cf(b))}("rels",[cj("source","source",Gm(),function(a){return Es(function(b){return a(b)})}(function(a){return Q.isArray(a)?v6.identify(a):H.error("Sources was not an array: "+a)}))])]),po={requestOne:f.constant(w6),responseFailed:f.constant(x6),responseSucceeded:f.constant(y6)},
Jv={failed:function(a){return IH("EmbedResponse.failure",po.responseFailed(),a).fold(function(a){return H.error({code:f.constant(600),subcode:f.constant(0),msg:f.constant(Gs(a))})},function(a){return H.error({code:a.status_code,subcode:a.sub_code,msg:a.msg})})},success:function(a){return IH("EmbedResponse.success",po.responseSucceeded(),a).fold(function(a){return H.error({code:f.constant(601),subcode:f.constant(0),msg:f.constant(Gs(a))})},function(a){return H.value({recommended:f.constant({html:a.html,
source:a.rels().source})})})}},te=w.resolve("embed-checking"),qo={configure:function(a){a.add(a.input(),te,Ca.removeClass(te));a.add(a.output(),te,Ca.removeClass(te));a.add(a.history(),te,Ca.removeClass(te));a.add(a.internal(),te,Ca.removeClass(te))},embedChecking:f.constant(te)},Hs=function(){return u.translate("link.anchor.top")},Is=function(){return u.translate("link.anchor.bottom")},VH=function(){var a={};a[Hs().toLowerCase()]="top";a[Is().toLowerCase()]="bottom";return a},Wa={bookmarkDataAttr:f.constant("data-textbox-bookmark"),
bookmarkAnchorDataAttr:f.constant("data-textbox-bookmark-anchor"),bookmarkBookmarkDataAttr:f.constant("data-textbox-user-bookmark"),topAnchorUrl:Hs,bottomAnchorUrl:Is,top:f.constant("top"),bottom:f.constant("bottom"),reservedUrls:VH,isReservedUrl:function(a){return VH().hasOwnProperty(a.toLowerCase())},getReservedUrl:function(a){var b={};b.top=Hs();b.bottom=Is();return b[a.toLowerCase()]}},z6={setCss:function(a,b,c){a.dom().styleSheet?a.dom().styleSheet.cssText=b:v.append(a,c)}},A6={escape:function(a){return a.replace(/[-[\]{}()*+?.,\\^$|#\s]/g,
"\\$&")}},WH=function(a,b,c){b=RegExp("url\\(\\s*['\"]?"+A6.escape(b)+"(.*?)['\"]?\\s*\\)","g");return a.replace(b,'url("'+c+'$1")')},B6={replace:WH,replaceMany:function(a,b){var c=a;W.each(b,function(a,b){console.log("rm css",c);c=WH(c,b,a)});return c}},XH={stylesheets:function(a){a=a.dom().styleSheets;return Array.prototype.slice.call(a)},inject:function(a,b,c){var d=q.fromTag("style",c.dom());m.set(d,"type","text/css");a=void 0===b?a:B6.replaceMany(a,b);z6.setCss(d,a,q.fromText(a,c.dom()));c=I.descendant(c,
"head").getOrDie();v.append(c,d)}},C6=C.immutable("selector","style","raw"),Js=function(a){return k.bind(a.cssRules,function(a){if(a.type===CSSRule.IMPORT_RULE)return Js(a.styleSheet);if(a.type===CSSRule.STYLE_RULE){var c=a.selectorText,d=a.style.cssText;if(void 0===d)throw"WARNING: Browser does not support cssText property";return[C6(c,d,a.style)]}return[]})},YH={extract:Js,extractAll:function(a){return k.bind(a,Js)}},ZH={},$H={exports:ZH};(function(a,b,c,d){(function(d){"object"===typeof b&&"undefined"!==
typeof c?c.exports=d():"function"===typeof a&&a.amd?a([],d):("undefined"!==typeof window?window:"undefined"!==typeof global?global:"undefined"!==typeof self?self:this).EphoxContactWrapper=d()})(function(){return function g(a,b,c){function f(k,m){if(!b[k]){if(!a[k]){var n="function"==typeof d&&d;if(!m&&n)return n(k,!0);if(h)return h(k,!0);n=Error("Cannot find module '"+k+"'");throw n.code="MODULE_NOT_FOUND",n;}n=b[k]={exports:{}};a[k][0].call(n.exports,function(b){var c=a[k][1][b];return f(c?c:b)},
n,n.exports,g,a,b,c)}return b[k].exports}for(var h="function"==typeof d&&d,k=0;k<c.length;k++)f(c[k]);return f}({1:[function(a,b,c){a=function(){var a;a=function(a){var b=a,c,d={a:0,b:0,c:0},g=[];c=function(c,f){var l,h,k,p,m,s;if(c.test(b))for(l=b.match(c),h=0,k=l.length;h<k;h+=1)d[f]+=1,p=l[h],m=b.indexOf(p),s=p.length,g.push({selector:a.substr(m,s),type:f,index:m,length:s}),b=b.replace(p,Array(s+1).join(" "))};(function(){var a=function(a){var c,d,g;if(a.test(b))for(a=b.match(a),c=0,d=a.length;c<
d;c+=1)g=a[c],b=b.replace(g,Array(g.length+1).join("A"))};a(/\\[0-9A-Fa-f]{6}\s?/g);a(/\\[0-9A-Fa-f]{1,5}\s/g);a(/\\./g)})();(function(){var a=/:not\(([^\)]*)\)/g;a.test(b)&&(b=b.replace(a,"     $1 "))})();(function(){var a=/{[^]*/gm,c,d,g;if(a.test(b))for(a=b.match(a),c=0,d=a.length;c<d;c+=1)g=a[c],b=b.replace(g,Array(g.length+1).join(" "))})();c(/(\[[^\]]+\])/g,"b");c(/(#[^\#\s\+>~\.\[:]+)/g,"a");c(/(\.[^\s\+>~\.\[:]+)/g,"b");c(/(::[^\s\+>~\.\[:]+|:first-line|:first-letter|:before|:after)/gi,"c");
c(/(:[\w-]+\([^\)]*\))/gi,"b");c(/(:[^\s\+>~\.\[:]+)/g,"b");b=b.replace(/[\*\s\+>~]/g," ");b=b.replace(/[#\.]/g," ");c(/([^\s\+>~\.\[:]+)/g,"c");g.sort(function(a,b){return a.index-b.index});return{selector:a,specificity:"0,"+d.a.toString()+","+d.b.toString()+","+d.c.toString(),specificityArray:[0,d.a,d.b,d.c],parts:g}};return{calculate:function(b){var c,d,g,f=[];b=b.split(",");d=0;for(g=b.length;d<g;d+=1)c=b[d],0<c.length&&f.push(a(c));return f},compare:function(b,c){var d,g,f;if("string"===typeof b){if(-1!==
b.indexOf(","))throw"Invalid CSS selector";d=a(b).specificityArray}else if(Array.isArray(b)){if(4!==b.filter(function(a){return"number"===typeof a}).length)throw"Invalid specificity array";d=b}else throw"Invalid CSS selector or specificity array";if("string"===typeof c){if(-1!==c.indexOf(","))throw"Invalid CSS selector";g=a(c).specificityArray}else if(Array.isArray(c)){if(4!==c.filter(function(a){return"number"===typeof a}).length)throw"Invalid specificity array";g=c}else throw"Invalid CSS selector or specificity array";
for(f=0;4>f;f+=1){if(d[f]<g[f])return-1;if(d[f]>g[f])return 1}return 0}}}();"undefined"!==typeof c&&(c.calculate=a.calculate,c.compare=a.compare)},{}],2:[function(a,b,c){a=a("specificity");b.exports={boltExport:a}},{specificity:1}]},{},[2])(2)})})(void 0,ZH,$H,void 0);var D6=$H.exports.boltExport,aI=C.immutable("selector","raw"),E6=function(a,b){var c={};k.each(a,function(d){if(void 0!==a[d]){var e=b.dom().style;k.contains(e,d)||(c[d]=a[d])}});return c},F6=function(a,b){var c=k.bind(b,function(b){var c=
X.descendants(a,b.selector());k.each(c,function(a){var c=E6(b.raw(),a);t.setAll(a,c)});return c});k.each(c,function(a){m.remove(a,"class")})},bI=function(a,b){var c=function(a){return-1!==a.selector().indexOf(",")},d=k.bind(k.filter(a,c),function(a){var b=a.selector().split(",");return k.map(b,function(b){b=b.trim();return aI(b,a.raw())})}),d=k.filter(a,function(a){return!c(a)}).concat(d);d.sort(function(a,b){return D6.compare(a.selector(),b.selector())}).reverse();F6(b,d)},cI={inlineStyles:function(a,
b,c){a=XH.stylesheets(a);a=YH.extractAll(a).map(function(a){var b=a.selector(),b=c.hasOwnProperty(b)?c[b]:b;return aI(b,a.raw())});bI(a,b)},inlinePrefixedStyles:function(a,b,c){a=XH.stylesheets(a);a=YH.extractAll(a);a=k.filter(a,function(a){return aa.startsWith(a.selector(),c)});bI(a,b)}},Kv={inlineStyles:function(a,b,c){cI.inlineStyles(a,b,c)},inlinePrefixedStyles:function(a,b,c){cI.inlinePrefixedStyles(a,b,c)}},gk={handle:function(a,b){return E.bind(a,"click",b)}},G6={editor:function(a,b){var c=
f.curry(u.translate,b?"aria.label.fullscreen":"aria.label.editor");return a.fold(f.identity,c)}},H6=function(a,b){var c=setInterval(b,500);return function(){clearInterval(c)}},I6=function(a,b){var c=new window.MutationObserver(b);c.observe(y.owner(a).dom(),{attributes:!0,subtree:!0,childList:!0,attributeFilter:["style","class"]});return function(){c.disconnect()}},J6=void 0!==window.MutationObserver&&null!==window.MutationObserver?I6:H6,Wv={onShow:function(a,b){if(Sb.isVisible(a))return Xj.requestAnimationFrame(b),
f.noop;var c=oc.adaptable(function(){Sb.isVisible(a)&&(d(),Xj.requestAnimationFrame(b))},100),d=J6(a,c.throttle);return d}},gj=[],Ks=function(a){return k.findIndex(gj,function(b){return L.eq(b.element,a)}).getOr(-1)},Ls={begin:function(a,b){if(-1===Ks(a)){var c=b();gj.push({element:a,unbind:c})}},query:function(a){a=Ks(a);return-1===a?h.none():h.some(gj[a])},end:function(a){a=Ks(a);if(-1!==a){var b=gj[a];gj.splice(a,1);b.unbind()}}},K6=function(a){return{element:a,handlers:[],lastWidth:ra.get(a),
lastHeight:ha.get(a)}},ue=[],dI=function(a){return k.findIndex(ue,function(b){return L.eq(b.element,a)}).getOr(-1)},eI=function(a){var b=ra.get(a.element),c=ha.get(a.element);if(b!==a.lastWidth||c!==a.lastHeight)a.lastWidth=b,a.lastHeight=c,k.each(a.handlers,f.apply)},fI=function(a){var b=a.element;Sb.isVisible(b)?eI(a):Ls.begin(b,function(){return Wv.onShow(b,function(){Ls.end(b);eI(a)})})},Ms=!1,L6=function(){Ms=!1;k.each(ue,fI)},M6=function(){Ms||(Ms=!0,Xj.requestAnimationFrame(L6))},Nm=h.none(),
N6=function(){Nm.each(function(a){a.unbind();Nm=h.none()})},Mv={bind:function(a,b){var c=k.find(ue,function(b){return L.eq(b.element,a)}).getOr(void 0);void 0===c&&(c=K6(a),ue.push(c));c.handlers.push(b);Nm.isNone()&&(Nm=h.some(E.bind(q.fromDom(window),"resize",M6)));setTimeout(function(){-1!==dI(c.element)&&fI(c)},100)},unbind:function(a,b){Ls.end(a);var c=dI(a);if(-1!==c){var d=k.indexOf(ue[c].handlers,b);d.isNone()||(ue[c].handlers.splice(d.getOr(0),1),0===ue[c].handlers.length&&ue.splice(c,1),
0===ue.length&&N6())}}},Nv=Y.detect(),O6=f.constant(!1),ck=Y.detect(),gI=ck.browser.isIE()||ck.browser.isEdge()?2:5,Pv=la.generate([{above:["element"]},{below:["element"]}]),hI=function(a,b,c){return function(b){b=Ea.forElement(a,b);b=Vb.exactFromRange(b);return Ea.getBounds(a,b).fold(O6,c)}},$P=function(a,b){return hI(a,b,function(a){return b>a.top()+a.height()-gI})},aQ=function(a,b){return hI(a,b,function(a){return b<a.top()+gI})},rb={clearAll:function(a){Ea.clear(a)},get:function(a){return Ea.getExact(a).map(function(a){return Zb(a.start(),
a.soffset(),a.finish(),a.foffset())})},set:function(a,b){Ea.setExact(a,b.startContainer(),b.startOffset(),b.endContainer(),b.endOffset())},setExact:function(a,b,c,d,e){Ea.setExact(a,b,c,d,e)},setRelative:function(a,b,c){Ea.setRelative(a,b,c)},replace:function(a,b){Ea.get(a).each(function(c){Ea.replace(a,c,b)})}},bQ=function(a,b){var c=f.curry(L.eq,ca.body()),d=b.join(", ");return $a.findMap(a,function(a){return sa.ancestor(a,function(a){return qa.is(a,d)},c)}).isSome()},P6=function(a,b){return{toEditor:a,
toOld:f.curry(T.focus,b),isSet:function(){return T.active().exists(function(a){return L.eq(a,b)})}}},iI=function(a,b,c,d){d=d.dom().activeElement;return a()?{toEditor:b,toOld:f.noop,isSet:f.constant(!0)}:void 0===d||null===d?{toEditor:c,toOld:f.noop,isSet:f.constant(!1)}:P6(c,q.fromDom(d))},ro={build:iI,toEditor:function(a,b,c,d){iI(a,b,c,d).toEditor()}},Q6=function(a){return db.closest(a.startContainer(),'[contenteditable="false"]')&&db.closest(a.endContainer(),'[contenteditable="false"]')},Sv={focus:function(a,
b,c){b=b().filter(Q6);b.each(function(b){I.closest(b.endContainer(),'[contenteditable="false"]').each(function(b){rb.setRelative(a.win(),da.after(b),da.after(b))})});a.focus();b.each(function(a){c(a.startContainer(),a.startOffset(),a.endContainer(),a.endOffset())})}},eQ=Y.detect(),R6=C.immutable("doc","href"),gQ=function(){var a=[],b=function(a,b){return function(e){return L.eq(a,e.doc())&&b===e.href()}};return{addLinkIfMissing:function(c,d){k.exists(a,b(c,d))||(a.push(R6(c,d)),Wy.addStylesheet(d,
c))}}}(),Tv=function(){console.log("The previous selection could not be restored. Defaulting to the current selection.")},Ns=Y.detect(),S6=Ns.deviceType.isiOS()?nQ:Ns.deviceType.isAndroid()?lQ:mQ,qQ={get:function(a){return S6(a,Ns)}},T6=function(a){a=a.dom();try{var b=a.contentWindow?a.contentWindow.document:a.contentDocument;return void 0!==b&&null!==b?h.some(q.fromDom(b)):h.none()}catch(c){return console.log("Error reading iframe: ",a),console.log("Error was: "+c),h.none()}},Uv={doc:function(a){return T6(a).fold(function(){return a},
function(a){return a})}},pQ=Y.detect(),sQ={resolve:jb.create("ephox-hare").resolve},Vv={write:function(a,b){if(!ca.inBody(a))throw"Internal error: attempted to write to an iframe that is not in the DOM";var c=Uv.doc(a).dom();c.open("text/html","replace");c.writeln(b);c.close()}},tQ=function(a){var b=a.base.fold(f.constant(""),function(a){return'<base href="'+a+'" />'}),c=a.editorStyles.concat(a.stylesheets),d=k.map(c,function(a){return'<link rel="stylesheet" type="text/css" href="'+a+'" onload="styleLoaded()" onerror="styleLoaded()" />'});
a=0===a.documentStyles.length?"":'<style type="text/css">'+a.documentStyles+"</style>";return"<!doctype html>\n<html>\n  <head>\n    "+b+'\n    <script type="text/javascript">\n      var stillToLoad = '+c.length+";\n      function styleLoaded() {\n        stillToLoad--;\n      }\n    \x3c/script>\n    "+d.join("")+"\n    "+a+'\n  </head>\n  <body contenteditable="true" spellcheck="false"></body>\n</html>'},jI=function(a){var b=h.none(),c=Lc.tap(function(a,b,c){t.trigger.nodeChanged(a,b,c)});a.loaded(function(a){var d=
function(){try{return null!==a.win().window&&void 0!==a.win().window}catch(b){return!1}};if(d()){b=h.some(a);if(Y.detect().browser.isFirefox()){try{a.execCommand("enableObjectResizing",!1,!1)}catch(e){}try{a.execCommand("enableInlineTableEditing",!1,!1)}catch(f){}}a.events.nodeChanged.bind(function(a){c.instance(a.node(),a.offset(),a.prev())});a.events.loiter.bind(function(a){t.trigger.loiter(a.node(),a.offset())});a.events.uiStale.bind(function(){t.trigger.uiStale()});a.events.domChanged.bind(function(){t.trigger.domChanged()});
a.events.interaction.bind(function(){t.trigger.interaction()});a.events.keyup.bind(function(a){t.trigger.keyup(a.original())});a.events.keydown.bind(function(a){t.trigger.keydown(a.original())});a.events.keypress.bind(function(a){t.trigger.keypress(a.original())});a.events.mousedown.bind(function(a){t.trigger.mousedown(a.original())});a.events.mouseup.bind(function(a){t.trigger.mouseup(a.original())});a.events.contextmenu.bind(function(a){t.trigger.contextmenu(a.original())});a.events.cut.bind(function(a){t.trigger.cut(a.original())});
a.events.copy.bind(function(a){t.trigger.copy(a.original())});a.events.paste.bind(function(a){t.trigger.paste(a.original())});a.events.focus.bind(function(a){t.trigger.focus(a.original())});a.events.focusOut.bind(function(a){t.trigger.focusOut(a.original())});a.events.dblclick.bind(function(a){t.trigger.dblclick(a.original())});a.events.selectionchange.bind(function(a){t.trigger.selectionchange(a.original())});a.futures.stylesheetLoad.get(function(a){a.each(function(a){t.trigger.stylesheetLoad(a)})});
a.events.paint.bind(function(){t.trigger.paint()});a.resetContent(g);d()&&(t.trigger.ready(a),t.trigger.loaded(),a.uiChanged())}else a.destroy()});var d=function(){return b.map(function(a){return a.win()})},e=function(){return b.map(function(a){return a.doc()})},g=a.initial(),l=function(){b.each(function(a){a.focus()})},k=function(){return b.bind(function(a){return a.getSelection()})},m=function(a,c,d,e){b.each(function(b){b.setSelection(a,c,d,e)})},n=function(a,c){b.each(function(b){b.setRelativeSelection(a,
c)})},q=function(){var a=arguments;b.each(function(b){b.execCommand.apply(null,a)})},t=D.create({nodeChanged:r(["node","offset","prev"]),loiter:r(["node","offset"]),uiStale:r([]),domChanged:r([]),interaction:r([]),keydown:r(["original"]),keyup:r(["original"]),keypress:r(["original"]),mousedown:r(["original"]),mouseup:r(["original"]),contextmenu:r(["original"]),cut:r(["original"]),copy:r(["original"]),paste:r(["original"]),focus:r(["original"]),focusOut:r(["original"]),dblclick:r(["original"]),selectionchange:r(["original"]),
paint:r([]),ready:r(["api"]),loaded:r([]),stylesheetLoad:r(["sheets"])});return{element:a.element,tabindex:a.tabindex,onCanvas:a.onCanvas,win:d,doc:e,body:function(){return b.map(function(a){return a.body()})},getContent:function(){return b.fold(function(){return g},function(a){return a.getContent()})},setContent:function(a){b.fold(function(){g=a},function(b){b.setContent(a)})},resetContent:function(a){b.fold(function(){g=a},function(b){b.resetContent(a)})},blur:function(){b.each(function(a){a.blur()})},
focus:l,uiChanged:function(){b.each(function(a){a.uiChanged()})},domChanged:function(){b.each(function(a){a.domChanged()})},clearSelection:function(){b.each(function(a){a.clearSelection()})},getSelection:k,setSelection:m,setRelativeSelection:n,backupSelection:function(){b.each(function(a){a.backupSelection()})},replaceSelection:function(a){b.each(function(b){b.replaceSelection(a)})},execCommand:q,lockdown:function(a){var b=c.control.isBlocked();c.control.block();a();b||c.control.unblock()},destroy:function(){a.destroy();
b=h.none()},events:t.registry,background:function(){b.each(function(a){a.background()})},foreground:function(){b.each(function(a){a.foreground()})},on:function(a){return d().bind(function(b){return e().map(function(c){return a({win:f.constant(b),doc:f.constant(c),execCommand:q,getSelection:k,setSelection:m,setRelativeSelection:n,focus:l})})})},translateScreen:function(a,c){return b.fold(function(){return Ba(a,c)},function(b){return b.translateScreen(a,c)})},translateLocation:function(a,c){return b.fold(function(){return Ba(a,
c)},function(b){return b.translateLocation(a,c)})},placeholder:a.placeholder,isInline:a.isInline}},kI={frame:function(a,b){var c=uQ(a,b);return jI(c)},detached:function(a,b,c){a=fQ(a,b,c);return jI(a)}},lI=Y.detect(),mI=lI.browser,U6=!(mI.isEdge()&&16>mI.version.major||lI.deviceType.isiOS()),V6=function(a,b){if(U6&&void 0!==a&&Q.isFunction(a.setData))try{return W.each(b,function(b,c){a.setData(c,b())}),!0}catch(c){return!1}else return!1},W6=function(a,b,c){var d=q.fromTag("div",a.doc().dom());t.setAll(d,
{position:"absolute",top:"-1000px"});b=b["text/html"]();ua.set(d,b);v.append(a.body(),d);var e=a.getSelection();Ea.setToElement(a.win(),d);setTimeout(function(){B.remove(d);e.each(function(b){a.setSelection(b.startContainer(),b.startOffset(),b.endContainer(),b.endOffset())});setTimeout(c,0)},0)},X6=function(a){return function(b,c,d){var e=b.raw();if(!Q.isString(e.type)||"copy"!==e.type.toLowerCase()&&"cut"!==e.type.toLowerCase())throw"Can only set the clipboard with a cut or copy event";if(!Q.isFunction(c["text/html"]))throw"Must provide at least text/html data function when setting clipboard contents";
V6(e.clipboardData,c)?(b.kill(),setTimeout(d,0)):a(c,d)}},Y6=Eb.exactly(["doc","win","body","getSelection","setSelection"]),Os={register:function(a){Y6(a);a=f.curry(W6,a);return{setClipboard:X6(a)}},textMime:f.constant("text/plain"),htmlMime:f.constant("text/html")},Ps=yu(A.isComment,"comment"),nI={get:function(a){return Ps.get(a)},getOption:function(a){return Ps.getOption(a)},set:function(a,b){Ps.set(a,b)}},Zh={intraFlag:f.constant({findClipboardTags:function(a){a=$a.cat(k.map(a,function(a){if(A.isComment(a)){var c=
nI.get(a);if(aa.contains(c,"x-textbox/html"))return h.some(a)}return h.none()}));return 0===a.length?h.none():h.some(a)}}),buildClipboardContents:function(a,b){var c={};c[Os.textMime()]=xb.cached(a);c[Os.htmlMime()]=xb.cached(function(){return"\x3c!-- x-textbox/html --\x3e"+b()});return c},ignoreSelectors:f.constant([".ephox-sloth-bin"])},oI=function(a,b){return{editable:f.constant(a),connect:b}},Z6=function(a,b){var c=kI.frame(b,Zh.ignoreSelectors());c.events.ready.bind(function(b){b=b.api().body();
a.updateUi(b)});return oI(c,function(a){v.append(a,c.element())})},$6=function(a,b){0!==b.stylesheets.length&&console.log("You have attempted to declare the following stylesheets for use in textbox.io: ["+b.stylesheets.join(", ")+"]. User stylesheets are not used in inline editing mode and have been ignored.");0!==b.documentStyles.length&&console.log('You have attempted to declare the following document styles for use in textbox.io: "'+b.documentStyles+'". Document styles are not used in inline editing mode and have been ignored.');
b.base.fold(f.noop,function(a){console.log('You have attempted to declare the following content base URL for use in textbox.io: "'+a+'". Content base URL is not used in inline editing mode and has been ignored.')});var c=kI.detached(b.inline,b.editorStyles,Zh.ignoreSelectors());return oI(c,function(a){v.append(a,c.placeholder());a=I.ancestor(a,".ephox-polish-editor-container").getOr(a);t.set(c.placeholder(),"display","none");ea.add(a,[w.resolve("inline-editor-container"),w.resolve("layer-editor")])})},
a7={build:function(a,b){return(void 0!==b.inline?$6:Z6)(a,b)}},b7=Y.detect().browser.isFirefox(),c7=function(a){k.each(a,function(a){y.nextSibling(a).isNone()&&v.after(a,q.fromText(Ua.zeroWidth()))})},d7={configure:function(a){b7&&a.addSelector(a.input(),"a",c7)}},Om=w.resolve("content-eph-wrapper"),Pm=w.resolve("content-eph-extra"),Qm=w.resolve("content-eph-general"),e7=function(a){k.each(a,function(a){n.remove(a,hb.styleSpan());m.remove(a,hb.overrideSpan());m.hasNone(a)?B.unwrap(a):vc.isTransient(a)&&
B.remove(a)})},pI=function(a){k.each(a,function(a){n.remove(a,hb.quasiBlock())})},qI=function(a){k.each(a,function(a){var c=m.get(a,"style");m.set(a,"style",c.replace(/"/g,"'"))})},f7=function(a){return ja.isCursorPosition(a)||fa.isBlock(a)||ja.isCursorPosition(Ka.freefallLtr(a).element())},rI=function(a){k.each(a,function(a){if(0===k.filter(y.children(a),f7).length){var c=q.fromTag("br");v.append(a,c)}})},Rm={configure:function(a){a.add(a.internal(),Om,Ca.unwrap);a.add(a.internal(),Pm,Ca.remove);
a.add(a.internal(),Qm,Ca.remove);a.add(a.internal(),hb.quasiBlock(),pI);a.add(a.output(),Om,Ca.unwrap);a.add(a.output(),Pm,Ca.remove);a.add(a.output(),Qm,Ca.remove);a.add(a.output(),hb.styleSpan(),e7);a.add(a.output(),hb.quasiBlock(),pI);a.addExcludedContext(["."+Om,"."+Pm,"."+Qm,"."+hb.styleSpan()]);a.addSelector(a.input(),"[style]",qI);a.addSelector(a.input(),"td,th,p",rI);a.addSelector(a.paste(),"[style]",qI);a.addSelector(a.paste(),"td,th,p",rI);a.addSelector(a.output(),"strong,b,em,i,u,s,strike,del,sup,sub",
Ca.removeIfEmpty);d7.configure(a)},markerWrapper:f.constant(Om),markerExtra:f.constant(Pm),markerGeneral:f.constant(Qm)},df={resolve:jb.create("ephox-cereal").resolve},Qs=df.resolve("start-cursor"),Rs=df.resolve("finish-cursor"),Ss="data-"+df.resolve("start-offset"),Ts="data-"+df.resolve("finish-offset"),sI=function(a){m.remove(a,Ss);m.remove(a,Ts);ea.remove(a,[Qs,Rs]);""===m.get(a,"class")&&m.remove(a,"class")},tI=function(a,b){var c=m.get(a,b);return parseInt(c,10)},dh={setInfo:function(a,b,c,d){k.each([a,
b],sI);n.add(a,Qs);n.add(b,Rs);m.set(a,Ss,c);m.set(b,Ts,d)},clearInfo:sI,findStart:function(a){return I.descendant(a,"."+Qs).map(function(a){return{token:f.constant(a),offset:f.constant(tI(a,Ss))}})},findFinish:function(a){return I.descendant(a,"."+Rs).map(function(a){return{token:f.constant(a),offset:f.constant(tI(a,Ts))}})}},uI=C.immutable("token","remove","extra"),vI={use:function(a,b){return uI(b,f.noop,[])},extract:function(a){return{remove:f.curry(dh.clearInfo,a),element:f.constant(a)}}},wI=
df.resolve("pre-cursor-token"),xI=df.resolve("post-cursor-token"),yI=df.resolve("first-cursor-token"),Us=function(){var a=q.fromTag("span");t.set(a,"display","none");return a},Vs=function(a){var b=f.curry(B.remove,a);return uI(a,b,[a])},g7=function(a){return n.has(a,wI)?y.nextSibling(a):n.has(a,xI)?y.prevSibling(a):n.has(a,yI)?y.parent(a):h.none()},Uf={pre:function(a,b){var c=Us();v.before(b,c);n.add(c,wI);return Vs(c)},post:function(a,b){var c=Us();v.after(b,c);n.add(c,xI);return Vs(c)},first:function(a,
b){var c=Us();v.prepend(a,c);n.add(c,yI);return Vs(c)},extract:function(a){return g7(a).map(function(b){return{remove:f.curry(B.remove,a),element:f.constant(b)}})}},h7=C.immutable("element","offset"),i7=C.immutable("startContainer","startOffset","endContainer","endOffset"),j7={point:h7,range:i7},Ws=df.resolve("text-node-wrapper"),zI=function(a){return n.has(a,Ws)},ef={create:function(){var a=q.fromTag("span");n.add(a,Ws);return a},findIn:function(a){return X.children(a,"."+Ws)},isWrap:zI,inWrap:function(a){return y.parent(a).fold(f.constant(!1),
function(a){return zI(a)})},child:function(a){return y.child(a,0).fold(function(){var b=q.fromText("");v.append(a,b);return b},f.identity)}},k7=function(a){a=ef.findIn(a);k.each(a,function(a){0===y.children(a).length&&v.before(a,q.fromText(""));B.unwrap(a)})},l7=function(a){y.parent(a).each(B.unwrap)},AI=function(a){(ef.inWrap(a)?l7:k7)(a)},Xs=function(a,b,c,d){return L.eq(a,b)?Uf.first(a,b):A.isElement(b)&&!d(b)?vI.use(a,b):c(a,b)},Ys={extractFrom:function(a,b){a.remove();b.remove();var c=function(a){var b=
ef.isWrap(a)?B.unwrap:AI,c=ef.isWrap(a)?ef.child(a):a;return{target:f.constant(c),unwrap:f.curry(b,a)}},d=c(a.element()),e=c(b.element()),g=j7.range(d.target(),a.offset(),e.target(),b.offset());return{remove:function(){d.unwrap();e.unwrap()},getSelection:function(){return g}}},same:function(a,b,c,d,e){a=Xs(a,b,Uf.pre,e);dh.setInfo(a.token(),a.token(),c,d);return[a]},diff:function(a,b,c,d,e,g){var f=wc.after(b,c,d,e),h=f?Uf.pre:Uf.post;b=Xs(a,b,f?Uf.post:Uf.pre,g);a=Xs(a,d,h,g);dh.setInfo(b.token(),
a.token(),c,e);return[b,a]}},m7=function(a){return y.parent(a).fold(f.constant(!1),function(a){return ef.isWrap(a)})},n7=function(a){return k.foldr(a,function(a,c){if(A.isText(c)&&!m7(c)){var d=ef.create();v.wrap(c,d);return[d].concat(a)}return a},[])},o7=function(a){var b=y.children(a),b=0<b.length?b:[a];return ef.isWrap(a)?[]:n7(b)},p7=function(a){a.remove()},BI={combine:function(a,b){var c=k.bind(a,o7),d=k.bind(b,function(a){return a.extra()});return{extra:f.constant(d),wrappers:f.constant(c),
remove:function(){k.each(b,function(a){dh.clearInfo(a.token())});k.each(a,AI);k.each(b,p7)}}}},q7=function(a,b,c,d,e,g){var f=[b,d];a=Ys.diff(a,b,c,d,e,g);return BI.combine(f,a)},r7=function(a,b,c,d,e,g){d=[b];a=Ys.same(a,b,c,e,g);return BI.combine(d,a)},CI=function(a,b){return b(a).map(function(a){var b=Uf.extract(a.token()).getOrThunk(function(){return vI.extract(a.token())});return{remove:b.remove,offset:a.offset,element:b.element}})},s7=function(a){return CI(a,dh.findStart).bind(function(b){return CI(a,
dh.findFinish).map(function(a){return{startMarker:f.constant(b),finishMarker:f.constant(a)}})})},DI={insertAt:function(a,b,c,d,e,g){return(L.eq(b,d)?r7:q7)(a,b,c,d,e,g)},extract:function(a){return s7(a).map(function(a){return Ys.extractFrom(a.startMarker(),a.finishMarker())})}},EI={insert:function(a,b,c){a=DI.insertAt(a,b.startContainer(),b.startOffset(),b.endContainer(),b.endOffset(),c);return{extra:a.extra,wrappers:a.wrappers,remove:a.remove}},extract:function(a){return DI.extract(a).map(function(a){return{remove:a.remove,
getSelection:a.getSelection}})}},FI=function(a,b){k.each(a,function(a){n.add(a,b)})},t7=function(a){var b=function(){return y.parent(a).map(function(a){return"false"===m.get(a,"contenteditable")}).getOr(!1)};return"false"===m.get(a,"contenteditable")||b()},Sm={extract:function(a){return EI.extract(a)},getSelection:function(a){var b=a.getSelection();a=b.startContainer();var c=b.startOffset(),d=b.endContainer(),b=b.endOffset(),e=ja.getEnd(a),g=ja.getEnd(d);return 0<=c&&c<=e&&0<=b&&b<=g?{start:f.constant(da.on(a,
c)),finish:f.constant(da.on(d,b))}:{start:f.constant(da.before(a)),finish:f.constant(da.before(a))}},remove:function(a){a.remove()},serialise:function(a,b){return Kg.path(a,b.startContainer()).bind(function(c){return Kg.path(a,b.endContainer()).bind(function(d){var e=ac.deep(a);return Kg.follow(e,c).bind(function(a){return Kg.follow(e,d).map(function(c){c={startContainer:f.constant(a),startOffset:f.constant(b.startOffset()),endContainer:f.constant(c),endOffset:f.constant(b.endOffset())};c=EI.insert(e,
c,t7);FI(c.wrappers(),Rm.markerWrapper());FI(c.extra(),Rm.markerExtra());return Zk.writeChildren(e)})})})})}},Tm=C.immutable("word","left","right"),GI=["'","\u2018","\u2019"],u7=k.bind(GI,function(a){return k.map(["twas"],function(b){return a+b})}),v7=function(a){var b=a.word();return Tm(b.substring(1),h.some(b.charAt(0)),a.right())},Um=function(a){return k.contains(GI,a)},w7=function(a){var b=a.word(),c=k.exists(u7,function(a){return-1<b.indexOf(a)})?2:1,d=b.substring(0,c);return k.forall(d,Um)&&
!Um(b.charAt(c))?v7(a):a},HI=function(a){var b=a.word();2<=b.length&&Um(b.charAt(b.length-1))&&!Um(b.charAt(b.length-2))&&(b=a.word(),a=Tm(b.substring(0,b.length-1),a.left(),h.some(b.charAt(b.length-1))));return w7(a)},x7={scope:HI,text:function(a){a=Tm(a,h.none(),h.none());return HI(a).word()}},II={words:function(a){var b=cb.unsafetoken(cb.wordchar()+"+"),b=rm.findall(a,b),c=a.length;return k.map(b,function(b){var e=b.start(),g=b.finish();b=a.substring(e,g);e=0<e?h.some(a.charAt(e-1)):h.none();g=
g<c?h.some(a.charAt(g)):h.none();b=Tm(b,e,g);return x7.scope(b)})}},JI={identify:function(a){return II.words(a)},isWord:function(a,b){return!Ti.hasBreak(b)}},y7=Sa(),z7={identify:function(a){return JI.identify(a)},isWord:function(a){return JI.isWord(y7,a)}},A7=Y.detect(),KI=function(a,b){return A.isText(a)?h.some(S.point(a,b)):0===y.children(a).length?h.none():y.child(a,b).bind(function(a){return KI(a,0)})},B7=function(a,b,c){a.on(function(a){Ec.expandWord(a,b,c)})},C7=function(a,b){var c=a.dom().createRange();
c.setStart(b.startContainer().dom(),b.startOffset());c.setEnd(b.endContainer().dom(),b.endOffset());return z7.isWord(c.cloneContents().textContent)},LI={correct:function(a){a.getSelection().each(function(b){a.doc().each(function(c){C7(c,b)&&KI(b.startContainer(),b.startOffset()).each(function(c){(!b.collapsed()||a.isInline()&&A7.browser.isIE())&&B7(a,c.element(),c.offset())})})})},expand:function(a){a.on(Ec.expand);a.backupSelection()}},MI=function(a,b){return a.bind(function(a){return a.fold(function(){return va.pure(a)},
function(a){return b(a)})})},NI=function(a){return va.pure(H.value(a))},OI=function(a){return va.nu(function(b){a.then(function(a){b(H.value(a))},function(a){b(H.error(a))})})},PI=function(a){return a.map(H.value)},Pa={fromPromise:OI,error:function(a){return va.pure(H.error(a))},map:function(a,b){return a.map(function(a){return a.map(b)})},bind:MI,pure:NI,fromChain:function(a){return function(b){return k.foldl(a,function(a,b){return MI(a,function(a){return b(a)})},NI(b))}},fromFuture:PI,pToFR:function(a){return f.compose(OI,
a)},fToFR:function(a){return f.compose(PI,a)},effect:function(a){return function(b){b.each(function(){a()});return b}}},D7=function(a){return va.nu(function(b){if(!0===a.dom().complete)b(H.value(a));else{var c=to();QI(c,b);c.monitor(a)}})},QI=function(a,b){a.events.success.bind(function(a){b(H.value(a.image()))});a.events.fail.bind(function(a){b(H.error("Unable to download image "+a.url()))})},Vm={load:function(a){return va.nu(function(b){var c=to();QI(c,b);c.go(a)})},loadIfNeeded:function(a){return!0===
a.dom().complete||void 0===m.get(a,"src")?Pa.pure(a):D7(a)}},eh={text:function(a){a=y.children(a);return $k.toText(a)},html:function(a,b){var c=q.fromTag("div");v.append(c,a);return bi.output(b,c)},fragment:function(a,b){if(b.collapsed())return h.none();var c=Vb.exact(b.startContainer(),b.startOffset(),b.endContainer(),b.endOffset()),c=Ea.clone(a,c);return h.some(c)}},RI=Y.detect(),E7=function(a,b,c,d,e){Rm.configure(a);var g=h.none(),l={inline:c.inline,base:h.from(c.base),editorStyles:[c.css+"/content.css"],
stylesheets:c.stylesheets,documentStyles:c.documentStyles,needStyles:c.showDocumentStyles,autoresize:c.autoresize};d=a7.build(d,l);var k=d.editable();null!==c.tabindex&&k.tabindex(c.tabindex);void 0!==e.raw&&k.setContent(e.raw);k.events.ready.bind(function(){if(void 0!==e.raw){var a=k.getContent();e.raw===a&&e.marked!==e.raw&&z(e.marked,!1)}a=k.body().getOrDie();g=h.some(E.bind(a,"dblclick",function(a){LI.correct(k)}))});k.events.ready.bind(function(a){kp.addClasses(a.api().body())});var s=function(){return k.getSelection().bind(function(a){var b=
k.body().getOrDie("content should not return a selection if body is not yet available");return Sm.serialise(b,a)}).getOr(k.getContent())},z=function(a,b){k.body().each(function(c){k.setContent(a);Sm.extract(c).fold(function(){var a=Ka.freefallLtr(c);k.setSelection(a.element(),a.offset(),a.element(),a.offset())},function(a){var b=Sm.getSelection(a);Sm.remove(a);k.setRelativeSelection(b.start(),b.finish())});if(!RI.deviceType.isiOS()){var d=X.descendants(c,"img");b?Ic.mapM(d,Vm.loadIfNeeded).get(function(){C()}):
C()}})},x=D.create({nodeChanged:r(["node","offset","prev"]),undoChanged:r([]),loiter:K(["node","offset"],k.events.loiter),uiStale:K([],k.events.uiStale),domChanged:K([],k.events.domChanged),interaction:K([],k.events.interaction),keydown:K(["original"],k.events.keydown),keyup:K(["original"],k.events.keyup),keypress:K(["original"],k.events.keypress),mousedown:K(["original"],k.events.mousedown),mouseup:K(["original"],k.events.mouseup),contextmenu:K(["original"],k.events.contextmenu),copy:K(["original"],
k.events.copy),paste:K(["original"],k.events.paste),focus:K(["original"],k.events.focus),focusOut:K(["original"],k.events.focusOut),dblclick:K(["original"],k.events.dblclick),selectionchange:K(["original"],k.events.selectionchange),paint:K([],k.events.paint),ready:K(["api"],k.events.ready),loaded:K([],k.events.loaded),stylesheetLoad:K(["sheets"],k.events.stylesheetLoad),background:r([]),foreground:r([]),scrollToCursor:r([]),scrollToElement:r(["element"]),toEditing:r([]),toReading:r([])});k.events.nodeChanged.bind(function(a){x.trigger.nodeChanged(a.node(),
a.offset(),a.prev());a.prev().fold(u,function(b){sa.ancestor(b,fa.isBlock).each(function(b){sa.ancestor(a.node(),fa.isBlock).each(function(a){L.eq(a,b)||u()})})})});var t=Lc.tap(function(){x.trigger.undoChanged()}),u=function(){t.instance()},w=function(a){t.instance();var b=t.control.isBlocked();t.control.block();a=a();b||t.control.unblock();t.instance();return a},C=function(){x.trigger.scrollToCursor()},F=Lc.tap(function(){k.focus()}),l=function(a){return function(){var b=arguments;y.parent(k.element()).fold(function(){a.apply(null,
b)},function(c){var d=c.dom().scrollTop;a.apply(null,b);c.dom().scrollTop=d})}}(k.execCommand),I=function(a){return A.isText(a)&&(RI.browser.isSafari()||0===Fa.get(a).length)||A.isElement(a)&&!fa.isEmptyTag(a)&&!fa.isBlock(a)},H=function(a){var b=q.fromText(Ua.zeroWidth());v.after(a,b);return b},J=function(a,b){var c=y.children(a);if(b>=c.length)return S.point(a,b);var d=c[b];return A.isElement(d)&&!fa.isEmptyTag(d)?J(c[b],0):S.point(a,b)},N=function(a){a=I(a)?H(a):a;k.setRelativeSelection(da.after(a),
da.after(a));k.getSelection().each(function(a){a=J(a.startContainer(),a.startOffset());k.setSelection(a.element(),a.offset(),a.element(),a.offset())})},P=function(){return O.getSelection().bind(function(a){return O.win().bind(function(b){return eh.fragment(b,a)})})},O={onCanvas:k.onCanvas,element:k.element,isInline:k.isInline,win:k.win,doc:k.doc,body:k.body,getContent:k.getContent,setContent:k.setContent,resetContent:k.resetContent,focus:function(){F.instance()},blur:k.blur,uiChanged:k.uiChanged,
domChanged:k.domChanged,undoChanged:u,clearSelection:k.clearSelection,getSelection:k.getSelection,getSelectionStart:function(){return k.getSelection().map(function(a){return a.startContainer()})},setSelection:k.setSelection,setRelativeSelection:k.setRelativeSelection,backupSelection:k.backupSelection,replaceSelection:k.replaceSelection,replaceElement:function(a,b){var c=O.getSelection().filter(function(b){var c=f.curry(L.eq,a);return sa.closest(b.startContainer(),c)||sa.closest(b.endContainer(),c)}).isSome();
v.before(a,b);B.remove(a);c&&N(b);O.domChanged();u()},findTagAtCursor:function(b){var c=function(b,c,d){b=y.child(b,c).getOr(b);return sa.closest(b,function(b){return qa.is(b,d)&&a.includeContext(b)})};return O.getSelection().bind(function(a){return c(a.startContainer(),a.startOffset(),b).orThunk(function(){return c(a.endContainer(),a.endOffset(),b)})})},getFilteredAttributes:function(b){b=ac.shallow(b);var c=q.fromTag("div");v.append(c,b);a.filterDom(a.output(),c);return m.clone(b)},execCommand:l,
insertHtmlAtCursor:function(a){var c=Ld.fromHtml(a);w(function(){xc.insertAtCursorWithInstructions(bf.doNotMerge,O,c).each(function(a){if(0===c.length)k.setSelection(a.element(),a.offset(),a.element(),a.offset());else{var d=a.element();y.parent(d).each(function(a){N(d);b.input(c)})}})})},on:k.on,destroy:function(){g.each(function(a){a.unbind()});k.destroy()},events:x.registry,state:function(){return{raw:k.getContent(),marked:s()}},serialize:s,deserialize:function(a){z(a,!0)},background:function(){k.background();
x.trigger.background()},foreground:function(){k.foreground();x.trigger.foreground()},isRoot:function(a){return k.body().fold(f.constant(!1),function(b){return L.eq(b,a)})},selectWord:function(){LI.expand(k)},cursor:function(){return vQ(k)},activate:function(){F.control.unblock()},deactivate:function(){F.control.block()},cursorIntoView:C,elementIntoView:function(a){x.trigger.scrollToElement(a)},placeholder:k.placeholder,connect:d.connect,translateScreen:k.translateScreen,translateLocation:k.translateLocation,
runOrOnLoaded:function(a){k.body().fold(function(){k.events.ready.bind(function(b){a(b.api().body())})},function(b){a(b)})},getSelectedText:function(){return P().map(eh.text)},getSelectedHtml:function(){return P().map(function(b){return eh.html(b,a)})},getFilteredContents:function(b){return bi.output(a,b)},toEditing:function(){x.trigger.toEditing()},toReading:function(){x.trigger.toReading()},undoOperation:w,markAsEphemeral:function(a){n.add(a,Rm.markerGeneral())},hideInlineSelection:function(){k.isInline()&&
(k.backupSelection(),k.clearSelection())},imageExcludes:c.imageExcludes};return O},F7={get:f.constant({onShortcut:function(a,b){a.bind(b)}})},SI="data-"+w.resolve("context-type"),uo={nu:function(a,b,c){a=ab.item(a,c.value(),c.text());m.set(a,SI,b);m.setAll(a,c.attrs());return a},type:function(a){return m.get(a,SI)}},xQ={derive:function(a,b,c){b=k.map(b,function(b){var e=c[b],g=e.primary(),f=e.submenus();return k.map(g,function(c){var e=uo.nu(a,b,c),g=f.hasOwnProperty(c.value())&&void 0!==f[c.value()]?
[ia.resolve("menu-more")]:[],k=void 0!==f[c.value()];O.menuItem(e,h.some(c.text()),h.some(k));ea.add(e,g);return e})});b=k.filter(b,function(a){return 0<a.length});return k.flatten(sA.intersperseThunk(b,function(){return[ab.separator(a)]}))}},yQ={derive:function(a,b,c){return k.bind(b,function(b){var e=c[b].secondary();return k.map(e,function(c){var e=ab.submenu(a,c.value(),[]);O.menu(e,u.get(c.textkey()));c=k.map(c.items(),function(c){var e=uo.nu(a,b,c);O.menuItem(e,h.some(c.text()),h.none());return e});
J.append(e,c);return e})})}},TI={mainmenu:function(a,b,c,d,e,g){return of.main(a,b,c,d,e,g)},submenu:function(a,b,c,d,e){return of.submenu(a,b,c,d,e)}},yk={makeshift:function(a,b,c,d,e,g,l,h,k){return{recalculate:f.noop,isAnchored:f.constant(!1),place:function(f){var m=b.uiOrigin(),n=a.isInline()?Ba(c,d):Bd.translate(m,c,d),q=Re(n.left(),n.top(),e,g),n=l.isRtl()?mg.allRtl():mg.all(),m=gg.box(q,m);f=f.panel();vk.simple(m,f,h,n,void 0===k?{}:k)}}},mainmenu:function(a,b,c,d){return TI.mainmenu(a.uiContainer,
a.bounds,b,c,d)},submenu:function(a,b,c){return TI.submenu(a.uiContainer,a.bounds,b,c)}},UI=C.immutable("target","x","y"),VI=Y.detect().browser,AQ=function(a,b,c,d,e,g){c=b.doc().getOrDie();var l=wQ(c),p=Ba(0,0);c=F7.get();var m=zk.fromUnsafe(b),n=Qd.menuSystem(e.uiContainer,f.constant("context"),Bh.menu({focusActive:!0})),q=Qd.popup(n.sandbox,e.bounds,a,[],pf.editorContainer());g=P.div();var r=q.initMenu(g),u=function(a){l.update(a.target());var b=D(),c=[n.sandbox()];if(0<b.all.length){var d=a.x(),
e=a.y();p=Ba(d,e);r.setContent(b.main);B(r);r.open();n.open(c,b.main);return h.some(a)}return h.none()},v=function(a){return b.getSelection().bind(function(a){return function(){return ee.selectionContains(a).fold(function(){return A.isText(a.startContainer())?y.parent(a.startContainer()):h.some(a.startContainer())},function(a){return h.some(a)})}().map(function(a){var c=Ja.viewport(a),c=b.translateScreen(c.left(),c.top());return UI(a,c.left(),c.top())})})},w=function(a){var c;c=a.original();c=VI.isIE()&&
10>=VI.version.major?Ba(c.raw().clientX,c.raw().clientY):Ba(c.x(),c.y());c=b.translateScreen(c.left(),c.top());return UI(a.original().target(),c.left(),c.top())},B=function(c){var d;d=ag(14,10);d=yk.makeshift(b,e,p.left(),p.top(),0,0,a.uiDirection(),d);e.show(c,d)},C=function(){r.close();var a=D();k.each(a.all,function(a){t.set(a,"display","none")});m.end()};r.events.close.bind(function(){n.close()});var D=function(){var a=l.all();return{all:a,main:a[0],submenus:a.slice(1)}};b.events.contextmenu.bind(function(a){var b=
w(a);u(b).orThunk(function(){return v().bind(u)}).each(function(b){a.original().raw().preventDefault()})});c.onShortcut(d.events.context,function(){v().each(u)});n.events.open.bind(function(){var a=l.structure(),b=D();n.update(a);q.registerMenus(b.submenus);B(r);n.setActiveMenu(b.main)});n.events.itemAction.bind(function(a){l.handle(a.item())});n.events.itemHover.bind(function(a){m.begin()});n.events.reveal.bind(function(a){ga.expanded(a.trigger());q.expandMenu(a.menu(),a.trigger(),r);B(r)});n.events.collapse.bind(function(a){q.hideMenu(a.menu());
a.item().each(ga.collapsed)});n.events.itemAction.bind(C);n.events.escaped.bind(function(){C();b.focus()});b.events.mousedown.bind(C);return{register:l.register,destroy:function(){r.destroy();n.destroy()}}},Zs={resolve:ll.css("ephox-darwin").resolve},WI=Zs.resolve("selected"),G7="."+WI,XI=Zs.resolve("first-selected"),H7="."+XI,YI=Zs.resolve("last-selected"),I7="."+YI,od={selected:f.constant(WI),selectedSelector:f.constant(G7),firstSelected:f.constant(XI),firstSelectedSelector:f.constant(H7),lastSelected:f.constant(YI),
lastSelectedSelector:f.constant(I7)},CQ=function(a){B.empty(a);v.append(a,q.fromTag("br"))},J7=Y.detect().browser,$s=function(a){var b=q.fromHtml("<p><br></p>");v.append(a,b);return h.some(b)},K7=function(a){var b=y.children(a);return 0===b.length?$s(a):1===b.length&&"br"===A.name(b[0])?(B.empty(a),$s(a)):h.none()},L7=function(a){return 1===a.dom().childNodes.length?y.firstChild(a).fold(f.constant(!1),function(a){return"br"===A.name(a)&&m.has(a,"_moz_editor_bogus_node")}):!1},M7=function(a){return K7(a).orThunk(function(){var b;
J7.isFirefox()&&L7(a)?(B.empty(a),b=$s(a)):b=h.none();return b})},FQ={listen:function(a){a.events.nodeChanged.bind(function(b){b=b.node();a.isRoot(b)&&M7(b).each(function(b){a.setSelection(b,0,b,0)})})}},Xv={onNodeChange:function(a,b){a.events.nodeChanged.bind(function(c){c.prev().each(function(c){vc.withinTransient(c,c).each(function(c){b.atomic(function(){vc.cleanup(a.isRoot,c)})})})});return{destroy:f.noop}},preLinebreak:function(a){a.getSelection().each(function(b){y.parent(b.startContainer()).each(function(b){vc.withinTransient(b,
b).each(function(b){vc.cleanupNonEmpty(a.isRoot,b)})})})}},ff=function(a,b){var c=b.original(),c=c.raw().which||c.raw().keycode;return k.contains(a,c)},N7=f.curry(ff,N.ENTER()),O7=f.curry(ff,N.SPACE()),P7=f.curry(ff,N.BACKSPACE()),Q7=f.curry(ff,N.DEL()),R7=f.curry(ff,N.LEFT().concat(N.UP())),S7=f.curry(ff,N.RIGHT().concat(N.DOWN())),T7=f.curry(ff,N.TAB()),U7=f.curry(ff,N.ESCAPE()),hd={isEnter:N7,isSpace:O7,isBackspace:P7,isDel:Q7,isTab:T7,isLeftOrUp:R7,isRightOrDown:S7,isEscape:U7},ZI=function(a,
b,c,d){return vb.isCollapsed(a)?b(a.startContainer(),a.startOffset(),d):c(a.startContainer(),a.startOffset(),a.endContainer(),a.endOffset(),d)},Yv={soft:function(a,b){return ZI(a,os.soft,rs.soft,b)},hard:function(a,b){return ZI(a,os.hard,rs.hard,b)}},$I=function(a,b){k.each(b,function(b){var d=b.find(a);b.cleaner(d,a)})},dk={filterHtml:function(a,b){var c=q.fromTag("div");c.dom().innerHTML=a;$I(c,b);return Zk.writeChildren(c)},filterDom:$I},aJ=function(a,b){var c=S.point(a,b);return A.isText(a)?Tf.scanRight(a,
b).getOr(c):c},aw={handle:function(a){var b=aJ(a.startContainer(),a.startOffset());a=aJ(a.endContainer(),a.endOffset());return Zb(b.element(),b.offset(),a.element(),a.offset())}},Vf=la.generate([{onText:["element","offset"]},{firstText:["parent","child","offset"]},{beforeText:["parent","child","offset"]},{afterText:["parent","child"," offset"]},{lastText:["parent","child","offset"]},{onElement:["element","offset"]}]),bJ={detect:function(a,b){if(A.isText(a))return Vf.onText(a,b);var c=y.children(a);
return 0===c.length?Vf.onElement(a,b):0===b&&A.isText(c[0])?(0,Vf.firstText)(a,c[0],0):b===c.length&&A.isText(c[c.length-1])?(c=c[b-1],(0,Vf.lastText)(a,c,ja.getEnd(c))):b<c.length&&A.isText(c[b])?(0,Vf.beforeText)(a,c[b],0):0<b&&A.isText(c[b-1])?(c=c[b],(0,Vf.afterText)(a,c,ja.getEnd(c))):Vf.onElement(a,b)},cata:function(a,b,c,d,e,g,f){return a.fold(b,c,d,e,g,f)}},Wf=C.immutable("startContainer","startOffset","endContainer","endOffset"),cJ=jb.create("ephox-newt").resolve("cursor-marker"),hj={generator:function(a){var b=
null;return{getOrInit:function(){var c;null===b?(c=q.fromTag("span",a.dom()),n.add(c,cJ),t.set(c,"display","none")):c=b;return b=c}}},isCursor:function(a){return n.has(a,cJ)}},dJ=function(a,b){return{element:f.constant(b),backup:f.identity,restore:function(){var b=Wf(a,0,a,0);return h.some(b)}}},eJ=function(a){a=y.children(a);return k.filter(a,f.not(hj.isCursor))},V7=function(a,b){return{element:f.constant(b),backup:f.identity,restore:function(){var b=eJ(a).length,b=Wf(a,b,a,b);return h.some(b)}}},
W7=function(a){return y.parent(a).bind(function(b){var c=eJ(b);return k.findIndex(c,function(b){return L.eq(a,b)}).map(function(a){return Wf(b,a,b,a)})})},X7=function(a,b){return{backup:function(){v.before(a,b)},restore:function(){var a=y.nextSibling(b);B.remove(b);return a.map(function(a){return W7(a).getOrThunk(function(){return Wf(a,0,a,0)})})},element:f.constant(b)}},Y7={place:function(a,b,c){var d=y.children(a);return 0===d.length?dJ(a,c):d.length===b?V7(a,c):0===b?dJ(a,c):b>d.length?Zv(c):X7(d[b],
c)}},fJ=function(a,b){return b().fold(function(){return hj.generator(a).getOrInit()},function(a){return a.element()})},Wm=function(a){a=a();a.backup();return h.some(a)},gJ=function(a,b){var c=a.or(b),d=b.or(a);return c.bind(function(a){return d.map(function(b){return Wf(a.startContainer(),a.startOffset(),b.startContainer(),b.startOffset())})})},Z7=function(a,b,c){var d=h.none(),e=h.none();return{backup:function(){e=Wm(b);d=Wm(c)},restore:function(){return d.bind(function(a){return e.bind(function(b){var c=
a.restore();b=b.restore();return gJ(c,b)})})},element:f.curry(fJ,a,function(){return e})}},$7=function(a,b,c){var d=h.none(),e=h.none();return{backup:function(){d=Wm(c);e=Wm(b)},restore:function(){return e.bind(function(a){return d.bind(function(b){var c=a.restore();b=b.restore();return gJ(b,c)})})},element:f.curry(fJ,a,function(){return d})}},a8=function(a,b,c){return{backup:function(){v.before(b,c)},restore:function(){var b=Kb.after(c,a).map(function(a){return Wf(a,0,a,0)});B.remove(c);return b},
element:f.constant(c)}},hJ=function(a,b,c){return{backup:function(){v.after(b,c)},restore:function(){var b=Kb.before(c,a).map(function(a){var b=ja.getEnd(a);return Wf(a,b,a,b)});B.remove(c);return b},element:f.constant(c)}},iJ={place:function(a,b,c,d){b=Pg.split(b,c);return Pg.position(b).fold(function(){return Zv(d)},function(b){return a8(a,b,d)},function(b,c){return hJ(a,b,d)},function(b){return hJ(a,b,d)})}},at=C.immutable("result","cursor"),b8=function(a,b,c){var d=function(b,d,f){return iJ.place(a,
d,f,c)};return bJ.cata(b,function(b,d){return iJ.place(a,b,d,c)},d,d,d,d,function(a,b){return Y7.place(a,b,c)})},bt=function(a,b,c,d){d=d.getOrInit();b=bJ.detect(b,c);return b8(a,b,d)},jJ=function(a,b){a.backup();var c=b(a.element());return at(c,a.restore())},Xm={inspect:bt,runOnRange:function(a,b,c,d,e,g){var f=y.owner(b),h=(wc.after(b,c,d,e)?$7:Z7)(f,function(){return bt(a,d,e,hj.generator(f))},function(){return bt(a,b,c,hj.generator(f))});return jJ(h,g)},runOnCursor:jJ},c8=function(a,b,c,d,e,g){return Xm.runOnRange(a,
b,e>c?c:e,b,e>c?e:c,g)},d8=Xm.runOnRange,kJ={point:function(a,b,c,d){var e=y.owner(b),e=hj.generator(e);a=Xm.inspect(a,b,c,e);return Xm.runOnCursor(a,d)},range:function(a,b,c){return(L.eq(b.startContainer(),b.endContainer())?c8:d8)(a,b.startContainer(),b.startOffset(),b.endContainer(),b.endOffset(),c)}},e8=function(a,b){return function(a,d){var e=d(b);return at(e,h.none())}},f8=function(a,b){return function(c,d){return kJ.point(a,b.startContainer(),b.startOffset(),lJ(c,d))}},g8=function(a,b){return function(c,
d){return kJ.range(a,b,lJ(c,d))}},lJ=function(a,b){return function(c){n.add(c,a);return b(c)}},$v={diagnose:function(a,b){var c=b.startContainer(),d=b.endContainer(),e=y.owner(c);return ca.inBody(c)&&ca.inBody(d)&&T.active(e).forall(ca.inBody)?b.collapsed()?f8(a,b):g8(a,b):e8(a,b.startContainer())}},ct={fold:function(a,b){return k.foldr(a,function(a,d){return a.bind(function(a){return b(d).map(function(b){return[b].concat(a)})})},H.value([]))}},mJ=function(a,b,c){Q.isObject(a)&&b.hasOwnProperty(a.label)&&
c(b[a.label]);return a},nJ={mapGroup:function(a,b){return mJ(a,b,function(b){return a.label=b})},mapMenu:function(a,b){return mJ(a,b,function(b){b.hasOwnProperty("label")&&(a.label=b.label);b.hasOwnProperty("menuLabel")&&(a.menuLabel=b.menuLabel)})}},h8=function(a,b,c){b=b.groups();return b.hasOwnProperty(a)?H.value(b[a]):Wd("Unknown group: "+a,["No binding for group: "+a+". Known groups: "+W.keys(b)])},i8=function(a,b,c){a=nJ.mapGroup(a,c.groupMappings());a=Q.isArray(a)?{label:"",items:a}:a;return H.value(a)},
j8=function(a,b,c,d,e,g){return ct.fold(b,function(a){return e.item(a,c,d,e,g)}).map(function(b){return{category:a,items:b}})},k8=function(a,b,c,d,e){b=b.commands();return b.hasOwnProperty(a)?H.value(b[a]):Wd("Unknown command: "+a,["No binding for command: "+a+". Known commands: "+W.keys(b)])},m8=function(a,b,c,d,e){return(void 0===a.items?l8:d.menu)(a,b,c,d,e)},l8=function(a,b,c,d,e){return void 0===c?Wd("You need a custom action factory to use this",[]):c(a)},n8=function(a){return k.forall(a,Q.isArray)?
H.value(a):k.exists(a,Q.isArray)?Wd("Menu items must be a single array or an array where every element is an array",["Menu items must be a single array or an array where every element is an array.","Contents of menu: "+Vc.stringify(a)]):H.value([a])},oJ=W.map({group:function(a,b,c,d,e){return(Q.isString(a)?h8:i8)(a,b,e).bind(function(a){return j8(a.label,a.items,b,c,d,e)})},item:function(a,b,c,d,e){return(Q.isString(a)?k8:m8)(a,b,c,d,e)},menu:function(a,b,c,d,e){if(void 0===a.label||void 0===a.items||
0===a.items.length)return Wd("Invalid toolbar configuration for menu",["Invalid menu. Must be an object containing label and items.","Contents of menu: "+Vc.stringify(a)]);var g=nJ.mapMenu(a,e.menuMappings()),f=g.menuLabel?g.menuLabel:g.label;return n8(g.items).bind(function(a){return ct.fold(a,function(a){return d.group(a,b,c,d,e)})}).map(function(b){return{name:a.id,textkey:a.label,menuTextkey:f,type:"submenu",contentFocus:!1,enabled:!0,icon:a.icon,commands:b}})}},function(a,b){return function(){if(5!==
arguments.length)throw"Incorrect usage of builder ["+b+"]. Only given: "+arguments.length;return a.apply(null,arguments)}}),o8=function(a){if(void 0===a.items)return Wd("Invalid group, no items specified",["Invalid group, no items specified: "+a.label]);var b=a.items;return Q.isArray(b)?(a=k.bind(b,function(a,b){return Q.isString(a)||Q.isArray(a)||void 0!==a.label&&Q.isArray(a.items)?[]:["Invalid group at index: "+b+". Must be either a string, an array or an object containing label and items. Was: "+
Vc.stringify(a)]}),0===a.length?H.value(b):Wd("Invalid toolbar configuration for groups",a)):Wd("Invalid toolbar, items is not an array",["Invalid toolbar, items is not an array: "+Vc.stringify(a)])},pJ={build:function(a,b,c,d){return o8(a).bind(function(a){return ct.fold(a,function(a){return oJ.group(a,b,c,oJ,d)})})}},qJ=function(){return Lb.isSmallTouch()},rJ=function(a,b){return{feature:a.feature,command:a.command,type:"pre_flatmenu",items:b}},wo={shouldFlatten:qJ,never:f.constant("never_flatten"),
streamline:function(a){var b=function(a){return k.bind(a,function(a){return"never_flatten"===a.flatten?[a]:"submenu"===a.type?k.bind(a.commands,function(a){return b(a.items)}):"pre_flatmenu"===a.type?k.map(a.items,function(b){return{feature:a.feature,type:"general",command:b}}):[a]})};return k.map(a,function(a){var d=b(a.items);return{category:a.category,items:d}})},setup:function(a,b){var c=rJ(a,b);return Lb.choice([{predicate:qJ,value:f.constant(c)}],a)},make:rJ},Hh=function(a,b){return{predicate:a,
value:f.constant(b)}},sJ=function(){return{make:function(a){var b=function(b){return Wd(u.translate("errors.toolbar.missing.custom.string",b),['The required property "'+b+'" for a custom command must be a string. It was: '+Vc.stringify(a[b]),"Properties specified in custom command: "+W.keys(a).join(", "),"Definition specified for custom command: "+Vc.stringify(a)])};if(!Q.isString(a.id))return b("id");if(!Q.isString(a.text))return b("text");b={};b[a.id]=f.constant({general:function(){return{toggle:!1,
value:pl.cssSanitise(a.id),textkey:u.raw(a.text),action:a.action,updateGeneral:f.identity,icon:void 0!==a.icon?a.icon:!1}}});return H.value({feature:h.some(b),command:a.id,type:"general"})}}}(),p8=function(a,b){return a.bind(function(a){return b.map(function(b){return a.concat(b)})})},tJ={groupMappings:f.constant({"group.undo":"category.undo","group.insert":"category.insert","group.style":"category.style","group.language":"category.language","group.emphasis":"category.emphasis","group.align":"category.align",
"group.listindent":"category.listindent","group.format":"category.format","group.tools":"category.tools","group.table":"category.table","group.image":"category.image"}),menuMappings:f.constant({"menu.insert":{label:"insert.menu-button",menuLabel:"insert.menu"},"menu.font":{label:"font.menu-button",menuLabel:"font.menu"}})},Ih={config:function(a,b,c){return function(d,e,g,h){d=SQ(d,e,g,h,c);d=Z.deepMerge(d,b);h={"table-tools":{feature:h.table().ui(),command:"cell",type:"palette"},"image-tools":{feature:h.imageEdit().ui(),
command:"edit",type:"palette"},"crop-tools":{feature:h.imageEdit().ui(),command:"crop",type:"palette"}};d={forItems:f.constant({commands:f.constant(d),groups:cw}),forContextual:f.constant({commands:f.constant(h),groups:cw})};h=pJ.build({items:a.items},d.forItems(),sJ.make,tJ);d=pJ.build({items:a.contextual},d.forContextual(),sJ.make,tJ);e=Y.detect().deviceType.isTouch()?wo.streamline:f.identity;return p8(h,d).map(e)}}},q8=function(a){return function(a){setTimeout(function(){a()},0)}},r8={resume:function(a){a.focus();
var b=q.fromDom(a.document.body);(T.active().exists(function(a){return k.contains(["input","textarea"],A.name(a))})?q8(b):f.apply)(function(){T.active().each(T.blur);T.focus(b)})}},Ym={safeParse:function(a,b){var c=parseInt(m.get(a,b),10);return isNaN(c)?0:c}},s8=function(a){return{left:a.left,top:a.top,width:2,height:a.height}},t8=function(a){if(a.collapsed){var b=q.fromDom(a.startContainer);return y.parent(b).bind(function(c){c=Vb.exact(b,a.startOffset,c,ja.getEnd(c));return Ea.getFirstRect(a.startContainer.ownerDocument.defaultView,
c).map(function(a){return W.map(a,f.apply)}).map(s8).map(k.pure)}).getOr([])}return a.getClientRects()},zo={getRectangles:function(a){a=a.getSelection();return void 0!==a&&0<a.rangeCount?t8(a.getRangeAt(0)):[]}},pd={resolve:jb.create("ephox-nomad").resolve},dt="data-"+pd.resolve("last-outer-height"),u8=function(a){return{top:f.constant(a.top),bottom:f.constant(a.top+a.height)}},v8=function(a){a=zo.getRectangles(a);return 0<a.length?h.some(a[0]).map(u8):h.none()},w8=function(a){a=Ym.safeParse(a,dt);
var b=window.innerHeight;return a>b?h.some(a-b):h.none()},WQ={setup:function(a,b){var c=q.fromDom(b.document.body),d=E.bind(q.fromDom(a),"resize",function(){w8(c).each(function(a){v8(b).each(function(c){c=c.top()>b.innerHeight||c.bottom()>b.innerHeight?Math.min(a,c.bottom()-b.innerHeight+50):0;0!==c&&b.scrollTo(b.pageXOffset,b.pageYOffset+c)})});m.set(c,dt,window.innerHeight)});m.set(c,dt,window.innerHeight);return{toEditing:function(){r8.resume(b)},destroy:function(){d.unbind()}}}},uJ=function(a){var b;
b=new (Ub.getOrDie("Event"))("Event");b.initEvent(a,!0,!0);return b},dw={event:function(a,b){var c=uJ(b);a.target().dom().dispatchEvent(c)},target:function(a,b){var c=uJ(b);a.dom().dispatchEvent(c)}},vJ=function(){var a=window.matchMedia("(orientation: portrait)").matches;return{isPortrait:f.constant(a)}},eg={get:vJ,onChange:function(){var a=D.create({ready:r(["orientation"]),change:r(["orientation"])}),b=q.fromDom(window),c=null,d=E.bind(b,"orientationchange",function(){clearInterval(c);var b=vJ();
a.trigger.change(b);e(function(){a.trigger.ready(b)})}),e=function(a){clearInterval(c);var b=window.innerHeight,d=0;c=setInterval(function(){b!==window.innerHeight?(clearInterval(c),a(h.some(window.innerHeight))):20<d&&(clearInterval(c),a(h.none()));d++},50)};return{onAdjustment:e,events:a.registry,destroy:function(){d.unbind()}}}},fw={tag:function(){var a=I.first("head").getOrDie(),b=I.first('meta[name="viewport"]').getOrThunk(function(){var b=q.fromTag("meta");m.set(b,"name","viewport");v.append(a,
b);return b}),c=m.get(b,"content");return{maximize:function(){m.set(b,"content","width=device-width, initial-scale=1.0, user-scalable=no, maximum-scale=1.0")},restore:function(){void 0!==c&&null!==c&&0<c.length?m.set(b,"content",c):m.remove(b,"content")}}}},wJ=function(a,b){var c=ra.get(a);return Math.floor(b/100*c)},xJ=function(a,b){return I.ancestor(b,"td,th").fold(function(){return wJ(a,98)},function(a){return wJ(a,94)})},x8=function(a,b,c){var d=b.dom().width;a=xJ(a,b);return Math.max(0,Math.min(a,
d+c))},y8=function(a,b,c){return b.dom().height+c},xo={compare:function(a,b){var c=b.deltaX()-a.deltaX(),d=b.deltaY()-a.deltaY(),e=b.deltaDistance()-a.deltaDistance();return{deltaX:f.constant(c),deltaY:f.constant(d),deltaDistance:f.constant(e)}},extract:function(a){var b=a.raw().touches;if(2>b.length)return h.none();a=Math.abs(b[0].clientX-b[1].clientX);var b=Math.abs(b[0].clientY-b[1].clientY),c=Math.sqrt(Math.pow(a,2)+Math.pow(b,2));return h.some({deltaX:f.constant(a),deltaY:f.constant(b),deltaDistance:f.constant(c)})},
resize:function(a,b,c){var d=t.getRaw(b,"height"),e=t.getRaw(b,"width"),g=0<c.deltaDistance()?1:-1,f=g*Math.abs(c.deltaX()),h=g*Math.abs(c.deltaY());c=x8(a,b,f);g=y8(a,b,h);f=Math.abs(f)>Math.abs(h);t.setAll(b,{height:f?"auto":g+"px",width:f?c+"px":"auto",transform:"translate3d(0, 0, 0)"});ra.get(b)>xJ(a,b)&&(d.each(function(a){t.set(b,"height",a)}),e.each(function(a){t.set(b,"width",a)}))}},VQ=6<=Y.detect().os.version.major,z8=function(a){return a.body().map(function(a){a=t.get(a,"background-color");
return void 0!==a&&""!==a?"background-color:"+a+"!important":"background-color:rgb(255,255,255)!important;"}).getOr("background-color:rgb(255,255,255)!important;")},iw={clobberStyles:function(a,b){var c=function(a){return function(b){var c=m.get(b,"style"),c=void 0===c?"no-styles":c.trim();c!==a&&(m.set(b,"data-ephox-mobile-fullscreen-style",c),m.set(b,"style",a))}},d=X.ancestors(a,"*"),e=k.bind(d,function(a){return X.siblings(a,"*")}),g=z8(b);k.each(e,c("display:none!important;"));k.each(d,c("position:absolute!important;top:0!important;left:0!important;margin:0!important;padding:0!important;width:100%!important;height:100%!important;overflow:visible!important;"+
g))},restoreStyles:function(){var a=X.all("[data-ephox-mobile-fullscreen-style]");k.each(a,function(a){var c=m.get(a,"data-ephox-mobile-fullscreen-style");"no-styles"!==c?m.set(a,"style",c):m.remove(a,"style");m.remove(a,"data-ephox-mobile-fullscreen-style")})}},yJ={input:function(a,b){var c=q.fromTag("input");t.setAll(c,{opacity:"0",position:"absolute",top:"-1000px",left:"-1000px"});v.append(a,c);T.focus(c);b(c);B.remove(c)}},Go={refreshInput:function(a){var b=a.dom().selectionStart,c=a.dom().selectionEnd,
d=a.dom().selectionDirection;setTimeout(function(){a.dom().setSelectionRange(b,c,d);T.focus(a)},50)},refresh:function(a){var b=a.getSelection();if(0<b.rangeCount){var c=b.getRangeAt(0);a=a.document.createRange();a.setStart(c.startContainer,c.startOffset);a.setEnd(c.endContainer,c.endOffset);b.removeAllRanges();b.addRange(a)}}},yo={resume:function(a,b){T.active().each(function(a){L.eq(a,b)||T.blur(a)});a.focus();T.focus(q.fromDom(a.document.body));Go.refresh(a)}},fR={stubborn:function(a,b,c,d,e){var g=
ek(e),f=function(){yo.resume(a,c)},h=E.bind(b,"keydown",function(a){k.contains(["input","textarea"],A.name(a.target()))||(g.closeMenus(void 0),f())});return{toReading:function(){yJ.input(ca.body(),T.blur)},toEditing:f,onToolbarTouch:function(a){},destroy:function(){h.unbind()}}},timid:function(a,b,c,d,e){return{toReading:function(){T.blur(c)},toEditing:function(){yo.resume(a,c)},onToolbarTouch:function(){T.blur(c)},destroy:f.noop}}},A8={touch:function(a){var b=D.create({touchstart:r(["raw"]),touchend:r(["raw"])}),
c=!1,d=h.none(),e=E.capture(a,"touchstart",function(e){c=!0;d=h.some(E.capture(a,"touchend",function(a){c=!1;b.trigger.touchend(a.raw());g()}));b.trigger.touchstart(e.raw())}),g=function(){d.each(function(a){a.unbind()})};return{isTouching:function(){return c},events:b.registry,destroy:function(){e.unbind();g()}}}},B8=function(a){a=y.documentElement(a);var b=pd.resolve("unfocused-selection");return I.descendant(a,"."+b).bind(function(a){return Ja.absolute(a).top})},et={toFake:function(a,b,c){var d=
c.isActive,e=!1;return{on:function(){d()||(e=!1,c.update(),b.save(),Ea.clear(a))},off:function(){d()&&!e&&(c.clear(),b.restore())},fakeOut:function(){e=!0;yJ.input(ca.body(),b.restore)}}},inView:function(a,b,c){return function(){return B8(b).map(function(b){var c=a.dom().scrollTop;return 0<b()-c})}},onScroll:function(a,b,c,d){var e=function(){a()||g()},g=function(){d.events.touchend.unbind(e);d.isTouching()?d.events.touchend.bind(e):(c().getOr(!0)?b.off:b.fakeOut)()};return{start:function(){d.events.touchend.unbind(e);
b.on()},stop:g,destroy:function(){d.events.touchend.unbind(e)}}}},zJ=function(a,b){return $a.findMap([{width:320,height:480,keyboard:{portrait:300,landscape:240}},{width:320,height:568,keyboard:{portrait:300,landscape:240}},{width:375,height:667,keyboard:{portrait:305,landscape:240}},{width:414,height:736,keyboard:{portrait:320,landscape:240}},{width:768,height:1024,keyboard:{portrait:320,landscape:400}},{width:1024,height:1366,keyboard:{portrait:380,landscape:460}}],function(c){return a<=c.width&&
b<=c.height?h.some(c.keyboard):h.none()}).getOr({portrait:b/5,landscape:a/4})}(window.screen.width,window.screen.height),AJ=function(a){a=ha.get(a);var b=eg.get().isPortrait(),c=b?zJ.portrait:zJ.landscape;return a-((b?window.screen.height:window.screen.width)-window.innerHeight>c?0:c)},ft={getGreenzone:AJ,updatePadding:function(a,b){var c=AJ(b),c=ha.get(b)-c;t.set(a,"padding-bottom",c+"px")}},BJ=la.generate([{fixed:["element","offsetY"]},{scroller:["element","offsetY"]}]),gf="data-"+pd.resolve("position-y-fixed"),
gt="data-"+pd.resolve("scrolling"),CJ="data-"+pd.resolve("last-window-height"),DJ=function(a){return Ym.safeParse(a,gf)},C8=function(a){var b=DJ(a);return("true"===m.get(a,gt)?BJ.scroller:BJ.fixed)(a,b)},D8=function(a){var b=m.get(a,"style");t.setAll(a,{position:"absolute",top:"0px"});m.set(a,gf,"0px");return{restore:function(){m.set(a,"style",b||"");m.remove(a,gf)}}},E8=function(a,b,c){var d=m.get(c,"style");cc.register(c);t.setAll(c,{position:"absolute",height:b+"px",width:"100%",top:a+"px"});m.set(c,
gf,a+"px");m.set(c,gt,"true");return{restore:function(){cc.deregister(c);m.set(c,"style",d||"");m.remove(c,gf);m.remove(c,gt)}}},EJ=function(a,b){var c=window.innerHeight;m.set(a,CJ,c+"px");return c-b},ht={findFixtures:function(a){a=X.descendants(a,"["+gf+"]");return k.map(a,C8)},takeover:function(a,b,c){var d=D8(c),e=ha.get(c),g=EJ(a,e),h=E8(e,g,a),e=function(){var b=window.innerHeight,c=Ym.safeParse(a,CJ);return b>c},k=function(){var d=ha.get(c),e=EJ(a,d);m.set(a,gf,d+"px");t.set(a,"height",e+"px");
ft.updatePadding(b,a)};ft.updatePadding(b,a);return{setViewportOffset:function(b){m.set(a,gf,b+"px");k()},isExpanding:e,isShrinking:f.not(e),refresh:k,restore:function(){d.restore();h.restore()}}},getYFixedData:DJ},F8=function(a,b,c){return Math.abs(a-b)<=c?h.none():a<b?h.some(a+c):h.some(a-c)},Zm=function(){var a=null;return{animate:function(b,c,d,e,g,f){clearInterval(a);var h=function(b){clearInterval(a);g(b)};a=setInterval(function(){var f=b();F8(f,c,d).fold(function(){clearInterval(a);g(c)},function(d){e(d,
h);var l=b();if(l!==d||Math.abs(l-c)>Math.abs(f-c))clearInterval(a),g(c)})},f)}}}(),$m="data-"+pd.resolve("last-scroll-top"),FJ=function(a){a=t.getRaw(a,"top").getOr(0);return parseInt(a,10)},GJ=function(a){return parseInt(a.dom().scrollTop,10)},HJ=function(a,b){var c=b+ht.getYFixedData(a)+"px";t.set(a,"top",c)},ij={moveScrollAndTop:function(a,b,c){return va.nu(function(d){var e=f.curry(GJ,a);Zm.animate(e,b,15,function(b){a.dom().scrollTop=b;t.set(a,"top",FJ(a)+15+"px")},function(e){a.dom().scrollTop=
b;t.set(a,"top",c+"px");d(b)},10)})},moveOnlyScroll:function(a,b){return va.nu(function(c){var d=f.curry(GJ,a);m.set(a,$m,d());var e=Math.abs(b-d()),e=Math.ceil(e/10);Zm.animate(d,b,e,function(b,c){Ym.safeParse(a,$m)!==a.dom().scrollTop?c(a.dom().scrollTop):(a.dom().scrollTop=b,m.set(a,$m,b))},function(d){a.dom().scrollTop=b;m.set(a,$m,b);c(b)},10)})},moveOnlyTop:function(a,b){return va.nu(function(c){var d=f.curry(FJ,a),e=function(b){t.set(a,"top",b+"px")},g=Math.abs(b-d()),g=Math.ceil(g/10);Zm.animate(d,
b,g,e,function(a){e(b);c(b)},10)})},moveWindowScroll:function(a,b,c){return va.nu(function(d){var e=function(c){HJ(a,c);HJ(b,c);window.scrollTo(0,c)};Zm.animate(function(){return window.pageYOffset},c,15,e,function(a){e(a);d(a)},10)})}},G8={scrollIntoView:function(a,b,c,d){var e=ft.getGreenzone(b);a=f.curry(Go.refresh,a);c>e||d>e?ij.moveOnlyScroll(b,b.dom().scrollTop-e+d).get(a):0>c&&ij.moveOnlyScroll(b,b.dom().scrollTop+c).get(a)}},H8=function(a,b){return a.fold(function(a,d){t.set(a,"top",b+d+"px");
return va.pure(d)},function(a,d){var e=b+d,g=t.getRaw(a,"top").getOr(d),g=e-parseInt(g,10),g=a.dom().scrollTop+g;return ij.moveScrollAndTop(a,g,e)})},IJ={updatePositions:function(a,b){var c=ht.findFixtures(a),c=k.map(c,function(a){return H8(a,b)});return Ic.par(c)}},I8=function(a,b,c,d,e,g){var l=bR(function(c){return ij.moveWindowScroll(a,b,c)}),k=function(){var a=zo.getRectangles(g);return h.from(a[0]).bind(function(a){var c=a.top-b.dom().scrollTop;return c>window.innerHeight+5||-5>c?h.some({top:f.constant(c),
bottom:f.constant(c+a.height)}):h.none()})},m=oc.adaptable(function(){l.idle(function(){IJ.updatePositions(c,d.pageYOffset).get(function(a){k().each(function(a){b.dom().scrollTop=b.dom().scrollTop+a.top()});l.start(0);e.refresh()})})},1E3),n=E.bind(q.fromDom(d),"scroll",function(){0>d.pageYOffset||m.throttle()});IJ.updatePositions(c,d.pageYOffset).get(f.identity);return{unbind:n.unbind}},eR={setup:function(a){var b=a.cWin(),c=a.ceBody(),d=a.socket(),e=a.toolstrip(),g=a.toolbar(),h=a.contentElement(),
k=a.cursor(),m=a.keyboardType();a=a.isScrolling();var n=ht.takeover(d,c,e),r=m(b,ca.body(),h,e,g),u=eg.onChange();u.events.ready.bind(n.refresh);u.onAdjustment(function(){n.refresh()});var v=E.bind(q.fromDom(window),"resize",function(){n.isExpanding()&&n.refresh()}),w=I8(e,d,ca.body(),window,n,b),y=aR(b,h),A=function(){y.clear()},e=et.toFake(b,k,y),c=et.inView(d,c,g),B=A8.touch(q.fromDom(b)),C=et.onScroll(a,e,c,B);return{toEditing:function(){r.toEditing();A()},toReading:function(){r.toReading()},
onToolbarTouch:function(a){r.onToolbarTouch(a)},refreshSelection:function(){y.isActive()&&y.update()},clearSelection:A,highlightSelection:function(){y.update()},scrollIntoView:function(a,c){G8.scrollIntoView(b,d,a,c)},updateToolbarPadding:f.noop,setViewportOffset:function(a){n.setViewportOffset(a);ij.moveOnlyTop(d,a).get(f.identity)},syncHeight:function(){t.set(h,"height",h.dom().contentWindow.document.body.scrollHeight+"px")},selectionScrollStarted:function(){C.start()},selectionScrollStopped:function(){C.stop()},
destroy:function(){n.restore();u.destroy();w.unbind();v.unbind();r.destroy();C.destroy();B.destroy();y.destroy()}}}},JJ="data-"+pd.resolve("horizontal-scroll"),J8=function(a){var b;(b=0<a.dom().scrollTop)||(a.dom().scrollTop=1,b=0!==a.dom().scrollTop,a.dom().scrollTop=0);return b},K8=function(a){var b;(b=0<a.dom().scrollLeft)||(a.dom().scrollLeft=1,b=0!==a.dom().scrollLeft,a.dom().scrollLeft=0);return b},KJ={markAsHorizontal:function(a){m.set(a,JJ,"true")},hasScroll:function(a){return"true"===m.get(a,
JJ)?K8:J8}},L8=function(a){var b=a.dom().scrollTop,c=a.dom().scrollHeight;a=a.dom().offsetHeight;return 0>=b?h.some(1):b+a>=c?h.some(c-a-1):h.none()},LJ=function(a){L8(a).each(function(b){a.dom().scrollTop=b})},it=function(a,b){return E.bind(a,"touchstart",function(a){b(a.target()).each(LJ)})},kw={fixEdges:LJ,exclusive:function(a,b){return E.bind(a,"touchmove",function(a){I.closest(a.target(),b).filter(KJ.hasScroll).fold(function(){a.raw().preventDefault()},f.noop)})},link:function(a,b){return it(a,
f.constant(b))},ancestor:function(a,b){return it(a,function(a){return I.closest(a,b)})},indirect:it,markAsHorizontal:function(a){KJ.markAsHorizontal(a)}},MJ=function(a){return q.fromText(Ua.zeroWidth(),a.dom())},NJ={runAndRemove:function(a,b){var c=y.owner(a),d=q.fromTag("span",c.dom());v.append(d,MJ(c));v.prepend(a,d);c=b(d);B.remove(d);return c},enrichAndRemove:function(a,b){var c=MJ(y.owner(a));v.append(a,c);var d=b(a);B.remove(c);return d}},an=C.immutable("left","top","width","height","direction",
"absolute"),OJ=function(a){return{position:f.constant(qi.find(a)),width:f.constant(ra.getOuter(a)),height:f.constant(ha.getOuter(a))}},M8=function(a){var b=t.get(a,"display");return{backup:function(){t.set(a,"display","inline-block")},restore:function(){t.set(a,"display",b)}}},N8={backup:f.noop,restore:f.noop},O8=function(a){return A.isElement(a.startContainer())?h.some(a.startContainer()):A.isElement(a.endContainer())?h.some(a.endContainer()):y.parent(a.startContainer()).filter(A.isElement).orThunk(function(){return y.parent(a.endContainer()).filter(A.isElement)})},
P8=function(a,b){return O8(b).fold(function(){return an(0,0,0,a.uiDirection(),Ba(0,0))},function(b){var d=qi.find(b),e=ra.get(b),g=ha.get(b),f=Ja.absolute(b);return an(d.left(),d.top(),e,g,a.directionAt(b),f)})},Q8=function(a,b,c,d){return $v.diagnose(a,c)(d,function(a){var d=Sb.isVisible(a)||"br"===A.name(a)?N8:M8(a);d.backup();var f;if(ca.inBody(a)){var h=NJ.enrichAndRemove(a,OJ);f=h.position();var k=h.width(),h=h.height(),m=b.directionAt(a);a=Ja.absolute(a);f=an(f.left(),f.top(),k,h,m,a)}else f=
P8(b,c);d.restore();return f})},R8=function(a,b,c,d){var e=c.startContainer(),g=c.startOffset();if("body"===A.name(e)&&0===g){var f=c.startContainer();a=parseInt(t.get(f,"padding-top"),10);d=parseInt(t.get(f,"padding-left"),10);var k=NJ.runAndRemove(f,OJ),e=k.position(),g=k.width(),k=k.height();b=b.directionAt(f);f=Ja.absolute(f);c=at(an(e.left()+d,e.top()+a,g,k,b,f),h.some(c))}else c=Q8(a,b,c,d);return c},PJ=function(a,b,c,d,e){b.focus();a=R8(b.isRoot,a,c,e);a.cursor().each(function(a){b.setSelection(a.startContainer(),
a.startOffset(),a.endContainer(),a.endOffset())});a=a.result();d(a)},jw={insertAt:PJ,insertAtCursor:function(a,b,c,d){b.getSelection().each(function(e){PJ(a,b,e,c,d)})}},mw=Y.detect(),QJ=function(){try{var a=He.localStorage;a.setItem("__storage_test__","__storage_test__");a.removeItem("__storage_test__");return h.some(a)}catch(b){return h.none()}}().fold(function(){var a={};return{getItem:function(b){return a[b]},setItem:function(b,c){a[b]=c}}},function(a){return{getItem:function(b){return a.getItem("ephox.textboxio."+
b)},setItem:function(b,c){a.setItem("ephox.textboxio."+b,c)}}}),RJ=function(a,b){return h.from(QJ.getItem(a)).map(Vc.parse).getOr(b)},SJ=function(a){return RJ(a,{})},TJ=function(a,b){var c=Vc.stringify(b);QJ.setItem(a,c)},Ao={read:SJ,readOr:RJ,write:TJ,access:function(a){return{read:f.curry(SJ,a),write:f.curry(TJ,a)}}},UJ=function(a,b,c){b.body().each(function(d){c.save();var e=q.fromHtml(Ua.zeroWidth());a(d,e);b.setSelection(e,0,e,0)})},nw={upOrLeft:function(a,b,c){a.setRelativeSelection(da.before(c),
da.before(c));a.getSelection().fold(function(){UJ(v.prepend,a,b)},f.noop)},right:function(a,b,c){a.setRelativeSelection(da.after(c),da.after(c));a.getSelection().fold(function(){UJ(v.append,a,b)},f.noop)}},Kh={left:function(a,b,c){return a(b)&&ja.isStart(b,c)?h.none():ja.isStart(b,c)?Kb.before(b,a).filter(function(a){return!db.ancestor(a,"head")}):a(b)&&0<c?y.child(b,c-1):h.none()},right:function(a,b,c){return a(b)&&ja.isEnd(b,c)?h.none():ja.isEnd(b,c)?Kb.after(b,a).filter(function(b){return a(b)||
db.ancestor(b,"body")}):a(b)&&c<ja.getEnd(b)?y.child(b,c+1):h.none()},isFirstInContent:function(a,b){return a.body().map(function(a){a=y.children(a);return L.eq(a[0],b)}).getOr(!1)},isLastInContent:function(a,b){return a.body().map(function(a){a=y.children(a);return 0<a.length&&L.eq(a[a.length-1],b)}).getOr(!1)}},S8=function(a,b){return a.getSelection().bind(function(c){return c.collapsed()?b(a.isRoot,c.startContainer(),c.startOffset()):h.none()})},T8=function(a,b){return k.foldr(a,function(a,d){return d(b).or(a)},
h.none())},Bo={get:function(a,b,c){return S8(a,c).bind(function(a){return T8(b,a)})}},fh={response:C.immutable("selection","kill")},gh=function(a){return function(b){return b===a}},U8=gh(38),V8=gh(40),Qc={ltr:{isBackward:gh(37),isForward:gh(39)},rtl:{isBackward:gh(39),isForward:gh(37)},isUp:U8,isDown:V8,isNavigation:function(a){return 37<=a&&40>=a}},fg={convertToRange:function(a,b){var c=Ed.asLtrRange(a,b);return{start:f.constant(q.fromDom(c.startContainer)),soffset:f.constant(c.startOffset),finish:f.constant(q.fromDom(c.endContainer)),
foffset:f.constant(c.endOffset)}},makeSitus:function(a,b,c,d){return{start:f.constant(da.on(a,b)),finish:f.constant(da.on(c,d))}}},VJ=function(a,b){return b.column()>=a.startCol()&&b.column()+b.colspan()-1<=a.finishCol()&&b.row()>=a.startRow()&&b.row()+b.rowspan()-1<=a.finishRow()},WJ={inSelection:function(a,b){var c=b.column(),d=b.column()+b.colspan()-1,e=b.row(),g=b.row()+b.rowspan()-1;return c<=a.finishCol()&&d>=a.startCol()&&e<=a.finishRow()&&g>=a.startRow()},isWithin:VJ,isRectangular:function(a,
b){for(var c=!0,d=f.curry(VJ,b),e=b.startRow();e<=b.finishRow();e++)for(var g=b.startCol();g<=b.finishCol();g++)c=c&&fb.getAt(a,e,g).exists(d);return c?h.some(b):h.none()}},XJ=function(a,b,c){b=fb.findItem(a,b,L.eq);var d=fb.findItem(a,c,L.eq);return b.bind(function(a){return d.map(function(b){return ya.bounds(Math.min(a.row(),b.row()),Math.min(a.column(),b.column()),Math.max(a.row()+a.rowspan()-1,b.row()+b.rowspan()-1),Math.max(a.column()+a.colspan()-1,b.column()+b.colspan()-1))})})},YJ={getAnyBox:XJ,
getBox:function(a,b,c){return XJ(a,b,c).bind(function(b){return WJ.isRectangular(a,b)})}},jj={moveBy:function(a,b,c,d){return fb.findItem(a,b,L.eq).bind(function(b){var g=0<c?b.row()+b.rowspan()-1:b.row();b=0<d?b.column()+b.colspan()-1:b.column();return fb.getAt(a,g+c,b+d).map(function(a){return a.element()})})},intercepts:function(a,b,c){return YJ.getAnyBox(a,b,c).map(function(b){b=fb.filterItems(a,f.curry(WJ.inSelection,b));return k.map(b,function(a){return a.element()})})},parentCell:function(a,
b){return fb.findItem(a,b,function(a,b){return L.contains(b,a)}).bind(function(a){return a.element()})}},bn=function(a){a=Se.fromTable(a);return fb.generate(a)},hh={moveBy:function(a,b,c){return Xa.table(a).bind(function(d){d=bn(d);return jj.moveBy(d,a,b,c)})},intercepts:function(a,b,c){a=bn(a);return jj.intercepts(a,b,c)},nestedIntercepts:function(a,b,c,d,e){var g=bn(a);b=L.eq(a,c)?b:jj.parentCell(g,b);a=L.eq(a,e)?d:jj.parentCell(g,d);return jj.intercepts(g,b,a)},getBox:function(a,b,c){a=bn(a);return YJ.getBox(a,
b,c)}},jt=function(a,b){return I.ancestor(a,"table")},kj=C.immutableBag(["boxes","start","finish"],[]),ZJ=function(a,b,c){var d=function(a){return function(b){return c(b)||L.eq(b,a)}};return L.eq(a,b)?h.some(kj({boxes:h.some([a]),start:a,finish:b})):jt(a,c).bind(function(e){return jt(b,c).bind(function(g){if(L.eq(e,g))return h.some(kj({boxes:hh.intercepts(e,a,b),start:a,finish:b}));if(L.contains(e,g)){var f=X.ancestors(b,"td,th",d(e)),f=0<f.length?f[f.length-1]:b;return h.some(kj({boxes:hh.nestedIntercepts(e,
a,e,b,g),start:a,finish:f}))}return L.contains(g,e)?(f=X.ancestors(a,"td,th",d(g)),f=0<f.length?f[f.length-1]:a,h.some(kj({boxes:hh.nestedIntercepts(g,a,e,b,g),start:a,finish:f}))):Zd.ancestors(a,b).shared().bind(function(f){return I.closest(f,"table",c).bind(function(c){var f=X.ancestors(b,"td,th",d(c)),f=0<f.length?f[f.length-1]:b,l=X.ancestors(a,"td,th",d(c)),l=0<l.length?l[l.length-1]:a;return h.some(kj({boxes:hh.nestedIntercepts(c,a,e,b,g),start:l,finish:f}))})})})})},W8=function(a,b){return k.find(a,
function(a){return qa.is(a,b)})},X8=function(a,b){return I.ancestor(a,"table").bind(function(c){return I.descendant(c,b).bind(function(b){return ZJ(b,a).bind(function(a){return a.boxes().map(function(b){return{boxes:f.constant(b),start:f.constant(a.start()),finish:f.constant(a.finish())}})})})})},Ce={identify:ZJ,retrieve:function(a,b){var c=X.descendants(a,b);return 0<c.length?h.some(c):h.none()},shiftSelection:function(a,b,c,d,e){return W8(a,e).bind(function(a){return hh.moveBy(a,b,c).bind(function(a){return X8(a,
d)})})},getEdges:function(a,b,c){return I.descendant(a,b).bind(function(b){return I.descendant(a,c).bind(function(a){return Zd.sharedOne(jt,[b,a]).map(function(c){return{first:f.constant(b),last:f.constant(a),table:f.constant(c)}})})})}},$J=function(a,b,c,d,e){return L.eq(c,d)?h.none():Ce.identify(c,d,b).bind(function(b){var d=b.boxes().getOr([]);return 0<d.length?(e(a,d,b.start(),b.finish()),h.some(fh.response(h.some(fg.makeSitus(c,0,c,ja.getEnd(c))),!0))):h.none()})},kt={sync:function(a,b,c,d,e,
g,f){return L.eq(c,e)&&d===g?h.none():I.closest(c,"td,th",b).bind(function(c){return I.closest(e,"td,th",b).bind(function(d){return $J(a,b,c,d,f)})})},detect:$J,update:function(a,b,c,d,e){return Ce.shiftSelection(d,a,b,e.firstSelectedSelector(),e.lastSelectedSelector()).map(function(a){e.clear(c);e.selectRange(c,a.boxes(),a.start(),a.finish());return a.boxes()})}},ih=C.immutableBag(["left","top","right","bottom"],[]),Hc={nu:ih,moveUp:function(a,b){return ih({left:a.left(),top:a.top()-b,right:a.right(),
bottom:a.bottom()-b})},moveDown:function(a,b){return ih({left:a.left(),top:a.top()+b,right:a.right(),bottom:a.bottom()+b})},moveBottomTo:function(a,b){var c=a.bottom()-a.top();return ih({left:a.left(),top:b-c,right:a.right(),bottom:b})},moveTopTo:function(a,b){var c=a.bottom()-a.top();return ih({left:a.left(),top:b,right:a.right(),bottom:b+c})},getTop:function(a){return a.top()},getBottom:function(a){return a.bottom()},translate:function(a,b,c){return ih({left:a.left()+b,top:a.top()+c,right:a.right()+
b,bottom:a.bottom()+c})},toString:function(a){return"("+a.left()+", "+a.top()+") -> ("+a.right()+", "+a.bottom()+")"}},cn=function(a){return Hc.nu({left:a.left,top:a.top,right:a.right,bottom:a.bottom})},dn={getBoxAt:function(a,b,c){return A.isElement(b)?h.some(a.getRect(b)).map(cn):A.isText(b)?(a=0<=c&&c<ja.getEnd(b)?a.getRangedRect(b,c,b,c+1):0<c?a.getRangedRect(b,c-1,b,c):h.none(),a.map(cn)):h.none()},getEntireBox:function(a,b){return A.isElement(b)?h.some(a.getRect(b)).map(cn):A.isText(b)?a.getRangedRect(b,
0,b,ja.getEnd(b)).map(cn):h.none()}},Hd=la.generate([{none:[]},{retry:["caret"]}]),aK=function(a,b,c){return sa.closest(b,fa.isBlock).fold(f.constant(!1),function(b){return dn.getEntireBox(a,b).exists(function(a){return c.left()<a.left()||1>Math.abs(a.right()-c.left())||c.left()>a.right()})})},Y8={point:Hc.getBottom,adjuster:function(a,b,c,d,e){var g=Hc.moveDown(e,5);return 1>Math.abs(c.bottom()-d.bottom())?Hd.retry(g):c.top()>e.bottom()?Hd.retry(g):c.top()===e.bottom()?Hd.retry(Hc.moveDown(e,1)):
aK(a,b,e)?Hd.retry(Hc.translate(g,5,0)):Hd.none()},move:Hc.moveDown,gather:Kb.after},Z8=function(a,b,c){return a.elementFromPoint(b,c).filter(function(a){return"table"===A.name(a)}).isSome()},$8=function(a,b,c,d,e){return lt(a,b,c,b.move(d,5),e)},lt=function(a,b,c,d,e){return 0===e?h.some(d):Z8(a,d.left(),b.point(d))?$8(a,b,c,d,e-1):a.situsFromPoint(d.left(),b.point(d)).bind(function(g){return g.start().fold(h.none,function(g,f){return dn.getEntireBox(a,g,f).bind(function(f){return b.adjuster(a,g,
f,c,d).fold(h.none,function(d){return lt(a,b,c,d,e-1)})}).orThunk(function(){return h.some(d)})},h.none)})},a9=function(a,b,c){return a.point(b)>c.getInnerHeight()?h.some(a.point(b)-c.getInnerHeight()):0>a.point(b)?h.some(-a.point(b)):h.none()},bK=function(a,b,c){var d=a.move(c,5),e=lt(b,a,c,d,100).getOr(d);return a9(a,e,b).fold(function(){return b.situsFromPoint(e.left(),a.point(e))},function(c){b.scrollBy(0,c);return b.situsFromPoint(e.left(),a.point(e)-c)})},lj={tryUp:f.curry(bK,{point:Hc.getTop,
adjuster:function(a,b,c,d,e){var g=Hc.moveUp(e,5);return 1>Math.abs(c.top()-d.top())?Hd.retry(g):c.bottom()<e.top()?Hd.retry(g):c.bottom()===e.top()?Hd.retry(Hc.moveUp(e,1)):aK(a,b,e)?Hd.retry(Hc.translate(g,5,0)):Hd.none()},move:Hc.moveUp,gather:Kb.before}),tryDown:f.curry(bK,Y8),ieTryUp:function(a,b){return a.situsFromPoint(b.left(),b.top()-5)},ieTryDown:function(a,b){return a.situsFromPoint(b.left(),b.bottom()+5)},getJumpSize:f.constant(5)},en=la.generate([{none:["message"]},{success:[]},{failedUp:["cell"]},
{failedDown:["cell"]}]),b9=function(a){return I.closest(a,"tr")},jh={verify:function(a,b,c,d,e,g,f){return I.closest(d,"td,th",f).bind(function(c){return I.closest(b,"td,th",f).map(function(b){return L.eq(c,b)?L.eq(d,c)&&ja.getEnd(c)===e?g(b):en.none("in same cell"):Zd.sharedOne(b9,[c,b]).fold(function(){var d=a.getRect(b),e=a.getRect(c);return e.right>d.left&&e.left<d.right?en.success():g(b)},function(a){return g(b)})})}).getOr(en.none("default"))},cata:function(a,b,c,d,e){return a.fold(b,c,d,e)},
adt:en},c9=C.immutable("ancestor","descendants","element","index"),cK=C.immutable("parent","children","element","index"),fn=function(a,b){return k.findIndex(a,f.curry(L.eq,b))},d9={childOf:function(a,b){return sa.closest(a,function(a){return y.parent(a).exists(function(a){return L.eq(a,b)})})},indexOf:fn,indexInParent:function(a){return y.parent(a).bind(function(b){var c=y.children(b);return fn(c,a).map(function(d){return cK(b,c,a,d)})})},selectorsInParent:function(a,b){return y.parent(a).bind(function(c){var d=
X.children(c,b);return fn(d,a).map(function(b){return cK(c,d,a,b)})})},descendantsInAncestor:function(a,b,c){return I.closest(a,b).bind(function(b){var e=X.descendants(b,c);return fn(e,a).map(function(c){return c9(b,e,a,c)})})}},mt=function(a){return"br"===A.name(a)},nt=function(a,b,c){return b(a,c).bind(function(a){return A.isText(a)&&0===Fa.get(a).trim().length?nt(a,b,c):h.some(a)})},e9=function(a,b,c){return c.traverse(b).orThunk(function(){return nt(b,c.gather,a)}).map(c.relative)},f9=function(a,
b){return y.child(a,b).filter(mt).orThunk(function(){return y.child(a,b-1).filter(mt)})},g9=function(a,b,c,d){return f9(b,c).bind(function(b){return d.traverse(b).fold(function(){return nt(b,d.gather,a).map(d.relative)},function(a){return d9.indexInParent(a).map(function(a){return da.on(a.parent(),a.index())})})})},dK={tryBr:function(a,b,c,d){return(mt(b)?e9(a,b,d):g9(a,b,c,d)).map(function(a){return{start:f.constant(a),finish:f.constant(a)}})},process:function(a){return jh.cata(a,function(a){return h.none()},
function(){return h.none()},function(a){return h.some(S.point(a,0))},function(a){return h.some(S.point(a,ja.getEnd(a)))})}},mj=Y.detect(),h9=function(a,b,c){return a.getSelection().bind(function(d){return dK.tryBr(b,d.finish(),d.foffset(),c).fold(function(){return h.some(S.point(d.finish(),d.foffset()))},function(e){e=a.fromSitus(e);e=jh.verify(a,d.finish(),d.foffset(),e.finish(),e.foffset(),c.failure,b);return dK.process(e)})})},ot=function(a,b,c,d,e,g){return 0===g?h.none():i9(a,b,c,d,e).bind(function(f){var k=
a.fromSitus(f),k=jh.verify(a,c,d,k.finish(),k.foffset(),e.failure,b);return jh.cata(k,function(){return h.none()},function(){return h.some(f)},function(f){return L.eq(c,f)&&0===d?eK(a,c,d,Hc.moveUp,e):ot(a,b,f,0,e,g-1)},function(f){return L.eq(c,f)&&d===ja.getEnd(f)?eK(a,c,d,Hc.moveDown,e):ot(a,b,f,ja.getEnd(f),e,g-1)})})},eK=function(a,b,c,d,e){return dn.getBoxAt(a,b,c).bind(function(b){return fK(a,e,d(b,lj.getJumpSize()))})},fK=function(a,b,c){return mj.browser.isChrome()||mj.browser.isSafari()||
mj.browser.isFirefox()||mj.browser.isEdge()?b.otherRetry(a,c):mj.browser.isIE()?b.ieRetry(a,c):h.none()},i9=function(a,b,c,d,e){return dn.getBoxAt(a,c,d).bind(function(b){return fK(a,e,b)})},j9={handle:function(a,b,c){return h9(a,b,c).bind(function(d){return ot(a,b,d.element(),d.offset(),c,20).map(a.fromSitus)})}},k9=Y.detect(),l9=function(a,b){return Bc.ancestor(a,function(a){return y.parent(a).exists(function(a){return L.eq(a,b)})})},gK=function(a,b,c,d,e){return I.closest(d,"td,th",b).bind(function(d){return I.closest(d,
"table",b).bind(function(l){return l9(e,l)?j9.handle(a,b,c).bind(function(a){return I.closest(a.finish(),"td,th",b).map(function(b){return{start:f.constant(d),finish:f.constant(b),range:f.constant(a)}})}):h.none()})})},hK=function(a,b,c,d,e,g){return k9.browser.isIE()?h.none():g(d,b).orThunk(function(){return gK(a,b,c,d,e).map(function(a){a=a.range();return fh.response(h.some(fg.makeSitus(a.start(),a.soffset(),a.finish(),a.foffset())),!0)})})},iK=function(a,b,c,d,e,g,f){return gK(a,c,d,e,g).bind(function(a){return kt.detect(b,
c,a.start(),a.finish(),f)})},m9=function(a,b){return I.closest(a,"tr",b).bind(function(a){return I.closest(a,"table",b).bind(function(d){var e=X.descendants(d,"tr");return L.eq(a,e[0])?Kb.seekLeft(d,function(a){return Ab.last(a).isSome()},b).map(function(a){var b=ja.getEnd(a);return fh.response(h.some(fg.makeSitus(a,b,a,b)),!0)}):h.none()})})},n9=function(a,b){return I.closest(a,"tr",b).bind(function(a){return I.closest(a,"table",b).bind(function(d){var e=X.descendants(d,"tr");return L.eq(a,e[e.length-
1])?Kb.seekRight(d,function(a){return Ab.first(a).isSome()},b).map(function(a){return fh.response(h.some(fg.makeSitus(a,0,a,0)),!0)}):h.none()})})},pw=function(a,b){return I.closest(a,"td,th",b)},jK={traverse:y.nextSibling,gather:Kb.after,relative:da.before,otherRetry:lj.tryDown,ieRetry:lj.ieTryDown,failure:jh.adt.failedDown},kK={traverse:y.prevSibling,gather:Kb.before,relative:da.before,otherRetry:lj.tryUp,ieRetry:lj.ieTryUp,failure:jh.adt.failedUp},kh=C.immutable("rows","cols"),sw={mouse:function(a,
b,c,d){a=ow(a);b=mR(a,b,c,d);return{mousedown:b.mousedown,mouseover:b.mouseover,mouseup:b.mouseup}},keyboard:function(a,b,c,d){var e=ow(a),g=function(){d.clear(b);return h.none()};return{keydown:function(a,k,m,n,q,r){var t=a.raw().which,u=!0===a.raw().shiftKey;return Ce.retrieve(b,d.selectedSelector()).fold(function(){return Qc.isDown(t)&&u?f.curry(iK,e,b,c,jK,n,k,d.selectRange):Qc.isUp(t)&&u?f.curry(iK,e,b,c,kK,n,k,d.selectRange):Qc.isDown(t)?f.curry(hK,e,c,jK,n,k,n9):Qc.isUp(t)?f.curry(hK,e,c,kK,
n,k,m9):h.none},function(a){var c=function(c){return function(){return $a.findMap(c,function(c){return kt.update(c.rows(),c.cols(),b,a,d)}).fold(function(){return Ce.getEdges(b,d.firstSelectedSelector(),d.lastSelectedSelector()).map(function(a){var c=Qc.isDown(t)||r.isForward(t)?da.after:da.before;e.setRelativeSelection(da.on(a.first(),0),c(a.table()));d.clear(b);return fh.response(h.none(),!0)})},function(a){return h.some(fh.response(h.none(),!0))})}};return Qc.isDown(t)&&u?c([kh(1,0)]):Qc.isUp(t)&&
u?c([kh(-1,0)]):r.isBackward(t)&&u?c([kh(0,-1),kh(-1,0)]):r.isForward(t)&&u?c([kh(0,1),kh(1,0)]):Qc.isNavigation(t)&&!1===u?g:h.none})()},keyup:function(a,e,g,f,k){return Ce.retrieve(b,d.selectedSelector()).fold(function(){var m=a.raw().which;return!0===a.raw().shiftKey===!1?h.none():Qc.isNavigation(m)?kt.sync(b,c,e,g,f,k,d.selectRange):h.none()},h.none)}}}},qw={byClass:function(a){var b=le.addClass(a.selected()),c=le.removeClasses([a.selected(),a.lastSelected(),a.firstSelected()]),d=function(b){b=
X.descendants(b,a.selectedSelector());k.each(b,c)};return{clear:d,selectRange:function(c,g,f,h){d(c);k.each(g,b);n.add(f,a.firstSelected());n.add(h,a.lastSelected())},selectedSelector:a.selectedSelector,firstSelectedSelector:a.firstSelectedSelector,lastSelectedSelector:a.lastSelectedSelector}},byAttr:function(a){var b=function(b){m.remove(b,a.selected());m.remove(b,a.firstSelected());m.remove(b,a.lastSelected())},c=function(b){m.set(b,a.selected(),"1")},d=function(c){c=X.descendants(c,a.selectedSelector());
k.each(c,b)};return{clear:d,selectRange:function(b,g,f,h){d(b);k.each(g,c);m.set(f,a.firstSelected(),"1");m.set(h,a.lastSelected(),"1")},selectedSelector:a.selectedSelector,firstSelectedSelector:a.firstSelectedSelector,lastSelectedSelector:a.lastSelectedSelector}}},tw={retrieve:function(a,b){return Ce.retrieve(a,b)},retrieveBox:function(a,b,c){return Ce.getEdges(a,b,c).bind(function(b){var c=function(b){return L.eq(a,b)},g=I.ancestor(b.first(),"thead,tfoot,tbody,table",c),f=I.ancestor(b.last(),"thead,tfoot,tbody,table",
c);return g.bind(function(a){return f.bind(function(c){return L.eq(a,c)?hh.getBox(b.table(),b.first(),b.last()):h.none()})})})}},pR={configure:function(a){k.each([a.output(),a.internal()],function(b){var c=[od.lastSelected(),od.firstSelected(),od.selected()],d=k.map(c,function(a){return"."+a}).join(",");a.addSelector(b,d,function(a){k.each(a,le.removeClasses(c))})})}},lK=function(a){return 0===a.button},gn=function(a,b){return{bind:function(c,d){return Kp.bind(c,a,b,d)}}},hk={realClick:gn("click",
function(a){return 6===a.mozInputSource||0===a.mozInputSource?!1:void 0!==a.isTrusted&&!0!==a.isTrusted?!1:!0}),leftDown:gn("mousedown",lK),leftPressedOver:gn("mouseover",function(a){return void 0===a.buttons?!0:0!==(a.buttons&1)}),leftUp:gn("mouseup",lK)},rw=Y.detect(),sR=function(a){var b=Y.detect(),c=b.os.isOSX(),d=b.os.isLinux(),e=c?N.META():N.CTRL(),b=[[e,"Z"]],g=c?[[N.META(),N.SHIFT(),"Z"]]:d?[[N.CTRL(),"Y"],[N.CTRL(),N.SHIFT(),"Z"]]:[[N.CTRL(),"Y"]],f=[[N.SHIFT(),121]],h=c?[[N.ALT(),121]]:
[[121]],k=[[e,N.SHIFT(),"F"]],d=c?[[N.META(),N.ALT(),"U"]]:d?[[N.CTRL(),N.ALT(),"U"]]:[[N.CTRL(),N.SHIFT(),"U"]],c=c?[[N.CTRL(),N.ALT(),"H"]]:[[N.CTRL(),N.SHIFT(),"H"]],m=[[e,"B"]],n=[[e,"I"]],q=[[e,"U"]],r=[[e,221],[e,"M"]],t=[[e,219],[e,N.SHIFT(),"M"]],u=[[e,N.SHIFT(),"9"]],v=[[e,"K"]],e=[[e,"F"]],w=C.immutable("keys","trigger");return{undo:w(b,a.trigger.undo),redo:w(g,a.trigger.redo),context:w(f,a.trigger.context),toolbar:w(h,a.trigger.toolbar),bold:w(m,a.trigger.bold),italic:w(n,a.trigger.italic),
underline:w(q,a.trigger.underline),indent:w(r,a.trigger.indent),outdent:w(t,a.trigger.outdent),link:w(v,a.trigger.link),search:w(e,a.trigger.search),blockquote:w(u,a.trigger.blockquote),help:w(c,a.trigger.help),fullscreen:w(k,a.trigger.fullscreen),plaincode:w(d,a.trigger.plaincode)}},tR=function(a,b){return function(c){return k.contains(a,c)?h.some(b):h.none()}},mK=function(a){return function(b){return b.key()===a}},o9=C.immutable("key","value"),vR={put:function(a,b,c,d,e){var g=void 0!==d?d:o9,f=
void 0!==e?e:mK(b);a=k.foldl(a,function(a,d){var e=f(d)?g(b,c):d;return{updated:f(d)||a.updated,acc:a.acc.concat([e])}},{updated:!1,acc:[]});return a.updated?a.acc:a.acc.concat([g(b,c)])},get:function(a,b,c){b=void 0!==c?c:mK(b);return k.find(a,b)}},wR=C.immutable("popup","anchor"),uw={bind:function(a,b){var c=Ga.get(a);return{unbind:E.bind(a,"scroll",function(d){d=Ga.get(a);d.top()===c.top()&&d.left()===c.left()||b(d);c=d}).unbind}}},DR={isDefaultEmpty:function(a){return/^\s*<p>\s*<br\s?\/?>\s*<\/p>\s*$/.test(a)}},
BR={fromInitial:function(a){return vw({initial:a,undo:[],redo:[]})},fromState:function(a){return vw(a)}},ik=C.immutable("raw","marked"),CR=function(a){return ik(a.raw,a.marked)},ww=function(a,b){return{initial:b(a.initial),undo:k.map(a.undo,b),redo:k.map(a.redo,b)}},ER=function(a){return{raw:a.raw(),marked:a.marked()}},pt=la.generate([{aboveView:["item"]},{inView:["item"]},{belowView:["item"]}]),uf={aboveView:pt.aboveView,inView:pt.inView,belowView:pt.belowView,cata:function(a,b,c,d){return a.fold(b,
c,d)}},oW=function(a,b,c){var d=Lv(a),e=jR(c.profile),g=JQ(c.filters),l=LQ(),p=E7(g,l,a.content,b,c.content),m=oR(b,g,p),n=rR(p,a.shortcuts),q=a.ui.layout.bounds(a.ui),r=xR(p,q,b,a.ui),t=!1!==a.fullscreen.bundled?KQ(p,n,a.fullscreen):Aa.fullscreen(),v=iR(p,r,b,t,a.platform),w=zR(p,n,r,v,t,b,a.ui,c.ui),y=PQ(p,w),A=AR(g,p,y,n,c.undo),B=BQ(p,m,y,A),C=kR(p,y,A),D=RQ(g,p),E=EQ(p,A,a.editorcontext),F=FR(p,a.ui.autoresize),H=lR(w,a.registration),J=zQ(b,p,y,n,r,a.contextmenu),L=Xv.onNodeChange(p,D),K=Cu(c.laundry);
A.events.changed.bind(function(){K.setDirty(!0)});K.events.clean.bind(function(){p.undoChanged()});p.events.interaction.bind(function(a){!K.isDirty()&&A.checkChanged()&&K.setDirty(!0)});var N=Y.detect(),P=N.deviceType.isTouch(),q=n.isHelpShortcutEnabled();c=!p.isInline()&&!P&&a.ui.showHelpHint;a=G6.editor(a.ui.editorName,a.ui.isFullScreen);var N=u.translate(N.os.isOSX()?"aria.help.mac":"aria.help.ctrl"),q=q?h.some(N):h.none(),Q=(p.isInline()?O.inline:O.editor)(w.element(),p.element(),a,q,c),S=h.none();
p.runOrOnLoaded(function(a){var b=gk.handle(a,function(a){I.closest(a.target(),"a").each(function(b){I.closest(b,'[contenteditable="false"]').each(a.kill)})});S=h.some(b);P&&(O.label(a,u.translate("aria.label.content")),O.region(w.viewport()),O.region(w.tabstrip.element()))});return{region:f.constant(b),communication:f.constant(d),profile:f.constant(e),filter:f.constant(g),internalevents:f.constant(l),content:f.constant(p),keyboard:f.constant(y),shortcuts:f.constant(n),smartview:f.constant(r),undo:f.constant(A),
del:f.constant(B),proximity:f.constant(C),operations:f.constant(D),context:f.constant(E),fullscreen:f.constant(t),platform:f.constant(v),registration:f.constant(H),contextmenu:f.constant(J),ui:f.constant(w),selections:f.constant(m),insertFilteredHtmlAtCursor:function(a){a=g.filterHtml(g.input(),a);p.insertHtmlAtCursor(a)},viewablearea:f.constant(F),laundry:f.constant(K),state:function(){return{ui:w.state(),undo:A.state(),content:p.state(),profile:e.state(),laundry:K.state()}},destroy:function(){S.each(function(a){a.unbind()});
k.each([p,F,L,J,H,v,t,E,D,C,A,B,r,n,y,m,g,e,d,w],function(a){a.destroy?a.destroy():console.log("Feature missing destroy method: ",a)});Q.destroy()}}},ib={resolve:jb.create("ephox-hermes").resolve},nK=function(){var a=D.create({upload:r(["files"])}),b=q.fromTag("input");n.add(b,ib.resolve("hidden"));n.add(b,ib.resolve("file-selector-input"));m.setAll(b,{type:"file",accept:"image/*"});var c=E.bind(b,"change",function(b){b=qd.toFiles(b);a.trigger.upload(b)});return{element:f.constant(b),open:function(){$.set(b,
"");b.dom().click()},destroy:function(){c.unbind()},events:a.registry}},yw={single:nK,multiple:function(){var a=nK();m.set(a.element(),"multiple","multiple");return{element:a.element,open:a.open,destroy:a.destroy,events:a.events}}},oK=function(a,b){return k.map(b,function(b){var d=q.fromTag("img"),e=E.bind(d,"load",function(){e.unbind();a.domChanged()});b=kc.cata(b,function(a,b,c){return c},function(a,b,c){return b});m.set(d,"src",b);return d})},Fo={insertMobileAssets:function(a,b,c,d){var e=oK(a,
d);return a.undoOperation(function(){var g=xc.insertAt(a,b,e);c.uploadAssets(d);return g})},insertAssets:function(a,b,c){var d=oK(a,c);a.focus();a.undoOperation(function(){xc.insertAtCursor(a,d).each(function(b){a.setSelection(b.element(),b.offset(),b.element(),b.offset())});b.uploadAssets(c)})}},Bb={resolve:jb.create("ephox-gel").resolve},JR=Y.detect().deviceType.isiOS(),KR=Y.detect(),pK=function(a){a.dom().click();return h.some(a)},ob={setup:function(a,b,c){b=pa.dialog({execute:function(a){a.dom().click()},
ok:b.ok().element(),cancel:b.cancel().element()});a=ba.dialog(a.element(),c,b);return{enter:a.enter,exit:a.exit,destroy:a.destroy}},button:function(a){return(qa.is(a,".ephox-pastry-button")?h.some(a):I.descendant(a,".ephox-pastry-button")).bind(pK)},click:pK,radio:function(a,b,c){b={item:f.constant(b),selected:f.constant(c)};return ba.radio(a,b,pa.radio({one:function(a,b){b.dom().click()}}))}},MR={previewAsset:function(a,b){kc.cata(a,f.die("asset should not be a file type"),function(a,d,e){n.add(b,
ib.resolve("fluid-image"));m.set(b,"src",d)})}},Bw=Y.detect(),vf=C.immutable("heading","renderer"),Do={left:f.constant("left"),top:f.constant("top")},p9=["image"],q9=function(a,b,c){return k.exists(p9,function(a){return Q.isString(b.getType())&&-1<b.getType().indexOf(a)})},WR={validate:function(a){a=k.foldl(a,function(a,c){return!1===kc.cata(c,q9,f.constant(!0))?{assets:a.assets,failure:!0}:{assets:a.assets.concat([c]),failure:a.failure}},{assets:[],failure:!1});return{assets:f.constant(a.assets),
failure:f.constant(a.failure)}}},ve={multiple:function(a){return qd.multiple(a)},single:function(a){return qd.single(a)},singleWithUrl:function(a,b){return qd.singleWithUrl(a,b)}},qt=[0,0.01,0.02,0.04,0.05,0.06,0.07,0.08,0.1,0.11,0.12,0.14,0.15,0.16,0.17,0.18,0.2,0.21,0.22,0.24,0.25,0.27,0.28,0.3,0.32,0.34,0.36,0.38,0.4,0.42,0.44,0.46,0.48,0.5,0.53,0.56,0.59,0.62,0.65,0.68,0.71,0.74,0.77,0.8,0.83,0.86,0.89,0.92,0.95,0.98,1,1.06,1.12,1.18,1.24,1.3,1.36,1.42,1.48,1.54,1.6,1.66,1.72,1.78,1.84,1.9,1.96,
2,2.12,2.25,2.37,2.5,2.62,2.75,2.87,3,3.2,3.4,3.6,3.8,4,4.3,4.7,4.9,5,5.5,6,6.5,6.8,7,7.3,7.5,7.8,8,8.4,8.7,9,9.4,9.6,9.8,10],ae={identity:function(){return[1,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,1]},adjust:Eo,multiply:De,adjustContrast:function(a,b){var c;b=id(b,-1,1);b*=100;0>b?c=127+b/100*127:(c=b%1,c=0===c?qt[b]:qt[Math.floor(b)]*(1-c)+qt[Math.floor(b)+1]*c,c=127*c+127);return De(a,[c/127,0,0,0,0.5*(127-c),0,c/127,0,0,0.5*(127-c),0,0,c/127,0,0.5*(127-c),0,0,0,1,0,0,0,0,0,1])},adjustBrightness:function(a,
b){b=id(255*b,-255,255);return De(a,[1,0,0,0,b,0,1,0,0,b,0,0,1,0,b,0,0,0,1,0,0,0,0,0,1])},adjustSaturation:function(a,b){var c;b=id(b,-1,1);c=1+(0<b?3*b:b);return De(a,[0.3086*(1-c)+c,0.6094*(1-c),0.082*(1-c),0,0,0.3086*(1-c),0.6094*(1-c)+c,0.082*(1-c),0,0,0.3086*(1-c),0.6094*(1-c),0.082*(1-c)+c,0,0,0,0,0,1,0,0,0,0,0,1])},adjustHue:function(a,b){var c,d;b=id(b,-180,180)/180*Math.PI;c=Math.cos(b);d=Math.sin(b);return De(a,[0.213+0.787*c+-0.213*d,0.715+-0.715*c+-0.715*d,0.072+-0.072*c+0.928*d,0,0,0.213+
-0.213*c+0.143*d,0.715+c*(1-0.715)+0.14*d,0.072+-0.072*c+-0.283*d,0,0,0.213+-0.213*c+-0.787*d,0.715+-0.715*c+0.715*d,0.072+0.928*c+0.072*d,0,0,0,0,0,1,0,0,0,0,0,1])},adjustColors:function(a,b,c,d){b=id(b,0,2);c=id(c,0,2);d=id(d,0,2);return De(a,[b,0,0,0,0,0,c,0,0,0,0,0,d,0,0,0,0,0,1,0,0,0,0,0,1])},adjustSepia:function(a,b){b=id(b,0,1);return De(a,Eo([0.393,0.769,0.189,0,0,0.349,0.686,0.168,0,0,0.272,0.534,0.131,0,0,0,0,0,1,0,0,0,0,0,1],b))},adjustGrayscale:function(a,b){b=id(b,0,1);return De(a,Eo([0.33,
0.34,0.33,0,0,0.33,0.34,0.33,0,0,0.33,0.34,0.33,0,0,0,0,0,1,0,0,0,0,0,1],b))}},ad={invert:function(a){return function(b){return jk(b,a)}}([-1,0,0,0,255,0,-1,0,0,255,0,0,-1,0,255,0,0,0,1,0]),brightness:hg(ae.adjustBrightness),hue:hg(ae.adjustHue),saturate:hg(ae.adjustSaturation),contrast:hg(ae.adjustContrast),grayscale:hg(ae.adjustGrayscale),sepia:hg(ae.adjustSepia),colorize:function(a,b,c,d){return jk(a,ae.adjustColors(ae.identity(),b,c,d))},sharpen:Iw([0,-1,0,-1,5,-1,0,-1,0]),emboss:Iw([-2,-1,0,
-1,1,1,0,1,2]),gamma:Hw(function(a,b){return 255*Math.pow(a/255,1-b)}),exposure:Hw(function(a,b){return 255*(1-Math.exp(-(a/255)*b))}),colorFilter:jk,convoluteFilter:Gw},r9={scale:Jw},hn={rotate:function(a,b){return a.toCanvas().then(function(c){var d=a.getType(),e=b,g=bc.create(c.width,c.height),f=bc.get2dContext(g),h=0,k=0,e=0>e?360+e:e;90!=e&&270!=e||bc.resize(g,g.height,g.width);if(90==e||180==e)h=g.width;if(270==e||180==e)k=g.height;f.translate(h,k);f.rotate(e*Math.PI/180);f.drawImage(c,0,0);
return rd.fromCanvas(g,d)})},flip:function(a,b){return a.toCanvas().then(function(c){var d=a.getType(),e=bc.create(c.width,c.height),g=bc.get2dContext(e);"v"==b?(g.scale(1,-1),g.drawImage(c,0,-e.height)):(g.scale(-1,1),g.drawImage(c,-e.width,0));return rd.fromCanvas(e,d)})},crop:function(a,b,c,d,e){return a.toCanvas().then(function(g){var f=a.getType(),h=bc.create(d,e);bc.get2dContext(h).drawImage(g,-b,-c);return rd.fromCanvas(h,f)})},resize:function(a,b,c){return a.toCanvas().then(function(d){return r9.scale(d,
b,c).then(function(b){return rd.fromCanvas(b,a.getType())})})}},nj={invert:function(a){return ad.invert(a)},sharpen:function(a){return ad.sharpen(a)},emboss:function(a){return ad.emboss(a)},brightness:function(a,b){return ad.brightness(a,b)},hue:function(a,b){return ad.hue(a,b)},saturate:function(a,b){return ad.saturate(a,b)},contrast:function(a,b){return ad.contrast(a,b)},grayscale:function(a,b){return ad.grayscale(a,b)},sepia:function(a,b){return ad.sepia(a,b)},colorize:function(a,b,c,d){return ad.colorize(a,
b,c,d)},gamma:function(a,b){return ad.gamma(a,b)},exposure:function(a,b){return ad.exposure(a,b)},flip:function(a,b){return hn.flip(a,b)},crop:function(a,b,c,d,e){return hn.crop(a,b,c,d,e)},resize:function(a,b,c){return hn.resize(a,b,c)},rotate:function(a,b){return hn.rotate(a,b)}},oj=function(a){return function(b){return qc.blobToImageResult(b).then(function(b){return a(b)}).then(qc.imageResultToOriginalBlob)}},qK=function(a){return oj(function(b){return nj.rotate(b,a)})},rK=function(a){return oj(function(b){return nj.flip(b,
a)})},s9=function(a){return oj(function(b){return nj.resize(b,a.width(),a.height())})},t9=Pa.pToFR(oj(nj.sharpen)),u9=Pa.pToFR(qK(-90)),v9=Pa.pToFR(qK(90)),w9=Pa.pToFR(rK("v")),x9=Pa.pToFR(rK("h")),kg={rotateLeft:u9,rotateRight:v9,flipVertical:w9,flipHorizontal:x9,sharpen:t9,crop:function(a,b,c,d){return Pa.pToFR(oj(function(e){return nj.crop(e,a,b,c,d)}))},resizeTo:function(a){return Pa.pToFR(s9(a))}},sK={mapIfSet:function(a,b){return Pa.map(a,function(a){return a.map(b)})},applyIfSet:function(a){return function(b){return Pa.bind(a,
function(a){return a.fold(function(){return Pa.pure(b)},function(a){return a(b)})})}}},Xh={partition:function(a){var b=[],c=[];k.each(a,function(a){a.fold(function(a){b.push(a)},function(a){c.push(a)})});return{errors:b,values:c}}},jn=C.immutable("width","height"),tK=la.generate([{special:["size"]},{regular:["value","size","unit"]}]),kn={identify:function(a){a=a.match(/(\d*\.?\d*)(.*)/);return""!==a[1]?tK.regular(a[0],Number(a[1]),a[2]):tK.special(a[0])}},y9=function(a,b){return t.getRaw(a,b).orThunk(function(){return m.has(a,
b)?h.some(m.get(a,b)):h.none()}).bind(function(a){return kn.identify(a).fold(function(a){return h.none()},function(a,b,c){switch(c){case "":case "px":return h.some(parseInt(b,10));default:return h.none()}})})},rt=function(a,b,c){b=b(a);return 0<b?h.some(b):y9(a,c)},z9={get:function(a){return rt(a,ra.get,"width").bind(function(b){return rt(a,ha.get,"height").map(function(a){return jn(b,a)})})},measure:rt},uK=function(a,b){var c=b/a;return 1>c?c:1},A9=function(a,b){var c=uK(a.height,b.height);return 1===
c?a:{width:a.width*c,height:b.height}},B9=function(a,b){var c=uK(a.width,b.width);return 1===c?a:{width:b.width,height:a.height*c}},C9={max:function(a,b){var c=0<b.height?b.height:0,d=0<b.width?b.width:0;if(!(a.height>c||a.width>d)||c===d&&0===c)return a;var c={width:d,height:c},d=a.width>a.height,e=0<c.height,g=(e?a.height/c.height:0)>(0<c.width?a.width/c.width:0);return(c.width===c.height&&d||!e||!g?B9:A9)(a,c)}},D9=function(a){var b=Ne.createObjectURL(a);return Pa.map(Vm.load(b),function(a){a=
vK(a);Ne.revokeObjectURL(b);return a})},vK=function(a){return jn(a.dom().naturalWidth,a.dom().naturalHeight)},E9=function(a){var b=vK(a);return z9.get(a).filter(function(a){return a.width()!==b.width()||a.height()!==b.height()})},Ko={restrain:function(a){var b=a.width(),c=a.height(),d=function(a){var d=C9.max({width:a.width(),height:a.height()},{width:b,height:c});return a.height()>c||a.width()>b?h.some(jn(d.width,d.height)):h.none()};return function(a){a=D9(a);return Pa.map(a,d)}},changedBounds:function(a){return Pa.map(Vm.loadIfNeeded(a),
E9)}},F9=function(a){a=sK.mapIfSet(a,kg.resizeTo);return sK.applyIfSet(a)},wK=function(a,b,c){return Pa.fromChain([F9(a),c])(b)},Nh={instance:function(a){var b=Ko.restrain(a);return function(a){return kc.cata(a,function(d,e,g){d=Pa.fromPromise(qc.imageResultToOriginalBlob(e));return Pa.bind(d,function(d){var e=b(d);return wK(e,d,function(b){if(b===d)return Pa.pure(a);Ne.revokeObjectURL(g);return Pa.fromFuture(ve.single(b))})})},function(){return Pa.pure(a)})}},processResults:function(a){return function(b){b=
Xh.partition(b);0<b.errors.length&&(a("imageedit.generic"),console.error("Image resample errors: ",b.errors));return b.values}},resampleAction:wK},xK=w.resolve("find-match"),yK=w.resolve("find-mark"),st="."+xK+", ."+yK,Sc={configure:function(a){a.addSelector(a.output(),st,Ca.unwrap);a.addSelector(a.history(),st,Ca.unwrap);a.addSelector(a.internal(),st,Ca.unwrap)},matchClass:f.constant(xK),markClass:f.constant(yK),findIdAttr:f.constant("data-ephox-find-id"),shiftKeyState:function(a){return{isShift:f.constant(a)}}},
zK=function(a){return{fold:a}},ln={created:function(a){return zK(function(b,c){return c(a)})},preserved:function(a){return zK(function(b,c){return b(a)})}},G9=C.immutable("id","match","current"),tt={resolve:jb.create("data.ephox.cram").resolve},ut={resolve:jb.create("ephox-cram").resolve},AK=tt.resolve("highlight-id"),H9=ut.resolve("highlight-wrap"),BK=function(a,b){return I.closest(a,"."+b)},CK=function(a){return h.from(m.get(a,AK))},hf={marker:BK,idMarker:function(a){return BK(a,H9)},id:CK,set:function(a,
b){m.set(a,AK,b);n.add(a,b)},all:function(a){return CK(a).fold(f.constant([a]),function(b){var c=y.owner(a);return X.descendants(c,"."+b)})}},vt=C.immutable("word","pattern"),I9={separate:function(a,b,c){var d=k.bind(c,function(a){return[a.start(),a.finish()]}),e=Wc.splits(b,d,function(b,c){return ZD.subdivide(a,b.element(),c)});return k.map(c,function(b){var c=Wc.sublist(e,b.start(),b.finish()),c=k.map(c,function(a){return a.element()}),d=k.map(c,a.property().getText).join("");return{elements:f.constant(c),
word:b.word,exact:f.constant(d)}})}},J9=function(a,b){return Wc.generate(b,function(b,d){var e=d+a.property().getText(b).length;return h.from(S.range(b,d,e))})},wt=function(a,b,c,d){b=$D.group(a,b,d);return k.bind(b,function(b){b=Wk.justText(b);var d=k.map(b,a.property().getText).join(""),d=rm.findmany(d,c);b=J9(a,b);return I9.separate(a,b,d)})},xt={safeWords:function(a,b,c,d){c=k.map(c,function(a){var b=cb.safeword(a);return vt(a,b)});return wt(a,b,c,d)},safeToken:function(a,b,c,d){c=vt(c,cb.safetoken(c));
return wt(a,b,[c],d)},run:wt},yt={safeWords:function(a,b,c,d){return xt.safeWords(a,b,c,d)},safeToken:function(a,b,c,d){return xt.safeToken(a,b,c,d)},run:function(a,b,c,d){return xt.run(a,b,c,d)}},zt=Sa(),mn={safeWords:function(a,b,c){return yt.safeWords(zt,a,b,c)},safeToken:function(a,b,c){return yt.safeToken(zt,a,b,c)},run:function(a,b,c){return yt.run(zt,a,b,c)}},K9=function(a,b){var c=k.bind(a.elements(),function(a){return hf.marker(a,b).fold(f.constant([]),function(a){return[a]})}),d=Ma.generate("ephox-cram");
return G9(d,a,h.from(c[0]))},pj={matchWords:function(a,b,c){return mn.safeWords(a,b,c)},matchToken:function(a,b,c){return mn.safeToken(a,b,c)},matchPattern:function(a,b,c){return mn.run(a,[b],c)},annotates:function(a,b){return k.map(a,function(a){return K9(a,b)})}},DK=function(a,b,c,d){b=pj.annotates(d,c.label());return k.bind(b,function(b){return b.current().fold(function(){var d=b.match();if(a.ignore(d))return[];d=Sg.wrapper(d.elements(),c.nu)||[];k.each(d,f.curry(c.tag,b));return[ln.created(d)]},
function(a){return[ln.preserved(a)]})})},L9={highlight:function(a,b,c,d){c=pj.matchToken(b,c,a.optimise);return DK(a,b,d,c)},highlightPattern:function(a,b,c,d){c=pj.matchPattern(b,c,a.optimise);return DK(a,b,d,c)}},M9=function(a,b){return A.isElement(b)&&fa.isBlock(b)?0>nb.get(b).toLowerCase().indexOf(a):!1},N9=function(a){return{ignore:f.constant(!1),optimise:f.curry(M9,a.toLowerCase())}},nn=f.constant("."+Sc.matchClass()),O9={label:Sc.matchClass,tag:function(a,b){n.add(b,Sc.matchClass());m.set(b,
Sc.findIdAttr(),a.id())},nu:function(){var a=q.fromTag("span");return{element:f.constant(a),wrap:f.curry(v.append,a)}}},EK=function(a){k.each(a,function(a){n.add(a,Sc.markClass())})},P9=function(a){k.each(a,function(a){n.remove(a,Sc.markClass())})},At=function(a,b){var c=k.groupBy(X.descendants(a,b),function(a){return m.get(a,Sc.findIdAttr())});return 0===c.length?h.none():h.some(c)},FK=function(a,b){var c=cb.custom(cb.sanitise(a),f.constant(0),f.constant(0),b);return vt(a,c)},Bt=function(a,b,c){return At(a,
nn()).map(function(d){var e=k.filter(d,function(a){return n.has(a[0],Sc.markClass())}),g=k.findIndex(d,function(a){return k.contains(e,a)}).getOr(-1);return{pos:c(d,k.flatten(e),g,b(g,d.length)),all:At(a,nn())}})},Ct=function(a,b,c,d){P9(b);EK(a[d]);return d},GK=function(a,b){return a===b-1?0:a+1},Q9=function(a,b){return 0===a?b-1:a-1},HK=function(a,b){return Bt(a,GK,function(a,d,e,g){Ct(a,d,e,g);v.before(d[0],q.fromText(b));k.each(d,B.remove);return 0===g?g:e})},be={search:function(a,b,c){if(0===
b.length)return h.none();var d=N9(b),e=y.children(a);b=!0===c?FK(b,h.none()):FK(b,h.some("gi"));L9.highlightPattern(d,e,b,O9);return At(a,nn()).map(function(a){EK(a[0]);return{all:h.some(a),pos:0}})},clear:function(a){a=X.descendants(a,nn());k.each(a,B.unwrap);return h.none()},next:function(a){return Bt(a,GK,Ct)},prev:function(a){return Bt(a,Q9,Ct)},replace:HK,replaceAll:function(a,b){for(;HK(a,b).isSome(););return h.none()}},Mw=Y.detect().deviceType.isiOS(),Dt=function(a,b,c){a=a();var d=a.element();
ea.add(d,b);O.button(d,c);m.set(d,"tabindex","-1");a.events.click.bind(function(){T.focus(d)});return a},Et=function(a,b){var c=Dt(Yb,a,b);m.set(c.element(),"title",b);return c},IK=function(a,b){var c=w.resolve("inline-main-button"),c=a.concat([c]),c=Dt(Yb,c,b);c.content(mc(b));return c},JK=function(a,b,c){var d=w.resolve("inline-main-button-toggle");a=a.concat([d]);c=Dt(dd,a,c);m.set(c.element(),"title",b);return c},Ft=function(a,b,c){var d=q.fromTag("input");ea.add(d,a);m.set(d,"placeholder",b);
O.label(d,c);return{element:f.constant(d),destroy:f.curry(B.remove,d)}},kk={counter:function(a){var b=P.div(),c=P.span();n.add(b,w.resolve("search-widget-counter"));n.add(c,w.resolve("search-widget-counter-text"));v.append(b,c);return{element:f.constant(b),update:function(a,b){var g=u.translate("units.amount-of-total",a,b);B.empty(c);v.append(c,q.fromText(g));Sb.isVisible(c)&&Oa.speak(ca.body(),g)},hide:function(){t.set(b,"display","none")},show:function(){t.remove(b,"display")},destroy:function(){B.remove(c);
B.remove(b)}}},dummyCounter:function(a){a=P.div();n.add(a,w.resolve("search-widget-counter"));return{element:f.constant(a),update:f.noop,hide:f.noop,show:f.noop,destroy:f.curry(B.remove,a)}},searchField:function(){var a=P.span(),b=Et([w.resolve("stepper-button"),w.resolve("search-widget-previous")],u.translate("search.previous")),c=Et([w.resolve("stepper-button"),w.resolve("search-widget-next")],u.translate("search.next")),d=JK([w.resolve("search-widget-more")],u.translate("aria.label.more"),u.translate("aria.label.more"));
n.add(a,w.resolve("search-widget-searchField"));var e=Ft([w.resolve("search-widget-input"),w.resolve("search-widget-input-search")].concat(Lb.isSmallTouch()?[w.resolve("search-widget-small-touch")]:[]),u.translate("search.search"),u.translate("search.field.search")),g=D.create({next:K([],c.events.click),previous:K([],b.events.click),more:K([],d.events.click),input:r(["raw"])}),h=E.bind(e.element(),"input",g.trigger.input);J.append(a,[e.element(),b.element(),c.element(),d.element()]);return{events:g.registry,
element:f.constant(a),input:e.element,focus:function(){T.focus(e.element())},previous:b.element,next:c.element,moreToggle:d,destroy:function(){h.unbind();e.destroy();b.destroy();c.destroy();d.destroy()}}},replaceDrawer:function(){var a=Ft([w.resolve("search-widget-input"),w.resolve("search-widget-input-replace")],u.translate("search.replace"),u.translate("search.field.replace")),b=JK([w.resolve("search-widget-matchcase")],u.translate("search.matchcase"),u.translate("search.matchcase")),c=IK([w.resolve("search-widget-replace")],
u.translate("search.replace")),d=IK([w.resolve("search-widget-replace-all")],u.translate("search.replace-all")),e=q.fromTag("div");O.group(e);var g=P.div();n.add(e,w.resolve("search-widget-replace-drawer"));n.add(g,w.resolve("search-widget-replace-drawer-tools"));J.append(g,[b.element(),c.element(),d.element()]);J.append(e,[a.element(),g]);return{element:f.constant(e),replace:c,replaceAll:d,input:a,matchcase:b,destroy:function(){b.destroy();c.destroy();d.destroy();B.remove(g);B.remove(e)}}},button:Et,
input:Ft},XR=3,Ow=function(a,b,c){a?(ga.expanded(b),O.hidden(c,!1)):(ga.collapsed(b),O.hidden(c,!0))},Oh={text:la.generate([{text:["field","input"]}]).text,cata:function(a,b){return a.fold(b)}},aS=Y.detect(),$R=Eb.ensureWith("element addEscape open close execute type events destroy".split(" "),Xz.isFunctionOrEvents(["toEditor"])),Ho="search",KK=w.resolve("toolbar-dialog"),R9=function(a){var b=YR(a);return mv(a,b,Ho,KK)},S9=function(a){var b=ZR(a);return lk(a,b,KK)},cS=function(a){return(Y.detect().deviceType.isTouch()?
S9:R9)(a)},T9=function(a){return nd.isAnnotation(a)||m.has(a,hb.overrideSpan())},LK=function(a,b,c,d,e,g){var h=function(b){a(b,e,T9)};qb.cata(d.get(),f.noop,um.multiple(b,c,h,g),um.single(b,c,h,g))},on=function(a,b,c,d,e){LK(a,b,c,d,e,b.toEditing)},Ee={face:f.curry(on,Xg.face),background:f.curry(on,Xg.background),foreground:f.curry(on,Xg.foreground),size:f.curry(on,Xg.size),partialSize:f.curry(function(a,b,c,d,e){LK(a,b,c,d,e,f.noop)},Xg.size)},jg={color:C.immutable("hex","name"),face:C.immutable("textkey",
"value","icon"),size:C.immutable("name","size")},Hb=jg.color,Id=jg.face,Rw={colors:function(){return[Hb("#FFF",u.key("color.white")),Hb("#000",u.key("color.black")),Hb("#444",u.key("color.gray")),Hb("#777",u.key("color.metal")),Hb("#CCC",u.key("color.smoke")),Hb("#FC1D00",u.key("color.red")),Hb("#C81500",u.key("color.darkred")),Hb("#FF8C00",u.key("color.darkorange")),Hb("#FEBE00",u.key("color.orange")),Hb("#FFFC00",u.key("color.yellow")),Hb("#22AE50",u.key("color.green")),Hb("#006400",u.key("color.darkgreen")),
Hb("#3CB371",u.key("color.mediumseagreen")),Hb("#8FCD4E",u.key("color.lightgreen")),Hb("#00FF00 ",u.key("color.lime")),Hb("#0000CD",u.key("color.mediumblue")),Hb("#002360",u.key("color.navy")),Hb("#0173C1",u.key("color.blue")),Hb("#14B2F2",u.key("color.lightblue")),Hb("#ee82ee",u.key("color.violet"))]},faces:function(){return[Id(u.key("font.arial"),"Arial",h.none()),Id(u.key("font.comicsans"),"Comic Sans MS",h.none()),Id(u.key("font.consolas"),"Consolas",h.none()),Id(u.key("font.courier"),"Courier",
h.none()),Id(u.key("font.georgia"),"Georgia",h.none()),Id(u.key("font.impact"),"Impact",h.none()),Id(u.key("font.tahoma"),"Tahoma",h.none()),Id(u.key("font.timesnr"),"Times New Roman",h.none()),Id(u.key("font.trebuchet"),"Trebuchet MS",h.none()),Id(u.key("font.verdana"),"Verdana",h.none())]}},mk={configuration:f.constant({i18nNamespace:"font",cssNamespace:"font",property:"font-size",tag:"span",specials:["xx-small x-small small medium large x-large xx-large".split(" ")]})},U9=function(a){var b=!isNaN(parseFloat(a))&&
isFinite(a)?"px":"";return a+b},V9=function(a,b,c){return(t.isValidValue(a,b,c)?h.some(c):h.none()).fold(function(){return H.error("Invalid value: "+c)},function(a){return a===c?H.value(c):H.error("Invalid value: "+c)})},MK=function(a){return kn.identify(a).fold(function(a){return a},function(a,c,d){return Math.round(10*c)/10+d})},Fe={identify:kn.identify,validate:function(a,b,c){return(ke.isEmpty(a)?H.error("can not use empty value for font size."):H.value(a)).map(U9).map(MK).bind(f.curry(V9,b,c))},
sanitise:function(a){return MK(a)}},pn={px:1,em:0.1,"%":10,pt:1,rem:"0.1"},W9=function(a,b,c){return k.find(b,function(a){return k.contains(a,c)}).bind(function(b){return k.indexOf(b,c).bind(function(c){return h.from(b[a(c,b)])})}).getOr(c)},NK=function(a,b,c,d){return Fe.identify(d).fold(function(b){return W9(a,c,b)},function(a,c,d){a=void 0!==pn[d]?pn[d]:1;var f=b*(void 0!==pn[d]?pn[d]:1);return(Q.isNumber(c)&&0<=c?Math.max(a,c+f):a)+d})},nk={decrease:f.curry(NK,function(a,b){return Math.max(0,
a-1)},-1),increase:f.curry(NK,function(a,b){return Math.min(b.length-1,a+1)},1)},eS=C.immutableBag(["i18nNamespace","cssNamespace","property","tag","specials"],[]),X9=C.immutable("size"),Z9=function(a){a=qb.toSelection(a.get()).fold(oa.off,function(a){var c=a.startContainer();a=k.contains(["td","th"],A.name(c))?Ka.freefallLtr(a.startContainer()).element():a.startContainer();a=Y9(a);return oa.on(a)});return X9(a)},$9=function(a){return a.body().bind(function(a){a=t.get(a,"font-size");return h.from(a)})},
OK=function(a){var b=a.dom();if(!b.style)return!1;b=b.style.fontSize;return"body"!==A.name(a)&&!ke.isEmpty(b)},Y9=function(a){var b=A.isText(a)?y.parent(a).getOrDie():a;return(OK(b)?h.some(b):sa.ancestor(b,OK)).fold(function(){return t.get(b,"font-size")},function(a){return a.dom().style.fontSize})},ok={getState:function(a,b){return{readState:Z9(a),fallbackSize:$9(b).getOr("12px")}}},a$=function(a){a.dom().click();return h.some(a)},b$=function(a,b){var c=X.descendants(a,b);if(0<ha.get(a)&&0<c.length){var d=
Ja.absolute(c[0]).top();return k.findIndex(c.slice(1),function(a){return Ja.absolute(a).top()!==d}).map(function(a){return{rows:f.constant(Math.ceil(c.length/(a+1))),columns:f.constant(a+1)}})}return h.none()},c$=function(a){return k.map(a,function(a){var c=a.text,c=u.has("color."+c)?u.key("color."+c):u.raw(c);return jg.color(a.value,c)})},Qh={create:function(a){var b=0<a.length?c$(a):Rw.colors();a=gS();var c=k.map(b,function(a){var b=Pw(a);n.add(b.element(),w.resolve("palette-color-option"));t.set(b.element(),
"background-color",a.hex());return b});k.each(c,a.add);b=b.length%5;if(0!==b%5)for(b=5-b,c=0;c<b;c++){var d=Pw(jg.color("#FFF",u.key("color.white")));n.add(d.element(),w.resolve("palette-color-option"));n.add(d.element(),w.resolve("palette-color-option-spacer"));a.add(d)}return a},makeLayout:function(a,b,c){c=pa.grid(Z.deepMerge({trigger:a$},c));var d=ba.grid(a,{cell:f.constant(b)},4,5,c);return{layout:f.constant(d),refresh:function(){d.clear();b$(a,b).each(function(a){d.resize(a.rows(),a.columns())})}}}},
hS=".ephox-polish-palette-detail-action.ephox-polish-palette-color-option:not(.ephox-polish-palette-color-option-spacer)",iS=function(a){return db.closest(a,".ephox-polish-palette-detail-active")},kS=Y.detect().deviceType.isTouch,uS={widget:function(a,b){var c=a.content(),d=a.undo(),e=a.selections(),g=lS(b),h=D.create({color:K(["value"],g.events.color),highlight:K(["value"],g.events.highlight),done:r([]),abort:K([],g.events.abort)});g.events.color.bind(function(a){h.trigger.done();Ee.foreground(c,
d,e,a.value());c.toEditing()});g.events.highlight.bind(function(a){h.trigger.done();Ee.background(c,d,e,a.value());c.toEditing()});return{element:g.element,name:f.constant("color"),textkey:f.constant(u.key("font.coloroption")),menuTextkey:f.constant(u.key("aria.color.menu")),open:g.open,close:g.close,updateWidget:function(b){vh.isHighContrast(a.smartview())?b.disable():g.open()},ability:f.noop,destroy:g.destroy,events:h.registry,label:f.constant(!1)}}},oS=C.immutableBag(["i18nNamespace","cssNamespace",
"property","tag","specials"],[]),sS={widget:function(a,b){var c=Yn.cata(b,f.constant(f.noop),f.constant(function(a){a.initLayout()})),d=a.content(),e=a.undo(),g=pk(mk.configuration());c(g);var h=D.create({done:r([]),abort:K([],g.events.abort)});g.events.close.bind(function(a){h.trigger.done()});g.events.action.bind(function(b){var c=T.active();d.focus();Ee.size(d,e,a.selections(),b.value());c.each(T.focus)});return{element:g.element,item:g.item,name:f.constant("size"),textkey:f.constant(u.key("font.size")),
open:g.open,close:g.close,updateInlineWidget:function(){var b=ok.getState(a.selections(),d);g.updateInlineWidget(b.readState,b.fallbackSize)},ability:f.noop,destroy:g.destroy,events:h.registry}}},rS={widget:function(a,b){var c=a.content(),d=a.smartview().uiContainer(),e=a.ui().tabstrip.element,g=a.undo(),h=pk(mk.configuration()),k=h.input(),s=ek(e());m.set(k,"disabled","true");var n=E.bind(k,"touchstart",function(b){b.kill();s.closeMenus();var e=pS(c,d,f.curry(pk,mk.configuration()));e.show();b=e.contents;
var h=ok.getState(a.selections(),c),l=function(){e.destroy();c.cursorIntoView()};b.updateInlineWidget(h.readState,h.fallbackSize);b.events.close.bind(l);b.events.action.bind(function(b){Ee.size(c,g,a.selections(),b.value())});e.events.close.bind(e.destroy);e.events.ok.bind(function(b){Ee.size(c,g,a.selections(),b.value());l()})}),q=D.create({done:r([]),abort:K([],h.events.abort)});h.events.close.bind(function(a){q.trigger.done()});h.events.action.bind(function(b){Ee.size(c,g,a.selections(),b.value())});
return{element:h.element,item:h.item,name:f.constant("size"),textkey:f.constant(u.key("font.size")),open:h.open,close:h.close,updateInlineWidget:function(){var b=ok.getState(a.selections(),c);h.updateInlineWidget(b.readState,b.fallbackSize)},ability:f.noop,destroy:function(){n.unbind();h.destroy()},events:q.registry}}},tS={face:function(a){return qb.toSelection(a.get()).map(function(a){var c=a.startContainer();a=k.contains(["td","th"],A.name(c))?Ka.freefallLtr(a.startContainer()).element():a.startContainer();
a=Eh.value(a,"font-family");return ke.isEmpty(a)?oa.off():oa.on(a)}).getOrThunk(oa.unchanged)}},wS=function(a){var b=a.baseUrl;!0===a.source&&(b+="/licenses");return b+"/textbox-licenses.html"},qj=function(a,b){return a.map(function(a){return a.bind(function(a){var c=a[b];return void 0===c?H.error("Cannot find method "+b+" in help article list: "+W.keys(a)):Q.isFunction(c)?H.value(c()):H.error("Key "+b+" in help article list was not a function")})})},yS=function(a){a=Rk.addScript(a,f.identity);a.get(function(a){a.each(function(a){Ge.weakMatch(a.version,
"Help articles").each(function(a){console.warn(a)})})});return{about:qj(a,"about"),accessibility:qj(a,"accessibility"),a11ycheck:qj(a,"a11ycheck"),markdown:qj(a,"markdown"),shortcuts:qj(a,"shortcuts")}},Sh=function(a,b){return a?h.some(b):h.none()},AS=function(a){var b={item:f.constant(".ephox-pastry-statebutton.ephox-pastry-tablayout-item")},c=pa.flow({trigger:ob.button,executeOnArrow:!0});return ba.flow(a.menu(),b,c)},BS=function(a){var b={stops:f.constant(["a"])},c=pa.page({trigger:ob.click,first:".ephox-pastry-tablayout-active"});
return ba.page(a.body(),b,c)},FS=C.immutable("prefix","suffix","style"),Tw={rehighlight:function(a,b,c){var d=y.children(c),e=k.map(d,function(a){return A.isText(a)?Fa.get(a):""}).join("");k.find(b,function(a){return aa.startsWith(e,a.prefix())&&aa.endsWith(e,a.suffix())}).fold(function(){a.preserve(function(){B.unwrap(c)})},function(b){var e=q.fromTag("span");ea.add(e,[de.highlightClass()]);t.setAll(e,b.style());a.preserve(function(){v.before(c,e);J.append(e,d);B.remove(c)})})},unhighlight:function(a,
b){var c=y.children(b),d=q.fromTag("span");ea.add(d,[de.placeholderClass()]);a.preserve(function(){v.before(b,d);B.unwrap(b);J.append(d,c)})}},d$=function(a,b){var c=k.map(b,function(a){var b=cb.sanitise(a.prefix()),c=cb.sanitise(a.suffix()),b=cb.unsafetoken(b+"[^"+c+"]*"+c);return{pattern:f.constant(b),style:a.style}});return rm.findmany(a,c)},e$=vo("."+de.highlightClass(),Ca.unwrap),GS={run:function(a,b){a.body().each(function(a){dk.filterDom(a,[e$]);a=lc.descendants(a,A.isText);k.each(a,function(a){var c=
Fa.get(a),c=d$(c,b),g=k.bind(c,function(a){return[a.start(),a.finish()]}),f=Pg.subdivide(a,g);k.each(c,function(a){var b=Wc.sublist(f,a.start(),a.finish()),b=k.map(b,function(a){return a.element()});Sg.wrapper(b,function(){var b=q.fromTag("span");ea.add(b,[de.highlightClass()]);t.setAll(b,a.style());return Sg.nu(b)})})})})}},Gt=w.resolve("input-invalid-field"),f$=function(a){return parseInt(a,10).toString()===a&&0<=parseInt(a,10)},PK=function(a,b,c){var d=$.get(a);if(""===d)return H.value("");var e=
q.fromTag("img");c=f$(d)?d+c.getOr(""):d;t.set(e,b,c);c=t.getRaw(e,b);t.remove(e,b);return c.fold(function(){return H.error(a)},H.value)},QK=function(a){n.remove(a,Gt)},Wb={highlight:function(a){Oa.shout(a,u.translate("aria.input.invalid"));n.add(a,Gt)},dehighlight:QK,clearHighlights:function(a){a=X.descendants(a,"."+Gt);k.each(a,QK)},validate:function(a){return k.foldr(a,function(a,c){return a.bind(function(a){return PK(c.input(),c.property(),c.defaultUnit()).map(function(b){$.set(c.input(),b);var g=
{};g[c.property()]=f.constant(b);return Z.deepMerge(g,a)})})},H.value({}))},validateField:PK,rule:C.immutable("input","property","defaultUnit")},g$=C.immutable("size","unit"),qn=function(a){return kn.identify(a).fold(h.none,function(a,c,d){return h.some(g$(c,d))})},Io={fromHeight:function(a,b){return qn(b).map(function(b){return Math.ceil(a*b.size())+b.unit()})},fromWidth:function(a,b){return qn(b).map(function(b){return Math.ceil(1/a*b.size())+b.unit()})},calculate:function(a,b){return qn(a).fold(h.none,
function(a){return qn(b).fold(h.none,function(b){return h.some((a.size()+0)/(b.size()+0))})})}},RK=C.immutable("value","text","attrs"),SK=function(a){return"img"===A.name(a)},TK=function(a){return 0===a.length?f.always:function(b){return Jb.allowedForEditing(b,a)}},Vw={image:function(a){var b=TK(a),c=h.none(),d=D.create({properties:r(["image"]),contextmenu:r(["image"])});return{situation:function(a){a=c.map(function(a){return[RK("imagemenu-properties",u.translate("image.context.properties"),{})]}).getOr([]);
return{primary:f.constant(a),secondary:f.constant([]),submenus:f.constant([])}},handle:function(a){c.each(function(a){d.trigger.properties(a)})},assign:function(a){c=a.filter(SK).filter(b);c.each(d.trigger.contextmenu)},events:d.registry}},imageEdit:function(a,b,c,d){var e=TK(d),g=h.none(),l=function(a){return k.map(a,function(a){return RK(a.spec.value,u.get(a.spec.textkey),{})})};return{situation:function(a){a=g.map(l).getOr([]);return{primary:f.constant(a),secondary:f.constant([]),submenus:f.constant([])}},
handle:function(a){g.each(function(b){var c=m.get(a,"data-ephox-gopher-item-value");k.find(b,function(a){return a.spec.value===c}).each(function(a){a.spec.action()})})},assign:function(d){g=a()?h.some(b):d.filter(SK).filter(e).map(f.constant(c))}}}},Ww={generate:function(a,b,c){a=function(){e();d.trigger.close()};var d=D.create({ok:K(c,b.events.ok),close:r([])});b.events.close.bind(a);var e=function(){b.destroy()};return{open:function(){b.open()},hide:a,destroy:e,represent:b.represent,events:d.registry}}},
UK=la.generate([{html:["key","value"]},{css:["key","value"]}]),VK=function(a,b){return k.flatten(W.mapToArray(a,function(a,d){var e=[];if(m.has(b,d)){var g=m.get(b,d);e.push(UK.html(a,g))}t.getRaw(b,d).each(function(b){e.push(UK.css(a,b))});return e}))},h$=function(a){t.remove(a,"width");t.remove(a,"height");m.remove(a,"width");m.remove(a,"height")},i$=f.curry(VK,{width:"width",height:"height"}),j$=f.curry(VK,{width:"height",height:"width"}),WK=f.constant([]),fe={keepCrop:WK,keepFlip:i$,keepRotate:j$,
keepResample:WK,updater:function(a,b){var c=a(b);return Pa.effect(function(){h$(b);k.each(c,function(a){a.fold(function(a,c){m.set(b,a,c)},function(a,c){t.set(b,a,c)})})})}},k$={strictMode:!1,key:"source protocol authority userInfo user password host port relative path directory file query anchor".split(" "),q:{name:"queryKey",parser:/(?:^|&)([^&=]*)=?([^&]*)/g},parser:{strict:/^(?:([^:\/?#]+):)?(?:\/\/((?:(([^:@\/]*)(?::([^:@\/]*))?)?@)?([^:\/?#]*)(?::(\d*))?))?((((?:[^?#\/]*\/)*)([^?#]*))(?:\?([^#]*))?(?:#(.*))?)/,
loose:/^(?:(?![^:@\/]+:[^:@\/]*@)([^:\/?#.]+):)?(?:\/\/)?((?:(([^:@\/]*)(?::([^:@\/]*))?)?@)?([^:\/?#]*)(?::(\d*))?)(((\/(?:[^?#](?![^?#\/]*\.[^?#\/.]+(?:[?#]|$)))*\/?)?([^?#\/]*))(?:\?([^#]*))?(?:#(.*))?)/}},l$=function(a,b){for(var c=b.parser[b.strictMode?"strict":"loose"].exec(a),d={},e=14;e--;)d[b.key[e]]=c[e]||"";d[b.q.name]={};d[b.key[12]].replace(b.q.parser,function(a,c,e){c&&(d[b.q.name][c]=e)});return d},og={parse:function(a,b){var c=Z.merge(k$,b);return l$(a,c)}},XK=function(a){return""!==
a.trim()&&!aa.contains(a,"://")},Jo={local:function(a){return aa.startsWith(a,"data:")||aa.startsWith(a,"blob:")||aa.startsWith(a,"file:")},relative:XK,sameDomain:function(a,b){if(""===a.trim()||""===b.trim())return!1;if(XK(a))return!0;var c=og.parse(b),d=og.parse(a);return c.host===d.host&&c.port===d.port}},m$=C.immutable("bannerMessage","consoleMessage"),YK=function(a){return Q.isFunction(a.message)&&Q.isFunction(a.status)&&Q.isFunction(a.responseText)},ZK=function(a){if(YK(a)){var b=a.responseText();
return a.message()+". Response code "+a.status()+(0===b.length?".":". Error details: "+b)}return a},Lo={diagnoseImageEdit:function(a,b){var c=18===a.code||"SecurityError"===a.name?"imageedit.needsproxy":YK(a)&&0===a.status()?"imageedit.proxyerror":"imageedit.generic",d;d=og.parse(b);d=""===d.host||Jo.relative(b)?b:""===d.port?d.host:d.host+":"+d.port;c=Yd.get(c,[d]);return m$(c,ZK(a))},consoleMessage:ZK},lg={make:function(a,b,c){return{type:"general",spec:{value:a,textkey:u.key(b),action:c,updateGeneral:f.noop,
icon:!0,hasPopup:!1,toggle:!1,tooltip:Va.get}}}},n$=f.constant(4),Ya={resolve:jb.create("ephox-clipper").resolve,CORNER_SIZE:n$},o$=function(a,b){var c={left:"0px",top:"0px",width:a.width()+"px",height:a.height()+"px"},d={left:t.get(b,"left"),top:t.get(b,"top"),width:t.get(b,"width"),height:t.get(b,"height")};return{outside:f.constant(c),inside:f.constant(d)}},p$={snap:function(a,b){var c=o$(a,b),d=q.fromTag("div");n.add(d,Ya.resolve("dynamic-box"));t.setAll(d,c.outside());var e=q.fromTag("div");
n.add(e,Ya.resolve("opaque-box"));t.setAll(e,c.outside());var g=function(a,b){return 2<Math.abs(parseInt(a,10)-parseInt(b,10))},f=function(a){return va.nu(function(b){b(a)})},h=function(a,b){return va.nu(function(c){var d=E.bind(a,"transitionend",function(){d.unbind();c(a)});t.setAll(a,b.inside())})};return{prepare:function(a,c,g){var f=m.get(c,"src"),h=t.get(c,"width");c=t.get(c,"height");t.setAll(b,{"background-image":"url("+f+")","background-size":h+" "+c,"background-position-x":-g.left()+"px",
"background-position-y":-g.top()+"px"});n.add(b,Ya.resolve("snapshot"));n.add(d,Ya.resolve("dynamic-box-animate"));J.append(a,[d,e]);t.reflow(a)},showcase:function(){var a=c.outside(),b=c.inside();return g(a.left,b.left)||g(a.top,b.top)||g(a.right,b.right)||g(a.bottom,b.bottom)?h(d,c):f(d)}}}},YS={slide:function(){return{animate:function(a,b,c,d){c=p$.snap(c.box(),c.shade());c.prepare(a,b,{left:d.cropX,top:d.cropY,width:d.cropWidth,height:d.cropHeight});return c.showcase().map(f.constant(d))}}},none:function(){return{animate:function(a,
b,c,d){return va.pure(d)}}}},WS=C.immutableBag("displayWidth displayHeight cropX cropY cropWidth cropHeight".split(" "),[]),TS={bind:function(a,b){return E.bind(a,"mousedown",function(a){a.kill();var d=a.target(),e=!1,g=E.bind(d,"mouseup",function(){e=!0;g.unbind()});setTimeout(function(){e||(g.unbind(),b(d))},250)})}},q$=C.immutableBag(["top","left","width","height"],[]),r$=C.immutableBag(["top","left"],[]),s$=C.immutableBag(["top","left"],[]),eb={boxModel:q$,delta:r$,cornersMovements:s$},Ht=function(a,
b){var c=Math.min(a.top()+a.height(),Math.max(0,a.top()+b.top())),d=c-a.top(),d=a.height()-d;return{top:c,height:d}},It=function(a,b,c){a=Math.min(a.width(),Math.max(b.left(),b.left()+b.width()+c.left()))-b.left()-b.width();return{width:b.width()+a}},Jt=function(a,b,c){return Math.min(a.height(),Math.max(b.top(),b.top()+c.top()+b.height()))-b.top()},Kt=function(a,b){var c=Math.min(a.width()+a.left(),Math.max(0,a.left()+b.left())),d=c-a.left(),d=a.width()-d;return{left:c,width:d}},uk={nw:function(a,
b,c){a=Ht(b,c);b=Kt(b,c);return eb.boxModel({left:b.left,width:b.width,top:a.top,height:a.height})},n:function(a,b,c){a=Ht(b,c);return eb.boxModel({left:b.left(),width:b.width(),top:a.top,height:a.height})},ne:function(a,b,c){var d=Ht(b,c);a=It(a,b,c);return eb.boxModel({left:b.left(),width:a.width,top:d.top,height:d.height})},e:function(a,b,c){a=It(a,b,c);return eb.boxModel({left:b.left(),width:a.width,top:b.top(),height:b.height()})},se:function(a,b,c){var d=It(a,b,c);a=Jt(a,b,c);return eb.boxModel({left:b.left(),
width:d.width,top:b.top(),height:a})},s:function(a,b,c){a=Jt(a,b,c);return eb.boxModel({left:b.left(),width:b.width(),top:b.top(),height:a})},sw:function(a,b,c){a=Jt(a,b,c);c=Kt(b,c);return eb.boxModel({left:c.left,width:c.width,top:b.top(),height:a})},w:function(a,b,c){a=Kt(b,c);return eb.boxModel({left:a.left,width:a.width,top:b.top(),height:b.height()})},translate:function(a,b,c){var d=Math.min(Math.max(0,b.top()+c.top()),Math.max(0,a.height()-b.height()));a=Math.min(Math.max(0,b.left()+c.left()),
Math.max(0,a.width()-b.width()));return eb.boxModel({top:d,left:a,width:b.width(),height:b.height()})}},Uh={navigation:function(a,b){var c=function(a,c,g){return function(){b(a,Ba(c,g));return h.some(!0)}};return[U.rule(U.and([U.isShift,U.inSet(N.LEFT())]),c(a,-1,0)),U.rule(U.and([U.isShift,U.inSet(N.RIGHT())]),c(a,1,0)),U.rule(U.and([U.isShift,U.inSet(N.UP())]),c(a,0,-1)),U.rule(U.and([U.isShift,U.inSet(N.DOWN())]),c(a,0,1)),U.basic(N.LEFT()[0],c(a,-10,0)),U.basic(N.RIGHT()[0],c(a,10,0)),U.basic(N.UP()[0],
c(a,0,-10)),U.basic(N.DOWN()[0],c(a,0,10))]}},$K=function(a,b,c){var d=b.top(),e=b.left()+b.width()/2-c.middle(),g=d+b.height()/2-c.middle(),h=b.left()+b.width()-c.right();a=b.left()-c.left();c=d+b.height()-c.bottom();b=eb.cornersMovements({top:d,left:e});var e=eb.cornersMovements({top:c,left:e}),k=eb.cornersMovements({top:g,left:h}),g=eb.cornersMovements({top:g,left:a}),m=eb.cornersMovements({top:d,left:a}),d=eb.cornersMovements({top:d,left:h}),h=eb.cornersMovements({top:c,left:h});a=eb.cornersMovements({top:c,
left:a});return{n:f.constant(b),s:f.constant(e),e:f.constant(k),w:f.constant(g),nw:f.constant(m),ne:f.constant(d),se:f.constant(h),sw:f.constant(a)}},Xw={calculate:function(a,b){var c={middle:f.constant(2*Ya.CORNER_SIZE()+1),right:f.constant(Ya.CORNER_SIZE()),left:f.constant(0),bottom:f.constant(Ya.CORNER_SIZE())};return $K(a,b,c)},limitBounds:function(a,b){var c={};if(20>b.width()){var d=20-b.width();c.width=b.width()+d;c.left=b.left()===a.left()?a.left():b.left()-d}20>b.height()&&(d=20-b.height(),
c.height=b.height()+d,c.top=b.top()===a.top()?a.top():b.top()-d);return Z.merge(b,W.map(c,f.constant))},doCalculate:$K},Lt=function(a){return eb.boxModel({left:parseInt(m.get(a,"data-"+Ya.resolve("image-left")),10),top:parseInt(m.get(a,"data-"+Ya.resolve("image-top")),10),width:parseInt(m.get(a,"data-"+Ya.resolve("image-width")),10),height:parseInt(m.get(a,"data-"+Ya.resolve("image-height")),10)})},aL=function(a,b){m.set(a,"data-"+Ya.resolve("image-left"),b.left());m.set(a,"data-"+Ya.resolve("image-top"),
b.top());m.set(a,"data-"+Ya.resolve("image-width"),b.width());m.set(a,"data-"+Ya.resolve("image-height"),b.height())},wf={readPosition:Lt,writePosition:aL,updatePosition:function(a,b){var c=Lt(a),d=b(c),c=Xw.limitBounds(c,d);aL(a,c);return c},drawAtOrigin:function(a){var b=Lt(a);t.setAll(a,{left:b.left()+"px",top:b.top()+"px",width:b.width()+"px",height:b.height()+"px"})}},t$=Ya.resolve("magic-box"),Zw={magicBox:f.constant(t$)},tk={grab:function(a,b){m.set(a,"aria-grabbed",b)},effect:function(a,b){m.set(a,
"aria-dropeffect",b)}},u$=C.immutable("help","ids"),bL=function(a){m.set(a,"role","gridcell")},xf={base:function(a,b){m.setAll(a,{role:"grid","aria-label":b})},row:function(a){m.set(a,"role","row")},cell:function(a,b){bL(a);m.set(a,"aria-label",b)},gridcell:bL,createHelp:function(a,b,c){var d=q.fromTag("div");O.presentation(d);n.add(d,oi.resolve("aria-help"));for(var e=[],g=0;g<b;g++){var f=Ma.generate("ephox-aria"),h=q.fromTag("span");O.presentation(h);m.set(h,"id",f);n.add(h,oi.resolve("aria-help"));
v.append(h,q.fromText(c.col(g+1)));v.append(d,h);e[g]=f}g=[];for(f=0;f<a;f++){var h=Ma.generate("ephox-aria"),k=q.fromTag("span");O.presentation(k);m.set(k,"id",h);n.add(k,oi.resolve("aria-help"));v.append(k,q.fromText(c.row(f+1)));v.append(d,k);g[f]=[];for(k=0;k<b;k++)g[f][k]=e[k]+" "+h}return u$(d,g)}},Ie=function(a,b,c){var d=q.fromTag("div");t.set(d,"position","absolute");var e=q.fromTag("div");v.append(d,e);c.each(function(a){xf.cell(d,a);tk.grab(d,!1)});ea.add(d,[Ya.resolve("corner-wrapper"),
Ya.resolve("corner-wrapper-"+b)]);ea.add(e,[Ya.resolve("corner-element"),Ya.resolve("corner-"+a)]);m.set(d,"data-"+Ya.resolve("direction"),b);return d},Je=function(a,b){t.setAll(a,{top:b.top()+"px",left:b.left()+"px"})},Yw=function(a,b,c){var d=b()<c()?0:1;k.each(a,function(a){t.set(a,"opacity",String(d))})},PS={derive:function(a,b){return{leftRim:function(){var c=b.left(),d=a.height();return eb.boxModel({top:0,left:0,width:c,height:d})},topRim:function(){var c=b.left(),d=a.width()-b.left(),e=b.top();
return eb.boxModel({top:0,left:c,width:d,height:e})},rightRim:function(){return eb.boxModel({top:b.top(),left:b.left()+b.width(),width:a.width()-b.width()-b.left(),height:a.height()-b.top()})},bottomRim:function(){return eb.boxModel({top:b.top()+b.height(),left:b.left(),width:b.width(),height:a.height()-b.height()-b.top()})},shadeBox:f.constant(b)}}},rk=function(a){var b=q.fromTag("div");ea.add(b,[Ya.resolve("panel-"+a),Ya.resolve("side-panel")]);return b},sk=function(a,b){t.setAll(a,{top:b.top()+
"px",left:b.left()+"px",width:b.width()+"px",height:b.height()+"px"})},SS=function(a){var b=a.width();a=a.height();var c=Math.floor(0.125*a),d=Math.floor(0.125*b);return eb.boxModel({top:c,left:d,width:b-2*d,height:a-2*c})},VS=function(a){var b=Ja.absolute(a),c=b.top(),d=ha.get(a),b=b.left();a=ra.get(a);return eb.boxModel({top:c,left:b,width:a,height:d})},ZS=function(a,b){Jb.detect(a.getSelection()).fold(function(){a.setRelativeSelection(da.before(b),da.before(b))},function(b){a.setRelativeSelection(da.on(b.image(),
0),da.on(b.image(),0))})},cL=function(a,b,c,d){return a(function(a){var g=E.bind(b,c,function(b){clearTimeout(f);g.unbind();a(H.value(b))}),f=setTimeout(function(){g.unbind();a(H.error("Event "+c+" did not fire within "+d+"ms"))},d)})},v$={cWaitFor:function(a,b,c){return cL(Xd.nu,a,b,c)},waitFor:function(a,b,c){return cL(va.nu,a,b,c)}},w$=Pa.fToFR(ve.single),Mo={run:function(a,b,c){return Pa.fromChain([a.getImage,b,w$,c])},applyEdit:function(a){return function(b){var c=kc.cata(b,function(a,b,c){return c},
function(a,b,c){return b});m.set(a,"src",c);b=Pa.pure(b);return a.dom().loaded?b:Pa.bind(v$.waitFor(a,"load",1E3),f.constant(b))}}},x$=function(a){return 20<=a},Mt=function(a){return h.from(a).filter(x$)},aT={ensureMin:Mt,parse:function(a,b){var c=Mt(a).getOr(0),d=Mt(b).getOr(0);return 0===c&&0===d?h.none():h.some(jn(c,d))}},dT=function(a){return function(b){var c=b.image(),d=b.asset(),e=function(a){a.fold(function(){m.remove(c,"src")},function(a){kc.cata(a,function(a,b,d){m.set(c,"src",d)},f.noop)})};
return Vm.loadIfNeeded(c).bind(function(){return a(d).map(function(a){e(a);return a})})}},bT=f.constant(Pa.pure),cT=f.constant(function(a){return Pa.pure(a.asset())}),$w={edit:function(a,b,c,d){return{items:d,updatePalette:function(d){if(c())d.hide(h.none())&&a();else{var g=f.curry(d.show,h.some(u.translate("image.context.palette.show")));d=f.curry(d.hide,h.some(u.translate("image.context.palette.hide")));(b().isSome()?g:d)()&&a()}}}},crop:function(a,b,c){return{items:c,updatePalette:function(c){(b()?
c.show:c.hide)(h.none())&&a()}}}},dL=function(a){var b=aa.startsWith(a,"www.")?"http://"+a:a;return{text:f.constant(a),href:f.constant(b)}},Nt={preprocess:dL,auto:function(a){return dL(a).href()}},eL=function(a,b){a.setRelativeSelection(da.after(b),da.after(b))},y$=function(a,b,c,d){var e=a.getSelection();return Jb.detect(e).fold(function(){return e.fold(function(){return[]},function(a){return(a.collapsed()?c:d)(a)})},function(a){return b(a.image())})},z$=function(a,b,c){var d=q.fromTag("a");rn(d,
Z.deepMerge(b,{text:f.constant(h.none())}));v.wrap(c,d);ee.select(a,c);return[d]},rn=function(a,b){b.url().each(function(b){b=Nt.auto(b);Ng.attr(a,"href",b)});b.title().each(function(b){Ng.attr(a,"title",b)});b.target().each(function(b){Ng.attr(a,"target",b)});b.action().each(function(b){b(a)});return b.text().filter(b.textChanged).map(function(b){nb.set(a,b);return!0}).getOr(!1)},A$=function(a){return function(b){return{link:b,properties:a}}},B$=function(a){return function(b){return{link:b,properties:Z.deepMerge(a,
{text:f.constant(h.some(nb.get(b)))})}}},C$=function(a){return function(b){var c=hr.findDescendants(b.startContainer(),b.startOffset(),b.endContainer(),b.endOffset(),"a");b=0<c.length?c:hr.findAncestors(b.startContainer(),b.endContainer(),"a");return k.map(b,1===b.length?A$(a):B$(a))}},D$=function(a,b){return y$(a,f.curry(z$,a,b),function(c){var d=q.fromTag("a");rn(d,b);xc.insertAtCursor(a,[d]);b.action().each(function(a){a(d)});eL(a,d);return[d]},function(c){a.execCommand("CreateLink",!1,Nt.auto(b.url().getOr("")));
c=a.getSelection().map(C$(b)).getOr([]);k.each(c,function(c){rn(c.link,c.properties);b.action().each(function(a){a(c.link)});eL(a,c.link)});return k.map(c,function(a){return a.link})})},Ot={hyperlink:function(a,b){var c=b.text().fold(f.constant(b),function(a){return Z.deepMerge(b,{text:f.constant(h.some(0<a.trim().length?a:b.url().getOr(""))),textChanged:0<a.trim().length?b.textChanged:f.constant(!0)})});a.focus();return c.url().fold(f.constant([]),function(b){return 0<b.trim().length?D$(a,c):[]})},
setProperties:rn},fL=function(a,b){var c=ja.getEnd(b);a.setSelection(b,c,b,c)},gL=function(a,b){a.setSelection(b,0,b,0)},Nx={selectEnd:fL,moveToEnd:function(a){a.getSelection().each(function(b){fL(a,b.endContainer());a.focus()})},selectStart:gL,moveToStart:function(a){a.getSelection().each(function(b){gL(a,b.endContainer());a.focus()})}},hL=function(a,b){return a.getSelection().bind(function(c){return Pc.sharedLinkOrClosest(c,a.isRoot).map(function(a){b(a);return a})})},Ro={insert:Ot.hyperlink,update:function(a,
b){return hL(a,function(c){b.text().fold(function(){Ot.setProperties(c,b)},function(d){""===d&&""!==nb.get(c)?(a.setRelativeSelection(da.before(c),da.before(c)),B.remove(c)):Ot.setProperties(c,b)&&(d=y.children(c).length,a.setRelativeSelection(da.on(c,d),da.on(c,d)))});a.focus()})},unlink:function(a){hL(a,function(b){a.setSelection(b,0,b,y.children(b).length);var c=y.lastChild(b);B.unwrap(b);c.each(function(b){Nx.selectEnd(a,b)});a.focus()})}},E$=function(a){return a.getSelection().bind(function(b){return a.win().bind(function(a){var d=
Vb.exact(b.startContainer(),b.startOffset(),b.endContainer(),b.endOffset());return Ea.getFirstRect(a,d).map(function(a){a={left:a.left(),top:a.top(),right:a.right(),bottom:a.bottom(),width:a.width(),height:a.height()};return{bounds:f.constant(a),element:f.constant(b.startContainer())}})})})},iL=function(a,b,c){E$(b).fold(function(){jw.insertAtCursor(a,b,c)},function(d){var e=d.bounds();d=d.element();(A.isText(d)?y.parent(d):h.some(d)).each(function(d){d=a.directionAt(d);var h=b.translateScreen(e.left,
e.top);c({left:h.left,top:h.top,height:f.constant(e.height),width:f.constant(e.width),direction:f.constant(d)})})})},jL=function(a,b,c,d,e,g,f){var h=e.direction();a=yk.makeshift(a,b,e.left(),e.top(),e.width(),e.height(),h,g,f);b.show(c,a);c.setComponents([d.element()])},Qo={show:function(a,b,c,d,e){iL(a,b,function(a){jL(b,c,d,e,a,ag(0,0))})},showExpandable:function(a,b,c,d,e){iL(a,b,function(a){n.add(d.panel(),w.resolve("expandable-popup"));var f=ag(22,14),h={maxHeightFunction:Pd.expandable()};jL(b,
c,d,e,a,f,h)})}},Pt=function(a,b,c){a=Yb(a);b=u.translate(b);a.content(mc(b));n.add(a.element(),w.resolve(c));O.button(a.element(),b);return a},kL=function(a){var b=P.div();n.add(b,w.resolve("main-controls"));J.append(b,a);return b},lL=function(a,b,c){var d=Pt("remove","link.dialog.remove","link-remove"),e=Pt("cancel","button.cancel","link-cancel"),f=Pt(a,b,c);a=D.create({remove:K([],d.events.click),cancel:K([],e.events.click),execute:K([],f.events.click)});b=[ba.button(d.element(),pa.button({execute:ob.click})),
ba.button(e.element(),pa.button({execute:ob.click})),ba.button(f.element(),pa.button({execute:ob.click}))];return{remove:d,cancel:e,execute:f,keylayouts:b,events:a.registry,destroy:function(){d.destroy();e.destroy();f.destroy()}}},ex={insert:function(){var a=lL("insert","link.dialog.insert","link-insert"),b=kL([a.cancel.element(),a.execute.element()]);a.remove.disable();ga.disable(a.remove.element());return{dialogTitle:f.constant(u.key("link.dialog.aria.insert")),elements:f.constant([a.remove.element(),
b]),events:f.constant(a.events),keylayouts:f.constant(a.keylayouts),execute:a.execute,destroy:a.destroy}},update:function(){var a=lL("update","link.dialog.update","link-update"),b=kL([a.cancel.element(),a.execute.element()]);return{dialogTitle:f.constant(u.key("link.dialog.aria.update")),elements:f.constant([a.remove.element(),b]),events:f.constant(a.events),keylayouts:f.constant(a.keylayouts),execute:a.execute,destroy:a.destroy}}},mL=w.resolve("link-validation-highlight"),nL=w.resolve("link-validation-invalid"),
oL=w.resolve("link-validation-unknown"),pL=f.constant([mL,nL,oL]),ud={configure:function(a){k.each(pL(),function(b){a.add(a.output(),b,Ca.removeClass(b));a.add(a.internal(),b,Ca.removeClass(b))})},allClasses:pL,invalidLink:f.constant(nL),unknownLink:f.constant(oL),validationHighlight:f.constant(mL)},dx={enabled:function(a){var b=h.none(),c=C.immutable("value","text","attrs"),d=D.create({properties:r(["link"]),follow:r(["link"]),ignore:r(["link"]),remove:r(["link"])}),e={"linkmenu-properties":d.trigger.properties,
"linkmenu-follow":d.trigger.follow,"linkmenu-ignore":d.trigger.ignore,"linkmenu-remove":d.trigger.remove};return{situation:function(a){a=b.map(function(a){var b=[c("linkmenu-properties",u.translate("link.context.edit"),{}),c("linkmenu-follow",u.translate("link.context.follow"),{}),c("linkmenu-remove",u.translate("link.context.remove"),{})];a=n.has(a,ud.validationHighlight())?[c("linkmenu-ignore",u.translate("link.context.ignore"),{})]:[];return b.concat(a)}).getOr([]);return{primary:f.constant(a),
secondary:f.constant([]),submenus:f.constant([])}},handle:function(a){b.each(function(b){var c=m.get(a,"data-ephox-gopher-item-value"),c=e[c];void 0!==c&&c(b)})},assign:function(c){b=c.bind(function(b){return I.closest(b,"a[href]",a.isRoot)})},events:d.registry}},disabled:function(){var a=kf.noSituation(),b=D.create({properties:r(["link"])});return{situation:a,handle:f.noop,assign:f.noop,events:b.registry}}},sn=w.resolve("link-eph-cursor"),F$=function(a){k.each(a,B.remove)},G$=function(a,b){qL("textbox-bookmark-top",
a,v.prepend,b,Wa.top())},H$=function(a,b){qL("textbox-bookmark-bottom",a,v.append,b,Wa.bottom())},qL=function(a,b,c,d,e){var f=Wj.generate(a);k.each(b,function(a){m.set(a,"href","#"+f)});a=X.children(d,"["+Wa.bookmarkDataAttr()+'="'+e+'"]');k.each(a,B.remove);0<b.length&&(b=q.fromTag("span"),m.setAll(b,{id:f,style:"visibility: hidden;"}),m.set(b,Wa.bookmarkDataAttr(),e),c(d,b))},ng={configure:function(a){a.add(a.internal(),sn,Ca.remove);a.add(a.output(),sn,Ca.remove);a.addExcludedContext(["."+sn]);
a.addSelector(a.input(),"["+Wa.bookmarkDataAttr()+"]",F$);a.addSelector(a.output(),"["+Wa.bookmarkAnchorDataAttr()+'="'+Wa.top()+'"]',G$);a.addSelector(a.output(),"["+Wa.bookmarkAnchorDataAttr()+'="'+Wa.bottom()+'"]',H$)},properties:C.immutableBag("url textChanged text title target action invalid".split(" "),[]),insertCursor:f.constant(sn)},Vh=w.resolve("inline-popup-expanded"),I$={setValue:function(a,b,c){a=a.dom();a.value=b;a.text=c}},rL=function(a,b){a.dom().add(b.dom())},Po={getValue:function(a){var b=
a.dom();a=b.selectedIndex;b=b.options[a];return void 0===b||-1===a?h.none():h.from(b.value)},add:rL,addAll:function(a,b){k.each(b,function(b){rL(a,b)})},setSelected:function(a,b){a.dom().selectedIndex=b}},sL=[{value:"",i18nKey:"link.properties.target.none"},{value:"_blank",i18nKey:"link.properties.target.blank"},{value:"_top",i18nKey:"link.properties.target.top"},{value:"_self",i18nKey:"link.properties.target.self"},{value:"_parent",i18nKey:"link.properties.target.parent"}],jT={target:function(a){var b=
dc.common("select","target-container","link.properties.target.label"),c=k.map(sL,function(a){var b=q.fromTag("option");I$.setValue(b,a.value,u.translate(a.i18nKey));return b});Po.addAll(b.field(),c);var d=a.target().getOr("");a=k.findIndex(sL,function(a){return a.value===d}).getOr(0);Po.setSelected(b.field(),a);return{element:b.element,input:b.field}}},iT=function(){var a=P.div();n.add(a,w.resolve("invalid-link-info"));var b=dc.comboBox("href-url-value","link.properties.url.label",h.some(a));m.setAll(b.input(),
{placeholder:u.translate("link.properties.url.placeholder"),autocomplete:"off",autocorrect:"off"});var c=n.toggler(b.element(),w.resolve("link-is-invalid"));return{input:b.input,element:b.element,dropArrow:b.dropArrow,showInvalid:function(){c.on();var d=P.span();ea.add(d,[w.resolve("icon"),w.resolve("invalid-link-icon")]);v.append(a,d);var e=u.translate("link.properties.url.invalid");m.set(d,"title",e);d=Oa.describe(b.input(),e);m.set(d,"aria-live","assertive");v.append(a,d)},hideInvalid:function(){c.off();
B.empty(a);m.remove(b.input(),"aria-describedby")}}},lT=1E4,oT={stringArray:function(a){var b={};k.each(a,function(a){b[a]={}});return W.keys(b)}},Wh={url:function(a){return h.some(a.url())},title:function(a){return a.title()},innerText:function(a){a=a.innerText();return 0<a.length?h.some(a):h.none()}},Pb={resolve:jb.create("ephox-tarot").resolve},tL=function(a,b,c,d,e){var f=q.fromText(a.substr(0,b));b=q.fromText(a.substr(b,c));a=q.fromText(a.substr(d));e=q.fromTag(e);v.append(e,b);return[f,e,a]},
uL=function(a,b,c,d){var e=P.tag(b);J.append(e,c);d.each(function(a){n.add(e,a)});return{item:f.constant(a),marked:f.constant(h.some(e))}},vL=function(a,b,c,d){var e=a.text,f=a.marker.start(),l=a.marker.length(),k=0;0<d-(f+l)||0===f||(k=l>d?f-10:f-Math.floor((d-l)/2));d=e.substr(k);f-=k;b=tL(d,f,l,f+l,b);e=d.length===e.length?h.none():h.some(Pb.resolve("anchor-before"));return uL(a.item(),c,b,e)},Qt=function(a,b){var c=P.span();n.add(c,b);J.append(c,a);return c},wL=function(a,b,c){var d=[];b=Qt(b,
Pb.resolve("content-innertext"));0<a.length&&(a=Qt([q.fromText(a)],Pb.resolve("anchor-before")),d.push(a));d.push(b);0<c.length&&(c=Qt([q.fromText(c)],Pb.resolve("anchor-after")),d.push(c));return d},Rt={contentMarker:function(a,b,c,d){var e=a.item().before(),f=a.item().after(),l=a.text;if(0===e.length&&0===f.length&&l.length>d)return vL(a,b,c,d);d=a.marker.start();var k=a.marker.length();b=tL(l,d,k,d+k,b);e=wL(e,b,f);return uL(a.item(),c,e,h.none())},contentUnderlined:wL,attrMarker:vL},xL=function(a,
b,c){a=P.tag(b);v.append(a,q.fromText(c));return a},bx={anchors:function(a,b){var c=b.item(),d=c.url(),e=P.div();n.add(e,Pb.resolve("item-line"));var f=c.title().getOr(d);m.set(e,"title",f);c=b.marked().fold(function(){return xL(a,"div",f)},function(a){return a});n.add(c,Pb.resolve("item-main-label"));d=h.from(d).map(function(b){return b!==f?(b=xL(a,"div",b),n.add(b,Pb.resolve("item-secondary-label")),[b]):[]}).getOr([]);d=[c].concat(d);J.append(e,d);return e},standard:function(a,b){var c=b.item(),
d=P.div();n.add(d,Pb.resolve("item-line"));n.add(d,Pb.resolve("bookmark-icon"));var e=[c.before(),c.innerText(),c.after()].join("");m.set(d,"title",e);e=b.marked().fold(function(){var a=Rt.contentUnderlined(c.before(),[q.fromText(c.innerText())],c.after()),b=P.div();J.append(b,a);return b},function(a){return a});n.add(e,Pb.resolve("item-main-label"));c.indent()&&n.add(e,Pb.resolve("indent"));v.append(d,e);return d},error:function(a,b){var c=P.span(),d=q.fromText(b);v.append(c,d);return c}},J$=C.immutable("matchFunction",
"start","length"),K$=function(a,b,c){for(var d=0,e=[],f=function(a){e.push(a);d++},h=0,k=a.length;h<k&&d<b;h++)c(a[h]).each(f);return e},St={unmarked:function(a,b){var c=b.getOr(1E3),c=a.length>c?a.slice(0,c):a;return k.map(c,function(a){return{item:f.constant(a),marked:h.none}})},match:function(a,b,c,d){var e=c.toLowerCase();c=d.getOr(1E3);return K$(a,c,function(a){return $a.findMap(b,function(b){return b(a).bind(function(c){var d=c.toLowerCase().indexOf(e);if(-1<d){var k=e.length;return h.some({item:f.constant(a),
marked:h.none,text:c,marker:J$(b,d,k)})}return h.none()})})})},mark:function(a,b,c,d){return k.map(a,function(a){return(a.marker.matchFunction()===Wh.innerText?Rt.contentMarker:Rt.attrMarker)(a,b,c,d)})}},yL="data"+Pb.resolve("section-id"),Tt={create:function(a,b){var c=q.fromTag("ol");m.set(c,yL,b.id());var d=function(){B.empty(c)};return{element:f.constant(c),clear:d,add:function(a){var b=q.fromTag("li");v.append(b,a);v.append(c,b);return b},spec:f.constant(b),destroy:function(){d()}}},dataIdAttribute:f.constant(yL)},
L$=C.immutableBag(["container","sections","translate"],["doc"]),M$=C.immutableBag("id highlight contentLimit items render extractors".split(" "),["itemLimit"]),Ut="data"+Pb.resolve("item-id"),wk={init:function(a,b){var c=b.doc().getOr(q.fromDom(document)),d=b.translate(),e={},g=Mh(),l=P.div();n.add(l,Pb.resolve("predictive-menu"));O.hidden(l,!0);var p=mT(a,l),s=function(){k.each(g.state(),function(a){t(a,[])})},t=function(a,b){B.remove(a.element());a.clear();var d={};0<b.length&&(k.each(b,function(b){var e=
a.spec().render()(c,b),e=a.add(e),g=Ma.generate("");m.set(e,Ut,g);d[g]={gui:f.constant(e),item:f.constant(b.item())}}),v.append(l,a.element()));e[a.spec().id()]=d},x=function(){return y.parent(l).isSome()},u=function(a){n.add(a,Pb.resolve("selected"));H().bind(N).each(function(a){Oa.speak(ca.body(),a.item().url())})},w=function(a){u(a);Ga.intoViewIfNeeded(a,l)},A=function(a){n.remove(a,Pb.resolve("selected"))},C=function(){I.descendant(l,"li").each(w)},F=function(){qa.one("ol:last-child li:last-child",
l).each(w)},H=function(){return I.descendant(l,"li."+Pb.resolve("selected"))},J=function(){return H().bind(N).map(function(a){a=a.item();Oa.speak(ca.body(),d("link.dialog.autocomplete.accept",a.url()));return a})},K=function(a){0===y.children(a).length?y.nextSibling(a).fold(C,K):y.firstChild(a).fold(F,w)},L=function(a){0===y.children(a).length?y.prevSibling(a).fold(F,L):y.lastChild(a).fold(C,w)},N=function(a){a=I.closest(a,"["+Ut+"]");var b=a.bind(function(a){return I.closest(a,"["+Tt.dataIdAttribute()+
"]")}),c=a.map(function(a){return m.get(a,Ut)});return b.map(function(a){return m.get(a,Tt.dataIdAttribute())}).bind(function(a){return h.from(e[a])}).bind(function(a){return c.bind(function(b){return h.from(a[b])})})},Q=E.capture(l,"mouseover",function(a){a=a.target();db.closest(a,"li."+Pb.resolve("selected"))||N(a).fold(f.noop,function(a){H().each(function(a){A(a)});u(a.gui())})}),S=E.capture(l,"click",function(a){J().each(T.trigger.click)}),T=D.create({click:r(["item"])}),U=Eb.ensure(["url","indent"]);
k.each(b.sections(),function(a){k.each(a.items(),U);a=Tt.create(c,a);g.push(a)});s();return{element:f.constant(l),events:T.registry,reset:s,resetFull:function(){k.each(g.state(),function(a){a.clear();var b=a.spec().items(),c=a.spec().itemLimit(),b=St.unmarked(b,c);t(a,b)})},filter:function(a){0<a.length?(e={},k.each(g.state(),function(b){var c=b.spec(),d=St.match(c.items(),c.extractors(),a,c.itemLimit()),c=St.mark(d,c.highlight(),"div",c.contentLimit());t(b,c)})):s()},show:function(a){var c=b.container();
v.append(c,l);p.position(a,gg.relativeOrigin(c));Oa.speak(ca.body(),d("link.dialog.autocomplete.open"))},isShowing:x,hide:function(){x()&&Oa.speak(ca.body(),d("link.dialog.autocomplete.close"));B.remove(l);H().each(A)},getSelectedData:J,moveup:function(){H().fold(F,function(a){A(a);y.prevSibling(a).fold(function(){y.parent(a).bind(y.prevSibling).fold(F,L)},w)})},movedown:function(){H().fold(C,function(a){A(a);y.nextSibling(a).fold(function(){y.parent(a).bind(y.nextSibling).fold(C,K)},w)})},destroy:function(){Q.unbind();
S.unbind();k.each(g,function(a){a.destroy()});B.remove(l)}}},config:L$,section:M$},rT=Y.detect().browser.isSafari(),No=50,qT=1E3,Oo=C.immutable("url","indent","action","before","innerText","after"),pT=C.immutable("url","indent","title","action"),cx=C.immutable("url","action"),ax=C.immutable("url","indent","action"),Vt=la.generate([{invalid:["invalidUrl"]},{unknown:["unknownUrl"]},{valid:["validUrl"]}]),gx={cata:function(a,b,c,d){return a.fold(b,c,d)},derive:function(a,b){return"VALID"===b?Vt.valid(a):
"INVALID"===b?Vt.invalid(a):Vt.unknown(a)}},zL=[se("url"),TH("fresh",!1)],N$=cf(zL),O$=cf([cj("urls","urls",Gm(),n6(zL))]),fx={one:f.constant(N$),many:f.constant(O$)},P$={recompose:function(a){var b="";""!==a.protocol&&(b+=a.protocol,b+=":");""!==a.authority&&(b=b+"//"+a.authority);b+=a.path;""!==a.query&&(b+="?",b+=a.query);""!==a.anchor&&(b+="#",b+=a.anchor);return b}},tn={remove:function(a){for(var b="";""!==a;)if(aa.startsWith(a,"../"))a=aa.removeLeading(a,"../");else if(aa.startsWith(a,"./"))a=
aa.removeLeading(a,"./");else if(aa.startsWith(a,"/./"))a="/"+aa.removeLeading(a,"/./");else if("/."===a)a="/";else if(aa.startsWith(a,"/../"))a="/"+aa.removeLeading(a,"/../"),b=aa.removeTrailing(b,b.substring(b.lastIndexOf("/")));else if("/.."===a)a="/",b=aa.removeTrailing(b,b.substring(b.lastIndexOf("/")));else if("."===a||".."===a)a="";else{var c=a.match(/(^\/?.*?)(\/|$)/)[1];a=aa.removeLeading(a,c);b+=c}return b}},Q$={merge:function(a,b,c){if(""!==c&&""===a)return"/"+b;c=a.substring(a.lastIndexOf("/")+
1);return aa.removeTrailing(a,c)+b}},R$={transform:function(a,b){var c={strictMode:!0},d=og.parse(a,c),c=og.parse(b,c),e={};""!==c.protocol?(e.protocol=c.protocol,e.authority=c.authority,e.path=tn.remove(c.path),e.query=c.query):(""!==c.authority?(e.authority=c.authority,e.path=tn.remove(c.path),e.query=c.query):(""===c.path?(e.path=d.path,e.query=""!==c.query?c.query:d.query):(aa.startsWith(c.path,"/")?e.path=tn.remove(c.path):(e.path=Q$.merge(d.path,c.path,a.authority),e.path=tn.remove(e.path)),
e.query=c.query),e.authority=d.authority),e.protocol=d.protocol);e.anchor=c.anchor;return e}},hx={resolve:function(a,b){var c=R$.transform(a,b);return P$.recompose(c)}},AT=C.immutable("href","resolved"),CT={generate:function(a){var b={};k.each(a,function(a){var d=a.resolved();a=a.href();b.hasOwnProperty(d)?k.contains(b[d],a)||b[d].push(a):b[d]=[a]});return b}},S$={rules:[{current:ma.backtrack,next:ma.sidestep,fallback:h.none()},{current:ma.sidestep,next:ma.sidestep,fallback:h.some(ma.backtrack)},
{current:ma.advance,next:ma.sidestep,fallback:h.some(ma.sidestep)}],inclusion:function(a,b,c){return!a.property().parent(c).exists(function(c){return a.eq(c,b.item())})}},T$=ma.walkers(),AL=function(a,b,c,d){return ma.walk(a,b,c,T$.left(),d.rules).map(function(c){return a.property().isEmptyTag(c.item())||a.property().isBoundary(c.item())?[]:(d.inclusion(a,c,b)?[c.item()]:[]).concat(AL(a,c.item(),c.mode(),d))}).getOr([])},BL=function(a,b,c){a=AL(b,c,ma.sidestep,a);return k.reverse(a).concat([c])},
CL={top:f.curry(BL,S$),all:f.curry(BL,{rules:void 0,inclusion:function(a,b,c){return a.property().isText(b.item())}})},DL=Sa(),EL={top:function(a){return CL.top(DL,a)},all:function(a){return CL.all(DL,a)}},U$=function(a,b){var c=Wc.generate(b,function(b,c){return a.property().isText(b)?h.some(S.range(b,c,c+a.property().getText(b).length)):h.none()}),d=k.foldr(c,function(b,c){return a.property().getText(c.element())+b},"");return{list:f.constant(c),text:f.constant(d)}},V$=function(a,b,c,d){var e=Wc.find(b.list(),
function(b){return a.eq(b.element(),c)}).map(function(a){return a.start()+d});return{list:b.list,text:b.text,cursor:f.constant(e)}},W$={from:function(a,b,c,d){b=U$(a,b);return V$(a,b,c,d)}},X$=Sa(),Y$={from:function(a,b,c){return W$.from(X$,a,b,c)}},PT={get:function(a,b){var c=EL.all(a),d=Y$.from(c,a,b),c=d.cursor().orThunk(function(){return A.isText(a)?h.none():h.some(d.text().length)});return{list:d.list,text:d.text,cursor:f.constant(c)}}},FL=function(a,b){return{patterns:function(){return[RegExp("^("+
a+")(.+)","gi")]},useCursor:f.never,generate:function(a,d){var e=q.fromTag(b,a.dom());J.append(e,d.clones());return cd.species({elements:f.constant([e]),cursor:h.none,dictation:h.none,notify:h.none})},derive:function(a){var b=a[1];return h.some({startIndex:f.constant(a.index),finishIndex:f.constant(a.index+b.length)})}}},pg={normal:function(a,b){var c=cb.sanitise(a);return FL(c,b)},spaced:function(a,b){var c=cb.sanitise(a)+"\\s";return FL(c,b)}},GL=function(a,b){return cd.species({elements:f.constant([q.fromText(b.text())]),
cursor:h.none,dictation:h.none,notify:h.none})},Z$=function(){return{patterns:function(){return[/([^.?!][.?!]\s+)([a-z][^\s]*)/g,/^()([a-z][^\s]*)/g]},useCursor:f.constant(!0),generate:GL,derive:function(a){var b=a.index,c=b+a[0].length;a=a[1]+aa.capitalize(a[2]);return h.some({startIndex:f.constant(b),finishIndex:f.constant(c),text:f.constant(a)})}}}(),$$=function(){return{patterns:function(){return[RegExp("([A-Z][A-Z]+)([a-z]+)","g")]},useCursor:f.constant(!1),generate:GL,derive:function(a){var b=
a[2],b=aa.capitalize(a[1].toLowerCase())+b.toLowerCase(),c=a.index;a=c+a[0].length;return h.some({startIndex:f.constant(c),finishIndex:f.constant(a),text:f.constant(b)})}}}(),ix={capitalise:f.constant(Z$),normalise:f.constant($$)},NT={patterns:function(){return[ql.autolink()]},useCursor:f.constant(!0),generate:function(a,b){var c=q.fromTag("a");m.set(c,"href",b.href());v.append(c,q.fromText(b.text()));return cd.species({elements:f.constant([c]),cursor:h.none,dictation:h.none,notify:f.curry(h.some,
[c])})},derive:function(a){var b=Nt.preprocess(a[1]),c=b.text(),b=b.href();return-1<c.indexOf("@")?h.none():h.some({startIndex:f.constant(a.index),finishIndex:f.constant(a.index+c.length),text:f.constant(c),href:f.constant(b)})}},HT="headings",IT="lists",JT="semantics",KT="entities",LT="hr",MT="link",GT=f.constant(function(a,b){return b}),aaa={cloneAfter:function(a,b,c){var d=b;return k.map(a,function(a){var b=ac.deep(a);A.isText(a)&&L.eq(c.endContainer(),a)&&Fa.get(a).length>c.endOffset()&&Fa.set(b,
Fa.get(b).substring(0,c.endOffset()));if(A.isText(b)&&0<d){var f=Fa.get(b);a=Math.min(f.length,d);f=f.substring(a);Fa.set(b,f);d-=a}return b})}},HL={matcher:function(a,b,c){var d=function(a){return c.fold(function(){return a&&1<a.length},function(b){return a&&0<a.length&&a.index+a[0].length===b})};return $a.findMap(a,function(a){a:{if(!a.global)throw"Macro matching only works with global regexes: "+a;for(var c=a.exec(b);c;){if(d(c)){a=h.some(c);break a}c=a.exec(b)}a=h.none()}return a})}},baa=function(a,
b,c,d){b=aaa.cloneAfter(b,d.finishIndex(),c);var e=Z.merge(d,{clones:f.constant(b)});return{build:function(b){b=a.generate(b,e);return cd.applicator({elements:b.elements,cursor:b.cursor,range:f.constant(c),dictation:b.dictation,notify:b.notify})}}},caa=function(a,b,c){b=Wc.get(a,b);var d=Wc.get(a,c);return b.bind(function(a){return d.map(function(b){return{start:f.constant(a),finish:f.constant(b)}})})},daa=function(a,b){return b(a.start().element())&&b(a.finish().element())?h.some(a):h.none()},eaa=
function(a,b,c){return b.doc().bind(function(d){d=a.build(d);var e=d.elements();k.map(e,bf.doNotMerge);var f=aw.handle(d.range());xc.insertAt(b,f,e);k.map(e,bf.clear);d.dictation().each(function(a){Oa.shout(ca.body(),a())});d.notify().each(function(){c.input(e)});return d.cursor()})},IL=function(a,b,c,d,e){return a.detect(b,c,d,e).map(function(a){return{execute:f.curry(eaa,a)}})},To={block:f.curry(IL,{detect:function(a,b,c,d){var e=b.patterns(),f=a.cursor().filter(b.useCursor);return HL.matcher(e,
a.text(),f).bind(b.derive).bind(function(a){var e=EL.top(c);if(0<e.length){var f=or(e[0],0,c,d);return h.some(baa(b,e,f,a))}return h.none()})}}),inline:f.curry(IL,{detect:function(a,b,c,d){c=b.patterns();d=a.cursor().filter(b.useCursor);return HL.matcher(c,a.text(),d).bind(b.derive).bind(function(c){return caa(a.list(),c.startIndex(),c.finishIndex()).bind(function(a){return daa(a,b.allowed).map(function(a){var d=c.startIndex()-a.start().start(),g=c.finishIndex()-a.finish().start(),h=or(a.start().element(),
d,a.finish().element(),g);return{build:function(a){a=b.generate(a,c);return cd.applicator({elements:a.elements,cursor:a.cursor,range:f.constant(h),dictation:a.dictation,notify:a.notify})}}})})})}})},ST=Y.detect().deviceType.isTouch(),kx=function(a){a.disable();ga.disable(a.element())},VT=Y.detect().deviceType.isiOS(),YT=500,faa=C.immutable("rawData","extra"),lx=function(a,b,c){if(Q.isArray(b)&&Q.isArray(c))return H.value(faa(b,c));console.error(a+" callback parameters were not both arrays",b,c);return H.error(a+
" callback parameters were not both arrays")},Uo=function(a,b){if(gi.isPrototypeOf(b))return H.value(q.fromDom(b));console.error(a+" was not a DOM element",b);return H.error(a+" was not a DOM element")},jU={configure:function(a){var b=[a.internal(),a.history(),a.output()];k.each(b,function(b){a.addSelector(b,"span.ephox-polish-incomplete-mention",Ca.unwrap)});a.addExcludedContext(["span.ephox-polish-incomplete-mention"])}},nx=w.resolve("no-results"),mx=w.resolve("loading-results"),Vo=la.generate([{none:["item"]},
{extra:["value","item"]},{fetched:["userId","name","rawname","info","item"]}]),Wo=la.generate([{nothing:[]},{refetch:["term"]},{open:["term"]}]),JL=function(){return RegExp(cb.wordbreak(),"i")},gaa=function(a,b,c){return Tf.repeatLeft(a,c,function(a,b,c,f,h){return Tf.previousChar(f,h).fold(function(){return b.kontinue()},function(a){return b.finish(a.ch())})}).fold(h.none,h.none,h.some)},haa=function(a,b,c,d){return 0<=d&&"@"===c.charAt(d)?a.finish(S.point(b,d)):a.abort()},iaa=function(a,b,c,d){return a.finish(S.point(b,
d))},jaa=function(a){return h.some(S.point(a,ja.getEnd(a)))},px={isValidMention:function(a,b){return gaa(a,ma.sidestep,b).fold(f.constant(!0),function(a){return null===a.match(/[0-9a-zA-Z]/)})},scan:function(a,b){return Tf.expandLeft(a,b,{regex:JL,attempt:haa}).fold(h.none,h.none,h.some).bind(function(c){return Tf.expandRight(a,b,{regex:JL,attempt:iaa}).fold(h.none,jaa,h.some).map(function(a){return{start:c.element,soffset:c.offset,finish:a.element,foffset:a.offset}})})}},lh=la.generate([{none:[]},
{bare:["text","start","soffset","finish","foffset"]},{incomplete:["text","element"]},{complete:["text","element"]}]),KL=w.resolve("incomplete-mention"),kaa=function(a,b){return px.scan(a,b).map(function(a){return lh.bare("",a.start(),a.soffset(),a.finish(),a.foffset())})},LL=function(a){if(A.isText(a))return Fa.get(a);a=lc.descendants(a,A.isText);return k.map(a,Fa.get).join("")},ML=function(a,b){return a.collapsed()?I.closest(a.startContainer(),b.hoverSelector()).fold(function(){return I.closest(a.startContainer(),
"."+KL).fold(function(){return kaa(a.startContainer(),a.startOffset())},function(a){return h.some(lh.incomplete(LL(a),a))})},function(a){return h.some(lh.complete(LL(a),a))}).getOrThunk(lh.none):lh.none()},qg={detect:function(a,b){return a.getSelection().map(function(a){return ML(a,b)}).getOrThunk(lh.none)},detectOn:ML,withinIncomplete:function(a){return I.closest(a,"."+KL)}},NL=function(a){n.remove(a,w.resolve("incomplete-mention"));B.unwrap(a)},Yo={cancel:NL,create:function(){var a=q.fromTag("span");
n.add(a,w.resolve("incomplete-mention"));var b=q.fromText("@");v.append(a,b);return a},validatePrevious:function(a,b){qg.withinIncomplete(a).filter(function(a){return qg.withinIncomplete(b).forall(function(b){return!L.eq(a,b)})}).each(NL)}},Xo="."+w.resolve("mentions-business-card"),fU=function(a,b){return 1<arguments.length||/\{(\d+)\}/.test(a)?ql.tokens.call(void 0,a,b):a},iU=1E6,lU=C.immutable("textkey","value","icon"),laa=function(){return{configure:function(a){var b=[a.internal(),a.history(),
a.output(),a.paste()];k.each(b,function(b){a.addSelector(b,"[unselectable]",Ca.removeAttr("unselectable"))})},clean:function(a){m.remove(a,"unselectable")},disableNativeResize:function(a){m.set(a,"unselectable","on")}}},maa=function(){return{configure:f.noop,clean:function(a){y.nextSibling(a).filter(nd.isEmptyText).each(B.remove)},disableNativeResize:f.noop}},OL=Y.detect().browser,Zo=OL.isIE()?laa():OL.isFirefox()?maa():{configure:f.noop,clean:f.noop,disableNativeResize:f.noop},PL="data-"+w.resolve("resize-direction"),
un=function(a,b){var c=q.fromTag("span");ea.add(c,[w.resolve(a),w.resolve("resize-eph-resizer")]);m.set(c,PL,b);return c},tU={create:function(){var a=un("element-se-resize","1"),b=un("element-ne-resize","1"),c=un("element-sw-resize","-1"),d=un("element-nw-resize","-1"),e=q.fromTag("div");n.add(e,w.resolve("resize-wrapper"));J.append(e,[a,b,c,d]);var g=function(){B.remove(e)},h=D.create({click:r(["multiplier"])}),k=E.bind(e,"mousedown",function(a){n.has(a.target(),w.resolve("resize-eph-resizer"))&&
(a.prevent(),a=m.get(a.target(),PL),a=void 0!==a?parseInt(a,10):1,h.trigger.click(a))});return{refresh:function(g,h){v.append(g,e);var k;k=Ja.absolute(h);var l=ha.get(h),m=ra.get(h);k={top:k.top,height:f.constant(l),left:k.left,width:f.constant(m)};l=ra.get(c)/2;t.setAll(c,{top:k.top()+k.height()-l+"px",left:k.left()-l+"px"});t.setAll(a,{top:k.top()+k.height()-l+"px",left:k.width()+k.left()-l+"px"});t.setAll(b,{top:k.top()-l+"px",left:k.width()+k.left()-l+"px"});t.setAll(d,{top:k.top()-l+"px",left:k.left()-
l+"px"})},clear:g,events:h.registry,destroy:function(){k.unbind();g()}}}},naa=C.immutable("minRow","minCol","maxRow","maxCol"),oaa=function(a,b){var c=a.grid().columns(),d=a.grid().rows(),e=c,f=0,h=0;W.each(a.access(),function(a){if(b(a)){var c=a.row(),k=c+a.rowspan()-1,m=a.column();a=m+a.colspan()-1;c<d?d=c:k>f&&(f=k);m<e?e=m:a>h&&(h=a)}});return naa(d,e,f,h)},paa=function(a,b,c,d){for(var e=b.grid().columns(),f=b.grid().rows(),h=0;h<f;h++)for(var k=!1,m=0;m<e;m++)if(!(h<c.minRow()||h>c.maxRow()||
m<c.minCol()||m>c.maxCol()))if(fb.getAt(b,h,m).filter(d).isNone()){var n=k,r=a[h].element(),t=q.fromTag("td");v.append(t,q.fromTag("br"));(n?v.append:v.prepend)(r,t)}else k=!0},qaa=function(a,b){var c=k.filter(vi.firstLayer(a,"tr"),function(a){return 0===a.dom().childElementCount});k.each(c,B.remove);b.minCol()!==b.maxCol()&&b.minRow()!==b.maxRow()||k.each(vi.firstLayer(a,"th,td"),function(a){m.remove(a,"rowspan");m.remove(a,"colspan")});m.remove(a,"width");m.remove(a,"height");t.remove(a,"width");
t.remove(a,"height")},raa={extract:function(a,b){var c=function(a){return qa.is(a.element(),b)},d=Se.fromTable(a),e=fb.generate(d),f=oaa(e,c),h="th:not("+b+"),td:not("+b+")",m=vi.filterFirstLayer(a,"th,td",function(a){return qa.is(a,h)});k.each(m,B.remove);paa(d,e,f,c);qaa(a,f);return a}},yU=function(a){k.each(a,function(a){B.empty(a);v.append(a,q.fromTag("br"))})},saa=function(a){return Xa.table(a[0]).map(ac.deep).map(function(a){return[raa.extract(a,od.selectedSelector())]})},wU=function(a,b){var c=
Os.register({doc:a.doc,win:a.win,body:a.body,getSelection:a.getSelection,setSelection:a.setSelection});return function(b,e,f,h){e=Zh.buildClipboardContents(e,f);h();var k=zk.fromSafe(a);k.begin();c.setClipboard(b,e,function(){k.end()})}},xU=function(a,b){return saa(a).map(function(a){k.each(a,b);var d=f.curry($k.toText,a);a=f.curry($k.toHtml,a);return{text:d,html:a}})},zU=function(a,b,c){return eh.fragment(b.win(),a).map(function(a){var b=f.curry(eh.text,a);a=f.curry(eh.html,a,c);return{text:b,html:a}})},
zc={resolve:jb.create("ephox-cement").resolve},taa=zc.resolve("smartpaste-eph-bin"),Fx={binStyle:f.constant(taa)},QL=function(a,b){return qb.cata(b.get(),f.constant([]),f.identity,f.constant([a]))},Wt={mergable:function(a,b){return qb.cata(b.get(),h.none,function(b,d){return 0===b.length?h.none():tw.retrieveBox(a,od.firstSelectedSelector(),od.lastSelectedSelector()).bind(function(a){return 1<b.length?h.some({bounds:f.constant(a),cells:f.constant(b)}):h.none()})},h.none)},unmergable:function(a,b){var c=
function(a){return m.has(a,"rowspan")&&1<parseInt(m.get(a,"rowspan"),10)||m.has(a,"colspan")&&1<parseInt(m.get(a,"colspan"),10)},d=QL(a,b);return 0<d.length&&k.forall(d,c)?h.some(d):h.none()},selection:QL},RL=function(a){return{element:f.constant(a),mergable:h.none,unmergable:h.none,selection:f.constant([])}},uaa=C.immutable("element","clipboard","generators"),Ek={noMenu:RL,forMenu:function(a,b,c){return{element:f.constant(c),mergable:f.constant(Wt.mergable(b,a)),unmergable:f.constant(Wt.unmergable(c,
a)),selection:f.constant(Wt.selection(c,a))}},notCell:function(a){return RL(a)},paste:uaa},vaa=function(a){return"table"===A.name(a)||0===nb.get(a).trim().length},SL=function(a){var b=k.filter(a,function(a){return"table"===A.name(a)});return 1!==b.length?h.none():k.forall(a,vaa)?h.from(b[0]):h.none()},jV={rules:function(a,b,c){var d=f.noop,e=function(e,g){return Xa.table(e,a.isRoot).bind(function(h){var k=a.doc().getOrDie(),k=LB.paste(k),k=Ek.paste(e,g,k),m=f.constant(c);return Mb.execute(b,Db.pasteCells,
d,m)(a,h,k).map(function(a){return a.startContainer()})})},g=function(a){return SL(a).map(function(a){return{single:f.constant(a)}})};return{collapsed:f.constant(Qa(function(a,b,c){return Xa.cell(b,a)},g,function(a,b){return e(a.element(),b.single())},"custom arcade table insert collapsed")),ranged:f.constant(Qa(function(a,b,c){return Xa.cell(b.element(),a).map(function(a){return{left:f.constant(a),right:f.constant(a)}})},g,function(a,b){return e(a.left(),b.single())},"custom arcade table insert ranged"))}},
extractTable:SL},TL="officeStyles htmlStyles isWord proxyBin isInternal backgroundAssets".split(" "),UL=C.immutableBag([],TL),pb={nu:UL,merge:function(a,b){var c={};k.each(TL,function(d){b[d]().or(a[d]()).each(function(a){c[d]=a})});return UL(c)}},rj=la.generate([{error:["message"]},{paste:["elements","correlated"]},{cancel:[]},{incomplete:["elements","correlated","message"]}]),Xt=function(a,b,c,d,e){return a.fold(b,c,d,e)},La={error:rj.error,paste:rj.paste,cancel:rj.cancel,incomplete:rj.incomplete,
cata:Xt,carry:function(a,b){return Xt(a,h.none,h.none,h.none,function(a,d,e){return Xt(b,h.none,function(a,b){return h.some(rj.incomplete(a,b,e))},h.none,h.none)}).getOr(b)}},Yt=C.immutableBag(["response","bundle"],[]),sj=function(a){return Zt(function(b){var c=Yt(a);b(c)})},Zt=function(a){var b=function(b){a(b)},c=Zt;return{get:b,map:function(a){return c(function(c){b(function(b){b=a(b);c(b)})})},bind:function(a){return c(function(c){b(function(b){a(b).get(c)})})}}},wa={call:function(a,b){a(Yt(b))},
sync:Zt,pure:sj,pass:function(a){return sj({response:a.response(),bundle:a.bundle()})},done:Yt,error:function(a){return sj({response:La.error(a),bundle:pb.nu({})})},initial:function(){return sj({response:La.paste([],[]),bundle:pb.nu({})})},cancel:function(){return sj({response:La.cancel(),bundle:pb.nu({})})}},VL=C.immutable("steps","input","label","capture"),waa=function(a,b){return $a.findMap(a,function(a){return a.getAvailable(b).map(function(b){return VL(a.steps(),b,a.label(),a.capture())})})},
xaa=function(a,b){var c=f.curry(wa.pass,a),d=function(){return b().map(function(b){var c=pb.merge(a.bundle(),b.bundle());b=La.carry(a.response(),b.response());return wa.done({response:b,bundle:c})})};return La.cata(a.response(),c,d,c,d)},sx={choose:function(a,b,c){return waa(a,c).getOrThunk(function(){var a=b.getAvailable(c);return VL(b.steps(),a,b.label(),b.capture())})},run:function(a,b){return k.foldl(a,function(a,d){return a.bind(function(a){return xaa(a,function(){return d(b,a)})})},wa.initial())}},
tj=Ma.generate("simple-adt"),WL={generate:function(a){var b=function(a){return 0===a.indexOf(tj)?a.substring(tj.length+1):a},c=W.keys(a),d={};k.each(c,function(a){d["as"+aa.capitalize(a)]=function(b){return b._simpleAdt===tj+"_"+a?h.some(b.data):h.none()}});var e={};W.each(a,function(a,b){e[b]=function(c){var d=tj+"_"+b,e;e=0===a.length?{}:C.immutableBag(a,[])(c);return{_simpleAdt:d,data:e,_simpleAdt_data:c}}});return Z.deepMerge(d,{constructors:e,match:function(a,d){var e=W.keys(d);if(e.length!==
c.length)throw Error("Partial match");return $a.findMap(e,function(b){return a._simpleAdt===tj+"_"+b?h.some(d[b]):h.none()}).getOrDie("Must find branch for constructor: "+b(a._simpleAdt))(a.data)}})}},ec=WL.generate({event:["nativeEvent"],html:["container"],word:["html","rtf"],text:["text"],images:["images"]}),vn=WL.generate({getFromFlash:[],disabled:[],fromClipboard:["rtf"]}),Bk={getFromFlash:vn.constructors.getFromFlash,disabled:vn.constructors.disabled,fromClipboard:vn.constructors.fromClipboard,
match:vn.match},XL=function(a,b){var c=RegExp(b,"i");return $a.findMap(a,function(a){return null!==a.match(c)?h.some({type:a,flavor:b}):h.none()})},$t={isValidData:function(a){return void 0!==a&&void 0!==a.types&&null!==a.types},getPreferredFlavor:function(a,b){return $a.findMap(a,function(a){return XL(b,a)})},getFlavor:XL},au=Y.detect().browser,yaa=!(au.isIE()||au.isEdge()&&16>au.version.major),zaa=["^image/","file"],Aaa=function(a){return aa.contains(a,"<html")&&(aa.contains(a,'xmlns:o="urn:schemas-microsoft-com:office:office"')||
aa.contains(a,'xmlns:x="urn:schemas-microsoft-com:office:excel"'))},Baa=function(a){return 0<a.length},bu=function(a,b){return $t.getFlavor(a.types,b).map(function(b){return a.getData(b.type)}).filter(Baa)},uj=function(a){return yaa?h.some(a.clipboardData).filter($t.isValidData):h.none()},CU={fromEvent:function(a){var b=function(a){return void 0===a.items?h.none():$t.getPreferredFlavor(zaa,a.types).map(function(b){return ec.constructors.images({images:a.items})})},c=function(a){return $a.findMap(a.types,
function(b){return"text/plain"===b?h.some(a.getData(b)).map(function(a){return ec.constructors.text({text:a})}):h.none()})};return{getWordData:function(){return uj(a).bind(function(a){return bu(a,"html").filter(Aaa).map(function(b){var c=bu(a,"rtf");return ec.constructors.word({html:b,rtf:c.fold(Bk.getFromFlash,function(a){return Bk.fromClipboard({rtf:a})})})})})},getImage:function(){return uj(a).bind(b)},getText:function(){return uj(a).fold(function(){var a=window.clipboardData;return void 0!==a?
h.some(ec.constructors.text({text:a.getData("text")})):h.none()},c)},getHtml:function(){return uj(a).bind(function(a){return bu(a,"html").map(function(a){var b=q.fromTag("div");ua.set(b,a);return ec.constructors.html({container:b})})})},getOnlyText:function(){return uj(a).bind(function(a){var b=a.types;return 1===b.length&&"text/plain"===b[0]?c(a):h.none()})},getNative:function(){return ec.constructors.event({nativeEvent:a})}}},fromHtml:function(a){return{getWordData:function(){return h.some(ec.constructors.word({html:a,
rtf:Bk.disabled()}))},getImage:h.none,getText:h.none,getNative:f.die("There is no native event"),getOnlyText:h.none}},fromText:function(a){return{getWordData:h.none,getImage:h.none,getText:function(){return h.some(ec.constructors.text({text:a}))},getNative:f.die("There is no native event"),getOnlyText:h.none}}},Caa=jb.create("ephox-sloth").resolve("bin"),ux={bin:f.constant(Caa)},YL=Y.detect(),Daa=function(a,b,c){b.control.block();a.dom().execCommand("paste");c();b.control.unblock()},Eaa=function(a,
b,c){setTimeout(c,1)},ZL=YL.browser.isIE()&&10>=YL.browser.version.major,Faa=ZL?Daa:Eaa,vx={willBlock:f.constant(ZL),run:function(a,b,c){return Faa(a,b,c)}},tx=function(a){return k.map(a,function(a){return a.asset()})},vj=C.immutable("asset","image"),$L=function(a,b){return kc.cata(a,function(a,d,e,f){m.set(b,"src",e);return!0},f.never)},ge={assetImage:vj,createImages:function(a){var b=[],c=[],d=[];k.each(a,function(a){return kc.cata(a,function(f,h,k,n){f=q.fromTag("img");m.set(f,"src",k);b.push(f);
c.push(a);d.push(vj(a,f))},function(a,b,c){console.error("Internal error: Paste operation produced an image URL instead of a Data URI: ",b)})});return La.paste(b,d)},findImages:function(a,b){var c=[],d=k.bind(a,function(a){return"img"===A.name(a)?[a]:X.descendants(a,"img")});k.each(b,function(a){kc.cata(a,function(b,f,h,n){k.each(d,function(b){m.get(b,"src")===h&&c.push(vj(a,b))})},f.noop)});return c},updateSource:$L,updateSources:function(a,b){var c=[];k.each(a,function(a,e){var f=b[e];$L(a,f)&&
c.push(vj(a,f))});return c},browserBlobs:function(a){return Ic.mapM(a,function(a){return va.nu(function(c){var d=a.dom();qc.imageToImageResult(d).then(function(e){e.toBlob().then(function(f){f=aa.startsWith(d.src,"blob:")?d.src:URL.createObjectURL(f);var h=Ma.generate("image");f=kc.blob(h,e,f);c(vj(f,a))})})})})}},Gaa=function(a){return va.nu(function(b){var c=qc.imageResultToBlob(a,"image/png").then(function(a){ve.single(a).map(h.some).get(b)});return c["catch"].call(c,function(a){console.warn(a);
b(h.none())})})},DU=function(a){var b=function(){return va.pure(a)};return kc.cata(a.asset(),function(c,d,e){return/tiff$/.test(d.getType())?Gaa(d).map(function(b){return b.map(function(b){var c=a.image();Ne.revokeObjectURL(e);ge.updateSource(b,c);return ge.assetImage(b,c)}).getOr(a)}):b()},b)},kb={blocking:function(a){return function(b){return function(c,d){b.block();return a(c,d).map(function(a){b.unblock();return a})}}},normal:function(a){return f.constant(a)}},Haa={convert:function(a){var b=xd.resolve("window.clipboardData.files"),
c=void 0!==a.convertURL?a.convertURL:void 0!==a.msConvertURL?a.msConvertURL:void 0;return void 0!==b&&void 0!==c&&0<b.length?(b=Ic.mapM(b,function(b){var e=Ne.createObjectURL(b);c.apply(a,[b,"specified",e]);return ve.singleWithUrl(b,e)}),h.some(b)):h.none()}},Iaa=function(){var a=h.none();return{convert:function(b){a=Haa.convert(b)},listen:function(b){return a.fold(function(){return va.nu(function(a){a([])})},function(a){return a}).get(b)},clear:function(){a=h.none()}}},Jaa=function(a,b){return Th.dataUriToBlobSync(b).map(function(b){return ge.assetImage(ve.single(b),
a)})},Kaa=function(a,b){return Th.uriToBlob(b).map(function(b){var d=va.nu(function(a){b.then(function(b){ve.single(b).get(a)})});return ge.assetImage(d,a)})},xx=function(a){var b=q.fromTag("div");J.append(b,a);return X.descendants(b,"img[src]")},aM=function(a){return 0===a.indexOf("data:")&&-1<a.indexOf("base64")},yx=function(a){a=m.get(a,"src");return aM(a)||0===a.indexOf("blob:")},EU=function(a){return k.bind(xx(a),function(a){var c=m.get(a,"src");return aM(c)?Jaa(a,c).toArray():0===c.indexOf("blob:")?
Kaa(a,c).toArray():[]})},FU=function(a){a=k.filter(a,function(a){return"img"!==A.name(a)||!yx(a)});return La.incomplete(a,[],"errors.local.images.disallowed")},Laa={convert:function(a,b){if(0===a.length)throw"Zero length content passed to Hex conversion";for(var c=Array(a.length/2),d=0;d<a.length;d+=2){var e=a.substr(d,2);c[Math.floor(d/2)]=parseInt(e,16)}c=Dv(c);return Cv([c],{type:b})}},bM=la.generate([{unsupported:["id","message","isEquation"]},{supported:["id","contentType","blob","isEquation"]}]),
mh={unsupported:bM.unsupported,supported:bM.supported,cata:function(a,b,c){return a.fold(b,c)}},cM=function(a,b,c,d,e,f){return-1===a||-1===b?h.none():h.some({start:a,end:b,bower:c,regex:d,idRef:e,isEquation:f})},wn=function(a,b){if(-1===b)return b;var c=0,d=a.length,e,f;do if(e=a.indexOf("{",b),f=a.indexOf("}",b),f>e&&-1!==e?(b=e+1,++c):(e>f||0>e)&&-1!==f&&(b=f+1,--c),b>d||-1===f)return-1;while(0<c);return b},Maa=function(a,b,c,d,e){a=a.substring(c,d);return cM(c,d,a,/[^a-fA-F0-9]([a-fA-F0-9]+)\}$/,
"i",e)},Naa=function(a,b,c,d,e){a=a.substring(c,d);return cM(c,d,a,/([a-fA-F0-9]{64,})(?:\}.*)/,"s",e)},Oaa={identify:function(a,b){var c=a.indexOf("{\\pict{",b),d=wn(a,c),e=a.indexOf("{\\shp{",b),g=wn(a,e),k=a.indexOf("{\\mmathPict{",b),m=wn(a,k),m=-1!==k&&(k<c&&m>d||k<e&&m>g),k=f.curry(Naa,a,b,e,g,m),m=f.curry(Maa,a,b,c,d,m);return-1===c&&-1===e?h.none():-1===c?k():-1===e?m():e<c&&g>d?m():c<e&&d>g?k():c<e?m():e<c?k():h.none()},endBracket:wn},dM=function(a,b){return Oaa.identify(a,b)},eM=function(a){return 0<=
a.indexOf("\\pngblip")?H.value("image/png"):0<=a.indexOf("\\jpegblip")?H.value("image/jpeg"):H.error("errors.imageimport.unsupported")},fM=function(a,b){var c=a.match(b);return c&&c[1]&&0===c[1].length%2?H.value(c[1]):H.error("errors.imageimport.invalid")},gM=function(a){a=a.match(/\\shplid(\d+)/);return null!==a?h.some(a[1]):h.none()},Paa=function(a){var b=a.bower,c=a.regex,d=a.isEquation;return gM(b).map(function(e){var f=a.idRef+e;return eM(b).fold(function(a){return mh.unsupported(f,a,d)},function(a){return fM(b,
c).fold(function(a){return mh.unsupported(f,a,d)},function(b){return mh.supported(f,a,Laa.convert(b,a),d)})})})},Qaa=function(a){for(var b=[],c=function(){return a.length},d=function(a){var c=Paa(a);b=b.concat(c.toArray());return a.end},e=0;e<a.length;)e=dM(a,e).fold(c,d);return b},Raa={nextBower:dM,extractId:gM,extractContentType:eM,extractHex:fM,images:function(a){a=a.replace(/\r/g,"").replace(/\n/g,"");return Qaa(a)}},he={images:function(a){return Raa.images(a)},toId:function(a){return mh.cata(a,
function(a,c,d){return a},function(a,c,d,e){return a})},isEquation:function(a){return mh.cata(a,function(a,c,d){return d},function(a,c,d,e){return e})},toBlob:function(a){return mh.cata(a,function(a,c,d){return H.error(c)},function(a,c,d,e){return H.value(d)})}},Saa=function(a){return k.foldl(a,function(a,c){var d=he.toId(c),e=he.isEquation(c);return k.findIndex(a,function(a){return he.toId(a)===d&&he.isEquation(a)===e}).fold(function(){return a.concat([c])},function(d){return he.toBlob(a[d]).isValue()?
a:a.slice(0,d).concat(a.slice(d+1)).concat([c])})},[])},GU={convert:function(a,b,c,d){var e=Saa(b),f=[],h=!1;a=k.bind(a,function(a,b){var c=m.get(a,"data-image-id"),n="true"===m.get(a,"data-ms-equation");m.remove(a,"rtf-data-image");m.remove(a,"data-image-id");m.remove(a,"data-ms-equation");return"unsupported"===c?(h=!0,m.set(a,"alt",d("errors.imageimport.unsupported")),[]):k.find(e,function(a){return he.toId(a)===c&&he.isEquation(a)===n}).fold(function(){console.log("WARNING: unable to find data for image ",
a.dom());return[]},function(b){return he.toBlob(b).fold(function(b){h=!0;m.set(a,"alt",d(b));return[]},function(b){f.push(a);return[b]})})});ve.multiple(a).get(function(a){a=ge.updateSources(a,f);c(a,h)})}},hM=function(a){return X.descendants(a,"[rtf-data-image]")},Yh={exists:function(a){return 0<hM(a).length},find:hM},iM=function(a){return a.officeStyles().getOr(!0)},jM=function(a){return a.htmlStyles().getOr(!1)},kM=function(a){return a.isWord().getOr(!1)},Jd={proxyBin:function(a){return{handle:function(b,
c){return a.proxyBin().fold(function(){console.error(b);return wa.pure({response:La.cancel(),bundle:pb.nu({})})},c)}}},backgroundAssets:function(a){return va.nu(function(b){a.backgroundAssets().fold(function(){b([])},function(a){a.listen(b)})})},merging:function(a){var b=kM(a);return b&&iM(a)||!b&&jM(a)},mergeOffice:iM,mergeNormal:jM,isWord:kM,isInternal:function(a){return a.isInternal().getOr(!1)}},lM=function(a,b){var c=IU(a,b);return function(a,b){var f=b.bundle(),h=b.response();return wa.sync(function(a){c.get(Jd.isWord(f),
function(c){c=c.fold(function(){return{response:La.cancel(),bundle:b.bundle()}},function(a){return{response:h,bundle:pb.nu({officeStyles:a.officeStyles,htmlStyles:a.htmlStyles})}});wa.call(a,c)})})}},cu={fixed:function(a,b){return function(c,d){return wa.pure({response:d.response(),bundle:pb.nu({officeStyles:a,htmlStyles:b})})}},fromConfig:lM,fromConfigIfExternal:function(a,b){return function(c,d){return Jd.isInternal(d.bundle())?wa.pure({response:d.response(),bundle:pb.nu({officeStyles:!0,htmlStyles:!0})}):
lM(a,b)(c,d)}}},Taa={p:"p, li[data-converted-paragraph]"},Uaa=function(a){var b=function(){var b=q.fromTag("span");v.prepend(a,b);return b}();return{convertToPx:function(a){t.set(b,"margin-left",a);a=t.get(b,"margin-left");return parseFloat(a.match(/-?\d+\.?\d*/)[0])},destroy:function(){return B.remove(b)}}},Vaa=f.noop,Xaa=function(a,b){var c=function(a){m.remove(a,"data-list-level");m.remove(a,"data-text-indent-alt");m.remove(a,"data-border-margin");t.remove(a,"margin-left");t.remove(a,"text-indent");
W.each(t.getAllRaw(a),function(b,c){!c.startsWith("border")||"border-image"!==c&&"none"!==b.trim()&&"initial"!==b.trim()||t.remove(a,c)})},d=X.descendants(a,"li[data-converted-paragraph]");k.each(d,function(a){m.remove(a,"data-converted-paragraph")});b&&(d=X.descendants(a,"li"),k.each(d,function(b){var d=Uaa(a),f;f=m.has(a,"data-tab-interval")?m.get(a,"data-tab-interval"):"36pt";f=d.convertToPx(f);f=Waa(b,f,d).getOr({});c(b);d.destroy();t.setAll(b,f)}),d=X.descendants(a,"ol,ul"),k.each(d,function(a){var b=
X.descendants(a,"li");t.getRaw(a,"margin-top").orThunk(function(){h.from(b[0]).each(function(b){t.set(a,"margin-top",t.get(b,"margin-top"))})});t.getRaw(a,"margin-bottom").orThunk(function(){h.from(b[b.length-1]).each(function(b){t.set(a,"margin-bottom",t.get(b,"margin-bottom"))})})}));m.remove(a,"data-tab-interval")},Waa=function(a,b,c){var d=function(a){return m.has(a,"data-list-level")?parseInt(m.get(a,"data-list-level"),10):1};return t.getRaw(a,"text-indent").bind(function(e){return t.getRaw(a,
"margin-left").map(function(f){var h=t.getRaw(a,"list-style").exists(function(a){return aa.contains(a,"none")}),k=m.has(a,"data-border-margin")?m.get(a,"data-border-margin"):"0px",h=h?d(a)+1:d(a);f=c.convertToPx(f)+c.convertToPx(k);var h=b*h,n=m.has(a,"data-text-indent-alt")?c.convertToPx(m.get(a,"data-text-indent-alt")):c.convertToPx(e),k={},n=b/2*-1-n;0<n&&(k["text-indent"]=n+"px");f=f-h-n;k["margin-left"]=0<f?f+"px":"0px";return k})})},Yaa={process:function(a,b,c){c=c.mergeInline();(c?Kv.inlineStyles:
Vaa)(a,b,Taa);Xaa(b,c)}},Zaa=function(a){var b=JU(q.fromDom(document.body));return function(c,d){b.play(c,function(b,c){Yaa.process(b,c,{mergeInline:f.constant(a)});return ua.get(c)},d)}},$aa=function(a,b,c,d){var e=function(b){wa.call(a,{response:b,bundle:pb.nu({})})};Zaa(b)(c,function(a){var b=Ld.fromHtml(a);a=function(a){e(La.paste(b,a))};var c=q.fromTag("div");J.append(c,b);var f=qa.all("img[src]",c);0===f.length?a([]):d?ge.browserBlobs(f).get(a):(k.each(f,B.remove),a=y.children(c),e(La.incomplete(a,
[],"errors.local.images.disallowed")))})},aba={handle:function(a,b,c,d){var e=a.html();return wa.sync(function(a){c.cleanDocument(e,b).get(function(c){c.fold(function(b){wa.call(a,{response:La.error("errors.paste.process.failure"),bundle:pb.nu({})})},function(c){void 0===c||null===c||0===c.length?wa.call(a,{response:La.paste([],[]),bundle:pb.nu({})}):$aa(a,b,c,d)})})})}},bba={handle:function(a){a=k.filter(a,function(a){return"file"===a.kind&&/image/.test(a.type)});var b=k.map(a,function(a){return a.getAsFile()});
return wa.sync(function(a){ve.multiple(b).get(function(b){b=ge.createImages(b);wa.call(a,{response:b,bundle:pb.nu({})})})})}},cba=function(a,b){var c=A.value(a),d=q.fromTag("div"),e=c.indexOf("]>");d.dom().innerHTML=c.substr(e+2);return sa.descendant(d,function(a){return A.name(a)===b})},dba=function(a){return A.isComment(a)?cba(a,"v:shape"):h.none()},eba=function(a){if("img"===A.name(a)){var b=m.get(a,"src");if(void 0!==b&&null!==b&&aa.startsWith(b,"file://"))return a=ac.shallow(a),b=b.split(/[\/\\]/),
m.set(a,"data-image-id",b[b.length-1]),m.remove(a,"src"),m.set(a,"data-image-type","local"),n.add(a,"rtf-data-image"),h.some(a)}return h.none()},fba=function(a){return dba(a).map(function(a){var c=m.get(a,"o:spid"),c=void 0===c?m.get(a,"id"):c,d=q.fromTag("img");n.add(d,"rtf-data-image");m.set(d,"data-image-id",c.substr(7));m.set(d,"data-image-type","code");t.setAll(d,{width:t.get(a,"width"),height:t.get(a,"height")});return d})},mM={validStyles:function(){return/^(mso-.*|tab-stops|tab-interval|language|text-underline|text-effect|text-line-through|font-color|horiz-align|list-image-[0-9]+|separator-image|table-border-color-(dark|light)|vert-align|vnd\..*)$/},
specialInline:function(){return/^(font|em|strong|samp|acronym|cite|code|dfn|kbd|tt|b|i|u|s|sub|sup|ins|del|var|span)$/}},nh=la.generate([{starts:["value","f"]},{pattern:["regex","f"]},{contains:["value","f"]},{exact:["value","f"]},{all:[]},{not:["stringMatch"]}]),nM=function(a,b){return a.fold(function(a,d){return 0===d(b).indexOf(d(a))},function(a,d){return a.test(d(b))},function(a,d){return 0<=d(b).indexOf(d(a))},function(a,d){return d(b)===d(a)},function(){return!0},function(a){return!nM(a,b)})},
F={starts:nh.starts,pattern:nh.pattern,contains:nh.contains,exact:nh.exact,all:nh.all,not:nh.not,cata:function(a,b,c,d,e,f,h){return a.fold(b,c,d,e,f,h)},matches:nM,caseSensitive:function(a){return a},caseInsensitive:function(a){return a.toLowerCase()}},xn={keyval:function(a,b,c,d){var e=d.name,g=void 0!==d.condition?d.condition:f.constant(!0);d=void 0!==d.value?d.value:F.all();return F.matches(e,c)&&F.matches(d,b)&&g(a)},name:function(a,b){var c=A.name(a),d=b.name,e=void 0!==b.condition?b.condition:
f.constant(!0);return F.matches(d,c)&&e(a)}},gba=function(a,b,c){k.each(b,function(b){m.remove(a,b)});W.each(c,function(b,c){m.set(a,c,b)})},oM={filter:function(a,b){var c={};k.each(a.dom().attributes,function(a){b(a.value,a.name)||(c[a.name]=a.value)});return c},clobber:function(a,b,c){c=k.map(a.dom().attributes,function(a){return a.name});W.size(b)!==c.length&&gba(a,c,b)},scan:f.constant({})},hba=function(a){var b={};a=void 0!==a&&null!==a?a.split(";"):[];k.each(a,function(a){a=a.split(":");2===
a.length&&(b[aa.trim(a[0])]=aa.trim(a[1]))});return b},pM=function(a){var b=W.keys(a);return k.map(b,function(b){return b+": "+a[b]}).join("; ")},jf={filter:function(a,b){var c=a.dom().style,d={};k.each(void 0===c||null===c?[]:c,function(c){var f;f=a.dom().style.getPropertyValue(c);b(f,c)||(d[c]=f)});return d},clobber:function(a,b,c){m.set(a,"style","");var d=W.size(b),e=W.size(c);0===d&&0===e?m.remove(a,"style"):0===d?m.set(a,"style",pM(c)):(W.each(b,function(b,c){t.set(a,c,b)}),b=m.get(a,"style"),
c=0<e?pM(c)+"; ":"",m.set(a,"style",c+b))},scan:function(a,b,c){a=a.dom().getAttribute("style");var d=hba(a),e={};k.each(b,function(a){var b=d[a];void 0===b||c(b,a)||(e[a]=b)});return e}},iba=["mso-list"],qM=function(a,b){var c=jf.scan(a,iba,b),d=jf.filter(a,b);jf.clobber(a,d,c)},rM=function(a,b){var c=oM.filter(a,b);oM.clobber(a,c,{})},yn={style:qM,attribute:rM,styleDom:function(a,b){qM(q.fromDom(a),b)},attributeDom:function(a,b){rM(q.fromDom(a),b)},validateStyles:function(a){var b=jf.filter(a,f.constant(!1));
jf.clobber(a,b,{})}},sM=function(a,b,c){a(c,function(a,e){return k.exists(b,function(b){return xn.keyval(c,a,e,b)})})},zn={remover:function(a,b){var c=Z.merge({styles:[],attributes:[],classes:[],tags:[]},b),d=X.descendants(a,"*");k.each(d,function(a){sM(yn.style,c.styles,a);sM(yn.attribute,c.attributes,a);k.each(c.classes,function(b){var c=m.has(a,"class")?ea.get(a):[];k.each(c,function(c){F.matches(b.name,c)&&n.remove(a,c)})})});d=X.descendants(a,"*");k.each(d,function(a){k.exists(c.tags,f.curry(xn.name,
a))&&B.remove(a)})},unwrapper:function(a,b){var c=Z.merge({tags:[]},b),d=X.descendants(a,"*");k.each(d,function(a){k.exists(c.tags,f.curry(xn.name,a))&&B.unwrap(a)})},transformer:function(a,b){var c=Z.merge({tags:[]},b),d=X.descendants(a,"*");k.each(d,function(a){k.find(c.tags,f.curry(xn.name,a)).each(function(b){b.mutate(a)})})},validator:function(a){a=X.descendants(a,"*");k.each(a,function(a){yn.validateStyles(a)})}},wj=function(a,b,c){var d,e,f,h=q.fromDom(a);switch(a.nodeType){case 1:b?d="endElement":
(d="startElement",t.setAll(h,c||{}));e="HTML"!==a.scopeName&&a.scopeName&&a.tagName&&0>=a.tagName.indexOf(":")?(a.scopeName+":"+a.tagName).toUpperCase():a.tagName;break;case 3:d="text";f=a.nodeValue;break;case 8:d="comment";f=a.nodeValue;break;default:console.log("WARNING: Unsupported node type encountered: "+a.nodeType)}return{getNode:function(){return a},tag:function(){return e},type:function(){return d},text:function(){return f}}},tM=function(a,b){return wj(b.createElement(a),!0)},bb={START_ELEMENT_TYPE:"startElement",
END_ELEMENT_TYPE:"endElement",TEXT_TYPE:"text",COMMENT_TYPE:"comment",FINISHED:tM("HTML",window.document),token:wj,createStartElement:function(a,b,c,d){var e=d.createElement(a);W.each(b,function(a,b){e.setAttribute(b,a)});return wj(e,!1,c)},createEndElement:tM,createComment:function(a,b){return wj(b.createComment(a),!1)},createText:function(a,b){return wj(b.createTextNode(a))}},jba={create:function(a){var b=a.createDocumentFragment(),c=b;return{dom:c,receive:function(d){var e=function(a){a=a.getNode().cloneNode(!1);
b.appendChild(a);b=a},f=function(c,d){var e=a.createTextNode(c.text());b.appendChild(e)};switch(d.type()){case bb.START_ELEMENT_TYPE:e(d);break;case bb.TEXT_TYPE:f(d);break;case bb.END_ELEMENT_TYPE:b=b.parentNode;null===b&&(b=c);break;case bb.COMMENT_TYPE:break;default:throw{message:"Unsupported token type: "+d.type()};}},label:"SERIALISER"}}},kba={tokenise:function(a,b){var c;b=b||window.document;c=b.createElement("div");b.body.appendChild(c);c.style.position="absolute";c.style.left="-10000px";c.innerHTML=
a;var d=c.firstChild||bb.FINISHED,e=[],f=!1;return{hasNext:function(){return void 0!==d},next:function(){var a=d,h=f;!f&&d.firstChild?(e.push(d),d=d.firstChild):f||1!==d.nodeType?d.nextSibling?(d=d.nextSibling,f=!1):(d=e.pop(),f=!0):f=!0;a===bb.FINISHED||d||(b.body.removeChild(c),d=bb.FINISHED);a=a===bb.FINISHED?a:a?bb.token(a,h):void 0;return a}}}},uM=function(a,b,c){var d=c;for(c=b.length-1;0<=c;c--)d=b[c](d,{},a);return d},lba={build:uM,run:function(a,b,c){var d=jba.create(a);b=kba.tokenise(b,
a);for(a=uM(a,c,d);b.hasNext();)c=b.next(),a.receive(c);return d.dom}},Ra={removal:function(a){return function(b){zn.remover(b,a)}},unwrapper:function(a){return function(b){zn.unwrapper(b,a)}},transformer:function(a){return function(b){zn.transformer(b,a)}},validate:function(){return function(a){zn.validator(a)}},pipeline:function(a){return function(b){var c=ua.get(b),d=y.owner(b),c=lba.run(d.dom(),c,a);B.empty(b);b.dom().appendChild(c)}},isWordContent:function(a,b){return 0<=a.indexOf("<o:p>")||
b.browser.isEdge()&&0<=a.indexOf('v:shapes="')||b.browser.isEdge()&&0<=a.indexOf("mso-")||0<=a.indexOf("mso-list")||0<=a.indexOf("p.MsoNormal, li.MsoNormal, div.MsoNormal")||0<=a.indexOf("MsoListParagraphCxSpFirst")||0<=a.indexOf("<w:WordDocument>")},go:function(a,b,c){var d=q.fromTag("div",a.dom());d.dom().innerHTML=b;k.each(c,function(a){a(d)});return ua.get(d)}},du={getAttribute:function(a,b){var c=q.fromDom(a.getNode());return m.get(c,b)},getStyle:function(a,b){var c=q.fromDom(a.getNode());return t.get(c,
b)},isWhitespace:function(a){return a.type()===bb.TEXT_TYPE&&/^[\s\u00A0]*$/.test(a.text())},getMsoList:function(a){a=q.fromDom(a.getNode());return jf.scan(a,["mso-list"],f.constant(!1))["mso-list"]}},vM=function(a,b,c){return a===b||a&&b&&a.tag===b.tag&&a.type===b.type&&(c||a.variant===b.variant)},wM={guessFrom:function(a,b){return k.find(a,function(a){return"UL"===a.tag||b&&vM(a,b,!0)}).orThunk(function(){return k.head(a)})},eqListType:vM},eu=function(a,b){if(void 0===a||void 0===b)throw console.trace(),
"brick";a.nextFilter.set(b)},xM=function(a,b,c){b.nextFilter.get()(a,b,c)},An={next:eu,go:xM,jump:function(a){return function(b,c,d){eu(c,a);xM(b,c,d)}},isNext:function(a,b){return a.nextFilter.get()===b},setNext:function(a){return function(b,c,d){eu(c,a)}}},mba=C.immutable("level","token","type"),nba=function(a,b,c,d){a=c.getCurrentListType();c=c.getCurrentLevel()==d.level()?a:null;return wM.guessFrom(d.emblems(),c).filter(function(a){if(a="OL"===a.tag)a=!k.contains(["P"],b.tag())||/^MsoHeading/.test(du.getAttribute(b,
"class"));return!a})},yM={predicate:function(a,b){return m.has(q.fromDom(b.getNode()),"data-list-level")},action:function(a){return function(b,c,d){b=q.fromDom(d.getNode());var e=parseInt(m.get(b,"data-list-level"),10),g=m.get(b,"data-list-emblems"),g=JSON.parse(g);m.remove(b,"data-list-level");m.remove(b,"data-list-emblems");b={level:f.constant(e),emblems:f.constant(g)};b.level();c.originalToken.set(d);nba(c.listType.get(),d,c.emitter,b).each(c.listType.set);d=mba(b.level(),c.originalToken.get(),
c.listType.get());c.emitter.openItem(d.level(),d.token(),d.type());An.next(c,a.inside())}}},Dx=function(a,b){return function(a,d,e){return b(a,d,e)}},zM={inside:function(a){return Cx("Inside.List.Item",[$o(function(a,c){return c.type()===bb.END_ELEMENT_TYPE&&a.originalToken.get()&&c.tag()===a.originalToken.get().tag()},function(b,c,d){An.next(c,a.outside())},"Closing open tag")],function(a,c,d){a.emit(d)})},outside:function(a){return Cx("Outside.List.Item",[$o(yM.predicate,yM.action(a),"Data List ****"),
$o(function(a,c){return c.type()===bb.TEXT_TYPE&&du.isWhitespace(c)},function(a,c,d){a.emit(d)},"Whitespace")],function(b,c,d){c.emitter.closeAllLists();b.emit(d);An.next(c,a.outside())})}},oba=C.immutable("state","result"),pba=C.immutable("state","value"),Cb={state:C.immutable("level","type","types","items"),value:pba,result:oba},fu={start:function(a,b){var c=a.items().slice(0),d=void 0!==b&&"P"!==b?h.some(b):h.none();d.fold(function(){c.push("P")},function(a){c.push(a)});var e=Cb.state(a.level(),
a.type(),a.types(),c);return Cb.value(e,d)},finish:function(a){var b=a.items().slice(0);if(0<b.length&&"P"!==b[b.length-1]){var c=b[b.length-1];b[b.length-1]="P";a=Cb.state(a.level(),a.type(),a.types(),b);return Cb.value(a,h.some(c))}return Cb.value(a,h.none())}},gu=function(a,b,c){for(var d=[];b(a);){var e=c(a);a=e.state();d=d.concat(e.result())}return Cb.result(a,d)},AM={moveRight:function(a,b,c){return gu(a,function(a){return a.level()<b},c)},moveLeft:function(a,b,c){return gu(a,function(a){return a.level()>
b},c)},moveUntil:gu},qba={from:function(a){var b={"list-style-type":"none"};a?(a=du.getStyle(a,"margin-left"),a=void 0!==a&&"0px"!==a?{"margin-left":a}:{}):a=b;return a}},BM=function(a,b,c){var d=b.start&&1<b.start?{start:b.start}:{},e=a.level()+1,g=a.types().concat([b]);c=[f.curry(bb.createStartElement,b.tag,d,c)];a=Cb.state(e,b,g,a.items());return Cb.result(a,c)},CM=function(a){var b=a.types().slice(0),c=[f.curry(bb.createEndElement,b.pop().tag)],d=a.level()-1;a=Cb.state(d,b[b.length-1],b,a.items());
return Cb.result(a,c)},rba=function(a,b){var c=CM(a),d=BM(c.state(),b,b.type?{"list-style-type":b.type}:{});return Cb.result(d.state(),c.result().concat(d.result()))},oh={open:BM,openItem:function(a,b,c){var d=qba.from(b);a=a.type()&&!wM.eqListType(a.type(),c)?rba(a,c):Cb.result(a,[]);d=[f.curry(bb.createStartElement,"LI",{},d)];c=fu.start(a.state(),b&&b.tag());var e=c.value().map(function(a){yn.styleDom(b.getNode(),f.constant(!0));return[f.constant(b)]}).getOr([]);return Cb.result(c.state(),a.result().concat(d).concat(e))},
close:CM,closeItem:function(a){var b=f.curry(bb.createEndElement,"LI");a=fu.finish(a);var c=a.value().fold(function(){return[b]},function(a){return[f.curry(bb.createEndElement,a),b]});return Cb.result(a.state(),c)}},Bn=function(a){if(0===a.length)throw"Compose must have at least one element in the list";var b=a[a.length-1];a=k.bind(a,function(a){return a.result()});return Cb.result(b.state(),a)},sba=function(a){a=oh.closeItem(a);var b=oh.close(a.state());return Bn([a,b])},tba=function(a,b,c,d){return AM.moveRight(a,
c,function(a){var f=a.level()===c-1&&b.type?{"list-style-type":b.type}:{};a=oh.open(a,b,f);f=oh.openItem(a.state(),a.state().level()==c?d:void 0,b);return Bn([a,f])})},DM=function(a,b){return AM.moveLeft(a,b,sba)},uba=function(a,b,c,d){var e=1<c?fu.finish(a):Cb.value(a,h.none());a=e.value().map(function(a){return[f.curry(bb.createEndElement,a)]}).getOr([]);e.state().level();b=tba(e.state(),b,c,d);return Cb.result(b.state(),a.concat(b.result()))},Ex={openItem:function(a,b,c,d){a=a.level()>b?DM(a,b):
Cb.result(a,[]);a.state().level()===b?(b=a.state(),b=0<b.level()?oh.closeItem(b):Cb.result(b,[]),c=oh.openItem(b.state(),c,d),c=Bn([b,c])):c=uba(a.state(),d,b,c);return Bn([a,c])},closeAllLists:DM},LU=["disc","circle","square"],vba={getCurrentListType:function(){return xj().getCurrentListType()},getCurrentLevel:function(){return xj().getCurrentLevel()},closeAllLists:function(){return xj().closeAllLists.apply(void 0,arguments)},openItem:function(){return xj().openItem.apply(void 0,arguments)}},xj=
function(){return{getCurrentListType:f.constant({}),getCurrentLevel:f.constant(1),closeAllLists:f.identity,openItem:f.identity}},FM={inside:function(){return wba},outside:function(){return EM}},xba=function(){var a=!1,b="";return{check:function(c){return a&&c.type()===bb.TEXT_TYPE?(b+=c.text(),!0):c.type()===bb.START_ELEMENT_TYPE&&"STYLE"===c.tag()?a=!0:c.type()===bb.END_ELEMENT_TYPE&&"STYLE"===c.tag()?(a=!1,!0):!1}}}(),wba=zM.inside(FM),EM=zM.outside(FM),GM=function(a){var b=xa(a),c=xa(null),d=xa(null);
return{reset:function(e){b.set(a);c.set(null);d.set(null);e=KU(e,e.document);xj=f.constant(e)},nextFilter:b,originalToken:c,listType:d,emitter:vba}}(EM),yba=Bx(function(a,b,c){xba.check(b)||An.go(a,GM,b)},GM.reset,"list.filters"),zba=[{regex:/^\(?[dc][\.\)]$/,type:{tag:"OL",type:"lower-alpha"}},{regex:/^\(?[DC][\.\)]$/,type:{tag:"OL",type:"upper-alpha"}},{regex:/^\(?M*(CM|CD|D?C{0,3})(XC|XL|L?X{0,3})(IX|IV|V?I{0,3})[\.\)]$/,type:{tag:"OL",type:"upper-roman"}},{regex:/^\(?m*(cm|cd|d?c{0,3})(xc|xl|l?x{0,3})(ix|iv|v?i{0,3})[\.\)]$/,
type:{tag:"OL",type:"lower-roman"}},{regex:/^\(?[0-9]+[\.\)]$/,type:{tag:"OL"}},{regex:/^([0-9]+\.)*[0-9]+\.?$/,type:{tag:"OL",variant:"outline"}},{regex:/^\(?[a-z]+[\.\)]$/,type:{tag:"OL",type:"lower-alpha"}},{regex:/^\(?[A-Z]+[\.\)]$/,type:{tag:"OL",type:"upper-alpha"}}],HM={"\u2022":{tag:"UL",type:"disc"},"\u00b7":{tag:"UL",type:"disc"},"\u00a7":{tag:"UL",type:"square"}},IM={o:{tag:"UL",type:"circle"},"-":{tag:"UL",type:"disc"},"\u25cf":{tag:"UL",type:"disc"},"\ufffd":{tag:"UL",type:"circle"}},
Aba=function(a,b){return void 0!==a.variant?a.variant:"("===b.charAt(0)?"()":")"===b.charAt(b.length-1)?")":"."},Bba=function(a){var b=a.split(".");0===b.length?b=a:(a=b[b.length-1],b=0===a.length&&1<b.length?b[b.length-2]:a);b=parseInt(b,10);return isNaN(b)?{}:{start:b}},Cba={extract:function(a,b){var c=IM[a]?[IM[a]]:[],d=b&&HM[a]?[HM[a]]:b?[{tag:"UL",variant:a}]:[],e=k.bind(zba,function(b){return b.regex.test(a)?[Z.merge(b.type,Bba(a),{variant:Aba(b.type,a)})]:[]}),c=c.concat(d).concat(e);return k.map(c,
function(b){return void 0!==b.variant?b:Z.merge(b,{variant:a})})}},JM=function(a){return jf.scan(a,["mso-list"],f.constant(!1))["mso-list"]},KM=function(a){return A.isElement(a)&&t.getRaw(a,"font-family").exists(function(a){return k.contains(["wingdings","symbol"],a.toLowerCase())})},Qb={getMsoList:JM,extractLevel:function(a){a=JM(a);return(a=/ level([0-9]+)/.exec(a))&&a[1]?h.some(parseInt(a[1],10)):h.none()},extractEmblem:function(a,b){var c=nb.get(a).trim(),c=Cba.extract(c,b);return 0<c.length?
h.some(c):h.none()},extractSymSpan:function(a){return sa.child(a,KM)},extractMsoIgnore:function(a){return sa.descendant(a,function(a){return!!(A.isElement(a)?jf.scan(a,["mso-list"],f.constant(!1)):[])["mso-list"]})},extractCommentSpan:function(a){return sa.child(a,A.isComment).bind(y.nextSibling).filter(function(a){return"span"===A.name(a)})},isSymbol:KM,deduceLevel:function(a){return t.getRaw(a,"margin-left").bind(function(a){a=parseInt(a,10);return isNaN(a)?h.none():h.some(Math.max(1,Math.ceil(a/
18)))})}},LM=function(a){for(var b=[];null!==a.nextNode();)b.push(q.fromDom(a.currentNode));return b},Dba=function(a){try{return LM(a)}catch(b){return[]}},MM=Y.detect().browser,Eba=MM.isIE()||MM.isEdge()?Dba:LM,Fba=f.constant(f.constant(!0)),Gba={find:function(a,b){var c=b.fold(Fba,function(a){return function(b){return a(b.nodeValue)}});c.acceptNode=c;c=document.createTreeWalker(a.dom(),Ub.getOrDie("NodeFilter").SHOW_COMMENT,c,!1);return Eba(c)}},yj=function(a,b,c,d){m.set(a,"data-list-level",b);
b=JSON.stringify(c);m.set(a,"data-list-emblems",b);b=Gba.find(a,h.none());k.each(b,B.remove);k.each(d,B.remove);m.remove(a,"style");m.remove(a,"class")},Hba=function(a){return Qb.extractLevel(a).bind(function(b){return Qb.extractSymSpan(a).bind(function(c){return Qb.extractEmblem(c,!0).map(function(d){return{mutate:function(){yj(a,b,d,[c])}}})})})},Iba=function(a){return Qb.extractLevel(a).bind(function(b){return Qb.extractCommentSpan(a).bind(function(c){return Qb.extractEmblem(c,Qb.isSymbol(c)).map(function(d){return{mutate:function(){yj(a,
b,d,[c])}}})})})},Jba=function(a){return Qb.extractLevel(a).bind(function(b){return Qb.extractCommentSpan(a).bind(function(c){return Qb.extractEmblem(c,Qb.isSymbol(c)).map(function(d){return{mutate:function(){yj(a,b,d,[c])}}})})})},Kba=function(a){return"p"!==A.name(a)?h.none():Qb.extractLevel(a).bind(function(b){return Qb.extractMsoIgnore(a).bind(function(c){return Qb.extractEmblem(c,!1).map(function(d){return{mutate:function(){yj(a,b,d,[y.parent(c).getOr(c)])}}})})})},Lba=function(a){return"p"!==
A.name(a)?h.none():Qb.extractMsoIgnore(a).bind(function(b){var c=y.parent(b).getOr(b),d=Qb.isSymbol(c);return Qb.extractEmblem(b,d).bind(function(b){return Qb.deduceLevel(a).map(function(d){return{mutate:function(){yj(a,d,b,[c])}}})})})},Mba={find:function(a){return Hba(a).orThunk(function(){return Iba(a)}).orThunk(function(){return Jba(a)}).orThunk(function(){return Kba(a)}).orThunk(function(){return Lba(a)})}},Nba=Ra.transformer({tags:[{name:F.pattern(/^(p|h\d+)$/,F.caseInsensitive),mutate:function(a){Mba.find(a).each(function(a){a.mutate()})}}]}),
Oba=function(a){var b=a.dom().attributes,b=void 0!==b&&null!==b&&0<b.length;return"span"===A.name(a)?b:!0},Cn=function(a){return void 0===a.dom().attributes||null===a.dom().attributes?!0:0===a.dom().attributes.length||1===a.dom().attributes.length&&"style"===a.dom().attributes[0].name},NM=function(a,b){var c=q.fromTag(a);v.before(b,c);var d=b.dom().attributes;k.each(d,function(a){c.dom().setAttribute(a.name,a.value)});d=y.children(b);J.append(c,d);B.remove(b);return c},OM=function(a){return y.prevSibling(a).bind(function(a){return A.isText(a)&&
0===Fa.get(a).trim().length?OM(a):"li"===A.name(a)?h.some(a):h.none()})},Xf={changeTag:NM,addBrTag:function(a){0===ua.get(a).length&&v.append(a,q.fromTag("br"))},properlyNest:function(a){y.parent(a).each(function(b){b=A.name(b);k.contains(["ol","ul"],b)&&OM(a).fold(function(){var b=q.fromTag("li");t.set(b,"list-style-type","none");v.wrap(a,b)},function(b){v.append(b,a)})})},fontToSpan:function(a){var b=NM("span",a),c={"font-size":{1:"8pt",2:"10pt",3:"12pt",4:"14pt",5:"18pt",6:"24pt",7:"36pt"}};W.each({face:"font-family",
size:"font-size",color:"color"},function(a,e){if(m.has(b,e)){var f=m.get(b,e);t.set(b,a,void 0!==c[a]&&void 0!==c[a][f]?c[a][f]:f);m.remove(b,e)}})}},Pba=Ra.unwrapper({tags:[{name:F.pattern(/^([OVWXP]|U[0-9]+|ST[0-9]+):/i,F.caseInsensitive)}]}),Qba=[Ra.pipeline([yba])],Rba=Ra.removal({attributes:[{name:F.pattern(/^v:/,F.caseInsensitive)},{name:F.exact("href",F.caseInsensitive),value:F.contains("#_toc",F.caseInsensitive)},{name:F.exact("href",F.caseInsensitive),value:F.contains("#_mso",F.caseInsensitive)},
{name:F.pattern(/^xmlns(:|$)/,F.caseInsensitive)},{name:F.exact("type",F.caseInsensitive),condition:function(a){return"ol"===A.name(a)||"ul"===A.name(a)}}]});Ra.removal({attributes:[{name:F.exact("id",F.caseInsensitive)},{name:F.exact("name",F.caseInsensitive)}]});var Sba=Ra.removal({tags:[{name:F.exact("script",F.caseInsensitive)},{name:F.exact("link",F.caseInsensitive)},{name:F.exact("style",F.caseInsensitive),condition:function(a){return 0===ua.get(a).length}}],attributes:[{name:F.starts("on",
F.caseInsensitive)},{name:F.exact('"',F.caseInsensitive)},{name:F.exact("lang",F.caseInsensitive)},{name:F.exact("language",F.caseInsensitive)}],styles:[{name:F.all(),value:F.pattern(/OLE_LINK/i,F.caseInsensitive)}]}),PM=Ra.removal({tags:[{name:F.exact("meta",F.caseInsensitive)}]}),Tba=Ra.removal({tags:[{name:F.exact("style",F.caseInsensitive)}]}),Uba=Ra.removal({styles:[{name:F.not(F.pattern(/width|height|list-style-type/,F.caseInsensitive)),condition:function(a){return!n.has(a,"ephox-limbo-transform")}},
{name:F.pattern(/width|height/,F.caseInsensitive),condition:function(a){return"img"!==A.name(a)}}]}),Vba=Ra.removal({classes:[{name:F.not(F.exact("rtf-data-image",F.caseInsensitive))}]}),Wba=Ra.removal({styles:[{name:F.pattern(mM.validStyles(),F.caseInsensitive)}]}),Xba=Ra.removal({classes:[{name:F.pattern(/mso/i,F.caseInsensitive)}]}),Yba=Ra.unwrapper({tags:[{name:F.exact("img",F.caseInsensitive),condition:function(a){a=m.get(a,"src");return/^file:/.test(a)}},{name:F.exact("a",F.caseInsensitive),
condition:Cn}]}),Zba=Ra.unwrapper({tags:[{name:F.exact("a",F.caseInsensitive),condition:Cn}]}),$ba=Ra.removal({attributes:[{name:F.exact("style",F.caseInsensitive),value:F.exact("",F.caseInsensitive),debug:!0}]}),aca=Ra.removal({attributes:[{name:F.exact("class",F.caseInsensitive),value:F.exact("",F.caseInsensitive),debug:!0}]}),bca=Ra.unwrapper({tags:[{name:F.pattern(mM.specialInline(),F.caseInsensitive),condition:f.not(function(a){return Cn(a)?Oba(a)&&Bc.descendant(a,function(a){var c=!Cn(a),d=
!k.contains("font em strong samp acronym cite code dfn kbd tt b i u s sub sup ins del var span".split(" "),A.name(a));return A.isText(a)||c||d}):!0})}]}),cca=Ra.unwrapper({tags:[{name:F.exact("p",F.caseInsensitive),condition:function(a){return function(b){return y.parent(b).exists(function(b){return A.name(b)===a&&1===y.children(b).length})}}("li")}]}),dca=Ra.transformer({tags:[{name:F.exact("p",F.caseInsensitive),mutate:Xf.addBrTag}]}),eca=Ra.transformer({tags:[{name:F.pattern(/ol|ul/,F.caseInsensitive),
mutate:Xf.properlyNest}]}),fca=Ra.transformer({tags:[{name:F.exact("b",F.caseInsensitive),mutate:f.curry(Xf.changeTag,"strong")},{name:F.exact("i",F.caseInsensitive),mutate:f.curry(Xf.changeTag,"em")},{name:F.exact("u",F.caseInsensitive),mutate:function(a){a=Xf.changeTag("span",a);n.add(a,"ephox-limbo-transform");t.set(a,"text-decoration","underline")}},{name:F.exact("s",F.caseInsensitive),mutate:f.curry(Xf.changeTag,"strike")},{name:F.exact("font",F.caseInsensitive),mutate:Xf.fontToSpan,debug:!0}]}),
gca=Ra.removal({classes:[{name:F.exact("ephox-limbo-transform",F.caseInsensitive)}]}),hca=Ra.removal({tags:[{name:F.exact("br",F.caseInsensitive),condition:le.hasClass("Apple-interchange-newline")}]}),ica=Ra.removal({styles:[{name:F.pattern(/^-/,F.caseInsensitive)},{name:F.all(),value:F.exact("initial",F.caseInsensitive)},{name:F.exact("background-color",F.caseInsensitive),value:F.exact("transparent",F.caseInsensitive)},{name:F.exact("font-style",F.caseInsensitive),value:F.exact("normal",F.caseInsensitive)},
{name:F.pattern(/font-variant.*/,F.caseInsensitive)},{name:F.exact("letter-spacing",F.caseInsensitive)},{name:F.exact("font-weight",F.caseInsensitive),value:F.pattern(/400|normal/,F.caseInsensitive)},{name:F.exact("orphans",F.caseInsensitive)},{name:F.exact("text-decoration",F.caseInsensitive),value:F.exact("none",F.caseInsensitive)},{name:F.exact("text-size-adjust",F.caseInsensitive)},{name:F.exact("text-indent",F.caseInsensitive),value:F.exact("0px",F.caseInsensitive)},{name:F.exact("text-transform",
F.caseInsensitive),value:F.exact("none",F.caseInsensitive)},{name:F.exact("white-space",F.caseInsensitive),value:F.exact("normal",F.caseInsensitive)},{name:F.exact("widows",F.caseInsensitive)},{name:F.exact("word-spacing",F.caseInsensitive),value:F.exact("0px",F.caseInsensitive)},{name:F.exact("text-align",F.caseInsensitive),value:F.pattern(/start|end/,F.caseInsensitive)},{name:F.exact("font-weight",F.caseInsensitive),value:F.pattern(/700|bold/,F.caseInsensitive),condition:function(a){return/^h\d$/.test(A.name(a))}}]}),
jca=function(){var a=function(a,b){return function(c){return a(c).filter(function(a){return A.isText(c)&&b(nb.get(a)," ")}).isSome()}},b=a(y.prevSibling,aa.endsWith),c=a(y.nextSibling,aa.startsWith);return Ra.transformer({tags:[{name:F.exact("span",F.caseInsensitive),condition:le.hasClass("Apple-converted-space"),mutate:function(a){"\u00a0"===nb.get(a)&&(b(a)||c(a)?B.unwrap(a):(v.before(a,q.fromText(" ")),B.remove(a)))}}]})}(),kca=function(){var a=/^file:\/\/\/[^#]+(#[^#]+)$/;return Ra.transformer({tags:[{name:F.exact("a",
F.caseInsensitive),condition:function(b){return(b=m.get(b,"href"))?a.test(b):!1},mutate:function(b){var c=m.get(b,"href");m.set(b,"href",c.replace(a,"$1"))}}]})}(),lca=Ra.removal({attributes:[{name:F.exact("href",F.caseInsensitive),value:F.starts("file:///",F.caseInsensitive),debug:!0}]}),QM=function(a){a=lc.descendants(a,A.isComment);k.each(a,function(a){var c=nI.get(a);(aa.contains(c,"StartFragment")||aa.contains(c,"EndFragment"))&&B.remove(a)})},Dn=f.noop,En=function(a){return a.browser.isIE()&&
11<=a.browser.version.major},mca=function(a,b,c){var d=q.fromDom(a.getNode());return b(d).fold(function(){return[a]},function(b){var d=a.type()===bb.END_ELEMENT_TYPE,f=[bb.token(b.dom(),d)];!d&&c&&f.push(bb.token(b.dom(),!0));return f})},nca=function(a,b){return Bx(function(c,d){var e=mca(d,a,b);k.each(e,c.emit)},f.noop,"image filters")},oca=function(a,b){return En(b)&&a?[cca]:[]},pca=function(a,b,c){a=[Wba,Xba];c=[Uba,Vba];return b?a:c},qca=function(a,b,c){return En(c)||!a?[]:[Nba]},rca=function(a,
b,c){if(!a)return[Dn];a=[Pba];c=En(c)?[]:Qba;return a.concat(c).concat([Rba])},sca={derive:function(a,b,c){var d,e;d=(e=c.browser.isFirefox()||c.browser.isEdge())?eba:fba;var f=!e;d=En(c)?Dn:Ra.pipeline([nca(d,f)]);d=[a?d:Dn];e=[e?Dn:Yba];return k.flatten([qca(a,b,c),d,[fca],rca(a,b,c),[eca],[Sba],[PM],e,pca(a,b,c),[kca,lca,Zba],[$ba],[aca],[bca],[hca],!a&&b?[ica]:[],[jca],[dca],oca(a,c),[gca],[QM],[Tba]])}},tca=ql.link().source,uca=function(a){var b=C.immutable("word","pattern"),c=cb.unsafetoken(tca),
b=b("__INTERNAL__",c);return mn.run(a,[b])},vca=function(a){return!db.closest(a,"a")},wca=function(a){return h.from(a[0]).filter(vca).map(function(b){var c=q.fromTag("a");v.before(b,c);J.append(c,a);m.set(c,"href",nb.get(c));return c})},xca=function(a){a=uca(a);k.each(a,function(a){var c=a.exact(),d;(d=0>c.indexOf("@"))||(c=c.indexOf("://"),d=3<=c&&9>=c);d&&wca(a.elements())})},yca=function(a){k.each(a,function(a){A.isElement(a)&&t.getRaw(a,"position").isSome()&&t.remove(a,"position")})},zca=function(a){var b=
k.filter(a,function(a){return"li"===A.name(a)});if(0<b.length){var c=y.prevSiblings(b[0]),d=q.fromTag("ul");v.before(a[0],d);0<c.length&&(a=q.fromTag("li"),v.append(d,a),J.append(a,c));J.append(d,b)}},RM=function(a){var b=y.children(a);k.each([xca,yca,zca],function(a){a(b)})},hu={go:function(a,b,c,d,e){RM(c);c=ua.get(c);b=sca.derive(e,d,b);return Ra.go(a,c,b)},preprocess:RM,internal:function(a,b){var c=ua.get(b);return Ra.go(a,c,[QM,PM])}},Aca=Y.detect(),SM=function(a){try{var b=a(),c=void 0!==b&&
null!==b&&0<b.length?Ld.fromHtml(b):[];return H.value(c)}catch(d){return console.error(d),H.error("errors.paste.process.failure")}},TM=function(a){return a.fold(function(a){return wa.error(a)},function(a){return wa.pure({response:La.paste(a,[]),bundle:pb.nu({})})})},UM=function(a,b,c,d){return SM(function(){return hu.go(a,Aca,b,c,d)})},Fn={direct:function(a,b,c){a=UM(a,b,c,!1);return TM(a)},internal:function(a,b){var c=SM(function(){return hu.internal(a,b)});return TM(c)},transfer:function(a,b,c,
d,e){return UM(a,b,d,c).fold(function(a){return wa.error(a)},function(a){return wa.sync(function(b){e.get(function(c){c=ge.findImages(a,c);wa.call(b,{response:La.paste(a,c),bundle:pb.nu({})})})})})}},VM={internal:function(a,b,c){b=b.findClipboardTags(y.children(c)).getOr([]);k.each(b,B.remove);b=va.nu(function(a){a([])});return Fn.transfer(a,c,!1,!0,b)},external:function(a,b,c,d,e){return Fn.transfer(a,b,d,c,e)}},WM={encode:function(a){var b=q.fromTag("div");nb.set(b,a);return ua.get(b)},convert:function(a){a=
a.trim().split(/\n{2,}|(?:\r\n){2,}/);a=k.map(a,function(a){return a.split(/\n|\r\n/).join("<br />")});return 1===a.length?a[0]:k.map(a,function(a){return"<p>"+a+"</p>"}).join("")}},Bca={handle:function(a){var b=ec.asText(a).getOrDie("Required text input for Text Handler");return wa.sync(function(a){var d;0<b.text().length?(d=b.text(),d=WM.encode(d),d=WM.convert(d),d=Ld.fromHtml(d),d=La.paste(d,[])):d=La.cancel();wa.call(a,{response:d,bundle:pb.nu({})})})}},bd={plain:function(a,b,c){return Bca.handle(a)},
autolink:function(a,b){var c=function(a,c){var d=q.fromTag("div");J.append(d,a);hu.preprocess(d);d=y.children(d);return wa.pure({response:La.paste(d,c),bundle:b.bundle()})},d=f.curry(wa.pass,b);return La.cata(b.response(),d,c,d,c)},noImages:function(){return function(a,b){return wa.error("errors.local.images.disallowed")}},images:function(){return function(a,b){var c=ec.asImages(a).getOrDie("Must have image data for images handler");return bba.handle(c.images())}},handleInternal:function(a){return function(b,
c){var d=ec.asHtml(b).getOrDie("Wrong input type for HTML handler"),d=a.findClipboardTags(y.children(d.container()));d.each(function(a){k.each(a,B.remove)});d=d.isSome();return wa.pure({response:c.response(),bundle:pb.nu({isInternal:d})})}},nativeHtml:function(a,b,c){return function(c,e){var f=ec.asHtml(c).getOrDie("Wrong input type for HTML handler").container(),h=y.owner(b),k=e.bundle();if(Jd.isInternal(k))return Fn.internal(h,f);a(f);k=Jd.merging(k);return Fn.direct(h,f,k)}},external:function(a,
b){return function(c,d){var e=d.bundle();return Jd.proxyBin(e).handle("There was no proxy bin setup. Ensure you have run proxyStep first.",function(c){var d=Jd.merging(e),f=Jd.isWord(e),h=Jd.isInternal(e),k=Jd.backgroundAssets(e),m=y.owner(a);return h?VM.internal(m,b,c):VM.external(m,c,d,f,k)})}},wordimport:function(a,b){return function(c,d){var e=ec.asWord(c).getOrDie("Wrong input type for Word Import handler"),f=Jd.mergeOffice(d.bundle());return aba.handle(e,f,a,b)}},setBundle:function(a){return function(b,
c){var d=pb.merge(c.bundle(),pb.nu(a));return wa.pure({response:c.response(),bundle:d})}},none:function(a,b){return wa.cancel()}},Cca=function(a,b){return Bc.descendant(a,function(a){return m.has(a,"style")?-1<m.get(a,"style").indexOf("mso-"):!1})},Dca=function(a,b){var c=ua.get(a);return Ra.isWordContent(c,b)},NU={isWord:function(a,b){var c=a.browser;return(c.isIE()&&11<=c.version.major?Cca:Dca)(b,a)}},ap=Y.detect(),Eca=function(a,b){return a.isSupported()?b.getWordData():h.none()},Fca=function(a){return a.getNative()},
Gca=function(a){return a.getImage()},Hca=function(a){return a.getHtml()},Ica=function(a){return a.getText()},Jca=function(a){return a.getOnlyText()},Yf=function(a,b,c,d){return{_label:a,label:f.constant(a),getAvailable:b,steps:f.constant(c),capture:f.constant(d)}},Af={wordimport:function(a,b,c,d){return Yf("Word Import pasting",f.curry(Eca,a),[kb.normal(bd.setBundle({isWord:!0})),kb.normal(cu.fromConfig(b,c)),kb.normal(bd.wordimport(a,c.allowLocalImages)),kb.blocking(OU(c,Ax(d,c))),kb.normal(Ak())],
!0)},image:function(a){return Yf("Image pasting",Gca,[kb.normal(!1===a.allowLocalImages?bd.noImages(f.noop):bd.images()),kb.normal(Ak())],!0)},nativeHtml:function(a,b,c,d){return Yf("Outside of Textbox.io pasting HTML5 API (could be internal)",Hca,[kb.normal(bd.handleInternal(b.intraFlag)),kb.normal(cu.fromConfigIfExternal(a,b)),kb.normal(bd.nativeHtml(c,d,b.intraFlag)),kb.normal(wx(b)),kb.normal(Ak())],!0)},text:function(){return Yf("Plain text pasting",Ica,[kb.normal(bd.plain),kb.normal(bd.autolink)],
!0)},onlyText:function(){return Yf("Only plain text is available to paste",Jca,[kb.normal(bd.plain),kb.normal(bd.autolink)],!0)},none:function(){return Yf("There is no valid way to paste",h.some,[kb.normal(bd.none)],!1)},fallback:function(a,b,c,d,e,f){return Yf("Outside of Textbox.io pasting offscreen (could be internal)",Fca,[kb.normal(MU(d,c,e,b.intraFlag,Iaa)),kb.normal(cu.fromConfigIfExternal(a,b)),kb.normal(bd.external(e,b.intraFlag)),kb.blocking(Ax(f,b)),kb.normal(wx(b)),kb.normal(Ak())],!1)}},
XM=function(a){return q.fromHtml("<p>"+a("cement.dialog.flash.press-escape")+"</p>")},iu={paste:function(a){var b=q.fromTag("div");n.add(b,zc.resolve("flashbin-helpcopy"));var c;c=Y.detect().os.isOSX()?["\u2318"]:["Ctrl"];var d=q.fromHtml("<p>"+a("cement.dialog.flash.trigger-paste")+"</p>");c=q.fromHtml('<div><span class="ephox-polish-help-kbd">'+c+'</span> + <span class="ephox-polish-help-kbd">V</span></div>');n.add(c,zc.resolve("flashbin-helpcopy-kbd"));J.append(b,[d,c,XM(a)]);return b},noflash:function(a){var b=
q.fromTag("div");n.add(b,zc.resolve("flashbin-helpcopy"));var c=q.fromHtml("<p>"+a("cement.dialog.flash.missing")+"</p>");J.append(b,[c,XM(a)]);return b},indicator:function(a){var b=q.fromTag("div");n.add(b,zc.resolve("flashbin-loading"));var c=q.fromTag("div");n.add(c,zc.resolve("flashbin-loading-spinner"));var d=q.fromTag("p");a=a("loading.wait");ua.set(d,a);m.set(d,"aria-label",a);J.append(b,[c,d]);return b}},QU=Y.detect(),SU=function(a,b,c,d){b=iu.noflash(d);v.append(a,b);return{reset:f.noop}},
RU=function(a,b,c,d){var e=iu.paste(d),f=iu.indicator(d);J.append(a,[f,e,b.element()]);a=function(){t.set(e,"display","block");t.set(f,"display","none");c()};b.events.spin.bind(function(){t.set(e,"display","none");t.set(f,"display","block");t.remove(f,"height");t.remove(f,"padding");c()});b.events.reset.bind(a);b.events.hide.bind(function(){t.setAll(f,{height:"0",padding:"0"})});return{reset:a}},VU={responsive:function(){var a=xa(h.none()),b=D.create({crashed:r([]),timeout:r([])});return{start:function(c,
d,e,f){var k=d,m=setInterval(function(){e()?clearInterval(m):0>=k?(b.trigger.timeout(),clearInterval(m)):f()&&(clearInterval(m),b.trigger.crashed());k--},c);a.set(h.some(m))},stop:function(){a.get().each(function(a){clearInterval(a)})},events:b.registry}}},Ke=Ty.install("ephox.flash"),bp=Y.detect(),WU=h.none(),YM=Y.detect(),Kca=YM.deviceType.isiOS()||YM.deviceType.isAndroid(),Lca=function(a){var b=Rk.addScript(a+"/wordimport.js",f.identity);b.get(function(a){a.fold(function(a){console.error("Unable to load word import: ",
a)},f.noop)});return{isSupported:f.constant(!0),cleanDocument:function(a,d){return b.map(function(b){return b.map(function(b){return b.cleanDocument(a,d)})})}}},Mca=f.constant({isSupported:f.constant(!1),cleanDocument:f.constant(dj.error("not supported"))}),Nca=Kca?Mca:Lca,Oca="b i u sub sup strike".split(" "),Pca=function(a){k.each(y.children(a),function(a){A.isElement(a)&&!y.hasChildNodes(a)&&k.contains(Oca,A.name(a))&&B.remove(a)})},Qca=function(a,b){var c=y.children(a);k.each(c,function(a){if(b(a)){var c=
y.children(a),f=q.fromTag("div",y.owner(a).dom());J.append(f,c);v.before(a,f);B.remove(a)}})},aV={consolidate:function(a,b){y.nextSibling(a).filter(b).each(function(b){var d=y.children(b);J.append(a,d);B.remove(b)});Qca(a,b);Pca(a)}},Hx=ux.bin(),Ix=Hx+Ma.generate(""),$U=Od.onDirection("-100000px","100000px"),Rca=function(a){return{startContainer:a.start,startOffset:a.soffset,endContainer:a.finish,endOffset:a.foffset}},dV={set:function(a,b){Ea.setExact(a,b.startContainer(),b.startOffset(),b.endContainer(),
b.endOffset())},get:function(a,b){return Ea.getExact(a).map(Rca)}},iV=function(a,b,c,d){var e=fV(a.uiContainer(),d),g=function(a){b.filterDom(b.paste(),a)},h=gV(u,Zh.intraFlag(),c);return function(a){var b=Nca(h.baseUrl),c=f.curry(XU,e),d=cV(void 0!==h.pasteBinAttrs?h.pasteBinAttrs:{}),b=[Af.onlyText(),Af.wordimport(b,e,h,c),Af.nativeHtml(e,h,g,a),Af.image(h)];a=Af.fallback(e,h,g,d,a,c);return rx(b,a)}},mV=function(a){for(var b=[],c=a.start.charCodeAt(0);c<=a.finish.charCodeAt(0);c++)b.push(String.fromCharCode(c));
return b},Le=function(a){return{start:a,finish:a}},pV={controls:function(a){var b=a+"-";a=P.div();n.add(a,w.resolve(b+"dialog-controls"));var c=Rc.button(b,"cancel","button.cancel"),d=Rc.button(b,"insert","specialchar.insert");Rc.makeNormal(c.element());Rc.makeDefault(d.element());J.append(a,[c.element(),d.element()]);b=D.create({insert:K([],d.events.click),cancel:K([],c.events.click)});return{element:f.constant(a),ok:f.constant(d),cancel:f.constant(c),destroy:function(){d.destroy();c.destroy()},
events:b.registry}}},Sca=function(a){var b=q.fromTag("span");n.add(b,w.resolve("special-char"));var c=q.fromHtml(a);m.setAll(b,{"data-ephox-polish-special-char":a,"data-ephox-polish-char-code":a.charCodeAt(0).toString(16),tabindex:"-1"});xf.gridcell(b);v.append(b,c);return b},Tca=function(a,b){var c=q.fromTag("div");ea.add(c,[w.resolve("special-char-row"),w.resolve("special-char-row-"+b)]);xf.row(c);k.each(a,function(a){v.append(c,Sca(a))});return c},Uca=function(a,b,c){var d=q.fromTag("div");n.add(d,
w.resolve(b));xf.base(d,u.translate("specialchar.grid"));a=k.chunk(a,c);a=k.map(a,function(a){return Tca(a,b)});J.append(d,a);return d},oV={generateItems:function(a){var b=600>=Math.min(window.innerWidth,window.innerHeight)?12:16;return W.mapToArray(a,function(a,d){var e=Uca(a,d,b);return vf(u.translate("specialchar."+d),Fw(e))})}},qV=function(a){var b={item:f.constant(".ephox-pastry-statebutton.ephox-pastry-tablayout-item")},c=pa.flow({trigger:ob.button,executeOnArrow:!0});return ba.flow(a.menu(),
b,c)},Vca=function(a){return db.closest(a,".ephox-pastry-tablayout-active")},rV=function(a){var b={row:f.constant(".ephox-pastry-tablayout-active ."+w.resolve("special-char-row")),cell:f.constant(".ephox-pastry-tablayout-active ."+w.resolve("special-char"))},c=pa.tabular({trigger:ob.click,isValid:Vca});return ba.tabular(a.body(),b,c)},ZM=la.generate([{single:["element"]},{range:["start","soffset","finish","foffset"]}]),Ck={cata:function(a,b,c){return a.fold(b,c)},single:ZM.single,range:function(a,
b,c,d){var e=wc.after(c,d,a,b),f=e?S.point(a,b):S.point(c,d);a=e?S.point(c,d):S.point(a,b);return ZM.range(f.element(),f.offset(),a.element(),a.offset())}},Jx=C.immutable("suggestions","ignore"),rg={clean:function(a){var b=RegExp(Ua.zeroWidth(),"g"),c=RegExp("[\u2018\u2019]","g");return a.replace(b,"").replace(c,"'")}},ep={configure:function(a){a.add(a.internal(),"ephox-cram-annotation-wrap",Ca.unwrap);a.add(a.output(),"ephox-cram-annotation-wrap",Ca.unwrap);a.add(a.paste(),"ephox-cram-annotation-wrap",
Ca.unwrap);a.addExcludedContext([".ephox-cram-annotation-wrap"])},isWrap:function(a){return n.has(a,"ephox-cram-annotation-wrap")}},Wca={en_au:"en_gb",en_bz:"en_gb",en_ca:"en_gb",en_gb:"en_gb",en_ie:"en_gb",en_in:"en_gb",en_jm:"en_gb",en_my:"en_gb",en_nz:"en_gb",en_ph:"en_gb",en_sg:"en_gb",en_tt:"en_gb",en_za:"en_gb",en_zw:"en_gb",en_us:"en_us",en:"en_us"},Xca="da de en en_au en_br en_gb en_uk en_us es fi fr it nb nl pt pt_pt sv".split(" "),tc=function(a,b){return{value:f.constant(a),textkey:f.constant(b),
icon:h.none}},Yca=function(a){var b=Z.merge(Wp.localeList(),Wca);return Wp.determineFrom(a,b).filter(function(a){return k.contains(Xca,a)})},ie={determine:function(a){return"no.language"===a?h.some(a):Yca(a)},get:function(){return[tc("no.language",u.key("spelling.none")),tc("en_us",u.key("parlance.en_us")),tc("en_gb",u.key("parlance.en_gb")),tc("da",u.key("parlance.da")),tc("de",u.key("parlance.de")),tc("es",u.key("parlance.es")),tc("fi",u.key("parlance.fi")),tc("fr",u.key("parlance.fr")),tc("it",
u.key("parlance.it")),tc("nb",u.key("parlance.no")),tc("nl",u.key("parlance.nl")),tc("pt",u.key("parlance.pt_br")),tc("pt_pt",u.key("parlance.pt_pt")),tc("sv",u.key("parlance.sv"))]},isOn:function(a){return"no.language"!==a},offKey:f.constant("no.language")},xV=function(a,b){var c=ie.get();return{"spelling.dropdown":{name:"spellcheck",textkey:u.key("spelling.menu"),menuTextkey:"",updateDropdown:function(b){b.populate([{label:h.none,items:f.constant(c)}]);var e=a.profile().spelling().get();oa.on(e).fold(b.untick,
f.noop,b.tick)},action:function(c){a.profile().spelling().setAndCache(c);aa.startsWith(c,"en")||a.profile().autocorrect().set(!1);b.trigger.change(c)},values:c,render:h.none(),describe:function(a){return u.key("spelling.menu")},hasPopup:!0,toggle:!1}}},yV=function(a,b,c){var d=a.profile().spelling().get()!==ie.offKey();return{"spelling.general":{toggle:!0,value:"spellcheck",textkey:u.key("cog.spellcheck"),action:function(){var e=(d=!d)?b:ie.offKey();a.profile().spelling().setAndCache(e);c.trigger.change(e)},
updateGeneral:function(a){d?a.select():a.deselect()},icon:!1}}},AV=C.immutable("area","f"),zj={stop:f.constant("trampoline.stop"),run:function(a){for(;"trampoline.stop"!==a;)a=a()}},ph=la.generate([{inline:["item","mode","lang"]},{text:["item","mode"]},{empty:["item","mode"]},{boundary:["item","mode","lang"]},{concluded:["item","mode"]}]),$M=function(a,b,c,d){var e=a.property().isElement(b)?h.from(a.attrs().get(b,"lang")):h.none();return a.property().isText(b)?ph.text(b,c):d(b,c)?ph.concluded(b,c):
a.property().isBoundary(b)?ph.boundary(b,c,e):a.property().isEmptyTag(b)?ph.empty(b,c):ph.inline(b,c,e)},Zca=function(a,b,c,d){return ma.walk(a,b,c,ma.walkers().right(),void 0).fold(function(){return ph.concluded(b,c)},function(b){return $M(a,b.item(),b.mode(),d)})},aN=function(a,b,c,d,e,f){return function(){return b.fold(function(b,h,k){(h===ma.advance?d.openInline:d.closeInline)(k,b);return Aj(a,b,h,c,d,e,f)},function(b,h){var k=e(a,b);d.addDetail(k);return c(b,h)?zj.stop():Aj(a,b,h,c,d,e,f)},function(b,
h){d.addEmpty(b);return Aj(a,b,h,c,d,e,f)},function(b,h,k){var m=f.assess(b);return uf.cata(m,function(k){return h!==ma.backtrack?Aj(a,b,ma.sidestep,c,d,e,f):zj.stop()},function(m){(h===ma.advance?d.openBoundary:d.closeBoundary)(k,b);return Aj(a,b,h,c,d,e,f)},function(a){return zj.stop()})},function(a,b){return zj.stop()})}},Aj=function(a,b,c,d,e,f,h){b=Zca(a,b,c,d);return aN(a,b,d,e,f,h)},$ca={walk:function(a,b,c,d,e,f){var h=function(b,d){return a.eq(b,c)&&(d!==ma.advance||a.property().isText(b)||
0===a.property().children(b).length)},k=Vg.nu(d),m=$M(a,b,ma.advance,h);zj.run(function(){return aN(a,m,h,k,e,f)});return k.done()}},ada=C.immutableBag(["elements","lang","words"],[]),bda={fromWalking:function(a,b){var c=k.map(b,function(a){var b=a.details();a=a.lang();var c=k.map(b,function(a){return a.text()}).join(""),b=k.map(b,function(a){return a.item()}),c=II.words(c);return ada({lang:a,words:c,elements:b})});return{zones:f.constant(c)}}},cda=function(a,b,c,d,e,f){return(a.eq(b,c)?h.some(b):
a.property().parent(b)).map(function(h){h=Vg.calculate(a,h).getOr(d);return $ca.walk(a,b,c,h,e,f)})},Gn=function(a,b,c,d,e,f){b=Dc.subset(a,b,c).bind(function(b){return 0===b.length?h.none():cda(a,b[0],b[b.length-1],d,e,f)}).getOr([]);return bda.fromWalking(a,b)},ju=function(a,b){return function(c,d){return c.eq(d,a.item())?a:c.eq(d,b.item())?b:re.detail(c,d)}},bN=function(){return{zones:f.constant([])}},Zf={fromRange:function(a,b,c,d,e){b=Vi.getEdges(a,b,c,f.constant(!1));c=ju(b.left(),b.right());
return Gn(a,b.left().item(),b.right().item(),d,c,e)},transformEdges:ju,fromBounded:function(a,b,c,d,e){return Gn(a,b,c,d,re.detail,e)},fromBoundedWith:Gn,fromInline:function(a,b,c,d){b=Vi.byBoundary(a,b);var e=ju(b.left(),b.right());return b.isEmpty()?bN():Gn(a,b.left().item(),b.right().item(),c,e,d)},empty:bN},dN=function(a,b,c,d){return a.property().isBoundary(b)?Zf.fromBounded(a,b,b,c,d):a.property().isEmptyTag(b)?cN():Zf.fromInline(a,b,c,d)},cN=function(){return Zf.empty()},ku={single:dN,range:function(a,
b,c,d,e,f,h){b=ic.toLeaf(a,b,c);d=ic.toLeaf(a,d,e);return a.eq(b.element(),d.element())?dN(a,b.element(),f,h):Zf.fromRange(a,b.element(),d.element(),f,h)},empty:cN},eN=Sa(),Dk={single:function(a,b,c){return ku.single(eN,a,b,c)},range:function(a,b,c,d,e,f){return ku.range(eN,a,b,c,d,e,f)},empty:function(){return ku.empty()}},Kx={update:function(a,b,c){var d=W.keys(c);k.each(d,function(d){a.add(b,d,c[d])});return d},getInCache:function(a,b,c){return k.filter(c,function(c){return a.get(b,c.word()).fold(f.constant(!1),
function(a){return a.suggestions().isSome()})})}},dda=f.constant({assess:uf.inView})(),lu=function(a,b,c,d,e,f){a=Zf.fromBoundedWith(a,b,c,d,f,dda).zones();1===a.length?(a=a[0],e=a.lang()===e?h.some(a):h.none()):e=h.none();return e},fN=function(a,b,c,d,e){return lu(a,b,c,d,e,re.detail)},Hn={fromRange:function(a,b,c,d,e){var f=Vg.strictBounder(d,e);b=Vi.getEdges(a,b,c,f);c=Zf.transformEdges(b.left(),b.right());return lu(a,b.left().item(),b.right().item(),d,e,c)},fromBounded:fN,fromInline:function(a,
b,c,d){var e=Vg.strictBounder(c,d),e=Vi.getEdges(a,b,b,e),f=Zf.transformEdges(e.left(),e.right());e.isEmpty()?(f=a.property().isText(b)?a.property().getText(b):a.property().children(b).length,e=ic.toLeaf(a,b,0),b=ic.toLeaf(a,b,f),a=fN(a,e.element(),b.element(),c,d)):a=lu(a,e.left().item(),e.right().item(),c,d,f);return a},empty:function(){return h.none()}},gN=function(a,b,c,d){return a.property().isBoundary(b)?Hn.fromBounded(a,b,b,c,d):a.property().isEmptyTag(b)?Hn.empty():Hn.fromInline(a,b,c,d)},
hN={single:gN,range:function(a,b,c,d,e,f,h){b=ic.toLeaf(a,b,c);d=ic.toLeaf(a,d,e);return a.eq(b.element(),d.element())?gN(a,b.element(),f,h):Hn.fromRange(a,b.element(),d.element(),f,h)}},iN=Sa(),eda={single:function(a,b,c){return hN.single(iN,a,b,c)},range:function(a,b,c,d,e,f){return hN.range(iN,a,b,c,d,e,f)}},jN=function(a){return k.bind(a,function(a){return lc.descendants(a,A.isText)})},In={textnodes:jN,text:function(a){a=jN(a);return k.map(a,function(a){return A.isText(a)?Fa.get(a):""}).join("")},
parsed:function(a,b,c){return h.from(a[0]).bind(function(a){return eda.single(a,b,c).bind(function(a){a=a.words();return 1===a.length?h.some(a[0]).map(function(a){return a.word()}):h.none()})})},children:function(a){return k.bind(a,y.children)}},fda={clobber:function(a,b){var c=In.children(a),d=In.textnodes(a);return h.from(a[0]).bind(function(e){J.before(e,c);e=h.from(d[0]);e.each(function(a){Fa.set(a,b)});k.each(d.slice(1),function(a){Fa.set(a,"")});k.each(a,B.remove);return e})}},kN=tt.resolve("annotation"),
lN=tt.resolve("lingo"),mN=ut.resolve("annotation-wrap"),qh={nu:function(){var a=q.fromTag("span");n.add(a,mN);m.set(a,"aria-invalid","spelling");return Sg.nu(a)},set:function(a,b,c){m.set(a,kN,c);m.set(a,lN,b)},label:f.constant(mN),detail:function(a){return hf.id(a).bind(function(b){return h.from(m.get(a,kN)).bind(function(c){return h.from(m.get(a,lN)).map(function(a){return{id:f.constant(b),word:f.constant(c),lang:f.constant(a)}})})})}},gda=ut.resolve("wrap-disabled"),hda=function(a){a=hf.all(a);
k.each(a,function(a){n.remove(a,gda)})},ida=C.immutable("id","elements","word","lang"),nN=function(a){return{fold:a}},oN={success:function(a){return nN(function(b,c){c(a)})},fail:function(a){return nN(function(b,c){b(a)})}},jda=function(a,b){var c={};k.each(a,function(a){hf.marker(a,b.label()).filter(ca.inBody).each(function(a){b.detail(a).each(function(b){var d=b.id(),f=b.word();b=b.lang();var h=hf.all(a);0<h.length&&(c[d]=ida(d,h,f,b))})})});return c},pN=function(a,b,c,d){var e=In.text(a);a=In.parsed(a,
c,d);return e===b&&a.is(b)},kda=function(a,b,c){a=W.values(a);return k.map(a,function(a){return a.lang()===c&&pN(a.elements(),a.word(),b,a.lang())?oN.success(a):oN.fail(a)})},lda={validate:pN,verify:function(a,b,c,d,e){b=jda(a.elements(),b);a=kda(b,e,a.lang());k.each(a,function(a){var b=function(a){return function(b){k.each(b.elements(),a)}};a.fold(b(d),b(c))})}},qN=function(a){return hf.marker(a,qh.label())},dp={highlight:function(a,b,c,d){lda.verify(b,qh,hda,B.unwrap,a.lang());c=pj.matchWords(b.elements(),
c,d);c=pj.annotates(c,qh.label());return k.bind(c,function(c){return c.current().fold(function(){var d=c.match(),f=d.word();if(a.ignore(d))return[];d=Sg.wrapper(d.elements(),qh.nu)||[];k.each(d,function(a){hf.set(a,c.id());qh.set(a,b.lang(),f)});return[ln.created(d)]},function(a){return[ln.preserved(a)]})})},marker:qN,substitute:function(a,b){var c=qN(a).fold(f.constant([]),hf.all);return fda.clobber(c,b)},detail:function(a){return qh.detail(a)}},DV={highlight:function(a,b,c,d){var e={operation:a,
internal:a,ignore:f.constant(!1),lang:f.constant(d)},g=k.map(c,function(a){return a.word()}),h=k.filter(g,function(a,b){return k.indexOf(g,a).filter(function(a){return a===b}).isSome()});e.operation(function(){dp.highlight(e,b,h,f.constant(!1))})}},mda=function(a,b){return va.nu(function(c){var d={words:k.map(a.words(),function(a){return rg.clean(a.word())})};b.correction(d,a.lang(),function(b){b=H.value({spelling:f.constant(b),zone:f.constant(a)});c(b)},function(a){a=H.error(Error(a));c(a)})})},
EV={scan:function(a,b,c){var d=function(b){var c=b.zone(),d=Kx.update(a,c.lang(),b.spelling());b=k.filter(c.words(),function(a){a=rg.clean(a.word());return k.contains(d,a)});return{zone:f.constant(c),words:f.constant(b)}};c=k.map(c,function(a){return mda(a,b)});return Ic.par(c).map(function(a){a=k.bind(a,function(a){return a.fold(f.constant([]),k.pure)});return k.map(a,d)})}},Mx={active:function(a){var b={};a.autocorrect().get(function(a){a.fold(function(a){console.log("Error loading autocorrect list")},
function(a){b=a.corrections})});return{lookup:function(a){return b.hasOwnProperty(a)?h.from(b[a]):h.none()}}},inactive:function(){return{lookup:h.none}}},nda=cf([se("language"),se("words")]),GV={many:f.constant(nda)},oda=function(a,b){return aj(a,b).getOrThunk(function(){return Yj()})},mu=Ma.generate("good-spelling"),Lx={execute:function(a,b,c,d,e,g){var h=oda(b,c);g=ak.multiple(function(b,d){return a.execute({language:c,words:b})},h,d,function(a){return a.spell},f.identity,e,void 0!==g?g:!1);b[c]=
h;return Vd.mapSync(g,function(a){k.each(d,function(b){a.hasOwnProperty(b)&&void 0!==a[b]&&null!==a[b]||h.set(b,mu,e)});var b={};W.each(a,function(a,c){h.get(e,c).is(mu)||(b[c]=a)});return b})},initCaches:function(a){var b={};W.each(void 0!==a?a:{},function(a,d){b[d]=Yj(a)});return b},correct:f.constant(mu)},pda={image:f.constant("1"),spelling:f.constant("1")},IV={corsQuery:function(a){return aa.ensureTrailing(a,"/")+"version"},spelling:function(a){var b=pda.spelling();return aa.ensureTrailing(a,
"/")+b+"/"}},Bj=function(a){a="data-"+w.resolve(a);return f.constant(a)},vd={value:Bj("spelling-value"),type:Bj("spelling-type"),overflow:Bj("spelling-overflow"),overflowMenu:Bj("spelling-overflow-menu"),spelling:Bj("spelling-suggestion")},rN=C.immutable("primary","secondary","submenus"),qda=C.immutable("value","text","attrs"),rda=C.immutable("textkey","value","items"),NV={generate:function(a,b){var c;if(a.length>b){c=a.slice(0,b);var d=qda(vd.overflow(),u.translate("spelling.context.more"),{}),e=
a.slice(b),f={};f[vd.overflow()]=vd.overflowMenu();e=rda(u.key("spelling.context.morelabel"),vd.overflowMenu(),e);c=rN(c.concat([d]),[e],f)}else c=rN(a,[],{});return c}},OV=4,MV=C.immutable("value","text","attrs"),Ox=Y.detect().browser,SV=C.immutableBag("communication profile content undo viewable cache url autocorrectOn language fromServiceState multilingual".split(" "),[]),sN=function(a){a=q.fromTag(a);var b=q.fromText(Ua.zeroWidth());v.append(a,b);n.add(a,hb.styleSpan());return a},tN=function(a,
b,c,d){var e=sN(d);y.firstChild(e).each(function(d){a(c,e);b.setSelection(d,0,d,0)})},uN={nu:sN,insertAfter:f.curry(tN,v.after),insertBefore:f.curry(tN,v.before)},vN=Y.detect().browser,wN=function(a,b){return Ka.toLeaf(a,b)},sda=function(a){return A.isText(a)&&0!==Fa.get(a).trim().length},tda=function(a){return A.isElement(a)&&"br"===A.name(a)},uda=function(a){return k.exists([sda,tda],function(b){return b(a)})},vda=function(a){return A.isText(a.element())&&0===a.offset()||A.isElement(a.element())},
wda=function(a,b,c){var d=f.constant(a);return(!1===b&&vda(a)?h.some(!0):h.none()).fold(d,function(b){return Kb.seekLeft(a.element(),uda,c).fold(d,function(a){return S.point(a,A.isText(a)?Fa.get(a).length:0)})})},xda=function(a,b){return L.eq(a.element(),b.element())},je={context:function(a){return a.getSelection().bind(function(b){if(b.collapsed()){var c=b.startContainer();return Xa.cell(c,a.isRoot).bind(function(d){return Xa.table(c,a.isRoot).map(function(a){return{cell:f.constant(d),table:f.constant(a),
start:f.constant(c),selection:f.constant(b)}})})}return h.none()})},selectedCells:function(a,b){return qb.cata(a.get(),f.constant([]),f.identity,function(a){var d=vN.isFirefox()?wN(a.startContainer(),a.startOffset()):S.point(a.startContainer(),a.startOffset()),e=vN.isFirefox()?wN(a.endContainer(),a.endOffset()):S.point(a.endContainer(),a.endOffset());a=wda(e,a.collapsed()||xda(d,e),b);return Zd.sharedOne(function(a){return Xa.cell(a,b)},[d.element(),a.element()]).toArray()})}},Jn=function(a){return{fold:a}},
rh={none:function(a){return Jn(function(b,c,d,e){return b(a)})},first:function(a){return Jn(function(b,c,d,e){return c(a)})},middle:function(a,b){return Jn(function(c,d,e,f){return e(a,b)})},last:function(a){return Jn(function(b,c,d,e){return e(a)})}},xN=function(a,b){return Xa.table(a,b).bind(function(b){var d=Xa.cells(b);return k.findIndex(d,function(b){return L.eq(a,b)}).map(function(a){return{index:f.constant(a),all:f.constant(d)}})})},Kn={next:function(a,b){return xN(a,b).fold(function(){return rh.none(a)},
function(b){return b.index()+1<b.all().length?rh.middle(a,b.all()[b.index()+1]):rh.last(a)})},prev:function(a,b){return xN(a,b).fold(function(){return rh.none()},function(b){return 0<=b.index()-1?rh.middle(a,b.all()[b.index()-1]):rh.first(a)})}},Ux={upOrLeft:function(a){je.context(a).each(function(b){Kn.prev(b.cell()).fold(f.noop,function(){Kh.isFirstInContent(a,b.table())&&tf.isLeft(b.cell(),b.selection())&&uN.insertBefore(a,b.table(),"p")},f.noop,f.noop)})},right:function(a){je.context(a).each(function(b){Kn.next(b.cell()).fold(f.noop,
f.noop,f.noop,function(){Kh.isLastInContent(a,b.table())&&tf.isRight(b.cell(),b.selection())&&uN.insertAfter(a,b.table(),"p")})})}},jW={widget:function(a){var b=a.content(),c=C.immutable("value","icon","textkey"),d=c("aligntop",h.some(ia.resolve("aligntop")),u.key("table.cell.alignment.top")),e=c("alignmiddle",h.some(ia.resolve("alignmiddle")),u.key("table.cell.alignment.middle")),c=c("alignbottom",h.some(ia.resolve("alignbottom")),u.key("table.cell.alignment.bottom")),g=[d,e,c],d=function(a){return function(b){t.set(b,
"vertical-align",a)}},l={aligntop:d("top"),alignmiddle:d("middle"),alignbottom:d("bottom")},m=h.none(),n=function(a,b){a.enable();return t.getRaw(b,"vertical-align").fold(function(){return oa.on("aligntop")},function(a){return"middle"===a?oa.on("alignmiddle"):"bottom"===a?oa.on("alignbottom"):oa.on("aligntop")})};return{name:"cell-alignment",textkey:u.key("table.cell.alignment.toolbar"),menuTextkey:u.key("table.cell.alignment.toolbar"),action:function(c){b.focus();var d=je.selectedCells(a.selections(),
b.isRoot);k.each(d,l[c]);b.uiChanged()},updateDropdown:function(c){var d=je.selectedCells(a.selections(),b.isRoot);0<d.length?d=n(c,d[0]):(c.disable(),d=oa.off());c.populate([{label:h.none,items:f.constant(g)}]);Qj.updateMenu(c,d,oa.on(),g,m)},values:g,render:m,tooltip:Va.get,toggle:!1,describe:function(a){return u.translate("alignment.describe",u.get(a.textkey()))}}}},yda={cssNamespace:"table-cell-border",i18nNamespace:"table.cell.border",property:"border-width",tag:"table",specials:[["thin","medium",
"thick"]]},iW={widget:function(a){var b=a.content(),c=pk(yda);c.initLayout();O.dialog(c.element(),u.translate("aria.table.cell.border.size"));var d=D.create({done:r([]),abort:K([],c.events.abort)});c.events.close.bind(function(a){d.trigger.done();b.focus()});c.events.action.bind(function(c){var d=T.active();b.focus();var e=je.selectedCells(a.selections(),b.isRoot);k.each(e,function(a){t.set(a,"border-width",c.value());t.getRaw(a,"border-style").fold(function(){t.set(a,"border-style","solid")},f.noop)});
d.each(T.focus)});var e=function(){c.enter();c.open()};return{element:c.element,destroy:c.destroy,name:f.constant("cellborderwidth"),textkey:f.constant(u.key("table.cell.border.width")),tooltip:Va.get,label:f.constant(!1),updateWidget:function(d){var h=je.selectedCells(a.selections(),b.isRoot);0<h.length?(d.enable(),d=t.getRaw(h[0],"border-width").fold(oa.off,oa.on),c.updateInlineWidget({size:f.constant(d)},"1px")):d.disable();e()},events:d.registry,open:e,close:c.close}}},zda=C.immutableBag(["name",
"textkey","menuTextkey","action","shortname"],[]),Sx={widget:function(a,b,c){var d=zda(c),e=a.content();c=P.div();O.label(c,u.translate(d.textkey()));ea.add(c,[w.resolve("palette-cell-colors"),w.resolve(d.shortname()+"-cell-colors")]);var g=Qh.create(b.colors.buttons);v.append(c,g.element());b="."+w.resolve(d.shortname()+"-cell-colors")+" ."+w.resolve("palette-detail-action")+":not(."+w.resolve("palette-color-option-spacer")+")";var h=Qh.makeLayout(c,b,{});b=h.layout();var k=D.create({done:r([]),
abort:r([])});g.events.selected.bind(function(b){b=b.value();var c=je.selectedCells(a.selections(),e.isRoot);d.action()(c,b);k.trigger.done()});var m=function(){n.enter();h.refresh()},n=Xu(c,[b]);n.events.exit.bind(function(){k.trigger.abort()});return{element:f.constant(c),destroy:function(){n.destroy();g.destroy()},name:f.constant(d.name()),textkey:f.constant(u.key(d.textkey())),tooltip:Va.get,label:f.constant(!1),updateWidget:function(b){vh.isHighContrast(a.smartview())?b.disable():(0===je.selectedCells(a.selections(),
e.isRoot).length?b.disable():b.enable(),m())},events:k.registry,open:m,close:function(){k.trigger.done()}}}},Ada={styles:{"border-collapse":"collapse",width:"100%"},attributes:{border:"1"},percentages:!0},Bda=function(a,b,c,d,e){void 0===e&&(e=Ada);var f=q.fromTag("table");t.setAll(f,e.styles);m.setAll(f,e.attributes);var h=q.fromTag("tbody");v.append(f,h);for(var k=[],n=0;n<a;n++){for(var r=q.fromTag("tr"),u=0;u<b;u++){var w=n<c||u<d?q.fromTag("th"):q.fromTag("td");u<d&&m.set(w,"scope","row");n<
c&&m.set(w,"scope","col");v.append(w,q.fromTag("br"));e.percentages&&t.set(w,"width",100/b+"%");v.append(r,w)}k.push(r)}J.append(h,k);return f},Cda={insert:function(a,b,c,d,e){return a.getSelection().bind(function(f){var k=Bda(b,c,d,e);xc.insertAtCursor(a,[k]).each(function(b){Xa.firstCell(k).each(function(b){a.setSelection(b,0,b,0)})});return h.some(k)})}},Dda=Ac.resolve("table-picker"),Eda=Ac.resolve("table-picker-row"),Fda=Ac.resolve("table-picker-cell"),Gda=Ac.resolve("table-picker-button"),Bf=
{table:f.constant(Dda),row:f.constant(Eda),cell:f.constant(Fda),button:f.constant(Gda)},Hda="."+Bf.cell(),Ida="."+Bf.row(),Me={cells:function(a){return X.descendants(a,Hda)},rows:function(a){return X.descendants(a,Ida)},grid:function(a,b,c){b=parseInt(m.get(a,b),10);a=parseInt(m.get(a,c),10);return ya.grid(b,a)},button:function(a){return I.child(a,"."+Bf.button()).getOr(a)}},yN=function(a,b,c,d,e){d=Math.max(d,Math.min(e,a.row()));a=Math.max(b,Math.min(c,a.column()));return ya.address(d,a)},zN=function(a,
b){var c=yN(a,1,b.maxCols,1,b.maxRows),d;d=ya.address(c.row()+1,c.column()+1);d=yN(d,b.minCols,b.maxCols,b.minRows,b.maxRows);return{selection:f.constant(c),full:f.constant(d)}},Qx={resize:function(a,b){var c;c=ya.address(a.row()+1,a.column()+1);return zN(c,b)},grow:function(a,b,c,d){a=ya.address(a.rows()+c,a.columns()+b);return zN(a,d)}},AN=function(a,b,c,d){var e=a.width()/b.columns();a=a.height()/b.rows();return ya.address(Math.floor(d/a),Math.floor(c/e))},Jda={pickerCell:function(a,b,c,d){var e=
d.x()-a.x();a=d.y()-a.y();return AN(b,c,e,a)},isRtl:f.constant(!1)},Kda={pickerCell:function(a,b,c,d){var e=a.x()+b.width()-d.x();a=d.y()-a.y();return AN(b,c,e,a)},isRtl:f.constant(!0)},hW={widget:function(a,b){var c=a.content(),d=XV(a.region().uiDirection().isRtl()?Kda:Jda,b),e=a.undo(),g=D.create({done:K([],d.events.done),abort:K([],d.events.abort)});d.events.select.bind(function(a){e.save();Cda.insert(c,a.rows(),a.cols(),a.rowHeaders(),a.columnHeaders()).each(function(a){e.save();c.domChanged()});
c.toEditing()});return{element:d.element,name:f.constant("table"),textkey:f.constant(u.key("insert.table")),menuTextkey:f.constant(u.key("table.menu")),tooltip:Va.get,label:f.constant(!1),updateWidget:function(a){c.getSelection().each(function(b){a.enable()});d.open()},destroy:d.destroy,events:g.registry,open:d.open,close:d.close}}},$h={set:function(a,b){a.dom().checked=b},find:function(a){return I.descendant(a,"input:checked")}},BN=C.immutableBag(["floatval","caption","summary","border","dimensions"],
[]),Lda=function(a){a=m.get(a,"border");return"0"===a||"1"===a?h.some(a):h.none()},Mda=function(a){var b=t.getRaw(a,"width");a=t.getRaw(a,"height");return{width:f.constant(b),height:f.constant(a)}},fp={divine:function(a,b){var c=Ir.divine(b),d=m.get(b,"summary"),e=I.child(b,"caption").map(function(b){b=ua.get(b);return a.filterHtml(a.output(),b)}).getOr(""),f=Lda(b),h=Mda(b);return BN({floatval:c,caption:e,summary:d,border:f,dimensions:h})},properties:BN,apply:function(a,b){b.floatval().each(function(b){Nf.runFloat(a,
b)});b.border().each(function(b){m.set(a,"border",b)});""===b.summary()?m.remove(a,"summary"):Ae.setSummary(a,b.summary());""===b.caption()?I.child(a,"caption").each(B.remove):Ae.setCaption(a,b.caption());Ae.setDimensions(a,b.dimensions())}},gp={halve:function(a,b){Gb.getGenericWidth(a).each(function(c){var d=c.width()/2;Gb.setGenericWidth(a,d,c.unit());Gb.setGenericWidth(b,d,c.unit())})}},CN=function(a,b,c,d){return c.fold(h.none,h.none,function(a,b){return Ab.first(b).bind(function(a){return h.some(Zb(a,
0,a,0))})},function(c){return Xa.table(c,b.isRoot).bind(function(g){Mb.execute(a,Db.insertRowAfter,f.noop,d)(b,g,Ek.noMenu(c));g=X.descendants(g,"tr");if(0<g.length)return I.descendant(g[g.length-1],"td,th").map(function(a){return Zb(a,0,a,0)})})})},Tx={forward:function(a,b,c,d){return CN(a,b,Kn.next(c),d)},backward:function(a,b,c,d){return CN(a,b,Kn.prev(c),d)}},Rx={setBorderColor:function(a,b){t.set(a,"border-color",b);t.getRaw(a,"border-style").fold(function(){t.set(a,"border-style","solid")},
f.noop)},setBackgroundColor:function(a,b){t.set(a,"background-color",b)},setHeight:function(a,b){t.set(a,"height",b)},setWidth:function(a,b){t.set(a,"width",b)},setType:function(a,b){var c=ac.copy(a);v.after(a,c);B.remove(a)},setScope:function(a,b){m.set(a,"scope",b)},setStyle:function(a,b){m.set(a,"style",b)},setClass:function(a,b){m.set(a,"class",b)}},eW=Ac.resolve("resizer-bar-dragging"),Nda=C.immutable("withSpaces","withoutSpaces"),Oda=function(a){return k.filter(a.split(/[\.,-\/#!$%\^&\*;:{}=\-_`~()\s\u00A0]/gim),
function(a){return 0<a.length}).length},Vx={count:function(a){return{words:f.constant(Oda(a)),characters:f.constant(Nda(a.length,a.replace(/[\s\u00A0]/gim,"").length))}}},pW=C.immutableBag("accessibility formatting alignindent bookmark directionality table font parlance media imageEdit blocktag specialchar wordcount link linkvalidator horizontalrule help fileupload findreplace plaincodeview macros spelling".split(" "),[]),Ln=0,nu=h.none(),jp={add:function(){if(0===Ln){var a=q.fromTag("style");nb.set(a,
'/*\n * Keep this file as small as possible.\n * It is injected into the JavaScript, so it needs to be tiny.\n */\n\n/*\n * Animate from 0 to 359, not 0 to 360, as they are the same and FireFox does nothing\n *\n * Until we have token replacement, manual shorthand for "ephox-polish-spin"\n */\n\n@keyframes e-p-spin {\n  0% {\n    transform: rotate(0deg);\n  }\n  100% {\n    transform: rotate(359deg);\n  }\n}\n\n/* Until we have token replacement, manual shorthand for "ephox-polish-spinner-img" */\n\n.e-p-s-img {\n  animation: e-p-spin 2s infinite linear;\n  width: 30px;\n  height: 30px;\n  margin: 2px 2em 0 auto;\n  background: url("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQBAMAAADt3eJSAAAAIVBMVEUAAABAQEBDQ0NERERERERCQkJDQ0NERERDQ0NEREREREQTPu3mAAAACnRSTlMAENDPwGBwsKB/qy4kVgAAAFpJREFUCNdjAAImAwYI4FoApooFuBYwWgAZXoZMCsJLgAyhpQwMUYpABmMiA4OYAAMCaC2GklqLwIxFMAmoYkmQYmGQdkOQgYpMBkIgA4tAVmggLAU7QwFIAADjyQ3FWhtneAAAAABJRU5ErkJggg==") 0/cover;\n}');
v.append(ca.body(),a);nu=h.some(a)}Ln++},remove:function(){0!==Ln&&0===--Ln&&(nu.each(B.remove),nu=h.none())}},Pda=yb.pencil(),Mn=yb.code(),DN=function(a){var b=a.old().toTransfer();a.nu().fromTransfer(b)},Qda={transition:DN,factory:Eu,style:yb.pencil},Rda={transition:DN,factory:Fk,style:yb.code},Gk={goingToDesign:function(a){return a===Mn},alternate:function(a){return a===Mn?Pda:Mn},detect:function(a){return a===Mn?Qda:Rda}},tW=function(a,b){return{destroy:f.noop,init:f.noop,setMode:f.die("Code view is not enabled, cannot switch modes"),
events:D.create({change:r([]),ready:r([])}).registry}},sW=function(a,b){var c=b.css+"/codemirror.css",d=D.create({change:r([]),ready:r(["type"])}),e=h.none(),g=function(){var a=Gj.load.codeview(b.js).map(function(a){return a.map(f.constant(!0))});e=h.some(a)},k=function(a){a(H.value(!0))};return{init:function(a){e.fold(function(){Rk.addStylesheet(c,k).get(function(b){b.fold(function(a){console.error(a);console.error("Code View disabled due to error loading stylesheet")},function(){g();d.trigger.ready(a)})})},
function(b){d.trigger.ready(a)})},setMode:function(b){return e.fold(function(){throw"Cannot set mode before Code View has loaded";},function(c){c.get(function(c){c.fold(function(a){d.trigger.ready(b);console.error(a);console.error("Code View non-functional due to error downloading script file")},function(){var c=Gk.detect(b),e=a.swap(c.factory,{},{});d.trigger.change();c.transition(e);e.destroy()})})})},events:d.registry,destroy:f.noop}},Wx=Y.detect().browser,xW={build:function(a,b,c,d,e,g,h,k){var m=
vW(a,b,c,g,h,k),n=d.full(m);n.init();return{element:m.element,socket:m.socket,viewport:m.viewport,uiContainerParent:m.uiContainerParent,init:function(b,d,f){d=n.config(a.isInline(),d,e,f);jB.setup(m,g,a,b,c,d);n.loaded()},connect:m.connect,destroy:function(){m.destroy();n.destroy()},displayBanner:m.displayBanner,hideBanner:m.hideBanner,position:f.noop,refresh:m.refresh,tabstrip:m.toolbar,state:f.constant(k),dialogContainer:m.dialogContainer}},bounds:function(){return ne.view}},EN={blobTob64:function(a,
b){var c=m.get(b,Ib.blobId());m.remove(b,Ib.blobId());a.get(c).each(function(a){m.remove(b,Ib.blobId());m.set(b,"src",qc.imageResultToDataURL(a.imageresult()))})},b64ToBlob:function(a,b){var c=m.get(b,"src"),d=function(){return Th.dataUriToBlobSync(c).map(function(b){var d=qc.fromBlobAndUrlSync(b,c);b=Ne.createObjectURL(b);var e=Ma.generate("image");return a.add(e,d,b)})};try{a.lookupByData(c).fold(d,h.some).each(function(a){m.set(b,Ib.blobId(),a.id());m.set(b,"src",a.objurl())})}catch(e){console.warn("Unable to read Base64 image data: ",
e,c)}}},KW={configure:function(a,b){var c=Ib.blobId(),d="img["+c+"]";a.addSelector(a.internal(),d,Ca.removeAttr(c));a.addSelector(a.output(),d,function(a){k.each(a,function(a){EN.blobTob64(b,a)})});a.addSelector(a.input(),"img:not(["+c+"])[src]",function(a){k.each(a,function(a){EN.b64ToBlob(b,a)})});c=Ca.removeClass(Ib.uploadInProgress());a.add(a.output(),Ib.uploadInProgress(),c);a.add(a.history(),Ib.uploadInProgress(),c);a.add(a.internal(),Ib.uploadInProgress(),c);d=Ib.trackedImage();c="img["+d+
"]";d=Ca.removeAttr(d);a.addSelector(a.output(),c,d);a.addSelector(a.internal(),c,d)},blobId:Ib.blobId},FN=C.immutable("image","blobInfo"),ou=la.generate([{failure:["error"]},{success:["result","images","blob"]}]),Tda=function(a,b,c,d){k.each(b,function(a){m.set(a,"src",d.location);m.remove(a,Ib.blobId())});return Sda(a,c)},GN=function(a,b,c,d,e){var f=qc.imageResultToDataURL(c),f=a.lookupByData(f).getOrThunk(function(){return a.add(b,c,d)});m.set(e,Ib.blobId(),f.id());return FN(e,f)},Uda=function(a,
b){var c=m.get(b,Ib.blobId());return a.get(c).fold(function(){return H.error(c)},function(a){return H.value(FN(b,a))})},Sda=function(a,b){return a.get(b).fold(function(){return H.error("Internal error with blob cache")},function(c){a.remove(b);return H.value(c)})},di={prepareForUpload:function(a,b,c){var d=a.isActive(b);a.register(c,b);n.add(c,Ib.uploadInProgress());return d?h.none():h.some(b)},handleUpload:function(a,b,c,d,e,g,h){var m=function(){console.error("Internal error with blob cache",e);
h(ou.failure({status:f.constant(666)}))};a.upload(g,e,function(a){var f=b.findById(d,e);k.each(f,le.removeClass(Ib.uploadInProgress()));a.fold(function(a){h(ou.failure(a))},function(a){Tda(c,f,e,a).fold(m,function(b){h(ou.success(a,f,b))})});b.report(e,f,a.isValue())})},registerAssets:function(a,b,c){return k.bind(c,function(c){return kc.cata(c,function(c,d,f){return I.descendant(b,'img[src="'+f+'"]').fold(function(){return[H.error("Image that was just inserted could not be found: "+f)]},function(b){return[H.value(GN(a,
c,d,f,b))]})},f.constant([]))})},registerBlob:GN,findBlobs:function(a,b,c){c=a.findAll(c);return a.inProgress()?[]:k.map(c,function(a){return Uda(b,a)})}},Vda=function(a){var b=function(b){var d=b.image(),e=b.blobInfo(),f=Ko.changedBounds(d),e=Pa.fromPromise(qc.imageResultToOriginalBlob(e.imageresult()));return Pa.bind(e,function(e){return Nh.resampleAction(f,e,function(f){if(f===e)return Pa.pure(b);var g=fe.updater(fe.keepResample,d),h=Mo.applyEdit(d);f=ve.single(f).bind(h).map(g);return Pa.map(f,
function(e){return kc.cata(e,function(b,c,e){return di.registerBlob(a,b,c,e,d)},function(a,d,e){return b})})})})};return function(a){return Ic.mapM(a,b)}},Wda=function(a){a=k.map(a,H.value);return va.pure(a)},JW={instance:function(a,b){return!0===a.immediate?Wda:Vda(b)}},Xda={400:"errors.http.400",401:"errors.http.401",403:"errors.http.403",404:"errors.http.404",407:"errors.http.407",409:"errors.http.409",413:"errors.http.413",415:"errors.http.415",500:"errors.http.500",501:"errors.http.501"},Yda=
{get:function(a,b){return h.from(Xda[a]).map(function(a){return u.translate(a,b)})}},Zda=function(a){return Q.isString(a)&&""!==a.trim()?{description:f.constant(a),link:f.constant(null)}:Yd.get("error.imageupload.generic")},$da=function(a,b){var c=b.status();return Yda.get(c,a).fold(function(){var b;b=0===c?"error.imageupload.cors":400<=c&&500>c?"error.code.images.not.found":"error.imageupload";return Yd.get(b,[a])},function(a){return{description:f.constant(a),link:f.constant(null)}})},HN=function(a,
b){return{instance:function(){return xb.cached(function(c){c=b(c);a.show(c)})}}},IN={simple:function(a){return HN(a,Zda)},url:function(a,b){return HN(a,f.curry($da,b))}},aea=["jpg","png","gif","jpeg"],ci={failureObject:C.immutable("message","status","contents"),getFilename:function(a,b){var c;Q.isString(a.name)&&!aa.endsWith(a.name,".tmp")?c=a.name:Q.isString(a.type)&&aa.startsWith(a.type,"image/")?(c=a.type.substr(6),c=k.contains(aea,c)?b+"."+c:b):c=b;return c},buildData:function(a,b,c){var d;d=
new (Ub.getOrDie("FormData"));d.append(a,b,c);return d}},BW=C.immutable("id","filename","blob","base64"),JN={direct:function(a){return zW(a)},custom:function(a){return AW(a)}},pu=C.immutable("uploader","errors"),IW={choose:function(a,b,c){return!0!==a.bundled?pu({upload:f.die},{instance:f.constant(f.die("Image Upload is disabled"))}):Q.isFunction(a.handler)?pu(JN.custom(a.handler),IN.simple(b)):pu(JN.direct(a.direct),IN.url(b,a.direct.url))}},DW=C.immutable("id","imageresult","objurl"),Hk=Ib.trackedImage(),
FW=function(a,b){return X.descendants(a,"img["+Hk+'="'+b+'"]')},GW=function(a){return X.descendants(a,"img:not(["+Hk+"])["+Ib.blobId()+"]")},bea={settings:function(a){var b={ui:{toolbar:{display:!1}},spelling:{bundled:!1},highlighter:{bundled:!1},table:{bundled:!1},resize:{bundled:!1},codeview:{bundled:!1},imageEdit:{bundled:!1},imageupload:{immediate:!0},linkvalidator:{bundled:!1}},b=Y.detect().deviceType.isTouch()?b:{};return Z.deepMerge(b,void 0===a.content||void 0===a.content.inline?{}:{fullscreen:{bundled:!1},
codeview:{bundled:!1},plaincodeview:{bundled:!1}})}},Zx={isRtl:f.constant(!1)},Yx={isRtl:f.constant(!0)},NW=function(a){return k.exists(["ar","fa","he"],function(b){return aa.startsWith(a,b)})},PW=function(a){return Z.deepMerge($x.settings(a.resources),a,bea.settings(a))},KN=function(a,b,c){var d=yz.withOptions(a,c);d.content&&d.content.tabindex&&(0,m.remove)(a,"tabindex",d.content.tabindex);c=mp(d,{});var e=ua.get(a),f=m.get(a,"style");b(a);ua.set(a,"");c.connect(a);Jc.set(c,e);return{polish:c,restore:function(b){ua.set(a,
b);null!==f&&void 0!==f&&0<f.length?m.set(a,"style",f):m.remove(a,"style");d.content&&d.content.tabindex&&(0,m.set)(a,"tabindex",d.content.tabindex);return a}}},LN={replace:function(a,b){return KN(a,b.content&&!0===b.content.autoresize?rY:qY,b)},takeover:function(a,b){return KN(a,f.noop,b)}},gb=function(a,b){var c={};if(void 0===a)return c;k.each(b,function(b){var e=b.name(),e=a[e];void 0!==e&&(b.validate(e),c[b.output()]=Q.isArray(b.contents)?gb(e,b.contents):e)});return c},cea=function(a){return k.map(void 0===
a?[]:a,function(a){var c=gb,d=V.string("prefix"),e=V.string("suffix"),f;f=[V.string("color"),V.string("background-color")];f=Z.merge(V.object("style"),{contents:f});return c(a,[d,e,f])})},dea=function(a){if(void 0===a||void 0===a.url)return{service:!1};var b=MN(a,"autocorrect",!0);if(Q.isString(a.url))return{url:a.url,service:!0,autocorrect:b};throw Error("Spelling URL was not a string");},eea=function(a){if(void 0===a||void 0===a.validation||void 0===a.validation.url)return{};if(Q.isString(a.validation.url))return{url:a.validation.url,
bundled:!0};throw Error("Link Validation URL was not a string");},fea=function(a){if(void 0===a||void 0===a.embed||void 0===a.embed.url)return{};if(Q.isString(a.embed.url))return{url:a.embed.url,bundled:!0};throw Error("Link Embed URL was not a string");},gea=function(a,b){var c=!1===b?!0:!1,d=(void 0===a?{}:a).upload;if(void 0!==d){if(void 0!==d.handler){if(!Q.isFunction(d.handler))throw Error("Image Upload Handler was not a function");return{handler:d.handler,immediate:c,bundled:!0}}if(!Q.isString(d.url))throw Error("Image Upload URL was not a string");
return{direct:gb(d,[V.string("url"),V.string("basePath"),V.bool("credentials")]),immediate:c,bundled:!0}}return{}},hea=function(a){a=gb((void 0===a?{}:a).editing,[V.bool("enabled"),V.string("proxy"),V.number("preferredWidth"),V.number("preferredHeight")]);void 0!==a.enabled&&(a.bundled=a.enabled);return a},MN=function(a,b,c){if(void 0===a[b])return c;V.bool(b).validate(a[b]);return a[b]},iea=function(a){return gb((void 0===a?{}:a).toolbar,[V.arrayOfToolbarGroups("items"),V.arrayOfStrings("contextual")])},
jea=function(a){if(void 0===a)return{};var b;if(void 0===a.toolbar)b={};else{var c=a.toolbar;if(void 0!==c.offset){c=c.offset;if(!Q.isObject(c)||void 0===c.top||void 0===c.left)throw Error("toolbar offset must be an object with left and top");if(!Q.isNumber(c.top)&&!Q.isNumber(c.left))throw Error("toolbar offset values must be numbers");b={draggable:!0,offset:{left:c.left,top:c.top}}}else b={}}c=gb(a.toolbar,[V.bool("visible"),V.bool("draggable"),V.bool("sticky")]);b=Z.deepMerge(b,c);return void 0===
c.sticky&&!0===a.autoresize?Z.deepMerge(b,{sticky:!0}):b},kea=function(a){if(void 0!==a){if(!Q.isString(a))throw Error("The basePath configuration value was not a string");return aa.removeTrailing(a,"/")}},lea=function(a){if(void 0===a||void 0===a.fonts)return[];a=a.fonts;if(!Q.isArray(a))throw Error("The fonts configuration was not an array");var b=function(a,b){console.error(a+" :",b);throw Error(a);};return k.map(a,function(a){if(Q.isString(a))return{value:a,text:a};Q.isObject(a)||b("The fonts array value was not a string or object",
a);void 0!==a.value&&Q.isString(a.value)||b("The font value configuration was not a string or is undefined",a);void 0===a.text||Q.isString(a.text)||b("The font text configuration was not a string",a);return{value:a.value,text:a.text&&0<a.text.length?a.text:a.value}})},nea=function(a){if(void 0===a||void 0===a.colors)return{};var b=gb(a.colors,[V.bool("custom")]);void 0!==a.colors.buttons&&(b.buttons=mea(a.colors.buttons));return b},mea=function(a){if(!Q.isArray(a))throw Error("The colors button configuration was not an array");
var b=function(a,b){console.error(a+" :",b);throw Error(a);};return k.map(a,function(a){if(Q.isString(a))return{value:a,text:a};Q.isObject(a)||b("A buttons array value was not a string or object",a);void 0!==a.value&&Q.isString(a.value)||b("The color button value configuration was not a string or is undefined",a);void 0===a.text||Q.isString(a.text)||b("The color button text configuration was not a string",a);return{value:a.value,text:a.text&&0<a.text.length?a.text:a.value}})},oea=function(a){a=gb(void 0===
a?{}:a,[V.bool("enabled"),V.bool("showButton")]);return{bundled:void 0===a.enabled||!0===a.enabled,showButton:void 0===a.showButton||!0===a.showButton}},pea=function(a){a=Z.merge({allowLocal:!0},void 0===a?{}:a);V.bool("allowLocal").validate(a.allowLocal);return a.allowLocal},qea=function(a){a=gb(void 0===a?{}:a,[V.arrayOfStrings("languages")]);return void 0===a.languages?{}:{languages:k.map(a.languages,function(a){return a.toLowerCase()})}},rea=function(a){void 0!==a.styles&&(a.styles=k.filter(a.styles,
function(a){a=a.rule;return!(void 0===a||"."===a||0<=a.indexOf("..")||0<=a.indexOf("#"))}))},sea=function(a,b,c){return"plain"===a?{forceText:!0}:{officeStyles:"retain"===a?"merge":void 0!==a?a:"prompt",htmlStyles:"retain"===a?"merge":void 0!==a?a:"merge",allowLocalImages:c,enableFlashImport:!1===b?!1:!0}},tea=function(a){a=gb(a.macros,[V.arrayOfStrings("allowed")]);void 0!==a.allowed&&(a.allowed=h.some(a.allowed));return a},RW=function(a){var b=gb(a,[V.arrayOfStrings("plugins")]),b=void 0===b.plugins?
[]:b.plugins,c=gb(a.ui,[V.string("locale","code")]),d=MN(a,"autosubmit",!0),e=gb(a.content,[V.arrayOfObjects("highlighters")]),f=gb(a.paste,[V.string("style"),V.bool("enableFlashImport")]),h=function(){var b=gb(a.css,[V.arrayOfStrings("stylesheets"),V.string("documentStyles"),V.bool("showDocumentStyles")]),c=gb(a.ui,[V.bool("autoresize")]);return Z.merge(b,c)}(),k=gb(a.css,[V.arrayOfObjects("styles"),V.bool("showDocumentStyles")]);rea(k);var m=gb(a.ui,[V.bool("shortcuts","features")]),n=qea(a.ui),
q=oea(a.codeview),r=dea(a.spelling),t=eea(a.links),u=fea(a.links),v=pea(a.images),w=hea(a.images),y=v?gea(a.images,w.bundled):{},A=iea(a.ui),B=jea(a.ui),C=kea(a.basePath),D=lea(a.ui),E=nea(a.ui),F=function(){var b=gb(a.ui,[V.string("aria-label","editorName"),V.bool("autoresize")]);return Z.merge(b,{locale:c,toolbar:B})}(),H=tea(a);return{resources:C,plugins:b,spelling:r,linkvalidator:t,embed:u,font:{faces:D,colors:E},table:{colors:E},macros:H,ui:F,shortcuts:m,autosubmit:d,highlighter:{external:cea(e.highlighters)},
smartclipboard:{paste:sea(f.style,f.enableFlashImport,v)},parlance:n,content:h,imageEdit:w,imageupload:y,blocktag:k,fileupload:{allowLocalImages:v},platform:{toolbar:A,allowLocalImages:v},plaincodeview:{bundled:q.bundled},codeview:q}},SW=function(a){var b=void 0===a.privateapi?{}:a.privateapi;a=gb(b.ui,[V.func("bounds"),V.bool("showHelpHint"),V.domElement("bottomBar"),V.domElement("sideBar")]);var c=gb(b.integration,[V.string("type"),V.string("version")]),d=gb(void 0===b.content?{}:b.content,[V.string("base"),
V.arrayOfStrings("imageExcludes")]),e=ny.paramList(),f=gb(b.mentions,e),h=W.keys(f).length,b=gb(b.output,[V.bool("prettyprint")]);if(0<h){if(h!==e.length)throw Error("Missing @mentions configuration. Expected "+e.length+" objects, was "+h);f.bundled=!0}return{ui:a,help:{integration:c},content:Z.merge(d,b),mentions:f}},uea={getPath:function(a){var b=document.getElementsByTagName("script");return k.find(k.from(b),function(b){return b.src.indexOf(a)===b.src.length-a.length}).map(function(b){return b.src.substring(0,
b.src.indexOf(a))}).getOr(void 0)}},NN=xb.cached(function(){return h.from(uea.getPath("textboxio.js")).map(function(a){return aa.removeTrailing(a,"/")})}),ON=function(a){return a+"/resources"},ay={setupResources:function(a){return h.from(a.resources).orThunk(NN).map(ON).fold(f.die("basePath auto detection failed, please provide one in the editor configuration"),function(b){b=ei.load(b);return Z.deepMerge(a,{resources:b})})},speculate:function(a){h.from(a).orThunk(NN).map(ON).each(ei.load)}},vea=function(a,
b,c){var d=function(){var a=q.fromDom(document.activeElement);b(a)&&c()};return E.bind(a,"blur",function(){setTimeout(d,200)})},wea=function(a,b,c){return E.bind(a,"focusout",function(a){PN(a,b)&&c()})},xea=function(a,b,c){return E.bind(a,"blur",function(a){PN(a,b)&&c()})},yea=function(){var a=Y.detect();return a.browser.isFirefox()?vea:a.browser.isIE()?wea:xea}(),PN=function(a,b){var c=h.from(a.raw().relatedTarget).getOr(document.activeElement);return b(q.fromDom(c))},zea={register:function(a,b,
c,d){var e=E.bind(a,"focus",function(a){T.hasFocus(a.target())&&c()}),f=yea(a,function(c){return!Bc.closest(c,function(c){return L.eq(a,c)||L.eq(b(),c)||n.has(c,Zw.magicBox())})},d);return{destroy:function(){e.unbind();f.unbind()}}}},Kd={replace:function(a,b){var c=Z.deepMerge(b,{content:{inline:a}}),d=m.clone(a),e=mp(c),f=TW(e.element,a,d),h=Qn(f.toolbarHide,f.toolbarShow,!1),k=function(){var a=f.isVisible();h.on();!1===a&&e.activateInline()},n=function(){e.deactivateInline();h.off()},q=zea.register(a,
e.element,k,n),c=function(){T.active().each(function(b){L.eq(b,a)||n()})};c();e.events.connected.bind(c);e.events.loaded.bind(function(){e.content().getSelection().bind(k)});var r=e.focus,c={polish:Z.merge(e,{focus:function(){k();r()}}),restore:function(b){q.destroy();f.restore();ua.set(a,b);return a}};e.connect(ca.body());Jc.set(e,ua.get(a));return c}},Aea={attach:function(a,b,c,d){if(4!==arguments.length)throw"requires 4 parameters";var e=function(b){return function(){var c=q.fromTag("input");m.setAll(c,
{type:"hidden",name:b});a.append(c.dom());return function(a){c.val(a)}}},f=c.getOrThunk(e(b)),h=d.getOrThunk(e(b+"_styles"));return function(a){f(a.content);h(a.styles)}}},QN=function(a,b){var c=a.onsubmit,d=UW(a);a.onsubmit=function(e){if(d.inprogress())return!0;b(function(){c&&!1===c.apply(a)||setTimeout(d.submit,0)});return!1};return{unbind:function(){a.onsubmit=c}}},Bea={attachToFormSubmit:QN,attachToParentFormSubmit:function(a,b,c,d,e){if(5!==arguments.length)throw"requires 5 parameters";var f=
a.parents("form:first");if(0!==f.size()){var h=f.get(0),k=Aea.attach(f,b,d,e);QN(h,function(a){k(c());a()})}}},Dea=function(a,b,c,d){t.set(b,"display","none");var e=mp(yz.withOptions(b,d)),f=$.get(b);e.connect(a);Jc.set(e,f);var k=!0===d.autosubmit?Cea(b,e):h.none();return{polish:e,restore:function(d){k.each(function(a){a.unbind()});$.set(b,d);c.fold(function(){t.remove(b,"display")},function(a){t.set(b,"display",a)});B.remove(a);return b}}},Cea=function(a,b){return I.closest(a,"form").map(function(c){return Bea.attachToFormSubmit(c.dom(),
function(c){b.uploadImages(function(){$.set(a,Jc.get(b));c()})})})},WW={textarea:{replace:function(a,b){var c=t.getRaw(a,"display");return y.parent(a).fold(function(){return null},function(){var d=m.get(a,"id"),d=d?"ephox_"+d:Ma.generate("ephox"),e=q.fromTag("div");m.set(e,"id",d);t.copy(a,e);(b.content&&!0===b.content.autoresize?pY:oY)(a,e);v.before(a,e);return Dea(e,a,c,b)})}},div:LN,body:{replace:function(a,b){var c=Z.deepMerge(b,{platform:{fillscreen:!0}}),c=LN.takeover(a,c);return{polish:c.polish,
restore:c.restore}}}},XW={div:Kd,blockquote:Kd,article:Kd,aside:Kd,figure:Kd,figcaption:Kd,footer:Kd,header:Kd,nav:Kd,section:Kd},Cj=function(a){return{name:a.name,required:f.never,validate:a.validate}},Ik={bool:f.compose(Cj,V.bool),func:f.compose(Cj,V.func),number:f.compose(Cj,V.number),object:f.compose(Cj,V.object),string:f.compose(Cj,V.string)},qu=function(a){return H.error("ERROR: Textbox.io requires "+a+" or above")},ru=Y.detect().os,Dj=Y.detect().browser,RN="CSS1Compat"===document.compatMode||
document.doctype&&"html"===document.doctype.name,Eea={supported:function(){if(Dj.isIE()&&11>Dj.version.major)return qu("Internet Explorer 11");if(ru.isOSX()&&Dj.isSafari()&&9>Dj.version.major)return qu("Safari 9");if(ru.isiOS()&&9>ru.version.major)return qu("iOS 9");if(!RN&&Dj.isIE())return H.error("ERROR: Document is not in standards mode. Textbox.io requires standards mode on Internet Explorer.");RN||void 0===console.warn||console.warn("WARNING: Document is not in standards mode. Textbox.io may experience user interface issues.");
return H.value(void 0)}},SN=function(a){He.textboxio=a},Fea=f.compose(SN,function(a){a=f.die(a);return{replace:a,replaceAll:a,inline:a,inlineAll:a,get:a,getActiveEditor:a,definePlugin:a,version:su,isSupported:f.never}});(function(){var a=He.install;He.install=function(b,c){He.install=a;Eea.supported().fold(Fea,function(){var a=null===c||void 0===c?{onprem:!0}:c,a=null===b||void 0===b?a:Z.deepMerge(a,{resources:b});SN(YW(a));ay.speculate(a.resources)})}})()})();
install();
